<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://xsc062.netlify.app</id>
    <title> â€¢ Posts by &#34;ç‚¹åˆ†æ²»&#34; tag</title>
    <link href="https://xsc062.netlify.app" />
    <updated>2025-06-12T09:18:55.000Z</updated>
    <category term="å¹¶æŸ¥é›†" />
    <category term="æ–œç‡ä¼˜åŒ–" />
    <category term="æ‚¬çº¿æ³•" />
    <category term="å“ˆå¸Œ" />
    <category term="å­—å…¸æ ‘" />
    <category term="DP" />
    <category term="å•è°ƒé˜Ÿåˆ—" />
    <category term="åˆ†æ²»" />
    <category term="äºŒåˆ†å›¾" />
    <category term="CRT / exCRT" />
    <category term="æ’åˆ—ç»„åˆ" />
    <category term="ç½‘ç»œæµ" />
    <category term="è´¹ç”¨æµ" />
    <category term="äºŒåˆ†" />
    <category term="ä¸Šä¸‹ç•Œç½‘ç»œæµ" />
    <category term="å®¹æ–¥åŸç†" />
    <category term="çº¿æ®µæ ‘" />
    <category term="æ ‘çŠ¶æ•°ç»„" />
    <category term="åŒºé—´ DP" />
    <category term="æ„é€ " />
    <category term="Tarjan" />
    <category term="æ•°æ®ç»“æ„" />
    <category term="ä¸‹é¥­" />
    <category term="LCA" />
    <category term="å€å¢" />
    <category term="é¸½å·¢åŸç†" />
    <category term="æ¦‚ç‡æœŸæœ›" />
    <category term="è°ƒå’Œçº§æ•°" />
    <category term="å·®åˆ†" />
    <category term="æ€ç»´" />
    <category term="æ ‘å½¢ DP" />
    <category term="æœ€å°ç”Ÿæˆæ ‘" />
    <category term="SAM" />
    <category term="çŠ¶å‹" />
    <category term="åˆ†å—" />
    <category term="å¯æŒä¹…åŒ–" />
    <category term="ç¬›å¡å°”æ ‘" />
    <category term="é«˜ç»´å‰ç¼€å’Œ" />
    <category term="é—²è¯" />
    <category term="æ¬§æ‹‰å›è·¯" />
    <category term="æ ‘é“¾å‰–åˆ†" />
    <category term="é•¿é“¾å‰–åˆ†" />
    <category term="KMP" />
    <category term="border" />
    <category term="å­—ç¬¦ä¸²" />
    <category term="AC è‡ªåŠ¨æœº" />
    <category term="SA" />
    <category term="æ•°å­¦" />
    <category term="æ ‘ä¸Šå·®åˆ†" />
    <category term="FWT" />
    <category term="å †" />
    <category term="æ ‘çš„é‡å¿ƒ" />
    <category term="äºŒé¡¹å¼å®šç†" />
    <category term="äºŒé¡¹å¼åæ¼”" />
    <category term="è´ªå¿ƒ" />
    <category term="å‡æ‘Š" />
    <category term="è®¡æ•°" />
    <category term="ä¼˜åŒ–å»ºå›¾" />
    <category term="åæ‚”è´ªå¿ƒ" />
    <category term="è°ƒæ•´æ³•" />
    <category term="èƒŒåŒ…" />
    <category term="åšå¼ˆè®º" />
    <category term="DP ä¼˜åŒ–" />
    <category term="è™šæ ‘" />
    <category term="ç‚¹åˆ†æ²»" />
    <category term="WQS äºŒåˆ†" />
    <category term="é—µå¯å¤«æ–¯åŸºå’Œ" />
    <category term="slope trick" />
    <category term="å››è¾¹å½¢ä¸ç­‰å¼" />
    <category term="æš´åŠ›" />
    <category term="çŠ¶å‹ DP" />
    <category term="ç»„åˆæ•°å­¦" />
    <category term="æ”¯é…å¯¹" />
    <category term="DDP" />
    <category term="å¹³è¡¡æ ‘" />
    <category term="å®¹æ–¥" />
    <category term="çŒ«æ ‘" />
    <category term="Kruskal é‡æ„æ ‘" />
    <category term="æè¶…çº¿æ®µæ ‘" />
    <entry>
        <id>https://xsc062.netlify.app/20250612/</id>
        <title>ç‚¹åˆ†æ²»</title>
        <link rel="alternate" href="https://xsc062.netlify.app/20250612/"/>
        <content type="html">&lt;p&gt;ä¸€æ—¶å…´èµ·åœ¨åšå®¢é‡Œæœç´¢ã€ç‚¹åˆ†æ²»ã€ï¼Œå‘ç°æ²¡æœ‰åŒ¹é…é¡¹ã€‚&lt;/p&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;å®šä¹‰&#34;&gt;å®šä¹‰&lt;/h2&gt;
&lt;p&gt;é€‚ç”¨äºè§£å†³å’Œç‚¹å¯¹ã€è·¯å¾„ç›¸å…³çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºä»»æ„ç‚¹ &lt;span class=&#34;math inline&#34;&gt;\(x\)&lt;/span&gt;ï¼Œæ ‘ä¸Šä»»æ„ç®€å•è·¯å¾„ &lt;span class=&#34;math inline&#34;&gt;\((u,v)\)&lt;/span&gt; è¢«åˆ†ä¸ºå‡ ç±»ï¼š&lt;/p&gt;
&lt;ol type=&#34;1&#34;&gt;
&lt;li&gt;ä¸ç»è¿‡ &lt;span class=&#34;math inline&#34;&gt;\(x\)&lt;/span&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç»è¿‡ &lt;span class=&#34;math inline&#34;&gt;\(x\)&lt;/span&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªç«¯ç‚¹ä¸º &lt;span class=&#34;math inline&#34;&gt;\(x\)&lt;/span&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¸¤ä¸ªç«¯ç‚¹éƒ½ä¸ä¸º &lt;span class=&#34;math inline&#34;&gt;\(x\)&lt;/span&gt;ï¼šå¯ä»¥ç”±ä¸Šä¸€ç§æƒ…å†µæ‹¼æ¥å¾—åˆ°ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬æŠŠæ¯ä¸ªç‚¹ä½œä¸º &lt;span class=&#34;math inline&#34;&gt;\(x\)&lt;/span&gt; çš„æƒ…å†µéƒ½æšä¸¾ä¸€éï¼Œå†ç»Ÿè®¡ä¸é‡å¤çš„ &lt;span class=&#34;math inline&#34;&gt;\((u,v)\)&lt;/span&gt;ï¼Œåœ¨ä¸€ç§ç‰¹å®šçš„æšä¸¾é¡ºåºä¸‹å¯ä»¥åšåˆ° &lt;span class=&#34;math inline&#34;&gt;\(O(n\log n)\)&lt;/span&gt; å®Œæˆæ‰€æœ‰ç‚¹å¯¹çš„æšä¸¾ã€‚&lt;/p&gt;
&lt;p&gt;è¯æ˜ç•¥ï¼Œæ¯æ¬¡å–å­æ ‘é‡å¿ƒï¼Œåªéå†æ²¡éå†è¿‡çš„ç‚¹å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºå­æ ‘é‡å¿ƒï¼Œä¸€åˆ™é˜…è¯»ææ–™ï¼š&lt;a href=&#34;https://liu-cheng-ao.blog.uoj.ac/blog/2969&#34;&gt;ä¸€ç§åŸºäºé”™è¯¯çš„å¯»æ‰¾é‡å¿ƒæ–¹æ³•çš„ç‚¹åˆ†æ²»çš„å¤æ‚åº¦åˆ†æ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;cf1575e-eye-pleasing-city-park-tour&#34;&gt;CF1575E Eye-Pleasing City Park Tour&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://codeforces.com/problemset/problem/1575/E&#34; class=&#34;uri&#34;&gt;https://codeforces.com/problemset/problem/1575/E&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;éšä¾¿ç”¨çº¿æ®µæ ‘ç»´æŠ¤ä¸€ä¸‹å°±è¡Œäº†ã€‚å¤æ‚åº¦ &lt;span class=&#34;math inline&#34;&gt;\(O(n\log^2 n)\)&lt;/span&gt;ã€‚&lt;/p&gt;
&lt;details&gt;
&lt;p&gt;éšä¾¿ç»´æŠ¤ä¸€ä¸‹ &lt;img src=&#34;/em/ll.gif&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;cpp&#34;&gt;&lt;code&gt;#include &amp;lt;bits/stdc++.h&amp;gt;
const int mod = 1e9 + 7;
int main() &amp;#123;
#ifdef ONLINE_JUDGE
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr), std::cout.tie(nullptr);
#else
    std::freopen(&amp;quot;.in&amp;quot;, &amp;quot;r&amp;quot;, stdin);
    std::freopen(&amp;quot;.out&amp;quot;, &amp;quot;w&amp;quot;, stdout);
#endif
    int n, k;
    std::cin &amp;gt;&amp;gt; n &amp;gt;&amp;gt; k;
    std::vector&amp;lt;int&amp;gt; a(n + 1);
    for (int i = 1; i &amp;lt;= n; ++i)
        std::cin &amp;gt;&amp;gt; a[i];
    std::vector&amp;lt;std::vector&amp;lt;std::pair&amp;lt;int, int&amp;gt; &amp;gt; &amp;gt; g(n + 1);
    for (int i = 1, x, y, c; i &amp;lt; n; ++i) &amp;#123;
        std::cin &amp;gt;&amp;gt; x &amp;gt;&amp;gt; y &amp;gt;&amp;gt; c;
        g[x].emplace_back(y, c), g[y].emplace_back(x, c);
    &amp;#125;
    std::vector&amp;lt;std::vector&amp;lt;std::pair&amp;lt;int, long long&amp;gt; &amp;gt; &amp;gt; bit(2, std::vector&amp;lt;std::pair&amp;lt;int, long long&amp;gt; &amp;gt; (n + 1));
    auto lowbit = [&amp;amp;](int x) &amp;#123;
        return x &amp;amp; -x;
    &amp;#125;;
    auto add = [&amp;amp;](int id, int x, long long v, int type) &amp;#123;
        for (++x; x &amp;lt;= n; x += lowbit(x))
            bit[id][x].first += type, (bit[id][x].second += v * type) %= mod;
        return;
    &amp;#125;;
    auto ask = [&amp;amp;](int id, int x) &amp;#123;
        std::pair&amp;lt;int, long long&amp;gt; res;
        for (++x; x; x -= lowbit(x))
            res.first += bit[id][x].first, (res.second += bit[id][x].second) %= mod;
        return res;
    &amp;#125;;
    std::vector&amp;lt;int&amp;gt; p, siz(n + 1), mx(n + 1), tag(n + 1);
    std::function&amp;lt;void(int, int)&amp;gt; findp = [&amp;amp;](int x, int fa) &amp;#123;
        p.push_back(x);
        siz[x] = 1, mx[x] = 0;
        for (auto [i, c] : g[x])
            if (i != fa &amp;amp;&amp;amp; !tag[i]) &amp;#123;
                findp(i, x);
                siz[x] += siz[i];
                mx[x] = std::max(mx[x], siz[i]);
            &amp;#125;
        return;
    &amp;#125;;
    auto findrt = [&amp;amp;](int x) &amp;#123;
        std::vector&amp;lt;int&amp;gt;().swap(p), findp(x, -1);
        int n = (int)p.size();
        for (auto i : p)
            if (mx[i] &amp;lt;= n / 2 &amp;amp;&amp;amp; n - siz[i] &amp;lt;= n / 2)
                return i;
        return -1;
    &amp;#125;;
    auto res(0ll);
    std::function&amp;lt;void(int, int, int, int, int, long long, int, int)&amp;gt; calc = [&amp;amp;](int x, int fa, int oc, int la, int cnt, long long s, int os, int type) &amp;#123;
        if (cnt &amp;gt; k)
            return;
        if (type == 0) &amp;#123;
            auto t0(ask(oc, k - cnt)), t1(ask(!oc, k - cnt - 1));
            // auto lr(res);
            (res += t0.first * (s - os) + t0.second) %= mod;
            (res += t1.first * (s - os) + t1.second) %= mod;
            // printf(&amp;quot;  %d(%d, %lld): ask[0](%d) = (%d, %lld), ask[1](%d) = (%d, %lld), res += %lld\n&amp;quot;, x, cnt, s - os, k - cnt, t0.first, t0.second, k - cnt - 1, t1.first, t1.second, res - lr);
        &amp;#125;
        else if (type != 0) &amp;#123;
            // printf(&amp;quot;  %d(%d, %lld): add(%d, %lld)\n&amp;quot;, x, cnt, s - os, oc, s * type);
            add(oc, cnt, s, type);
        &amp;#125;
        for (auto [i, c] : g[x])
            if (i != fa &amp;amp;&amp;amp; !tag[i])
                calc(i, x, oc, c, cnt + (la != c), (s + a[i]) % mod, os, type);
        return;
    &amp;#125;;
    std::function&amp;lt;void(int)&amp;gt; DFS = [&amp;amp;](int x) &amp;#123;
        x = findrt(x);
        // printf(&amp;quot;DFS %d\n&amp;quot;, x);
        for (auto [i, c] : g[x])
            if (!tag[i]) &amp;#123;
                calc(i, x, c, c, 0, (a[x] + a[i]) % mod, a[x], 0);
                calc(i, x, c, c, 0, (a[x] + a[i]) % mod, a[x], 1);
            &amp;#125;
        (res += ask(0, k).second + ask(1, k).second) %= mod;
        (res += a[x]) %= mod;
        // printf(&amp;quot;res += %lld + %lld\n&amp;quot;, ask(0, k).second, ask(1, k).second);
        for (auto [i, c] : g[x])
            if (!tag[i])
                calc(i, x, c, c, 0, (a[x] + a[i]) % mod, a[x], -1);
        // assert(!ask(0, k).second);
        tag[x] = 1;
        for (auto [i, c] : g[x])
            if (!tag[i])
                DFS(i);
        return;
    &amp;#125;;
    DFS(1);
    std::cout &amp;lt;&amp;lt; (res + mod) % mod &amp;lt;&amp;lt; &amp;#39;\n&amp;#39;;
    return 0;
&amp;#125;&lt;/code&gt;&lt;/pre&gt;
&lt;/details&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;a---ä¸‰å…ƒå›¾-graf&#34;&gt;A - ä¸‰å…ƒå›¾ Graf&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://www.luogu.com.cn/problem/P10829&#34; class=&#34;uri&#34;&gt;https://www.luogu.com.cn/problem/P10829&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å‘ç°å¾ˆåœ†æ–¹æ ‘ï¼›è§‚å¯Ÿé¢˜å›¾ï¼Œè‚¯å®šæƒ³è¦æŠŠä¸­é—´çš„æ–¹ç‚¹ä½œä¸ºæ ‘æ ¹ã€‚&lt;/p&gt;
&lt;p&gt;å‘ç°å®ƒå°±æ˜¯é‡å¿ƒï¼›è¿›ä¸€æ­¥åœ°ï¼Œæ•´ä¸ªåœ†æ–¹æ ‘å…¶å®æ˜¯ä¸€ä¸ªç‚¹åˆ†æ²»çš„ç»“æ„ã€‚æ˜¾ç„¶é™¤äº†æœ€åä¸€å±‚ï¼Œæ¯æ¬¡æ‰¾åˆ°çš„é‡å¿ƒéƒ½åº”è¯¥æ˜¯æ–¹ç‚¹ï¼›å¹¶ä¸”å…¶åº”è¯¥æœ‰ä¸‰ä¸ªç­‰å¤§çš„å„¿å­ã€‚check ä¸Šè¿°ä¸¤ç‚¹å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å”‰è¿˜æ˜¯æŒºå¸¸è§„çš„ï¼Œé™åˆ¶æˆ‘åšå‡ºæ¥è¿™é“é¢˜çš„åº”è¯¥æ˜¯æˆ‘å·²ç» &amp;gt; 1y æ²¡å†™è¿‡è¿é€šæ€§é—®é¢˜äº† ğŸ˜…&lt;/p&gt;
&lt;details&gt;
&lt;p&gt;æ€ä¹ˆè¿˜æœ‰äººä¸ä¼šåˆ¤é‡è¾¹çš„ ğŸ˜…&lt;/p&gt;
&lt;pre class=&#34;cpp&#34;&gt;&lt;code&gt;#include &amp;lt;bits/stdc++.h&amp;gt;
int main() &amp;#123;
#ifdef ONLINE_JUDGE
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr), std::cout.tie(nullptr);
#else
    std::freopen(&amp;quot;.in&amp;quot;, &amp;quot;r&amp;quot;, stdin);
    std::freopen(&amp;quot;.out&amp;quot;, &amp;quot;w&amp;quot;, stdout);
#endif
    int n, m;
    std::cin &amp;gt;&amp;gt; n &amp;gt;&amp;gt; m;
    std::vector&amp;lt;std::vector&amp;lt;int&amp;gt; &amp;gt; g(n + 1), _g(n + 1);
    auto nosol = [](void) &amp;#123;
        std::cout &amp;lt;&amp;lt; &amp;quot;ne&amp;quot; &amp;lt;&amp;lt; &amp;#39;\n&amp;#39;;
        exit(0);
        return;
    &amp;#125;;
    std::set&amp;lt;std::pair&amp;lt;int, int&amp;gt; &amp;gt; t;
    for (int x, y; m--; ) &amp;#123;
        std::cin &amp;gt;&amp;gt; x &amp;gt;&amp;gt; y;
        if (x == y || t.count(&amp;#123; x, y &amp;#125;))
            nosol();
        t.insert(&amp;#123; x, y &amp;#125;), t.insert(&amp;#123; y, x &amp;#125;);
        _g[x].push_back(y), _g[y].push_back(x);
    &amp;#125;
    std::vector&amp;lt;int&amp;gt; st, dfn(n + 1), low(n + 1);
    std::function&amp;lt;void(int, int)&amp;gt; DFS = [&amp;amp;](int x, int fa) &amp;#123;
        static int now = 0;
        st.push_back(x);
        dfn[x] = low[x] = ++now;
        for (auto i : _g[x])
            if (!dfn[i]) &amp;#123;
                DFS(i, x);
                low[x] = std::min(low[x], low[i]);
                if (low[i] &amp;gt;= dfn[x]) &amp;#123;
                    ++n, g.emplace_back();
                    for (int p = st.back(); ; p = st.back()) &amp;#123;
                        g[n].push_back(p), g[p].push_back(n);
                        st.pop_back();
                        if (p == i)
                            break;
                    &amp;#125;
                    g[n].push_back(x), g[x].push_back(n);
                &amp;#125;
            &amp;#125;
            else if (i != fa)
                low[x] = std::min(low[x], dfn[i]);
        return;
    &amp;#125;;
    int n1 = n;
    DFS(1, -1);
    std::vector&amp;lt;int&amp;gt; siz(n + 1), p, mx(n + 1), tag(n + 1);
    DFS = [&amp;amp;](int x, int fa) &amp;#123;
        siz[x] = 1, mx[x] = 0;
        p.push_back(x);
        for (auto i : g[x])
            if (i != fa &amp;amp;&amp;amp; !tag[i]) &amp;#123;
                DFS(i, x);
                siz[x] += siz[i];
                mx[x] = std::max(mx[x], siz[i]);
            &amp;#125;
        return;
    &amp;#125;;
    auto findrt = [&amp;amp;](int x) &amp;#123;
        p.clear(), DFS(x, -1);
        int n = (int)p.size();
        for (auto i : p)
            if (mx[i] &amp;lt;= n / 2 &amp;amp;&amp;amp; n - siz[i] &amp;lt;= n / 2)
                return i;
        return -1;
    &amp;#125;;
    std::function&amp;lt;void(int)&amp;gt; DFS1 = [&amp;amp;](int x) &amp;#123;
        x = findrt(x), DFS(x, -1);
        int si = -1, cnt = 0;
        if (siz[x] == 1) &amp;#123;
            if (x &amp;gt; n1)
                nosol();
            return;
        &amp;#125;
        if (x &amp;lt;= n1)
            nosol();
        for (auto i : g[x])
            if (!tag[i]) &amp;#123;
                ++cnt;
                if (~si &amp;amp;&amp;amp; si != siz[i])
                    nosol();
                if (si == -1)
                    si = siz[i];
            &amp;#125;
        if (cnt != 3)
            nosol();
        tag[x] = 1;
        for (auto i : g[x])
            if (!tag[i])
                DFS1(i);
        return;
    &amp;#125;; 
    DFS1(1);
    std::cout &amp;lt;&amp;lt; &amp;quot;da&amp;quot; &amp;lt;&amp;lt; &amp;#39;\n&amp;#39;;
    return 0;
&amp;#125;&lt;/code&gt;&lt;/pre&gt;
&lt;/details&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;b---distance-on-triangulation&#34;&gt;B - Distance on Triangulation&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://www.luogu.com.cn/problem/P6976&#34; class=&#34;uri&#34;&gt;https://www.luogu.com.cn/problem/P6976&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¼—ï¼ˆé™¤äº†æˆ‘ï¼‰æ‰€å‘¨çŸ¥ &lt;a href=&#34;/20231117/#ç»å…¸å»ºæ¨¡&#34;&gt;å‡¸å¤šè¾¹å½¢çš„ä¸‰è§’å‰–åˆ†å¯ä»¥è½¬åŒ–ä¸ºæ ‘ä¸Šé—®é¢˜&lt;/a&gt;ï¼Œæ•…æŠŠæ ‘å»ºå‡ºæ¥ï¼›ä¸€ä¸ªé‡è¦çš„ç‚¹æ˜¯è¦è®¤è¯†åˆ°è¿™ä¸ªæ ‘çš„æ„ä¹‰ã€‚æ ‘ä¸Šçš„ç‚¹å…¶å®æ˜¯æ²¡ä»€ä¹ˆç‰©ç†å«ä¹‰çš„ï¼›ç»è¿‡äº†æŸä¸€ä¸ªæ ‘ä¸Šçš„ç‚¹å’Œç»è¿‡äº†ä¸‰è§’å½¢ä¸Šçš„ä»»ä¸€ç‚¹æ˜¯ç­‰ä»·çš„ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œæƒ³è¦ä»æŸä¸ªç‚¹èµ°åˆ°å¦ä¸€ä¸ªç‚¹ï¼Œè‚¯å®šè¦ç»è¿‡å¯¹åº”çš„æ ‘ä¸Šè·¯å¾„ï¼Œä½†è¿™ä¸èƒ½ååº”å®é™…è·ç¦»ä»€ä¹ˆçš„ï¼Œåªæ˜¯èƒ½è·å–è·¯å¾„å¯èƒ½åŒ…å«çš„ç‚¹å’Œå¿…é¡»åŒ…å«çš„ç‚¹ï¼ˆçš„è¶…é›†ï¼‰ï¼Œå…·ä½“è¿˜æ˜¯è¦æœ€çŸ­è·¯ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ç€è½¬åŒ–ä¸ºç‚¹åˆ†æ²»ã€‚ä½†å…¶å®è¿™é‡Œçš„ç‚¹åˆ†æ²»æœ‰ç‚¹åƒåºåˆ—åˆ†æ²»ï¼šå…ˆè·‘ä¸€éæ ¹èŠ‚ç‚¹ï¼ˆä¸‰ä¸ªï¼‰åœ¨å½“å‰åˆ†æ²»èŒƒå›´å†…çš„æœ€çŸ­è·¯ï¼Œç„¶åå¤„ç†ç»è¿‡äº†è¿™ä¸ªç‚¹çš„è¯¢é—®ï¼Œç„¶åé€’å½’ã€‚å®¹æ˜“å‘ç°ä¸‰ä¸ªç‚¹é‡Œæœ‰ä¸€äº›ä¹‹å‰è¢«ç®—è¿‡äº†ï¼Œä¸”ä¸€å®šåŒ…å«äº†è¿™ä¸ªåˆ†æ²»èŒƒå›´ï¼Œç›´æ¥è·³è¿‡å°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„è¯¢é—®è¦å†™æˆæ•´ä½“äºŒåˆ†é‚£ç§åŠ¨æ€ä¸‹ä¼ çš„å½¢å¼ï¼ŒåªæŠŠè¢«æŸä¸ªå­æ ‘å®Œå…¨åŒ…å«çš„è¯¢é—®ä¼ ä¸‹å»ï¼›ä¸ç„¶å¤æ‚åº¦æ˜¯é”™çš„ã€‚ä»¥åŠè¿™æ ·å°±å¯ä»¥å‰ªæï¼šå‘ç°è¯¢é—®æ•°ç»„ç©ºäº†å°±å¯ä»¥åœäº†ã€‚ç›´æ¥ TLE to 200ms äº† ğŸ˜…&lt;/p&gt;
&lt;details&gt;
&lt;pre class=&#34;cpp&#34;&gt;&lt;code&gt;#include &amp;lt;bits/stdc++.h&amp;gt;
int main() &amp;#123;
#ifdef ONLINE_JUDGE
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr), std::cout.tie(nullptr);
#else
    std::freopen(&amp;quot;.in&amp;quot;, &amp;quot;r&amp;quot;, stdin);
    std::freopen(&amp;quot;.out&amp;quot;, &amp;quot;w&amp;quot;, stdout);
#endif
    int n;
    std::cin &amp;gt;&amp;gt; n;
    std::vector&amp;lt;int&amp;gt; deg(n + 1);
    std::vector&amp;lt;std::vector&amp;lt;int&amp;gt; &amp;gt; _g(n + 1), g(n + 1);
    for (int i = 1; i &amp;lt; n; ++i) &amp;#123;
        _g[i].push_back(i + 1), _g[i + 1].push_back(i);
        ++deg[i], ++deg[i + 1];
    &amp;#125;
    _g[1].push_back(n), _g[n].push_back(1);
    ++deg[1], ++deg[n];
    for (int i = 1, x, y; i &amp;lt;= n - 3; ++i) &amp;#123;
        std::cin &amp;gt;&amp;gt; x &amp;gt;&amp;gt; y;
        _g[x].push_back(y), _g[y].push_back(x);
        ++deg[x], ++deg[y];
    &amp;#125;
    int cnt = 0;
    std::vector&amp;lt;std::vector&amp;lt;int&amp;gt; &amp;gt; t(1);
    &amp;#123;
        std::queue&amp;lt;int&amp;gt; q;
        std::vector&amp;lt;int&amp;gt; inq(n + 1);
        for (int i = 1; i &amp;lt;= n; ++i)
            if (deg[i] == 2)
                q.push(i);
        std::map&amp;lt;std::pair&amp;lt;int, int&amp;gt;, int&amp;gt; st;
        for (; !q.empty(); ) &amp;#123;
            int x = q.front();
            q.pop(), inq[x] = 1;
            if (deg[x] == 2) &amp;#123;
                ++cnt, t.push_back(&amp;#123; x &amp;#125;);
                for (auto i : _g[x])
                    if (!inq[i]) &amp;#123;
                        t[cnt].push_back(i);
                    &amp;#125;
                std::sort(t[cnt].begin(), t[cnt].end());
                for (int a = 0; a &amp;lt; 2; ++a)
                    for (int b = a + 1; b &amp;lt; 3; ++b) &amp;#123;
                        std::pair&amp;lt;int, int&amp;gt; now(t[cnt][a], t[cnt][b]);
                        if (st.count(now)) &amp;#123;
                            int to = st[now];
                            // printf(&amp;quot;add %d &amp;lt;-&amp;gt; %d\n&amp;quot;, to, cnt);
                            g[cnt].push_back(to), g[to].push_back(cnt);
                        &amp;#125;
                        else
                            st[now] = cnt;
                    &amp;#125;
            &amp;#125;
            for (auto i : _g[x])
                if (--deg[i] == 2)
                    q.push(i);
        &amp;#125;
    &amp;#125;
    int q;
    std::cin &amp;gt;&amp;gt; q;
    std::vector&amp;lt;int&amp;gt; res(q + 1, 0x3f3f3f3f);
    std::vector&amp;lt;std::tuple&amp;lt;int, int, int&amp;gt; &amp;gt; u(q);
    for (int i = 1, x, y; i &amp;lt;= q; ++i)
        std::cin &amp;gt;&amp;gt; x &amp;gt;&amp;gt; y, u[i - 1] = &amp;#123; x, y, i &amp;#125;;
    int tik = 0;
    std::vector&amp;lt;int&amp;gt; siz(cnt + 1), mx(cnt + 1), p, now(n + 1), p1;
    std::vector&amp;lt;int&amp;gt; dis(n + 1), tag(n + 1), vis(n + 1), faa(n + 1);
    std::function&amp;lt;void(int, int)&amp;gt; DFS1 = [&amp;amp;](int x, int fa) &amp;#123;
        siz[x] = 1, mx[x] = 0;
        p.push_back(x);
        for (auto i : t[x])
            now[i] = tik, p1.push_back(i);
        for (auto i : g[x])
            if (i != fa &amp;amp;&amp;amp; !tag[i]) &amp;#123;
                DFS1(i, x);
                siz[x] += siz[i];
                mx[x] = std::max(mx[x], siz[i]);
            &amp;#125;
        return;
    &amp;#125;;
    auto findrt = [&amp;amp;](int x) &amp;#123;
        p.clear(), p1.clear(), DFS1(x, -1);
        int n = (int)p.size();
        for (auto i : p)
            if (mx[i] &amp;lt;= n / 2 &amp;amp;&amp;amp; n - siz[i] &amp;lt;= n / 2)
                return i;
        return -1;
    &amp;#125;;
    auto BFS = [&amp;amp;](int x) &amp;#123;
        std::queue&amp;lt;int&amp;gt; q;
        for (auto i : p1)
            dis[i] = 0x3f3f3f3f;
        q.push(x), dis[x] = 0;
        for (; !q.empty(); ) &amp;#123;
            int x = q.front();
            q.pop();
            for (auto i : _g[x])
                if (dis[i] == 0x3f3f3f3f &amp;amp;&amp;amp; now[i] == tik)
                    dis[i] = dis[x] + 1, q.push(i);
        &amp;#125;
        return;
    &amp;#125;;
    std::function&amp;lt;void(int, int, int)&amp;gt; calc = [&amp;amp;](int x, int fa, int rt) &amp;#123;
        for (auto i : t[x])
            faa[i] = rt;
        for (auto i : g[x])
            if (i != fa &amp;amp;&amp;amp; !tag[i])
                calc(i, x, rt);
        return;
    &amp;#125;;
    std::vector&amp;lt;std::vector&amp;lt;std::tuple&amp;lt;int, int, int&amp;gt; &amp;gt; &amp;gt; tmp(n + 1);
    std::function&amp;lt;void(int, std::vector&amp;lt;std::tuple&amp;lt;int, int, int&amp;gt; &amp;gt;)&amp;gt; DFS = [&amp;amp;](int x, std::vector&amp;lt;std::tuple&amp;lt;int, int, int&amp;gt; &amp;gt; q) &amp;#123;
        if (q.empty())
            return;
        ++tik, x = findrt(x);
        for (auto i : g[x])
            calc(i, x, i);
        for (auto k : t[x])
            if (!vis[k]) &amp;#123;
                vis[k] = 1, BFS(k);
                for (auto [u, v, id] : q)
                    res[id] = std::min(res[id], dis[u] + dis[v]);
            &amp;#125;
        for (auto [u, v, id] : q)
            if (faa[u] == faa[v])
                tmp[faa[u]].emplace_back(u, v, id);
        std::vector&amp;lt;std::tuple&amp;lt;int, int, int&amp;gt; &amp;gt;().swap(q);
        tag[x] = 1;
        for (auto i : g[x])
            if (!tag[i])
                DFS(i, std::move(tmp[i]));
        return;
    &amp;#125;;
    DFS(1, std::move(u));
    for (int i = 1; i &amp;lt;= q; ++i)
        std::cout &amp;lt;&amp;lt; res[i] &amp;lt;&amp;lt; &amp;#39;\n&amp;#39;;
    return 0;
&amp;#125;&lt;/code&gt;&lt;/pre&gt;
&lt;/details&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;c---shopping&#34;&gt;C - Shopping&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://www.luogu.com.cn/problem/P6326&#34; class=&#34;uri&#34;&gt;https://www.luogu.com.cn/problem/P6326&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ„è¯†åˆ°è¿é€šå— DP ä¹Ÿæ˜¯å¯ä»¥æ”¾åœ¨ç‚¹åˆ†ä¸Šåšçš„ï¼Œä»¤ &lt;span class=&#34;math inline&#34;&gt;\(f_{u,i}\)&lt;/span&gt; è¡¨ç¤ºåœ¨ï¼ˆç‚¹åˆ†æ—¶çš„ï¼‰å­æ ‘ &lt;span class=&#34;math inline&#34;&gt;\(u\)&lt;/span&gt; ä¸­ï¼Œ&lt;span class=&#34;math inline&#34;&gt;\(u\)&lt;/span&gt; é€‰äº†è‡³å°‘ä¸€ä¸ªï¼Œå…±ç”¨äº† &lt;span class=&#34;math inline&#34;&gt;\(i\)&lt;/span&gt; ä½“ç§¯çš„æœ€å¤§ä»·å€¼ã€‚å‰©ä¸‹å°±æ˜¯ä¸€ä¸ªæ ‘ä¸Šçš„å¤šé‡ + 01 èƒŒåŒ…ï¼›å‘ç°è¿™ä¸ª 01 èƒŒåŒ…ä¸æ»¡è¶³å¯ä»¥ä¼˜åŒ–çš„å½¢å¼ï¼Œæ‰€ä»¥è€ƒè™‘æ ‘ä¸ŠèƒŒåŒ…åºåˆ—åŒ–ï¼Œè½¬æ¢æˆåºåˆ—ä¸Šå¤šé‡èƒŒåŒ…é—®é¢˜ï¼›ä¸çŸ¥é“çœŸå®æ•°æ®å¼ºåº¦ï¼Œä½†æˆ‘è®¤ä¸ºåº”è¯¥ç”¨ &lt;a href=&#34;/20250707-1/#ä¾‹å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–å¤šé‡èƒŒåŒ…&#34;&gt;å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–å¤šé‡èƒŒåŒ…&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„æ ‘èƒŒåŒ…åºåˆ—åŒ–çš„ç»†èŠ‚å…¶å®æ˜¯æœ‰ç‚¹å¤šçš„ã€‚å¯èƒ½éœ€è¦ä¸€äº›é‚ªæ€ã€‚&lt;/p&gt;
&lt;details&gt;
&lt;pre class=&#34;cpp&#34;&gt;&lt;code&gt;#include &amp;lt;bits/stdc++.h&amp;gt;
const int inf = 0x3f3f3f3f;
int main() &amp;#123;
#ifdef ONLINE_JUDGE
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr), std::cout.tie(nullptr);
#else
    std::freopen(&amp;quot;.in&amp;quot;, &amp;quot;r&amp;quot;, stdin);
    std::freopen(&amp;quot;.out&amp;quot;, &amp;quot;w&amp;quot;, stdout);
#endif
    int T;
    for (std::cin &amp;gt;&amp;gt; T; T--; ) &amp;#123;
        int n, m;
        std::cin &amp;gt;&amp;gt; n &amp;gt;&amp;gt; m;
        std::vector&amp;lt;std::vector&amp;lt;int&amp;gt; &amp;gt; g(n + 1);
        std::vector&amp;lt;int&amp;gt; v(n + 1), w(n + 1), c(n + 1);
        for (int i = 1; i &amp;lt;= n; ++i)
            std::cin &amp;gt;&amp;gt; w[i];
        for (int i = 1; i &amp;lt;= n; ++i)
            std::cin &amp;gt;&amp;gt; v[i];
        for (int i = 1; i &amp;lt;= n; ++i)
            std::cin &amp;gt;&amp;gt; c[i];
        for (int i = 1, x, y; i &amp;lt; n; ++i) &amp;#123;
            std::cin &amp;gt;&amp;gt; x &amp;gt;&amp;gt; y;
            g[x].push_back(y), g[y].push_back(x);
        &amp;#125;
        std::vector&amp;lt;int&amp;gt; siz(n + 1), mx(n + 1), tag(n + 1), p;
        std::function&amp;lt;void(int, int)&amp;gt; DFS1 = [&amp;amp;](int x, int fa) &amp;#123;
            p.push_back(x);
            siz[x] = 1, mx[x] = 0;
            for (auto i : g[x])
                if (i != fa &amp;amp;&amp;amp; !tag[i]) &amp;#123;
                    DFS1(i, x);
                    siz[x] += siz[i];
                    mx[x] = std::max(mx[x], siz[i]);
                &amp;#125;
            return;
        &amp;#125;;
        int now = 0;
        std::vector&amp;lt;int&amp;gt; nex(n + 1), tab(n + 1);
        auto findrt = [&amp;amp;](int x) &amp;#123;
            p.clear(), DFS1(x, -1);
            int n = (int)p.size();
            for (auto i : p)
                if (mx[i] &amp;lt;= n / 2 &amp;amp;&amp;amp; n - siz[i] &amp;lt;= n / 2)
                    return i;
            assert(0);
            return -1;
        &amp;#125;;
        std::function&amp;lt;void(int, int)&amp;gt; DFS2 = [&amp;amp;](int x, int fa) &amp;#123;
            tab[++now] = x;
            for (auto i : g[x])
                if (i != fa &amp;amp;&amp;amp; !tag[i])
                    DFS2(i, x);
            nex[x] = now;
            return;
        &amp;#125;;
        int res = -inf;
        std::function&amp;lt;void(int)&amp;gt; DFS = [&amp;amp;](int x) &amp;#123;
            x = findrt(x), now = 0, DFS2(x, -1);
            std::vector&amp;lt;std::vector&amp;lt;int&amp;gt; &amp;gt; f(now + 1, std::vector&amp;lt;int&amp;gt; (m + 1, -inf));
            for (int i = 1; i &amp;lt;= c[x] &amp;amp;&amp;amp; i * v[x] &amp;lt;= m; ++i)
                f[1][i * v[x]] = i * w[x];
            for (int i = 1; i &amp;lt; now; ++i) &amp;#123;
                int V = v[tab[i + 1]], W = w[tab[i + 1]], C = c[tab[i + 1]];
                for (int b = 0; b &amp;lt; V; ++b) &amp;#123;
                    std::vector&amp;lt;int&amp;gt; q;
                    int h = 0, t = -1;
                    for (int a = 0; a * V + b &amp;lt;= m; ++a) &amp;#123;
                        for (; h &amp;lt;= t &amp;amp;&amp;amp; a - q[h] &amp;gt; C; ++h);
                        if (h &amp;lt;= t &amp;amp;&amp;amp; f[i][q[h] * V + b] != -inf)
                            f[i + 1][a * V + b] = std::max(f[i + 1][a * V + b], f[i][q[h] * V + b] + (a - q[h]) * W);
                        for (; h &amp;lt;= t &amp;amp;&amp;amp; f[i][a * V + b] - a * W &amp;gt;= f[i][q[t] * V + b] - q[t] * W; --t);
                        q.resize(++t + 1), q[t] = a;
                    &amp;#125;
                &amp;#125;
                int to = nex[tab[i + 1]];
                for (int j = 0; j &amp;lt;= m; ++j)
                    f[to][j] = std::max(f[to][j], f[i][j]);
            &amp;#125;
            res = std::max(res, *std::max_element(f[now].begin(), f[now].end()));
            std::vector&amp;lt;std::vector&amp;lt;int&amp;gt; &amp;gt;().swap(f);
            tag[x] = 1;
            for (auto i : g[x])
                if (!tag[i])
                    DFS(i);
            return;
        &amp;#125;;
        DFS(1);
        std::cout &amp;lt;&amp;lt; res &amp;lt;&amp;lt; &amp;#39;\n&amp;#39;;
    &amp;#125;
    return 0;
&amp;#125;&lt;/code&gt;&lt;/pre&gt;
&lt;/details&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;d---åŠ æ²¹ç«™&#34;&gt;D - åŠ æ²¹ç«™&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://www.luogu.com.cn/problem/P10805&#34; class=&#34;uri&#34;&gt;https://www.luogu.com.cn/problem/P10805&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç‚¹åˆ†æ²»ååˆ†ä¸º &lt;span class=&#34;math inline&#34;&gt;\(u\to rt\)&lt;/span&gt; å’Œ &lt;span class=&#34;math inline&#34;&gt;\(rt\to v\)&lt;/span&gt; ä¸¤ä¸ªéƒ¨åˆ†è€ƒè™‘ã€‚å‰è€…åªéœ€è¦å€å¢æ‰¾åˆ°ç¬¬ä¸€æ¬¡åŠ æ²¹çš„ç‚¹å³å¯ï¼›åè€…éœ€è¦å¯¹äºæ¯ä¸ªç‚¹ä½œä¸ºåŠ æ²¹ç«™çš„æƒ…å†µï¼Œç»Ÿè®¡èµ·ç‚¹ä¸ªæ•°ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“åœ°ï¼Œéœ€è¦åˆ†ç±»è®¨è®ºï¼šè‹¥ &lt;span class=&#34;math inline&#34;&gt;\(d(rt,v)&amp;lt;k\)&lt;/span&gt;ï¼Œè¯´æ˜&lt;strong&gt;ä¸Šæ¬¡åŠ æ²¹ä¸€å®šä¸åœ¨å½“å‰å­æ ‘å†…&lt;/strong&gt;ï¼›åœ¨æ ¹èŠ‚ç‚¹ä¸Šç™»è®°çš„åŠ æ²¹ç«™ä¸­ç»Ÿè®¡èµ°å¾—åˆ° &lt;span class=&#34;math inline&#34;&gt;\(fa_v\)&lt;/span&gt; ä½†èµ°ä¸åˆ° &lt;span class=&#34;math inline&#34;&gt;\(v\)&lt;/span&gt; çš„ï¼Œå°±å¯ä»¥æ‰¾åˆ° &lt;span class=&#34;math inline&#34;&gt;\(fa_v\)&lt;/span&gt; ä½œä¸ºåŠ æ²¹ç«™å¯¹åº”çš„èµ·ç‚¹ä¸ªæ•°ã€‚å¯¹ &lt;span class=&#34;math inline&#34;&gt;\(d(rt,v)\ge k\)&lt;/span&gt;ï¼Œåªéœ€è¦å€å¢æ‰¾åˆ°ä¸Šä¸€æ¬¡åŠ æ²¹çš„ç‚¹å³å¯æ‰¾åˆ° &lt;span class=&#34;math inline&#34;&gt;\(fa_v\)&lt;/span&gt; çš„ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;è¯´ç€å¾ˆè½»å·§ï¼Œå®ç°ç€å¾ˆæ¶å¿ƒã€‚æ‘†äº†ã€‚&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;e---é¦–éƒ½&#34;&gt;E - é¦–éƒ½&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://www.luogu.com.cn/problem/P7215&#34; class=&#34;uri&#34;&gt;https://www.luogu.com.cn/problem/P7215&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¯ç¤ºæˆ‘ä»¬ç‚¹åˆ†æ²»å¤„ç†çš„é—®é¢˜ä¸ä¸€æ˜¯ä¸ã€æ ‘ç»“æ„ã€å¼ºç›¸å…³è€…ï¼›ä¹Ÿå¯ä»¥ä»…åˆ©ç”¨ç‚¹åˆ†æ²»åˆ’åˆ†å‡ºæ¥çš„å—ï¼Œä¾‹å¦‚ã€è‹¥è¶…å‡ºå½“å‰å—ï¼Œåˆ™ä¸€å®šä¸ä¼˜ã€ä¹‹ç±»çš„ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬é¢˜çš„è¯¥æ€§è´¨é€šè¿‡åˆ†è®¨æ˜¯å¥½è¯çš„ï¼›æ‰€ä»¥ç›´æ¥æ¯ä¸ªå—å†…æš´åŠ›å³å¯ã€‚å¤æ‚åº¦ &lt;span class=&#34;math inline&#34;&gt;\(O(n\log n)\)&lt;/span&gt;ã€‚&lt;/p&gt;
&lt;details&gt;
&lt;pre class=&#34;cpp&#34;&gt;&lt;code&gt;#include &amp;lt;bits/stdc++.h&amp;gt;
int main() &amp;#123;
#ifdef ONLINE_JUDGE
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr), std::cout.tie(nullptr);
#else
    std::freopen(&amp;quot;.in&amp;quot;, &amp;quot;r&amp;quot;, stdin);
    std::freopen(&amp;quot;.out&amp;quot;, &amp;quot;w&amp;quot;, stdout);
#endif
    int n, k;
    std::cin &amp;gt;&amp;gt; n &amp;gt;&amp;gt; k;
    std::vector&amp;lt;std::vector&amp;lt;int&amp;gt; &amp;gt; g(n + 1), t(k + 1);
    for (int i = 1, x, y; i &amp;lt; n; ++i) &amp;#123;
        std::cin &amp;gt;&amp;gt; x &amp;gt;&amp;gt; y;
        g[x].push_back(y), g[y].push_back(x);
    &amp;#125;
    std::vector&amp;lt;int&amp;gt; col(n + 1), mx(n + 1), siz(n + 1);
    for (int i = 1; i &amp;lt;= n; ++i) &amp;#123;
        std::cin &amp;gt;&amp;gt; col[i];
        t[col[i]].push_back(i);
    &amp;#125;
    std::vector&amp;lt;int&amp;gt; tag(n + 1), p, tik(n + 1), faa(n + 1), vis(n + 1), book(k + 1);
    std::function&amp;lt;void(int, int)&amp;gt; DFS1 = [&amp;amp;](int x, int fa) &amp;#123;
        siz[x] = 1, mx[x] = 0;
        p.push_back(x), tik[x] = 1;
        for (auto i : g[x])
            if (!tag[i] &amp;amp;&amp;amp; i != fa) &amp;#123;
                DFS1(i, x);
                siz[x] += siz[i];
                mx[x] = std::max(mx[x], siz[i]);
            &amp;#125;
        return;
    &amp;#125;;
    auto findrt = [&amp;amp;](int x) &amp;#123;
        p.clear(), DFS1(x, -1);
        int n = (int)p.size();
        for (auto i : p)
            if (mx[i] &amp;lt;= n / 2 &amp;amp;&amp;amp; n - siz[i] &amp;lt;= n / 2)
                return i;
        assert(0);
        return -1;
    &amp;#125;;
    std::function&amp;lt;void(int)&amp;gt; DFS2 = [&amp;amp;](int x) &amp;#123;
        for (auto i : g[x])
            if (!tag[i] &amp;amp;&amp;amp; i != faa[x])
                faa[i] = x, DFS2(i);
        return;
    &amp;#125;;
    int res = 0x3f3f3f3f;
    std::function&amp;lt;void(int)&amp;gt; DFS = [&amp;amp;](int x) &amp;#123;
        x = findrt(x);
        faa[x] = -1, DFS2(x);
        std::queue&amp;lt;int&amp;gt; q;
        q.push(col[x]), book[col[x]] = 1;
        int cnt = 0;
        for (; !q.empty(); ) &amp;#123;
            int f = q.front();
            q.pop();
            for (auto i : t[f])
                if (tik[i]) 
                    for (int p = i; ~p &amp;amp;&amp;amp; !vis[p]; p = faa[p]) &amp;#123;
                        vis[p] = 1;
                        if (!book[col[p]]) &amp;#123;
                            if (++cnt &amp;gt;= res)
                                goto outo;
                            q.push(col[p]), book[col[p]] = 1;
                        &amp;#125;
                    &amp;#125;
                else
                    goto outo;
        &amp;#125;
        res = cnt;
        // printf(&amp;quot;x = %d: cnt = %d\n&amp;quot;, x, cnt);
    outo:
        for (auto i : p)
            vis[i] = tik[i] = book[col[i]] = 0;
        tag[x] = 1;
        for (auto i : g[x])
            if (!tag[i])
                DFS(i);
        return;
    &amp;#125;;
    DFS(1);
    std::cout &amp;lt;&amp;lt; res &amp;lt;&amp;lt; &amp;#39;\n&amp;#39;;    
    return 0;
&amp;#125;&lt;/code&gt;&lt;/pre&gt;
&lt;/details&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;f---å¼€åº—&#34;&gt;F - å¼€åº—&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://www.luogu.com.cn/problem/P3241&#34; class=&#34;uri&#34;&gt;https://www.luogu.com.cn/problem/P3241&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è½¬åŒ–é—®é¢˜ï¼ŒåŸé—®é¢˜å³æ±‚è§£æƒå€¼åœ¨ &lt;span class=&#34;math inline&#34;&gt;\([L,R]\)&lt;/span&gt; é—´çš„å…ƒç´ åˆ° &lt;span class=&#34;math inline&#34;&gt;\(u\)&lt;/span&gt; çš„è·ç¦»å’Œã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ±‚è§£è·ç¦»çš„æ–¹æ³•æ˜¯æ‰¾åˆ° LCA åè®¡ç®—ï¼Œè€ƒè™‘å¦‚æœä¸åˆ©ç”¨æ ‘ä¸Š LCAï¼Œè€Œæ˜¯åˆ©ç”¨ç‚¹åˆ†æ ‘ä¸Š LCA å¦‚ä½•è®¡ç®—ã€‚åˆ†è®¨æ˜“è¯å¾—ç‚¹åˆ†æ ‘ä¸Š LCA ä¸€å®šåœ¨ä¸¤ç‚¹è·¯å¾„ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å‚¨å­˜ç‚¹åˆ†æ ‘ä¸Šæ¯ä¸ªç‚¹åˆ°å…¶æ¯ä¸ªç¥–å…ˆçš„è·ç¦»ï¼Œå°±å¯ä»¥æ–¹ä¾¿åœ°è®¡ç®—ä»»æ„ä¸¤ç‚¹é—´è·ç¦»ã€‚æ¥ä¸‹æ¥å¤„ç†åŸé—®é¢˜çš„å¼±åŒ–ï¼šå¯¹äºæ¯ä¸ª &lt;span class=&#34;math inline&#34;&gt;\(u\)&lt;/span&gt; æ±‚è§£å…¶åˆ°æ ‘ä¸Šæ‰€æœ‰ç‚¹è·ç¦»å’Œã€‚æ˜¾ç„¶è¿™æ˜¯ä¸€ä¸ªç±»ä¼¼æ¢æ ¹çš„é—®é¢˜ï¼Œéšä¾¿åšå³å¯ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨éœ€è¦åœ¨çº¿åœ°è§£å†³åŸé—®é¢˜ã€‚&lt;strong&gt;å¯ä»¥ç”¨ vector å­˜å‚¨è¿™ä¸€å±‚æ‰€æœ‰ç‚¹çš„æƒå€¼ä¸æ·±åº¦ä¿¡æ¯ï¼ŒæŒ‰æƒå€¼æ’åºåäºŒåˆ†æŸ¥è¯¢&lt;/strong&gt;ã€‚å¤æ‚åº¦ &lt;span class=&#34;math inline&#34;&gt;\(O(n\log^2 n)\)&lt;/span&gt;ã€‚å®ç°çš„æ—¶å€™åº”è¯¥å¯ä»¥æ³¨æ„åˆ°åŸé¢˜é™åˆ¶ç‚¹åº¦æ•°å¯¹å¤æ‚åº¦çš„ä¿è¯ã€‚&lt;/p&gt;
&lt;details&gt;
&lt;p&gt;æ‰“èµ·æ¥çš„æ—¶å€™æ„Ÿè§‰å¾ˆå²ï¼Œä½†å®é™…ä¸Šè°ƒå¾—æ¯”å¤§å¤šæ•°é¢˜å¿«ã€‚&lt;/p&gt;
&lt;p&gt;å¤§æ¦‚æ‡‚å¾—ä¸ºä»€ä¹ˆç»å¸¸çœ‹å¤§ä½¬å†™æ¸¸è®°åšåˆ°å²é¢˜çš„å®ç°é¢„æœŸéƒ½æ˜¯ã€ä¸€éè¿‡ã€äº†ã€‚&lt;/p&gt;
&lt;pre class=&#34;cpp&#34;&gt;&lt;code&gt;#include &amp;lt;bits/stdc++.h&amp;gt;
const long long inf = 1e18;
const int maxn = 1.5e5 + 5;
std::vector&amp;lt;std::pair&amp;lt;int, int&amp;gt; &amp;gt; g[maxn];
int top[maxn], siz[maxn], fa[maxn], son[maxn], dep[maxn], dis[maxn];
void DFS1(int x) &amp;#123;
    siz[x] = 1;
    for (auto [i, w] : g[x])
        if (i != fa[x]) &amp;#123;
            fa[i] = x;
            dep[i] = dep[x] + 1, dis[i] = dis[x] + w;
            DFS1(i);
            siz[x] += siz[i];
            if (siz[i] &amp;gt; siz[son[x]])
                son[x] = i;
        &amp;#125;
    return;
&amp;#125;
void DFS2(int x) &amp;#123;
    if (son[x])
        top[son[x]] = top[x], DFS2(son[x]);
    for (auto [i, w] : g[x])
        if (i != fa[x] &amp;amp;&amp;amp; i != son[x])
            top[i] = i, DFS2(i);
    return;
&amp;#125;
int ask(int x, int y) &amp;#123;
    int sx = x, sy = y;
    for (; top[x] != top[y]; x = fa[top[x]])
        if (dep[top[x]] &amp;lt; dep[top[y]])
            std::swap(x, y);
    x = dep[x] &amp;lt; dep[y] ? x : y;
    return dis[sx] + dis[sy] - 2 * dis[x];
&amp;#125;
int main() &amp;#123;
#ifdef ONLINE_JUDGE
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr), std::cout.tie(nullptr);
#else
    std::freopen(&amp;quot;.in&amp;quot;, &amp;quot;r&amp;quot;, stdin);
    std::freopen(&amp;quot;.out&amp;quot;, &amp;quot;w&amp;quot;, stdout);
#endif
    int n, q, A;
    std::cin &amp;gt;&amp;gt; n &amp;gt;&amp;gt; q &amp;gt;&amp;gt; A;
    std::vector&amp;lt;int&amp;gt; c(n + 1);
    for (int i = 1; i &amp;lt;= n; ++i)
        std::cin &amp;gt;&amp;gt; c[i];
    for (int i = 1, x, y, w; i &amp;lt; n; ++i) &amp;#123;
        std::cin &amp;gt;&amp;gt; x &amp;gt;&amp;gt; y &amp;gt;&amp;gt; w;
        g[x].emplace_back(y, w), g[y].emplace_back(x, w);
    &amp;#125;
    DFS1(1), DFS2(1);
    std::vector&amp;lt;int&amp;gt; mx(n + 1), siz(n + 1), p, tag(n + 1);
    std::function&amp;lt;void(int, int)&amp;gt; DFS1 = [&amp;amp;](int x, int fa) &amp;#123;
        siz[x] = 1, mx[x] = 0;
        p.push_back(x);
        for (auto [i, w] : g[x])
            if (!tag[i] &amp;amp;&amp;amp; i != fa) &amp;#123;
                DFS1(i, x);
                siz[x] += siz[i];
                mx[x] = std::max(mx[x], siz[i]);
            &amp;#125;
        return;
    &amp;#125;;
    auto findrt = [&amp;amp;](int x) &amp;#123;
        p.clear(), DFS1(x, -1);
        int n = (int)p.size();
        for (auto i : p)
            if (mx[i] &amp;lt;= n / 2 &amp;amp;&amp;amp; n - siz[i] &amp;lt;= n / 2)
                return i;
        assert(0);
        return -1;
    &amp;#125;;
    std::vector&amp;lt;int&amp;gt; dis(n + 1);
    std::vector&amp;lt;std::array&amp;lt;std::vector&amp;lt;std::pair&amp;lt;int, long long&amp;gt; &amp;gt;, 3&amp;gt; &amp;gt; t(n + 1);
    std::function&amp;lt;void(int, int, std::vector&amp;lt;std::pair&amp;lt;int, long long&amp;gt; &amp;gt;&amp;amp;)&amp;gt; DFS2 = [&amp;amp;](int x, int fa, std::vector&amp;lt;std::pair&amp;lt;int, long long&amp;gt; &amp;gt; &amp;amp;t) &amp;#123;
        t.emplace_back(c[x], dis[x]);
        for (auto [i, w] : g[x])
            if (!tag[i] &amp;amp;&amp;amp; i != fa) &amp;#123;
                dis[i] = dis[x] + w;
                DFS2(i, x, t);
            &amp;#125;
        return;
    &amp;#125;;
    std::vector&amp;lt;std::pair&amp;lt;int, int&amp;gt; &amp;gt; to(n + 1);
    std::function&amp;lt;std::pair&amp;lt;int, int&amp;gt; (int)&amp;gt; DFS = [&amp;amp;](int x) &amp;#123;
        x = findrt(x);
        int ret = dis[x];
        for (int j = 0; j &amp;lt; (int)g[x].size(); ++j) &amp;#123;
            auto [i, w] = g[x][j];
            if (!tag[i]) &amp;#123;
                dis[i] = w;
                DFS2(i, x, t[x][j]);
                std::sort(t[x][j].begin(), t[x][j].end());
                // printf(&amp;quot;[%d, %d]: %d(%lld)&amp;quot;, x, j, t[x][j][0].first, t[x][j][0].second);
                for (int k = 1; k &amp;lt; (int)t[x][j].size(); ++k) &amp;#123;
                    t[x][j][k].second += t[x][j][k - 1].second;
                    // printf(&amp;quot; %d(%lld)&amp;quot;, t[x][j][k].first, t[x][j][k].second);
                &amp;#125;
                // puts(&amp;quot;&amp;quot;);
            &amp;#125;
        &amp;#125;
        tag[x] = 1;
        for (int j = 0; j &amp;lt; (int)g[x].size(); ++j) &amp;#123;
            auto [i, w] = g[x][j];
            if (!tag[i]) &amp;#123;
                auto [rt, d] = DFS(i);
                to[rt] = &amp;#123; x, j &amp;#125;;
            &amp;#125;
        &amp;#125;
        return std::make_pair(x, ret);
    &amp;#125;;
    int rt = DFS(1).first;
    std::vector&amp;lt;std::vector&amp;lt;int&amp;gt; &amp;gt; fd(n + 1);
    for (int i = 1; i &amp;lt;= n; ++i) &amp;#123;
        int now = i;
        for (;; now = to[now].first) &amp;#123;
            fd[i].push_back(ask(now, i));
            if (now == rt)
                break;
        &amp;#125;
    &amp;#125;
    for (int u, a, b; q--; ) &amp;#123;
        static long long la = 0ll;
        std::cin &amp;gt;&amp;gt; u &amp;gt;&amp;gt; a &amp;gt;&amp;gt; b;
        int l = std::min((a + la) % A, (b + la) % A), r = std::max((a + la) % A, (b + la) % A);
        // printf(&amp;quot;ask %d, [%d, %d]\n&amp;quot;, u, l, r);
        auto ask = [&amp;amp;](int x, int j) &amp;#123;
            auto res(0ll);
            int cnt = 0, p = 0;
            p = std::lower_bound(t[x][j].begin(), t[x][j].end(), std::make_pair(l, -1ll)) - t[x][j].begin();
            cnt -= p;
            if (p != 0)
                res -= t[x][j][p - 1].second;
            p = std::upper_bound(t[x][j].begin(), t[x][j].end(), std::make_pair(r, inf)) - t[x][j].begin();
            cnt += p;
            if (p != 0)
                res += t[x][j][p - 1].second;
            return std::make_pair(res, cnt);
        &amp;#125;;
        la = ask(u, 0).first + ask(u, 1).first + ask(u, 2).first;
        // int U = u;
        for (auto d = ++fd[u].begin(); u != rt; ++d) &amp;#123;
            auto [fa, k] = to[u];
            // fprintf(stderr, &amp;quot;u = %d, fa = %d, d = %d\n&amp;quot;, U, fa, *d);
            for (int j = 0; j &amp;lt; 3; ++j)
                if (j != k) &amp;#123;
                    auto [len, cnt] = ask(fa, j);
                    la += len + (long long)cnt * *d;
                &amp;#125;
            if (c[fa] &amp;gt;= l &amp;amp;&amp;amp; c[fa] &amp;lt;= r)
                la += *d;
            u = fa;
        &amp;#125;
        std::cout &amp;lt;&amp;lt; la &amp;lt;&amp;lt; &amp;#39;\n&amp;#39;;
    &amp;#125;
    return 0;
&amp;#125;&lt;/code&gt;&lt;/pre&gt;
&lt;/details&gt;
</content>
        <category term="ç‚¹åˆ†æ²»" />
        <updated>2025-06-12T09:18:55.000Z</updated>
    </entry>
</feed>
