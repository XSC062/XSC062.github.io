{
    "version": "https://jsonfeed.org/version/1",
    "title": "null â€¢ All posts by \"dp\" tag",
    "description": "",
    "home_page_url": "https://xsc062.netlify.app",
    "items": [
        {
            "id": "https://xsc062.netlify.app/20251007/",
            "url": "https://xsc062.netlify.app/20251007/",
            "title": "æ‚é¢˜é€‰è°ˆ",
            "date_published": "2025-10-07T08:29:43.000Z",
            "content_html": "<p>è¿‘æœŸæ¨¡æ‹Ÿèµ›</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"a.-è€ƒè¯•\">A. è€ƒè¯•</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6624/problem/1\" class=\"uri\">https://www.becoder.com.cn/contest/6624/problem/1</a></p>\n<blockquote>\n<p><span class=\"math inline\">\\(m\\)</span> é“é¢˜ï¼Œåˆ†æ•°æ˜¯ä¸€ä¸ª <span class=\"math inline\">\\(m\\)</span> çš„æ’åˆ—ï¼ˆåˆå§‹æœªçŸ¥ï¼‰ï¼Œåšå¯¹å¾—æ»¡åˆ†ï¼Œåšé”™å¾— 0 åˆ†</p>\n<p>ç»™å®š <span class=\"math inline\">\\(n\\)</span> ä¸ªäººå¯¹äºè¿™ <span class=\"math inline\">\\(m\\)</span> ä¸ªé¢˜çš„è¿‡é¢˜æƒ…å†µçŸ©é˜µï¼Œä¸”ç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªäººæœ‰ä¸€ä¸ªé¢„æœŸåˆ†æ•° <span class=\"math inline\">\\(x_i\\)</span>ã€‚</p>\n<p>æ±‚æ¯åˆ°é¢˜çš„åˆ†æ•°ï¼Œä½¿å¾—æ¯ä¸ªäººå®é™…å¾—åˆ†ä¸æœŸæœ›çš„åˆ†å·®çš„ç»å¯¹å€¼ä¹‹å’Œæœ€å¤§ã€‚è¾“å‡ºè¯¥æ’åˆ—ã€‚</p>\n<p><span class=\"math inline\">\\(n\\le 10,m\\le 10^4\\)</span>ã€‚</p>\n</blockquote>\n<ul>\n<li>ç»å¯¹å€¼æ˜¯è´ªå¿ƒä¸€ä¸ªå¾ˆå¤§çš„é˜»ç¢</li>\n<li><p>ä¸€ä¸ªå…¸å‹çš„ã€é’¦å®šã€å‹è´ªå¿ƒï¼Œæšä¸¾æ¯ä¸ªäººçš„ç»å¯¹å€¼æ˜¯å¦å–åï¼Œå°±å¯ä»¥å¾—åˆ°æ¯ä¸ªé¢˜å¯¹åº”çš„ç³»æ•°ã€‚</p>\n<p>å› ä¸ºã€å°±ç®—é”™äº†ä¹Ÿä¸ä¼šå½±å“æœ€ä¼˜è§£ã€ï¼Œæ‰€ä»¥æ˜¯å¯¹çš„ã€‚</p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n    std::freopen(&quot;test.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;test.out&quot;, &quot;w&quot;, stdout);\n    int T;\n    for (std::cin &gt;&gt; T; T--; ) &#123;\n        int n, m;\n        std::cin &gt;&gt; n &gt;&gt; m;\n        std::vector&lt;int&gt; s(n + 1);\n        for (int i = 1; i &lt;= n; ++i)\n            std::cin &gt;&gt; s[i];\n        std::vector&lt;std::vector&lt;int&gt; &gt; pos(n + 1);\n        for (int i = 1; i &lt;= n; ++i)\n            for (int j = 1; j &lt;= m; ++j) &#123;\n                char t;\n                std::cin &gt;&gt; t;\n                if (t == &#39;1&#39;)\n                    pos[i].push_back(j);\n            &#125;\n        auto res = 0ll;\n        int siz = 1 &lt;&lt; n;\n        std::vector&lt;std::vector&lt;int&gt; &gt; id(2 * n + 1);\n        std::vector&lt;int&gt; cnt(m + 1), ans(m + 1), p(m + 1);\n        for (int i = 0; i &lt; siz; ++i) &#123;\n            std::fill(cnt.begin() + 1, cnt.end(), 0);\n            for (int j = 0; j &lt;= 2 * n; ++j)\n                id[j].clear();\n            for (int j = 1; j &lt;= n; ++j)\n                if ((i &gt;&gt; (j - 1)) &amp; 1)\n                    for (auto k : pos[j])\n                        ++cnt[k];\n                else\n                    for (auto k : pos[j])\n                        --cnt[k];\n            for (int j = 1; j &lt;= m; ++j)\n                id[cnt[j] + n].push_back(j);\n            for (int i = 2 * n, k = m; ~i; --i)\n                for (auto j : id[i])\n                    p[j] = k--;\n            auto now = 0ll;\n            for (int i = 1; i &lt;= n; ++i) &#123;\n                int sum = 0;\n                for (auto j : pos[i])\n                    sum += p[j];\n                now += std::abs(sum - s[i]);\n            &#125;\n            if (now &gt;= res)\n                res = now, ans = p;\n        &#125;\n        // std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n        for (int i = 1; i &lt;= m; ++i)\n            std::cout &lt;&lt; ans[i] &lt;&lt; &#39; &#39;;\n        std::cout &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b.-å›´æ£‹\">B. å›´æ£‹</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6624/problem/2\" class=\"uri\">https://www.becoder.com.cn/contest/6624/problem/2</a></p>\n<blockquote>\n<p>ç»™å®š <span class=\"math inline\">\\(n \\times n\\)</span> çš„æ£‹ç›˜ï¼Œä¸Šé¢æœ‰é»‘æ£‹ã€ç™½æ£‹å’Œç©ºåœ°ï¼Œå®šä¹‰ç™½æ£‹çš„ã€æ°”ã€ä¸ºå››ä¸ªæ–¹å‘ç©ºåœ°çš„æ•°é‡ï¼Œè‹¥ä¸€ä¸ªç™½æ£‹å››è¿é€šå—ä¸­æ‰€æœ‰ç™½æ£‹çš„ã€æ°”ã€éƒ½ä¸º 0ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªç™½æ£‹å››è¿é€šå—ä¸­çš„æ‰€æœ‰ç™½æ£‹æ˜¯ã€æ­»çš„ã€ã€‚</p>\n<p>ç°æšä¸¾æ¯ä¸ªæ£‹å­ï¼Œå¹¶å°†å…¶åè½¬é¢œè‰²ï¼Œé—®ã€æ­»çš„ã€ç™½æ£‹æ•°é‡ã€‚æ“ä½œæ˜¯ç‹¬ç«‹çš„ã€‚</p>\n<p>3sï¼Œ<span class=\"math inline\">\\(n\\le 10^3\\)</span>ã€‚</p>\n</blockquote>\n<ul>\n<li>åˆ†è®¨é¢˜ï¼Œéœ€è¦æƒ³æ¸…æ¥šã€‚é¦–å…ˆéœ€è¦ä¸€æ¬¡ floodfill å®ŒæˆæŸ“è‰²ï¼Œè®°å½•å“ªäº›è¿é€šå—æ­»äº†ã€‚</li>\n<li><p>è‹¥åè½¬é»‘æ£‹ï¼š</p>\n<ul>\n<li><p>è‹¥é»‘æ£‹è‡ªå·±æœ‰æ°”ï¼Œæˆ–å’Œé»‘æ£‹ç›¸è¿çš„ç™½æ£‹å››è¿é€šå—æœ‰æ°”ï¼Œé‚£ä¹ˆé»‘æ£‹è‡ªå·±ï¼Œä»¥åŠæ‰€æœ‰å’Œé»‘æ£‹ç›¸è¿çš„ç™½æ£‹å››è¿é€šå—éƒ½æ˜¯æ´»çš„ã€‚</p>\n<p>æ­¤æ—¶éœ€è¦æ‰¾åˆ°æ‰€æœ‰å’Œé»‘æ£‹ç›¸è¿çš„ï¼Œä¸”æ­»äº†çš„ç™½æ£‹å››è¿é€šå—çš„å¤§å°ï¼Œç­”æ¡ˆéœ€è¦å‡å»ä¹‹ã€‚</p></li>\n</ul></li>\n<li><p>å¦åˆ™ï¼Œé»‘æ£‹è‡ªèº«è´¡çŒ® <span class=\"math inline\">\\(1\\)</span> çš„ç­”æ¡ˆã€‚</p></li>\n<li><p>è‹¥åè½¬ç™½æ£‹ï¼š</p>\n<ul>\n<li>è‹¥ç™½æ£‹æœ¬èº«æ˜¯æ­»çš„ï¼šç­”æ¡ˆ <span class=\"math inline\">\\(-1\\)</span>ã€‚</li>\n<li><p>å¦åˆ™ï¼Œéœ€è¦è€ƒè™‘æœ‰å¤šå°‘ä¸ªåŸæœ¬æ˜¯æ´»çš„ç™½æ£‹æ­¤æ—¶ä¸æœ‰æ°”çš„ç™½æ£‹ä¸è¿é€šï¼Œè¿™ç§æƒ…å†µå‘ç”Ÿå½“ä¸”ä»…å½“æœ‰æ°”çš„ç™½æ£‹æ˜¯è¢«åè½¬çš„ç™½æ£‹è‡ªèº«ï¼Œæˆ–è€…è¢«åè½¬çš„ç™½æ£‹æ˜¯å‰²ç‚¹ã€‚</p>\n<p>å¾ˆå¥‡å¦™çš„ä¸€ä¸ªæƒ³æ³•æ˜¯å»ºç«‹è¶…çº§æºç‚¹ï¼Œå‘æ‰€æœ‰ç©ºåœ°è¿è¾¹ï¼Œå†å»ºåœ†æ–¹æ ‘ï¼Œè¿™æ ·è¿™ä¸ªç‚¹çš„æ‰€æœ‰å„¿å­å°±æ˜¯å¾…æ±‚ã€‚åœ†æ–¹æ ‘å¹¶ä¸éœ€è¦æ˜¾å¼åœ°å»ºå‡ºæ¥ã€‚</p></li>\n</ul></li>\n</ul>\n<p>ä»£ç ï¼šä¸ä¼š</p>\n<hr />\n<h2 id=\"c.-ç›¸äº’æŠµæ¶ˆ\">C. ç›¸äº’æŠµæ¶ˆ</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6624/problem/3\" class=\"uri\">https://www.becoder.com.cn/contest/6624/problem/3</a></p>\n<blockquote>\n<p>ç»™å®š <span class=\"math inline\">\\(a_{1\\sim n}\\)</span>ï¼Œç»´æŠ¤ <span class=\"math inline\">\\(m\\)</span> æ¬¡æ“ä½œï¼š</p>\n<ol type=\"1\">\n<li>åŒºé—´åŠ ã€‚</li>\n<li>ç»™å®š <span class=\"math inline\">\\(l,r\\)</span>ï¼ŒæŸ¥è¯¢ <span class=\"math inline\">\\(\\left(\\sum\\limits_{i=l}^r\\sum\\limits_{j=i}^r ((\\sum_{k=i}^j a_k)^2 + (r-l+2)\\times(j-i)\\times a_i\\times a_j)\\right) \\bmod 998244353\\)</span>ã€‚</li>\n</ol>\n<p><span class=\"math inline\">\\(n,m\\le 5\\times 10^5\\)</span>ï¼Œå¼ºåˆ¶åœ¨çº¿ã€‚</p>\n</blockquote>\n<ul>\n<li>é¢˜ç›®åå­—æ˜¯çœŸåœ¨é™ä½éš¾åº¦å§ï¼Œå¼ºåˆ¶åœ¨çº¿å°±æ’é™¤ç¦»çº¿å†å²å’Œäº†ï¼›çŒœæµ‹è¯¢é—®æ‰€æ±‚å¯ä»¥åŒ–æˆä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ä¸œè¥¿ã€‚</li>\n<li><p>æ¨ä¸€ä¸‹ï¼š</p>\n<p>ï¼ˆçœç•¥ï¼‰</p>\n<p><span class=\"math display\">\\[\n=-\\left(\\sum_{i=l}^r i\\cdot a_i\\right)^2 + (1-l)(r+1)\\left(\\sum_{i=l}^r a_i\\right)^2+(l+r)\\left(\\sum_{i=l}^r i\\cdot a_i\\right)\\left(\\sum_{i=l}^r a_i\\right)\n\\]</span></p></li>\n<li>æ•…çº¿æ®µæ ‘ç»´æŠ¤ <span class=\"math inline\">\\(\\sum a_i\\)</span> å’Œ <span class=\"math inline\">\\(\\sum i\\cdot a_i\\)</span> å³å¯ã€‚</li>\n<li><p><a href=\"/20251010/#excercise\">å®é™…ä¸Šå¯ä»¥ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤</a>ã€‚</p></li>\n</ul>\n<details>\n<p>å–œææœ€ä¼˜è§£ï¼Œä¸å¾—ä¸è¯´ bit çš„é€Ÿåº¦ä¼˜åŠ¿è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353; \nconst int inv2 = (mod + 1) &gt;&gt; 1;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n    std::freopen(&quot;offset.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;offset.out&quot;, &quot;w&quot;, stdout);\n#else\n    std::freopen(&quot;./test/20251008/offset/ex_offset5.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int T, n, q;\n    std::cin &gt;&gt; T &gt;&gt; n &gt;&gt; q;\n    std::vector&lt;long long&gt; bit(n + 1), bit1(n + 1), bit2(n + 1);\n    auto lowbit = [&amp;](int x) &#123;\n        return x &amp; -x;\n    &#125;;\n    auto add = [&amp;](long long x, long long v) &#123;\n        auto v1 = x * v % mod, v2 = x * x % mod * v % mod;\n        for (; x &lt;= n; x += lowbit(x)) &#123;\n            (bit[x] += v) %= mod;\n            (bit1[x] += v1) %= mod;\n            (bit2[x] += v2) %= mod;\n        &#125;\n        return;\n    &#125;;\n    auto ask = [&amp;](long long x) &#123;\n        auto res = 0ll, res1 = 0ll, res2 = 0ll;\n        for (int i = x; i; i -= lowbit(i))\n            (res += bit[i]) %= mod, (res1 += bit1[i]) %= mod, (res2 += bit2[i]) %= mod;\n        return std::make_pair(((x + 1) * res + mod - res1) % mod, (x * (x + 1) % mod * res % mod + res1 + mod - res2) * inv2 % mod);\n    &#125;;\n    for (int i = 1, x; i &lt;= n; ++i)\n        std::cin &gt;&gt; x, add(i, x), add(i + 1, mod - x);\n    for (int op; q--; ) &#123;\n        static auto la = 0ll;\n        std::cin &gt;&gt; op;\n        if (op == 1) &#123;\n            int l, r, d;\n            std::cin &gt;&gt; l &gt;&gt; r &gt;&gt; d;\n            if (T == 1)\n                l ^= la, r ^= la, d ^= la;\n            add(l, d), add(r + 1, mod - d);\n        &#125;\n        else &#123;\n            long long l, r;\n            std::cin &gt;&gt; l &gt;&gt; r;\n            if (T == 1)\n                l ^= la, r ^= la;\n            auto t1 = ask(r), t2 = ask(l - 1);\n            auto res1 = t1.first + mod - t2.first, res2 = t1.second + mod - t2.second;\n            la = (mod - res2 * res2 % mod + mod - (l - 1) * (r + 1) % mod * res1 % mod * res1 % mod + (l + r) * res1 % mod * res2 % mod) % mod;\n            std::cout &lt;&lt; la &lt;&lt; &#39;\\n&#39;;\n        &#125;\n    &#125;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"a.-happylovelyeveryday\">A. HappyÂ·LovelyÂ·Everyday!</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6639/problem/1\" class=\"uri\">https://www.becoder.com.cn/contest/6639/problem/1</a></p>\n<blockquote>\n<p>ç»™å®šä¸€ä¸ªé•¿ä¸º <span class=\"math inline\">\\(n\\)</span> çš„ 01 åºåˆ—ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ¬¡ï¼ˆå¯ä»¥ä¸º <span class=\"math inline\">\\(0\\)</span>ï¼‰ã€æŠŠç›¸é‚»ä¸¤ä¸ªæ•°åˆå¹¶ä¸ºå…¶å¼‚æˆ–å€¼ã€çš„æ“ä½œï¼Œé—®æœ€ç»ˆèƒ½å¾—åˆ°çš„æœ¬è´¨ä¸åŒçš„åºåˆ—ä¸ªæ•°ã€‚</p>\n<p><span class=\"math inline\">\\(n\\le 2\\times 10^6\\)</span>ã€‚</p>\n</blockquote>\n<ul>\n<li>å¯¹äºä¸€ä¸ªæœ€ç»ˆåºåˆ—ï¼Œå¦‚æœè®¤ä¸ºå®ƒæ˜¯ç”±æŸä¸ªå­˜æ´»å…ƒç´ ã€åå¹¶ã€å®ƒå·¦ä¾§çš„è¿ç»­æ­»äº¡å…ƒç´ å¾—åˆ°çš„ï¼Œä¼šå‘ç°æœ€ç»ˆåºåˆ—ä¸­ï¼Œæ­¤å¤„çš„å‰ç¼€å¼‚æˆ–å€¼å°±æ˜¯åŸåºåˆ—çš„å‰ç¼€å¼‚æˆ–å€¼ã€‚</li>\n<li>ç»å…¸ trickï¼šå‰ç¼€å’Œå¯ä»¥å”¯ä¸€å¯¹åº”åŸæ•°ç»„ã€‚æ‰€ä»¥ã€æœ€ç»ˆæœ¬è´¨ä¸åŒåºåˆ—ã€ä¼šå’Œã€åŒ…å«ç¬¬ <span class=\"math inline\">\\(n\\)</span> ä¸ªå…ƒç´ çš„ï¼ŒåŸåºåˆ—å‰ç¼€å¼‚æˆ–å’Œçš„æœ¬è´¨ä¸åŒå­åºåˆ—ã€å½¢æˆåŒå°„ã€‚</li>\n<li><p>ç»Ÿè®¡åŒ…å«ç¬¬ <span class=\"math inline\">\\(n\\)</span> ä¸ªå…ƒç´ çš„ï¼ŒåŸåºåˆ—å‰ç¼€å¼‚æˆ–å’Œçš„æœ¬è´¨ä¸åŒå­åºåˆ—å³å¯ã€‚å¤æ‚åº¦ <span class=\"math inline\">\\(O(n)\\)</span>ã€‚</p>\n<details>\n<p><summary>How to æœ¬è´¨ä¸åŒå­åºåˆ—ï¼Ÿ</summary></p>\n<p>ä»¤ <span class=\"math inline\">\\(f_i\\)</span> è¡¨ç¤º DP åˆ° <span class=\"math inline\">\\(i\\)</span>ï¼Œä¸”å¼ºåˆ¶é€‰ <span class=\"math inline\">\\(i\\)</span> çš„æœ¬è´¨ä¸åŒå­åºåˆ—æ•°é‡ï¼Œè®° <span class=\"math inline\">\\(pre_i\\)</span> ä¸º <span class=\"math inline\">\\(i\\)</span> çš„å‰é©±ï¼ˆæ²¡æœ‰åˆ™ä¸º <span class=\"math inline\">\\(0\\)</span>ï¼‰ã€‚ä»¤ <span class=\"math inline\">\\(f_0=1\\)</span>ï¼Œé‚£ä¹ˆï¼š</p>\n<p><span class=\"math display\">\\[\nf_i\\gets \\sum\\limits_{j=pre_i}^{i-1} f_{j}\n\\]</span></p>\n<p>æˆ–ï¼Œä»¤ <span class=\"math inline\">\\(f_i\\)</span> è¡¨ç¤º DP åˆ° <span class=\"math inline\">\\(i\\)</span> æ—¶ï¼ˆä¸å¼ºåˆ¶é€‰ <span class=\"math inline\">\\(i\\)</span>ï¼‰æœ¬è´¨ä¸åŒå­åºåˆ—æ•°é‡ï¼Œè®° <span class=\"math inline\">\\(pre_i\\)</span> ä¸º <span class=\"math inline\">\\(i\\)</span> çš„å‰é©±ï¼ˆæ²¡æœ‰åˆ™ä¸º <span class=\"math inline\">\\(0\\)</span>ï¼‰ã€‚ä»¤ <span class=\"math inline\">\\(f_0=0\\)</span>ï¼Œé‚£ä¹ˆï¼š</p>\n<p><span class=\"math display\">\\[\nf_i=\\begin{cases}\n2\\cdot f_{i-1}+1&amp;pre_i= 0\\\\\n2\\cdot f_{i-1}-f_{pre_i-1}&amp;\\text{otherwise}\n\\end{cases}\n\\]</span></p>\n</details>\n<details>\n<p><summary>How to å¼ºåˆ¶é€‰ç¬¬ <span class=\"math inline\">\\(n\\)</span> ä¸ªå…ƒç´ çš„æœ¬è´¨ä¸åŒå­åºåˆ—ï¼Ÿ</summary></p>\n<p>ä»¤ <span class=\"math inline\">\\(f_i\\)</span> è¡¨ç¤º DP åˆ° <span class=\"math inline\">\\(i\\)</span>ï¼Œä¸”å¼ºåˆ¶é€‰ <span class=\"math inline\">\\(i\\)</span> çš„æœ¬è´¨ä¸åŒå­åºåˆ—æ•°é‡ï¼Œåˆ™ç­”æ¡ˆä¸ºï¼š</p>\n<p><span class=\"math display\">\\[\n\\sum\\limits_{a_i=a_n} f_i\n\\]</span></p>\n<p>æˆ–ï¼Œä»¤ <span class=\"math inline\">\\(f_i\\)</span> è¡¨ç¤º DP åˆ° <span class=\"math inline\">\\(i\\)</span>ï¼Œä¸”ä¸å¼ºåˆ¶é€‰ <span class=\"math inline\">\\(i\\)</span> çš„æœ¬è´¨ä¸åŒå­åºåˆ—æ•°é‡ï¼Œåˆ™ç­”æ¡ˆä¸ºï¼š</p>\n<p><span class=\"math display\">\\[\n\\sum\\limits_{a_i=a_n}\\begin{cases}\nf_{i-1}+1&amp;pre_i= 0\\\\\nf_{i-1}-f_{pre_i-1}&amp;\\text{otherwise}\n\\end{cases}\n\\]</span></p>\n</details></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n    std::freopen(&quot;a.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;a.out&quot;, &quot;w&quot;, stdout);\n#else\n    std::freopen(&quot;./test/20251014/a/a1.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int T;\n    for (std::cin &gt;&gt; T; T--; ) &#123;\n        std::string s;\n        std::cin &gt;&gt; s;\n        int n = (int)s.length();\n        s = &quot;#&quot; + s;\n        std::vector&lt;int&gt; a(n + 1);\n        for (int i = 1; i &lt;= n; ++i)\n            a[i] = a[i - 1] ^ (s[i] - &#39;0&#39;);\n        auto res = 0ll;\n        std::vector&lt;long long&gt; f(n + 1), la(2);\n        for (int i = 1; i &lt;= n; ++i) &#123;\n            if (la[a[i]])\n                f[i] = (2 * f[i - 1] + mod - f[la[a[i]] - 1]) % mod;\n            else\n                f[i] = (2 * f[i - 1] + 1) % mod;\n            if (a[i] == a[n]) &#123;\n                if (la[a[i]])\n                    res += (f[i - 1] + mod - f[la[a[i]] - 1]) % mod;\n                else\n                    res += f[i - 1] + 1;\n            &#125;\n            la[a[i]] = i;\n        &#125;\n        std::cout &lt;&lt; res % mod &lt;&lt; &#39;\\n&#39;;\n    &#125;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b.-æ•¬å¯è‡´é‚£æ—¶çš„æˆ‘\">B. æ•¬å¯ï¼Œè‡´é‚£æ—¶çš„æˆ‘</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6639/problem/2\" class=\"uri\">https://www.becoder.com.cn/contest/6639/problem/2</a></p>\n<blockquote>\n<p>å®šä¹‰ <span class=\"math inline\">\\(f_0=f_1=1,f_i=f_{i-1}+f_{i-2}\\)</span>ï¼Œç»™å®š <span class=\"math inline\">\\(n,k\\)</span>ï¼Œæ±‚ï¼š</p>\n<p><span class=\"math display\">\\[\n\\left(\\sum_{i=0}^n f_{i}\\cdot [\\text{popcount}(i)=k]\\right)\\bmod 10^9+7\n\\]</span></p>\n<p><span class=\"math inline\">\\(n\\le 2^{2000},0\\le k\\le \\log_2(n)\\)</span>ã€‚</p>\n</blockquote>\n<ul>\n<li>è€ƒè™‘æ•°ä½ DPï¼Œé‚£ä¹ˆéœ€è¦èƒ½å¤Ÿç”± <code>...xxx</code> å‘ <code>...0xxx</code> å’Œ <code>...1xxx</code> è½¬ç§»ã€‚</li>\n<li><p>æ˜¾ç„¶åªå…³å¿ƒå‘ <code>...1xxx</code> çš„è½¬ç§»ï¼Œé‚£ä¹ˆéœ€è¦å†è½¬ç§» <span class=\"math inline\">\\(2^{?}\\)</span> æ¬¡ï¼Œè®°å½•è½¬ç§»çŸ©é˜µçš„ <span class=\"math inline\">\\(2^{?}\\)</span> æ¬¡æ–¹å³å¯ã€‚</p>\n<p>è¿™ä¸€æ­¥ä¹Ÿå¯ä»¥ä¸ç”¨çŸ©é˜µï¼Œè€Œæ˜¯ç”¨æ–æ³¢é‚£å¥‘ <span class=\"math inline\">\\(f(ab)=...\\)</span> çš„æ€§è´¨ï¼Œä½†æ˜¾ç„¶äºŒè€…æ˜¯ç­‰ä»·çš„ï¼Œæ— ç”šå¿…è¦</p></li>\n<li><p>æ ¹æ®æ•°ä½ DP çš„å®ç°æ–¹å¼ï¼Œå¸¸æ•°ä¸Šé¡ºåºç»“æ„è‚¯å®šæ˜¯ä¼šåŠæ‰“é€’å½’çš„ã€‚ç„¶è€Œå¹¶ä¸æƒ¯å†™é¡ºåºç»“æ„çš„æ•°ä½ DPï¼Œwhatever.</p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 1e9 + 7;\nstruct matrix &#123;\n    long long a[2][2];\n    matrix() &#123;\n        a[0][0] = a[0][1] = a[1][0] = a[1][1] = 0ll;\n        return;\n    &#125;\n    long long* operator[] (const int q) &#123;\n        return a[q];\n    &#125;\n    matrix operator* (matrix &amp;q) const &#123;\n        matrix res;\n        res[0][0] = (a[0][0] * q[0][0] + a[0][1] * q[1][0]) % mod;\n        res[0][1] = (a[0][0] * q[0][1] + a[0][1] * q[1][1]) % mod;\n        res[1][0] = (a[1][0] * q[0][0] + a[1][1] * q[1][0]) % mod;\n        res[1][1] = (a[1][0] * q[0][1] + a[1][1] * q[1][1]) % mod;\n        return res;\n    &#125;\n    matrix&amp; operator+= (matrix q) &#123;\n        if ((a[0][0] += q[0][0]) &gt;= mod) a[0][0] -= mod;\n        if ((a[0][1] += q[0][1]) &gt;= mod) a[0][1] -= mod;\n        if ((a[1][0] += q[1][0]) &gt;= mod) a[1][0] -= mod;\n        if ((a[1][1] += q[1][1]) &gt;= mod) a[1][1] -= mod;\n        return *this;\n    &#125;\n&#125;;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n    std::freopen(&quot;b.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;b.out&quot;, &quot;w&quot;, stdout);\n#else\n    std::freopen(&quot;./test/20251014/b/b4.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    std::vector&lt;int&gt; up(n);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        char t;\n        std::cin &gt;&gt; t, up[n - i] = t - &#39;0&#39;;\n    &#125;\n    matrix init, zmat;\n    init[0][0] = init[0][1] = 1ll;\n    std::vector&lt;matrix&gt; mat(n);\n    mat[0][0][1] = mat[0][1][0] = mat[0][1][1] = 1ll;\n    for (int i = 1; i &lt; n; ++i)\n        mat[i] = mat[i - 1] * mat[i - 1];\n    std::vector&lt;std::vector&lt;int&gt; &gt; tag(n, std::vector&lt;int&gt; (k + 1));\n    std::vector&lt;std::vector&lt;matrix&gt; &gt; f(n, std::vector&lt;matrix&gt; (k + 1));\n    std::function&lt;matrix(int, int, int)&gt; DFS = [&amp;](int x, int k, int fl) &#123;\n        if (x == -1) &#123;\n            if (k == 0)\n                return init;\n            return zmat;\n        &#125;\n        if (!fl &amp;&amp; tag[x][k])\n            return f[x][k];\n        matrix res = DFS(x - 1, k, fl &amp;&amp; !up[x]);\n        if (k &amp;&amp; (!fl || up[x]))\n            res += DFS(x - 1, k - 1, fl) * mat[x];\n        if (!fl)\n            tag[x][k] = 1, f[x][k] = res;\n        return res;\n    &#125;;\n    std::cout &lt;&lt; DFS(n - 1, k, 1)[0][0] &lt;&lt; &#39;\\n&#39;;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"c.-lead-to-shine-more\">C. Lead to shine more</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6639/problem/3\" class=\"uri\">https://www.becoder.com.cn/contest/6639/problem/3</a></p>\n<blockquote>\n<p>ç¬¬ <span class=\"math inline\">\\(0\\)</span> æ¬¡æ“ä½œæ—¶å˜é‡ <span class=\"math inline\">\\(x=1\\)</span>ï¼Œæ­¤åæ¯æ¬¡æ“ä½œä½¿ <span class=\"math inline\">\\(x\\gets x+\\text{popcount}(x)\\)</span>ï¼Œç»™å®š <span class=\"math inline\">\\(m\\)</span> æ¬¡è¯¢é—®ï¼š</p>\n<ul>\n<li>ç»™å®š <span class=\"math inline\">\\(x&#39;\\)</span>ï¼Œé—® <span class=\"math inline\">\\(x\\)</span> åœ¨ç¬¬å‡ æ¬¡æ“ä½œåå˜ä¸º <span class=\"math inline\">\\(x&#39;\\)</span>ï¼Œæˆ–æŠ¥å‘Š <span class=\"math inline\">\\(x&#39;\\)</span> ä¸ä¼šè¢«ç»è¿‡ã€‚</li>\n</ul>\n<p><span class=\"math inline\">\\(m\\le 10^5,x&#39;\\le 10^{18}\\)</span>ã€‚</p>\n</blockquote>\n<ul>\n<li>ä¸€ä¸ªæœ´ç´ çš„æƒ³æ³•æ˜¯åˆ†é«˜ä½ä½ï¼Œåˆ™å› ä¸ºæ¯æ¬¡æ“ä½œå¸¦æ¥çš„å˜åŒ–é‡ä¸è¶…è¿‡ 60ï¼Œè¿œè¿œä½äºä½ä½çš„ <span class=\"math inline\">\\(2^30\\)</span>ï¼Œæ‰€ä»¥ä¸€æ¬¡æ“ä½œè‡³å¤šç»™é«˜ä½å¸¦æ¥ 1 çš„å˜åŒ–é‡ã€‚</li>\n<li><p>é«˜ä½å¯¹æ•´ä½“çš„è´¡çŒ®åªå–å†³äºå…¶ popcountï¼Œæ‰€ä»¥å¯ä»¥æšä¸¾é«˜ä½ 1 çš„æ•°é‡ï¼Œå†æšä¸¾åˆå§‹å€¼ï¼Œæ‰¾åˆ°ç¬¬ä¸€æ¬¡è®©é«˜ä½å˜åŒ–èŠ±çš„æ¬¡æ•°ã€‚</p>\n<p>åˆå§‹å€¼çš„å¯èƒ½å€¼æœ‰ <span class=\"math inline\">\\(60\\)</span> ä¸ªï¼Œè€Œå¤–å±‚å¾ªç¯æœ‰ <span class=\"math inline\">\\(30\\)</span> æ¬¡ï¼Œå†…å±‚å¾ªç¯å¤§æ¦‚æ˜¯ <span class=\"math inline\">\\(\\dfrac {2^{30}}{60}\\)</span> çš„ï¼Œæ€»ä¹‹æ— æ³•é€šè¿‡ã€‚</p></li>\n<li><p>é¢˜è§£è¯´æ–¹æ³•æ˜¯å¯¹ä¸Šé¢çš„æ‹“å±•ã€‚ç†è§£ä¸èƒ½ã€‚å‡ºå‘ç‚¹å¤§æ¦‚æ˜¯è€ƒè™‘åˆ°è®©ç¬¬ <span class=\"math inline\">\\(i\\)</span> ä½å˜åŒ–ç›¸å½“äºè®© <span class=\"math inline\">\\(i+1\\)</span> ä½å˜åŒ–ä¸¤æ¬¡ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€ä¸ªé€’æ¨çš„å…³ç³»ã€‚</p>\n<p>ä»¤ <span class=\"math inline\">\\(f_{i, s, d}\\)</span> ä¸ºå‰ <span class=\"math inline\">\\(i-1\\)</span> ä½çš„ popcount ä¸º <span class=\"math inline\">\\(d\\)</span>ï¼Œåˆå§‹å€¼ä¸º <span class=\"math inline\">\\(s\\)</span>ï¼Œè®© <span class=\"math inline\">\\(i\\)</span> ä½å˜åŒ–ä¸€æ¬¡çš„æ“ä½œæ¬¡æ•°ï¼›<span class=\"math inline\">\\(g_{i,s,d}\\)</span> ä¸ºä¸Šè¿°å˜åŒ–å <span class=\"math inline\">\\(x\\)</span> çš„å€¼ã€‚è®° <span class=\"math inline\">\\(pos=g_{i-1,s,d}\\)</span>ï¼Œé‚£ä¹ˆæœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\ng_{i,pos,d}=g_{i-1,pos,d+1}\\\\\nf_{i,pos,d}=f_{i-1,s,d}+f_{i-1,pos,d+1}\n\\]</span></p>\n<p>å…¶å®æ˜¯ä¸€ä¸ªç±»ä¼¼<strong>å€å¢</strong>çš„ç»“æ„ã€‚ä½†æ•æˆ‘å®åœ¨æ— æ³•è§£é‡Šæ€ä¹ˆæƒ³åˆ°çš„ã€‚</p></li>\n<li>æ˜¾ç„¶è¿™ä¸ªå¼å­åœ¨ <span class=\"math inline\">\\(i\\le 5\\)</span> æ—¶æ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬æš´åŠ›è·‘å³å¯ã€‚å¿½ç•¥è¿™ä¸€éƒ¨åˆ†å¸¸æ•°ï¼Œé¢„å¤„ç†æ€»å¤æ‚åº¦ <span class=\"math inline\">\\(O(\\log^3 n)\\)</span>ã€‚</li>\n<li><p>è€ƒè™‘æŸ¥è¯¢ï¼ŒæŒ‰ç…§ç±»ä¼¼æ•°ä½ DP çš„æ–¹æ³•ä»é«˜ä½åˆ°ä½ä½æ¨¡æ‹Ÿè¿›ä½è¿‡ç¨‹å³å¯ã€‚å¤æ‚åº¦ <span class=\"math inline\">\\(O(\\log n)\\)</span>ã€‚</p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n    std::freopen(&quot;c.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;c.out&quot;, &quot;w&quot;, stdout);\n#else\n    std::freopen(&quot;./test/20251014/c/c1.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    using arr = std::vector&lt;long long&gt;;\n    using brr = std::vector&lt;arr&gt;;\n    using crr = std::vector&lt;brr&gt;;\n    crr f(61, brr(256, arr(61))), g(61, brr(256, arr(61)));\n    for (int s = 0; s &lt; 256; ++s)\n        for (int d = 0; d &lt;= 60; ++d)\n            if (d || s) &#123;\n                int x = s, cnt = 0;\n                for (; x &lt; 256; x += __builtin_popcount(x) + d, ++cnt);\n                f[8][s][d] = cnt, g[8][s][d] = x &amp; 255;\n            &#125;\n    for (int i = 9; i &lt;= 60; ++i)\n        for (int s = 0; s &lt; 256; ++s)\n            for (int d = 0; d &lt; 60; ++d) &#123;\n                int pos = g[i - 1][s][d];\n                g[i][s][d] = g[i - 1][pos][d + 1];\n                f[i][s][d] = f[i - 1][s][d] + f[i - 1][pos][d + 1];\n            &#125;\n    int m;\n    std::cin &gt;&gt; m;\n    for (long long x; m--; ) &#123;\n        std::cin &gt;&gt; x;\n        auto pos = 1ll, cnt = 0ll, tot = 0ll;\n        for (int i = 60; i &gt;= 8; --i)\n            if ((x &gt;&gt; i) &amp; 1) &#123;\n                cnt += f[i][pos][tot];\n                pos = g[i][pos][tot++];\n            &#125;\n        for (; pos &lt; (x &amp; 255); pos += __builtin_popcountll(pos) + tot, ++cnt);\n        // std::cout &lt;&lt; pos &lt;&lt; &#39; &#39; &lt;&lt; cnt &lt;&lt; &#39;\\n&#39;;\n        if (pos == (x &amp; 255))\n            std::cout &lt;&lt; cnt &lt;&lt; &#39;\\n&#39;;\n        else\n            std::cout &lt;&lt; -1 &lt;&lt; &#39;\\n&#39;;\n    &#125;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"c.-query-on-a-tree-17\">C. Query On A Tree 17</h2>\n<p><a href=\"https://codeforces.com/gym/102759/problem/I\" class=\"uri\">https://codeforces.com/gym/102759/problem/I</a></p>\n<blockquote>\n<p>ç»™å®šä¸€ä¸ªä»¥ <span class=\"math inline\">\\(1\\)</span> ä¸ºæ ¹çš„æ ‘ï¼Œç‚¹æƒåˆå§‹ä¸ºå…¨ <span class=\"math inline\">\\(0\\)</span>ã€‚ç»´æŠ¤ <span class=\"math inline\">\\(m\\)</span> æ¬¡ä¿®æ”¹ï¼š</p>\n<ul>\n<li><code>1 u</code>ï¼Œè¡¨ç¤ºæŠŠ <span class=\"math inline\">\\(u\\)</span> å­æ ‘å†…çš„ç‚¹æƒåŠ ä¸€ã€‚</li>\n<li><code>2 u v</code>ï¼Œè¡¨ç¤ºæŠŠ <span class=\"math inline\">\\(u,v\\)</span> ç®€å•è·¯å¾„ä¸Šçš„ç‚¹æƒåŠ ä¸€ã€‚</li>\n</ul>\n<p>æ¯æ¬¡ä¿®æ”¹åï¼Œè¾“å‡ºæ ‘æ·±åº¦æœ€å°çš„å¸¦æƒé‡å¿ƒã€‚</p>\n<p><span class=\"math inline\">\\(n,m\\le 10^5\\)</span>ã€‚</p>\n</blockquote>\n<ul>\n<li><p>è€ƒè™‘é“¾ä¸Šçš„é—®é¢˜ï¼Œè€ƒè™‘ä¸€ç‚¹å°å¥¥åšæ³•ï¼ŒæŠŠæ‰€æœ‰ç‚¹é‡å¤å…¶å‡ºç°æ¬¡æ•°æ¬¡ï¼Œä»å·¦åˆ°å³æ’åˆ—ï¼Œå‘ç°ç­”æ¡ˆåœ¨ä¸­ä½æ•°ä¸Šã€‚</p>\n<p>ï¼ˆæ®ç»„é¢˜äººæ‰€è¨€ï¼‰ï¼Œè¿™æ˜¯ç”¨æ¥æç¤ºæ­£è§£çš„ã€‚äº‹å®ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ªå’Œå¸¦æƒé‡å¿ƒæœ‰å…³çš„ trickï¼š</p>\n<blockquote>\n<p>è‹¥ä¸€ä¸ªç‚¹ <span class=\"math inline\">\\(u\\)</span> æ˜¯<strong>æ·±åº¦æœ€å°çš„</strong>å¸¦æƒé‡å¿ƒï¼Œåˆ™å…¶å­æ ‘æƒå€¼å’Œå¿…é¡»<strong>ä¸¥æ ¼å¤§äº</strong>æ€»æƒå€¼çš„ä¸€åŠã€‚</p>\n</blockquote>\n<p>è¯æ˜æ˜¾ç„¶ï¼Œä½†ç»“è®ºä¸æ˜¾ç„¶ã€‚Whatever.</p></li>\n<li><p>ç”±è¿™ä¸€ç‚¹ä¼šå¾—åˆ°ï¼Œï¼ˆå‚ç…§é“¾ä¸Šçš„åšæ³•ï¼‰ï¼ŒæŠŠç‚¹é‡å¤ç‚¹æƒæ¬¡ï¼Œå¹¶æŒ‰ dfn æ’æˆä¸€è¡Œï¼Œå–ä¸­ä½æ•°ï¼Œé‚£ä¹ˆå–åˆ°çš„ä¸€å®šåœ¨<strong>æ·±åº¦æœ€å°çš„</strong>é‡å¿ƒå­æ ‘å†…ï¼Œï¼ˆè¿™å°±æ˜¯ç»„é¢˜äººè¯´çš„æç¤ºæ­£è§£ï¼‰ã€‚</p>\n<p>è¿™ä¸€ç‚¹åè€Œæ²¡é‚£ä¹ˆæ˜¾ç„¶ï¼Œæ¨å¯¼è¿‡ç¨‹æ˜¯ï¼Œ<strong>æ·±åº¦æœ€å°çš„</strong>é‡å¿ƒçš„å­æ ‘å äº†å¤§äºä¸€åŠï¼Œè€Œå…¶ dfn åˆæ˜¯è¿ç»­çš„ï¼Œï¼ˆç±»ä¼¼æ»‘åŠ¨çª—å£ï¼‰ï¼Œæ•…æ€»èƒ½å¤Ÿåˆ°ä¸­ä½æ•°ã€‚</p>\n<p>è€ƒè™‘éæ·±åº¦æœ€å°çš„é‡å¿ƒï¼Œæ­¤æ—¶å°±ä»<strong>ä¸¥æ ¼å¤§äº</strong>å˜ä¸º<strong>ä¸ä¸¥æ ¼å¤§äº</strong>ï¼Œå¯¼è‡´æ²¡æœ‰åŠæ³•å¾ˆå¥½åœ°ç²¾å‡†æ‰¾åˆ°ï¼Œéœ€è¦ä»ä¸­ä½æ•°å·¦å³åç§»ä¸€ä½ï¼Œæ˜¾ç„¶æ˜¯å¾ˆä¸‘é™‹çš„ã€‚</p></li>\n<li><p>å› æ­¤å¯ä»¥è€ƒè™‘çº¿æ®µæ ‘ä¸ŠäºŒåˆ†æ‰¾åˆ°ä¸­ä½æ•°ï¼ˆå®¹æ˜“å‘ç°çº¿æ®µæ ‘çš„ <span class=\"math inline\">\\(x\\)</span> è½´æœ¬æ¥å°±æ˜¯ dfnï¼‰ï¼Œç„¶åä»è¿™ä¸ªä¸­ä½æ•°å¾€ä¸Šè·³ï¼Œä¸€ç›´è·³åˆ°æ»¡è¶³ã€å­æ ‘æƒå€¼å’Œä¸¥æ ¼å¤§äºæ€»æƒå€¼ä¸€åŠã€çš„ç‚¹ï¼Œå°±æ˜¯æœ€æµ…çš„é‡å¿ƒã€‚</p>\n<p>è¿™ä¸€ç‚¹é‡‡ç”¨å€å¢å³å¯ã€‚</p></li>\n</ul>\n",
            "tags": [
                "DP",
                "æ ‘çŠ¶æ•°ç»„",
                "å€å¢",
                "è´ªå¿ƒ"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250924/",
            "url": "https://xsc062.netlify.app/20250924/",
            "title": "æ‚é¢˜é€‰è°ˆï¼šæœ€çŸ­è·¯",
            "date_published": "2025-09-24T06:27:15.000Z",
            "content_html": "<p>æœ€çŸ­è·¯ä¸ºèƒŒæ™¯çš„é¢˜ + åšæ³•æ˜¯æœ€çŸ­è·¯çš„é¢˜</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"a---minimum-path\">A - Minimum Path</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/CF1473E\" class=\"uri\">https://www.luogu.com.cn/problem/CF1473E</a></p>\n<ul>\n<li>ç»å…¸å¥—è·¯ï¼Œå‘ç°å¯ä»¥æŠŠ max å’Œ min æ¢æˆä»»æ„è·¯å¾„ä¸­çš„è¾¹ï¼Œç„¶å max å’Œ min å°±ä¼šæœ€å°åŒ–è¿™ä¸ªå¼å­</li>\n<li>æ•…å†™ä¸€ä¸ª Dijkstra + DPï¼Œæ±‚è¿™ä¸ªå¼å­çš„æœ€å°å€¼å³å¯</li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    using arr = std::vector&lt;long long&gt;;\n    using brr = std::vector&lt;arr&gt;;\n    std::vector&lt;std::vector&lt;std::pair&lt;int, int&gt; &gt; &gt; g(n + 1);\n    std::vector&lt;brr&gt; dis(2, brr(2, arr(n + 1, 1e18))), vis(2, brr(2, arr(n + 1)));\n    for (int x, y, w; m--; ) &#123;\n        std::cin &gt;&gt; x &gt;&gt; y &gt;&gt; w;\n        g[x].emplace_back(y, w);\n        g[y].emplace_back(x, w);\n    &#125;\n    dis[0][0][1] = 0;\n    std::array&lt;std::array&lt;std::priority_queue&lt;std::pair&lt;long long, int&gt; &gt;, 2&gt;, 2&gt; q;\n    q[0][0].emplace(0, 1);\n    for (int i = 0; i &lt; 2; ++i) &#123;\n        for (int j = 0; j &lt; 2; ++j) &#123;\n            for (; !q[i][j].empty(); ) &#123;\n                int f = q[i][j].top().second;\n                q[i][j].pop();\n                if (vis[i][j][f])\n                    continue;\n                vis[i][j][f] = 1;\n                for (auto k : g[f]) &#123;\n                    if (dis[i][j][k.first] &gt; dis[i][j][f] + k.second) &#123;\n                        dis[i][j][k.first] = dis[i][j][f] + k.second;\n                        q[i][j].emplace(-dis[i][j][k.first], k.first);\n                    &#125;\n                    if (!i &amp;&amp; dis[1][j][k.first] &gt; dis[i][j][f]) &#123;\n                        dis[1][j][k.first] = dis[i][j][f];\n                        q[1][j].emplace(-dis[1][j][k.first], k.first);\n                    &#125;\n                    if (!j &amp;&amp; dis[i][1][k.first] &gt; dis[i][j][f] + 2 * k.second) &#123;\n                        dis[i][1][k.first] = dis[i][j][f] + 2 * k.second;\n                        q[i][1].emplace(-dis[i][1][k.first], k.first);\n                    &#125;\n                &#125;\n            &#125;\n        &#125;\n    &#125;\n    for (int i = 2; i &lt;= n; ++i)\n        std::cout &lt;&lt; std::min(&#123; dis[0][0][i], dis[1][1][i] &#125;) &lt;&lt; &#39; &#39;;\n    std::cout &lt;&lt; &#39;\\n&#39;;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b---train-delay\">B - Train Delay</h2>\n<p><a href=\"https://vjudge.net/contest/750645#problem/B\" class=\"uri\">https://vjudge.net/contest/750645#problem/B</a></p>\n<ul>\n<li>ç®€åŒ–é¢˜ç›®å¾ˆé‡è¦çš„ä¸€ä¸ªè½¬åŒ–æ˜¯<strong>ç”±äº <span class=\"math inline\">\\(S\\le T\\)</span> å¸¦æ¥çš„ <span class=\"math inline\">\\(S\\)</span> å’Œ <span class=\"math inline\">\\(T\\)</span> åœ°ä½å¹³ç­‰ï¼Œè€ƒè™‘æŠŠå‡ºå‘å’Œåˆ°è¾¾åˆ†åˆ«çœ‹ä½œä¸€æ¬¡äº‹ä»¶å¤„ç†ã€‚</strong></li>\n<li><p>æŒ‰ç…§æ‰€æœ‰äº‹ä»¶çš„å‘ç”Ÿæ—¶åˆ»æ’åºï¼Œæœ‰ï¼š</p>\n<ul>\n<li>å¯¹äºä¸€æ¬¡å‡ºå‘äº‹ä»¶ï¼Œå¯ä»¥å¾—åˆ°åœ¨å…¶ä¹‹å‰è¯¥ç«™ç‚¹æ‰€æœ‰åˆ°è¾¾äº‹ä»¶çš„ <span class=\"math inline\">\\(\\max\\{T&#39;\\}\\)</span>ï¼Œç”¨ä¹‹æ›´æ–° <span class=\"math inline\">\\(X\\)</span> å³å¯ã€‚</li>\n<li>å¯¹äºä¸€æ¬¡åˆ°è¾¾äº‹ä»¶ï¼Œç”±äºå¯¹åº”çš„ <span class=\"math inline\">\\(X\\)</span> å·²ç»ç¡®å®šï¼Œæ›´æ–°è¯¥ç«™ç‚¹å½“å‰æœ€å¤§å€¼å³å¯ã€‚</li>\n</ul></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;int&gt; d(m + 1);\n    std::cin &gt;&gt; d[1];\n    struct event &#123;\n        int t, op, id, x;\n    &#125;;\n    std::vector&lt;event&gt; a;\n    std::vector&lt;int&gt; mx(n + 1);\n    for (int i = 1, x, y, s, t; i &lt;= m; ++i) &#123;\n        std::cin &gt;&gt; x &gt;&gt; y &gt;&gt; s &gt;&gt; t;\n        a.push_back(&#123; s, 0, i, x &#125;);\n        a.push_back(&#123; t, 1, i, y &#125;);\n    &#125;\n    std::sort(a.begin(), a.end(), [&amp;](event &amp;x, event &amp;y) &#123; return x.t == y.t ? x.op &gt; y.op : x.t &lt; y.t; &#125;);\n    for (auto [t, op, id, x] : a)\n        if (op == 1)\n            mx[x] = std::max(mx[x], t + d[id]);\n        else if (id != 1)\n            d[id] = std::max(mx[x] - t, 0);\n    for (int i = 2; i &lt;= m; ++i)\n        std::cout &lt;&lt; d[i] &lt;&lt; &#39; &#39;;\n    std::cout &lt;&lt; &#39;\\n&#39;;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"c---complete-the-graph\">C - Complete The Graph</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/CF715B\" class=\"uri\">https://www.luogu.com.cn/problem/CF715B</a></p>\n<p>ç¥ä»™äºŒåˆ†</p>\n<ul>\n<li>å¦‚æœåˆå§‹æŠŠæ‰€æœ‰ç™½è¾¹ç½®ä¸º <span class=\"math inline\">\\(1\\)</span>ï¼Œé‚£ä¹ˆä¼šæƒ³åˆ°è°ƒæ•´æ³•æ„é€ </li>\n<li>ä½†æ˜¯ä¸çŸ¥é“åº”è¯¥åœ¨å“ªäº›è¾¹ä¸Šè°ƒæ•´ï¼Œç¡®å®šè°ƒæ•´å¤šå°‘ä¼¼ä¹ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç®€å•çš„åšæ³•</li>\n<li><p>æ•…<strong>å¹³å‡ç”¨åŠ›</strong>ï¼Œæ„é€ ä¸€ä¸ª è¾¹1 += 1ï¼Œè¾¹2 += 1ï¼Œè¾¹3 += 1, â€¦, è¾¹cnt0 += 1, è¾¹1 += 1, è¾¹2 += 1, â€¦ çš„æ“ä½œåºåˆ—</p>\nå®¹æ˜“<strong>å‘ç°æ¯æ¬¡æ“ä½œæœ€å¤šè®©å½“å‰æœ€çŸ­è·¯é•¿åº¦å¢åŠ  1</strong>ï¼Œè€Œä¸”æœ‰å•è°ƒæ€§</li>\n<li><p>æ•…äºŒåˆ†ç­”æ¡ˆå³å¯</p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst __int128 inf = 1e18;\nconst __int128 inff = 1e23;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int n, m, s, t, l, cnt = 0;\n    std::cin &gt;&gt; n &gt;&gt; m &gt;&gt; l &gt;&gt; s &gt;&gt; t, ++s, ++t;\n    std::vector&lt;std::tuple&lt;int, int, long long&gt; &gt; u(m + 1);\n    std::vector&lt;std::vector&lt;std::pair&lt;int, long long&gt; &gt; &gt; g(n + 1);\n    for (int i = 1, x, y; i &lt;= m; ++i) &#123;\n        long long w;\n        std::cin &gt;&gt; x &gt;&gt; y &gt;&gt; w, ++x, ++y;\n        if (w == 0)\n            w = -(++cnt);\n        g[x].emplace_back(y, w), g[y].emplace_back(x, w);\n        u[i] = &#123; x, y, w &#125;;\n    &#125;\n    std::vector&lt;int&gt; vis(n + 1);\n    std::vector&lt;__int128&gt; dis(n + 1);\n    std::vector&lt;long long&gt; k(cnt + 1);\n    __int128 res = -1;\n    auto check = [&amp;](__int128 x) &#123;\n        for (int i = 1; i &lt;= cnt; ++i)\n            k[i] = x / cnt + (i &lt;= x % cnt);\n        std::fill(vis.begin() + 1, vis.end(), 0);\n        std::fill(dis.begin() + 1, dis.end(), inf);\n        std::priority_queue&lt;std::pair&lt;__int128, int&gt; &gt; q;\n        dis[s] = 0, q.emplace(0, s);\n        for (; !q.empty(); ) &#123;\n            int f = q.top().second;\n            q.pop();\n            if (vis[f])\n                continue;\n            vis[f] = 1;\n            for (auto [v, w] : g[f]) &#123;\n                if (w &lt; 0)\n                    w = k[-w];\n                if (dis[v] &gt; dis[f] + w) &#123;\n                    dis[v] = dis[f] + w;\n                    q.emplace(-dis[v], v);\n                &#125;\n            &#125;\n        &#125;\n        return dis[t] &lt;= l;\n    &#125;;\n    for (__int128 l = cnt, r = cnt * inf, mid; l &lt;= r; ) &#123;\n        mid = (l + r) &gt;&gt; 1;\n        if (check(mid))\n            res = mid, l = mid + 1;\n        else\n            r = mid - 1;\n    &#125;\n    if (res == -1)\n        std::cout &lt;&lt; &quot;NO\\n&quot;;\n    else &#123;\n        check(res);\n        if (dis[t] != l)\n            std::cout &lt;&lt; &quot;NO\\n&quot;;\n        else &#123;\n            std::cout &lt;&lt; &quot;YES\\n&quot;;\n            for (int i = 1; i &lt;= m; ++i) &#123;\n                auto [x, y, w] = u[i];\n                if (w &lt; 0)\n                    w = k[-w];\n                std::cout &lt;&lt; x - 1 &lt;&lt; &#39; &#39; &lt;&lt; y - 1 &lt;&lt; &#39; &#39; &lt;&lt; w &lt;&lt; &#39;\\n&#39;;\n            &#125;\n        &#125;\n    &#125;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"a---é‡åŠ›çƒ\">A - é‡åŠ›çƒ</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P7473\" class=\"uri\">https://www.luogu.com.cn/problem/P7473</a></p>\n<ul>\n<li><span class=\"math inline\">\\(m\\)</span> ç›¸å¯¹å¾ˆå°ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆåŸºäº <span class=\"math inline\">\\(m\\)</span> çš„åšæ³•</li>\n<li>æ¯æ¬¡çƒåœä¸‹çš„ä½ç½®ä¸€å®šæ˜¯æŸä¸ªéšœç¢ç‰©ï¼ˆæˆ–è¾¹ç•Œï¼‰ä¸Š / ä¸‹ / å·¦ / å³çš„æ ¼å­ï¼Œæ•…å¯ä»¥åœ¨è¿™ <span class=\"math inline\">\\(O(n + m)\\)</span> ä¸ªç‚¹ä¸Šå»ºå›¾</li>\n<li>æ€ä¹ˆåŒæ—¶ç»´æŠ¤ä¸¤ä¸ªçƒçš„ä¿¡æ¯å‘¢ï¼Œå‘ç° <span class=\"math inline\">\\(m\\)</span> è¿˜æ˜¯å¾ˆå°ï¼Œæ‰€ä»¥å¯ä»¥æŠŠä¸¤ä¸ªçƒå¡ä¸€èµ·ä½œä¸ºä¸€ä¸ªçŠ¶æ€</li>\n<li><p><span class=\"math inline\">\\(m^2\\)</span> æ¬¡ Dij è¿˜æ˜¯å¤ªæ¿€è¿›äº† è¿›ä¸€æ­¥æ€è€ƒå‘ç°å¯èƒ½çš„ç»ˆç‚¹å…± <span class=\"math inline\">\\(m\\)</span> ä¸ª å¹¶ä¸”å½¼æ­¤ä¸åŒºåˆ†</p>\n<p>æ•…ä»¥è¿™ <span class=\"math inline\">\\(m\\)</span> ä¸ªç»ˆç‚¹è·‘å¤šæºæœ€çŸ­è·¯å³å¯</p>\n<p>ä½† 5e6 è·‘ Dij è¿˜æ˜¯å¤ªå‹‰å¼ºäº†ã€‚<strong>å‘ç°è¾¹æƒä¸º 1ï¼Œä¸ºä»€ä¹ˆä¸ BFS å‘¢ ğŸ˜…</strong></p></li>\n<li><p>å‘ç°èµ·ç‚¹å¯èƒ½ä¸åœ¨æˆ‘ä»¬é™å®šçš„ç‚¹ä¸Šï¼Œä½†å¯ä»¥äººä¸ºé€‰æ‹©ä¸€æ¬¡é‡åŠ›æ–¹å‘ï¼Œç„¶åå°±å›åˆ°åˆšåˆšçš„é—®é¢˜äº†</p>\n<p>æˆ–è€…ç¦»çº¿ä¹Ÿæ˜¯ä¸€ç§æ–¹æ³•</p></li>\n</ul>\n<p>ç–‘ä¼¼å¸¸æ•°å¤ªå¤§ï¼Œæ‹¼å°½å…¨åŠ›å‹‰å¼ºå¡è¿‡</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int LEN = (1 &lt;&lt; 20);\n#ifdef ONLINE_JUDGE\ninline int nec(void) &#123;\n    static char buf[LEN], *p = buf, *e = buf;\n    if (p == e) &#123;\n        e = buf + fread(buf, 1, LEN, stdin);\n        if (e == buf)\n            return EOF;\n        p = buf;\n    &#125;\n    return *p++;\n&#125;\n#else\n#define nec getchar\n#endif\ninline bool read(int &amp;x) &#123;\n    x = 0;\n    bool f = 0;\n    char ch = nec();\n    while (ch &lt; &#39;0&#39; || ch &gt; &#39;9&#39;) &#123;\n        if (ch == EOF)\n            return 0;\n        if (ch == &#39;-&#39;)\n            f = 1;\n        ch = nec();\n    &#125;\n    while (ch &gt;= &#39;0&#39; &amp;&amp; ch &lt;= &#39;9&#39;) &#123;\n        x = x * 10 + ch - &#39;0&#39;;\n        ch = nec();\n    &#125;\n    if (f)\n        x = -x;\n    return 1;\n&#125;\nvoid print(int x) &#123;\n    if (x &lt; 0) &#123;\n        putchar(&#39;-&#39;);\n        x = -x;\n    &#125;\n    if (x &gt;= 10)\n        print(x / 10);\n    putchar(x % 10 + &#39;0&#39;);\n    return;\n&#125;\nvoid print(int x, char ch) &#123;\n    print(x);\n    putchar(ch);\n    return;\n&#125;\nconst int inf = 0x3f3f3f3f;\nconst int dir[][2] = &#123;&#123; -1, 0 &#125;, &#123; 1, 0 &#125;, &#123; 0, -1 &#125;, &#123; 0, 1 &#125;&#125;;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int n, m, q;\n    read(n), read(m), read(q);\n    std::vector&lt;std::pair&lt;int, int&gt; &gt; pos(m + 1);\n    std::vector&lt;std::vector&lt;int&gt; &gt; a(n + 1, std::vector&lt;int&gt; (n + 1));\n    for (int i = 1, x, y; i &lt;= m; ++i) &#123;\n        read(x), read(y);\n        pos[i] = &#123; x, y &#125;, a[x][y] = -1;\n    &#125;\n    for (int i = 1; i &lt;= n; ++i)\n        pos.emplace_back(0, i), ++m;\n    for (int i = 1; i &lt;= n; ++i)\n        pos.emplace_back(i, n + 1), ++m;\n    for (int i = 1; i &lt;= n; ++i)\n        pos.emplace_back(n + 1, i), ++m;\n    for (int i = 1; i &lt;= n; ++i)\n        pos.emplace_back(i, 0), ++m;\n    int cnt = 0;\n    std::vector&lt;std::pair&lt;int, int&gt; &gt; u(1);\n    for (int i = 1; i &lt;= m; ++i)\n        for (auto [fx, fy] : dir) &#123;\n            int nx = pos[i].first + fx, ny = pos[i].second + fy;\n            if (nx &gt;= 1 &amp;&amp; nx &lt;= n &amp;&amp; ny &gt;= 1 &amp;&amp; ny &lt;= n &amp;&amp; !a[nx][ny])\n                a[nx][ny] = ++cnt, u.emplace_back(nx, ny);\n        &#125;\n    std::vector&lt;std::vector&lt;std::array&lt;int, 4&gt; &gt; &gt; top(n + 1, std::vector&lt;std::array&lt;int, 4&gt; &gt; (n + 1));\n    for (int j = 1; j &lt;= n; ++j) &#123;\n        for (int i = 1; i &lt;= n; ++i)\n            if (a[i][j] != -1) &#123;\n                if (i == 1 || a[i - 1][j] == -1)\n                    top[i][j][0] = a[i][j];\n                else\n                    top[i][j][0] = top[i - 1][j][0];\n            &#125;\n        for (int i = n; i; --i)\n            if (a[i][j] != -1) &#123;\n                if (i == n || a[i + 1][j] == -1)\n                    top[i][j][1] = a[i][j];\n                else\n                    top[i][j][1] = top[i + 1][j][1];\n            &#125;\n    &#125;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        for (int j = 1; j &lt;= n; ++j)\n            if (a[i][j] != -1) &#123;\n                if (j == 1 || a[i][j - 1] == -1)\n                    top[i][j][2] = a[i][j];\n                else\n                    top[i][j][2] = top[i][j - 1][2];\n            &#125;\n        for (int j = n; j; --j)\n            if (a[i][j] != -1) &#123;\n                if (j == n || a[i][j + 1] == -1)\n                    top[i][j][3] = a[i][j];\n                else\n                    top[i][j][3] = top[i][j + 1][3];\n            &#125;\n    &#125;\n    const int N = cnt * cnt;\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(N + 1);\n    auto encode = [&amp;](int x, int y) &#123;\n        return (x - 1) * cnt + y;\n    &#125;;\n    auto decode = [&amp;](int id) &#123;\n        return std::make_pair((id - 1) / cnt + 1, (id - 1) % cnt + 1);\n    &#125;;\n    for (int i = 1; i &lt;= N; ++i)\n        for (int j = 0; j &lt; 4; ++j) &#123;\n            auto [a, b] = decode(i);\n            g[encode(top[u[a].first][u[a].second][j], top[u[b].first][u[b].second][j])].emplace_back(i);\n        &#125;\n    std::vector&lt;int&gt; dis(N + 1, inf), vis(N + 1);\n    &#123;\n        std::queue&lt;int&gt; q;\n        for (int i = 1; i &lt;= cnt; ++i)\n            dis[encode(i, i)] = 0, q.push(encode(i, i)), vis[encode(i, i)] = 1;\n        for (; !q.empty(); ) &#123;\n            int x = q.front();\n            q.pop();\n            for (auto i : g[x])\n                if (!vis[i])\n                    dis[i] = dis[x] + 1, vis[i] = 1, q.push(i);\n        &#125;\n    &#125;\n    for (int a, b, c, d; q--; ) &#123;\n        read(a), read(b), read(c), read(d);\n        if (a == c &amp;&amp; b == d)\n            print(0, &#39;\\n&#39;);\n        else &#123;\n            int res = inf;\n            for (int j = 0; j &lt; 4; ++j)\n                res = std::min(res, dis[encode(top[a][b][j], top[c][d][j])] + 1);\n            if (res == inf)\n                print(-1, &#39;\\n&#39;);\n            else\n                print(res, &#39;\\n&#39;);\n        &#125;\n    &#125;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b---çŸ©é˜µæ¸¸æˆ\">B - çŸ©é˜µæ¸¸æˆ</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P7515\" class=\"uri\">https://www.luogu.com.cn/problem/P7515</a></p>\n<ul>\n<li><p>æŠŠé—®é¢˜å½¢å¼åŒ–ä¸€ä¸‹ï¼Œç°åœ¨æœ‰ <span class=\"math inline\">\\(n\\times m\\)</span> ä¸ªæœªçŸ¥æ•°å’Œ <span class=\"math inline\">\\((n-1)\\times (m-1)\\)</span> ä¸ªæ–¹ç¨‹</p>\n<p>é‚£ä¹ˆå¯ä»¥å¯¹è¾¹ä¸Šä¸€åœˆä»»æ„èµ‹å€¼ï¼Œé™åˆ¶æ˜¯å·¦ä¸Šè§’è¿™ <span class=\"math inline\">\\((n-1)\\times (m-1)\\)</span> ä¸ªæœªçŸ¥æ•°å¿…é¡»è½åœ¨ <span class=\"math inline\">\\([0,10^6]\\)</span> ä¸Š</p></li>\n<li>æœ‰ä¸€ä¸ªå¾ˆå®¹æ˜“è§‚å¯Ÿåˆ°çš„æ€§è´¨ï¼Œå¯¹äºä¸€ä¸ª <span class=\"math inline\">\\(a\\)</span>ï¼Œé€‰å–ä¸€ä¸ª <span class=\"math inline\">\\(v\\)</span>ï¼Œå¹¶æŠŠæ£‹ç›˜é»‘ç™½æŸ“è‰²ï¼Œé‚£ä¹ˆæŠŠæ‰€æœ‰é»‘æ ¼ <span class=\"math inline\">\\(+=v\\)</span>ï¼Œç™½æ ¼ <span class=\"math inline\">\\(-=v\\)</span>ï¼Œå¯¹åº”çš„ <span class=\"math inline\">\\(b\\)</span> æ˜¯ä¸ä¼šå˜çš„ã€‚</li>\n<li><p><strong>è¿™ä¸ªæ“ä½œæ˜¯æ¶‰åŠå…¨å±€çš„ï¼Œå¤ªè‹›åˆ»äº†</strong>ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ›´ mild çš„æ„é€ ï¼Ÿ</p>\n<p>å‘ç°åªå¯¹ä¸€è¡Œ / åˆ—é»‘ç™½æŸ“è‰²å¹¶æ“ä½œä¹Ÿå¯ä»¥å¾—åˆ°ç›¸åŒçš„ç»“æœã€‚èƒ½æ„Ÿå—åˆ°<strong>æ“ä½œæ— æ³•å†ç®€åŒ–äº†</strong>ã€‚è€ƒè™‘ç”¨è¿™ä¸ªç‰ˆæœ¬çš„æ“ä½œ<strong>è°ƒæ•´</strong>ã€‚</p></li>\n<li>æ•…å¤§åŠ›ä»¤å‘¨å›´ä¸€åœˆçš„ä¸´æ—¶è§£ <span class=\"math inline\">\\(a&#39;\\)</span> ä¸º <span class=\"math inline\">\\(0\\)</span>ï¼Œä»¤æ¯è¡Œã€åˆ—çš„è°ƒæ•´ delta ä¸º <span class=\"math inline\">\\(r_i,c_i\\)</span>ï¼Œå¯ä»¥å¾—åˆ°è‹¥å¹²ä¸ªå…³äº <span class=\"math inline\">\\(0\\)</span> å’Œ <span class=\"math inline\">\\(10^6\\)</span> çš„çº¦æŸã€‚æœ€åå»ºå‡ºæ¥ä¸€ä¸ªå®Œå…¨äºŒåˆ†å›¾çŠ¶ç‰©ï¼Œè·‘å·®åˆ†çº¦æŸå³å¯ï¼Œå®¹æ˜“å‘ç°å¤æ‚åº¦æ­£ç¡®ã€‚</li>\n<li><p>å®ç°æŠ€å·§ï¼šè§„åˆ’ä¸€ä¸‹ <span class=\"math inline\">\\(r\\)</span> å’Œ <span class=\"math inline\">\\(c\\)</span> çš„æŸ“è‰²æ–¹å¼ï¼Œä½¿å¾—å®ƒä»¬é”™å¼€ï¼Œå¯ä»¥æŠŠæ‰€æœ‰ä½ç½®éƒ½å†™ä½œ <span class=\"math inline\">\\(a&#39;_{i,j}+c-r\\)</span> æˆ– <span class=\"math inline\">\\(a&#39;_{i,j}+r-c\\)</span> çš„å½¢å¼ï¼Œä¾¿äºå·®åˆ†çº¦æŸ</p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code></code></pre>\n</details>\n<hr />\n<h2 id=\"c---tax\">C - Tax</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P6822\" class=\"uri\">https://www.luogu.com.cn/problem/P6822</a></p>\n<ul>\n<li>å®¹æ˜“æƒ³åˆ°åˆ†ç±»è®¨è®ºï¼Œå¦‚æœé’¦å®šæ˜¯å…¥è¾¹è´¡çŒ®è¾¹æƒï¼Œé‚£ä¹ˆå‡ºè¾¹è¾¹æƒä¸èƒ½å¤§äºå…¥è¾¹è¾¹æƒï¼›å¦åˆ™ï¼Œå‡ºè¾¹è´¡çŒ®è¾¹æƒã€‚</li>\n<li>è€ƒè™‘æŠŠæ¯ä¸ªç‚¹ä¸Šçš„å‡ºè¾¹æŒ‰è¾¹æƒä»å°åˆ°å¤§æ’åºï¼Œæ˜¾ç„¶éœ€è¦å…¥è¾¹è´¡çŒ®çš„æ˜¯ä¸€æ®µå‰ç¼€ï¼Œéœ€è¦å‡ºè¾¹è´¡çŒ®çš„æ˜¯ä¸€æ®µåç¼€ï¼Œå°±å¯ä»¥åšä¸€ä¸ªå‰åç¼€ä¼˜åŒ–å»ºå›¾ã€‚</li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 1e18;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    struct edge &#123; int v, w, id, pi, si; &#125;;\n    std::vector&lt;std::vector&lt;edge&gt; &gt; g1(n + 2);\n    std::vector&lt;std::vector&lt;std::pair&lt;int, int&gt; &gt; &gt; g(1);\n    int cnt = 0;\n    for (int x, y, w; m--; ) &#123;\n        std::cin &gt;&gt; x &gt;&gt; y &gt;&gt; w;\n        g1[x].push_back(&#123; y, w, ++cnt, 0, 0 &#125;);\n        g1[y].push_back(&#123; x, w, ++cnt, 0, 0 &#125;);\n        g.emplace_back(), g.emplace_back();\n    &#125;\n    int s = ++cnt, t = ++cnt;\n    g1[0].push_back(&#123; 1, 0, s, 0, 0 &#125;), g1[n].push_back(&#123; n + 1, 0, t, 0, 0 &#125;);\n    g.emplace_back(), g.emplace_back();\n    for (int i = 0; i &lt;= n + 1; ++i)\n        if (!g1[i].empty()) &#123;\n            std::sort(g1[i].begin(), g1[i].end(), [&amp;](edge &amp;x, edge &amp;y) &#123; return x.w &lt; y.w; &#125;);\n            for (int j = 0; j &lt; (int)g1[i].size(); ++j) &#123;\n                g1[i][j].pi = ++cnt, g.emplace_back();\n                if (j != 0)\n                    g[cnt].emplace_back(cnt - 1, 0);\n                g[cnt].emplace_back(g1[i][j].id, 0);\n            &#125;\n            for (int j = (int)g1[i].size() - 1; ~j; --j) &#123;\n                g1[i][j].si = ++cnt, g.emplace_back();\n                if (j != (int)g1[i].size() - 1)\n                    g[cnt].emplace_back(cnt - 1, 0);\n                g[cnt].emplace_back(g1[i][j].id, g1[i][j].w);\n            &#125;\n        &#125;\n    for (int i = 0; i &lt;= n + 1; ++i)\n        for (auto &amp;[v, w, id, pi, si] : g1[i]) &#123;\n            auto to = std::upper_bound(g1[v].begin(), g1[v].end(), w, [&amp;](int x, edge &amp;y) &#123; return x &lt; y.w; &#125;);\n            if (to != g1[v].end())\n                g[id].emplace_back(to-&gt;si, 0);\n            if (to != g1[v].begin())\n                g[id].emplace_back((--to)-&gt;pi, w);\n        &#125;\n    std::vector&lt;int&gt; vis(cnt + 1, 0);\n    std::vector&lt;long long&gt; dis(cnt + 1, inf);\n    std::priority_queue&lt;std::pair&lt;long long, int&gt; &gt; q;\n    dis[s] = 0, q.emplace(0, s);\n    for (; !q.empty(); ) &#123;\n        int f = q.top().second;\n        q.pop();\n        if (vis[f])\n            continue;\n        vis[f] = 1;\n        for (auto [v, w] : g[f])\n            if (dis[v] &gt; dis[f] + w) &#123;\n                dis[v] = dis[f] + w;\n                q.emplace(-dis[v], v);\n            &#125;\n    &#125;\n    std::cout &lt;&lt; dis[t] &lt;&lt; &#39;\\n&#39;;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"d---travelling-through-the-snow-queens-kingdom\">D - Travelling Through the Snow Queenâ€™s Kingdom</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/CF685E\" class=\"uri\">https://www.luogu.com.cn/problem/CF685E</a></p>\n<p>ç›®å‰è§è¿‡çš„æ•°æ®èŒƒå›´æç¤ºæ€§æå¼±ï¼ˆè¯¯å¯¼æ€§æå¼ºï¼‰çš„å¾ªç¯ç»“æ„é¢˜ï¼š</p>\n<ul>\n<li>[BZOJ3620] ä¼¼ä¹åœ¨æ¢¦ä¸­è§è¿‡çš„æ ·å­</li>\n<li><a href=\"/20240906/#å­—ç¬¦åˆå¹¶\">å­—ç¬¦åˆå¹¶</a></li>\n<li><a href=\"/20250907/#e---subset-product-problem\">[ARC205E] Subset Product Problem</a></li>\n</ul>\n<p>æ­£èµ›å› ä¸ºæœ‰éƒ¨åˆ†åˆ†ï¼Œåº”è¯¥ä¸ä¼šå‡ºç°ä¸æ•¢å†™çš„é—®é¢˜</p>\n<ul>\n<li>è€ƒè™‘ç¦»çº¿è¯¢é—®ï¼Œé€†åºåŠ è¾¹ï¼›åŸæ–‡æ— è¾¹æƒï¼›è¾¹çš„é€šè¡Œæ—¶åˆ»åªå†³å®šåˆ°è¾¾ç‚¹çš„æ—¶åˆ»ã€‚</li>\n<li><p>å€Ÿé‰´ <a href=\"/20231113/#b.-å•†äºº\">merchant</a> ä¸­çš„æ€è·¯ï¼Œåªéœ€è¦æ›´æ–°å½“å‰è¾¹ä¸¤ä¾§ç‚¹ä¸ºèµ·ç‚¹çš„ DP æ•°ç»„ã€‚</p>\n<p>éœ€è¦æ³¨æ„è¾¹ä»æŸç§æ„ä¹‰ä¸Šè¯´æ˜¯ã€æœ‰å‘ã€çš„ã€‚</p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int inf = 0x3f3f3f3f;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int n, m, q;\n    std::cin &gt;&gt; n &gt;&gt; m &gt;&gt; q;\n    struct query &#123; int r, s, t, id; &#125;;\n    std::vector&lt;int&gt; res(q + 1);\n    std::vector&lt;std::vector&lt;query&gt; &gt; u(m + 1);\n    std::vector&lt;std::pair&lt;int, int&gt; &gt; e(m + 1);\n    for (int i = 1; i &lt;= m; ++i)\n        std::cin &gt;&gt; e[i].first &gt;&gt; e[i].second;\n    for (int i = 1, l, r, s, t; i &lt;= q; ++i) &#123;\n        std::cin &gt;&gt; l &gt;&gt; r &gt;&gt; s &gt;&gt; t;\n        u[l].push_back(&#123; r, s, t, i &#125;);\n    &#125;\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1, std::vector&lt;int&gt; (n + 1, inf));\n    for (int i = m; i; --i) &#123;\n        auto [x, y] = e[i];\n        g[x][y] = g[y][x] = i;\n        for (int j = 1; j &lt;= n; ++j)\n            g[x][j] = g[y][j] = std::min(g[x][j], g[y][j]);\n        for (auto [r, s, t, id] : u[i])\n            if (g[s][t] &lt;= r)\n                res[id] = 1;\n    &#125;\n    for (int i = 1; i &lt;= q; ++i)\n        std::cout &lt;&lt; (res[i] ? &quot;Yes&quot; : &quot;No&quot;) &lt;&lt; &#39;\\n&#39;;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"e---culture-code\">E - Culture Code</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/CF1197E\" class=\"uri\">https://www.luogu.com.cn/problem/CF1197E</a></p>\n<ul>\n<li>å…ˆæŒ‰ <span class=\"math inline\">\\(out\\)</span> æ’åºï¼Œåšä¸€ä¸ªå‰ç¼€ä¼˜åŒ–å»ºå›¾ã€‚</li>\n<li><p>å®¹æ˜“å‘ç°é™¤äº†æœ€å¤–å±‚ï¼Œæ¯ä¸€ä¸ªå¥—å¨ƒéƒ½ä¼šæä¾› <span class=\"math inline\">\\(in_i-out_i\\)</span> çš„ä»£ä»·ï¼Œè€Œæœ€å¤–å±‚ä¼šæä¾› <span class=\"math inline\">\\(in_x\\)</span> çš„ä»£ä»·ã€‚</p>\n<del>å¥½åœ¨è¦æ±‚çš„æ˜¯æœ€é•¿è·¯ï¼Œè¿™æ ·å°±å¯ä»¥ Dij äº†</del>ï¼Œå¹¶ä¸éœ€è¦çœŸæ­£æŠŠå›¾å»ºå‡ºæ¥ï¼Œå‘ç°è¿™ä¸ªå½¢å¼æ›´åºåˆ—ï¼Œç›´æ¥åœ¨åºåˆ—ä¸ŠäºŒåˆ†å‰ç¼€ + DP å³å¯ã€‚</li>\n<li><p>æ±‚æ–¹æ¡ˆæ˜¯å®¹æ˜“çš„ã€‚æœ€åç»Ÿè®¡ DP å€¼æœ€å¤§ï¼Œ<strong>ä¸”ä¸èƒ½è¢«å…¶ä»–å¥—å¨ƒåŒ…å«çš„å…ƒç´ </strong>å³å¯ã€‚</p>\n<p>Tipï¼šåœ¨æ±‚è§£è¿‡ç¨‹ä¸­å¹¶ä¸ç”¨è€ƒè™‘å½“å‰å…ƒç´ å’Œå‰ç¼€ min å…ƒç´ é—´èƒ½å¦åŠ å…¥å…¶ä»–å¥—å¨ƒï¼Œå› ä¸ºä¿è¯ <span class=\"math inline\">\\(out&gt;in\\)</span>ï¼Œå¦‚æœå­˜åœ¨è¿™æ ·çš„å¥—å¨ƒï¼Œå…¶ DP å€¼ä¼šæ¯”å‰ç¼€ min æ›´å°ï¼ŒçŸ›ç›¾ã€‚</p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 1e9 + 7;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;std::pair&lt;int, int&gt; &gt; a(n + 1);\n    int mxi = 0;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i].first &gt;&gt; a[i].second;\n        mxi = std::max(mxi, a[i].second);\n    &#125;\n    std::sort(a.begin() + 1, a.end());\n    std::vector&lt;long long&gt; g(n + 1), mxg(n + 1), f(n + 1), mx(n + 1);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        int j = std::upper_bound(a.begin() + 1, a.begin() + i, std::make_pair(a[i].second, 0x3f3f3f3f)) - a.begin() - 1;\n        if (j == 0)\n            f[i] = a[i].second, g[i] = 1ll;\n        else\n            f[i] = mx[j] + a[i].second, g[i] = mxg[j];\n        long long now = f[i] - a[i].first;\n        if (now &lt; mx[i - 1])\n            mx[i] = now, mxg[i] = g[i];\n        else if (now == mx[i - 1])\n            mx[i] = now, mxg[i] = (mxg[i - 1] + g[i]) % mod;\n        else\n            mx[i] = mx[i - 1], mxg[i] = mxg[i - 1];\n    &#125;\n    auto now = 0x3f3f3f3fll, res = 0ll;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        if (a[i].first &lt;= mxi)\n            continue;\n        if (f[i] &lt; now)\n            now = f[i], res = g[i];\n        else if (f[i] == now)\n            (res += g[i]) %= mod;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"a---awesome-arrowland-adventure\">A - Awesome Arrowland Adventure</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P6233\" class=\"uri\">https://www.luogu.com.cn/problem/P6233</a></p>\n<ul>\n<li>æ²¡ä»€ä¹ˆå¥½è¯´çš„å»ºå›¾ï¼Œæ³¨æ„åªèƒ½é¡ºæ—¶é’ˆè½¬</li>\n<li>ä»£ç ç•¥</li>\n</ul>\n<hr />\n<h2 id=\"b---åœ°é“çº¿è·¯\">B - åœ°é“çº¿è·¯</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P6096\" class=\"uri\">https://www.luogu.com.cn/problem/P6096</a></p>\n<ul>\n<li>è€ƒè™‘åšä¸€ä¸ªç¥ç§˜æ‹†ç‚¹ï¼ŒæŠŠæ¯ä¸ªç‚¹é™„ä¸Šçº¿è·¯å’Œè¿è¡Œæ–¹å‘çš„ä¿¡æ¯ï¼ˆæ‰€ä»¥æ˜¯å•å‘çš„ï¼‰</li>\n<li>è®¤ä¸ºè·¯å¾„ä»£ä»·æ˜¯äºŒå…ƒç»„ï¼Œé‚£ä¹ˆåŒæ¡çº¿è·¯ä¸­çš„ç‚¹é€šè¡Œä»£ä»·ä¸º <span class=\"math inline\">\\((0,-1)\\)</span></li>\n<li>æ¢ä¹˜éœ€è¦ä¼˜åŒ–å»ºå›¾ï¼Œæ¯ä¸ªç‚¹å¯ä»¥èŠ± <span class=\"math inline\">\\((0,0)\\)</span> çš„ä»£ä»·èµ°åˆ°è¿™ä¸ªç‚¹çš„ã€æ¢ä¹˜ç‚¹ã€ï¼Œå†èŠ± <span class=\"math inline\">\\((1,0)\\)</span> çš„ä»£ä»·èµ°åˆ°å¦ä¸€ä¸ªåˆ†ç‚¹</li>\n<li><p>ä½† <strong>15 å¹´çš„æ—¶å€™ SPFA å·²ç»æ­»äº†</strong>ï¼Œæ‰€ä»¥éœ€è¦å¥½å¥½è€ƒè™‘æ€ä¹ˆå®ç°æœ€çŸ­è·¯ã€‚</p>\n<p>åˆ†ä¸¤é—®æ˜¯æœ‰æç¤ºæ€§åœ¨çš„ï¼Œå¯ä»¥æƒ³åˆ° 01 BFS è§£å†³ç¬¬ä¸€ä¸ªå…³é”®å­—ï¼Œæ¯”è¾ƒå¯¹çš„æƒ³æ³•æ˜¯<strong>æŠŠæ‰€æœ‰æœ€çŸ­è·¯æ‹¿å‡ºæ¥å½¢æˆ DAGï¼Œåœ¨ DAG ä¸Šå¯¹ç¬¬äºŒå…³é”®å­— DP</strong>ã€‚</p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int n, m;\n    std::cin &gt;&gt; m &gt;&gt; n;\n    std::unordered_map&lt;std::string, int&gt; tab;\n    std::vector&lt;std::vector&lt;int&gt; &gt; l(n + 1);\n    std::vector&lt;std::vector&lt;std::tuple&lt;int, int, int&gt; &gt; &gt; g0(n + 1), g1(n + 1);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::string s;\n        std::cin &gt;&gt; s, tab[s] = i;\n    &#125;\n    int tot = n;\n    for (int i = 1, k; i &lt;= m; ++i) &#123;\n        std::cin &gt;&gt; k;\n        int lp = 0, lq = 0;\n        for (std::string s; k--; ) &#123;\n            std::cin &gt;&gt; s;\n            int p = ++tot, q = ++tot, id = tab[s];\n            g0.emplace_back(), g0.emplace_back();\n            g1.emplace_back(), g1.emplace_back();\n            if (lp) &#123;\n                g0[p].emplace_back(lp, 0, 1), g0[lq].emplace_back(q, 0, 1);\n                g1[lp].emplace_back(p, 0, 1), g1[q].emplace_back(lq, 0, 1);\n            &#125;\n            g0[p].emplace_back(id, 0, 0), g0[id].emplace_back(p, 1, 0);\n            g1[id].emplace_back(p, 0, 0), g1[p].emplace_back(id, 1, 0);\n            g0[q].emplace_back(id, 0, 0), g0[id].emplace_back(q, 1, 0);\n            g1[id].emplace_back(q, 0, 0), g1[q].emplace_back(id, 1, 0);\n            l[id].push_back(p), l[id].push_back(q);\n            lp = p, lq = q;\n        &#125;\n    &#125;\n    int s, t;\n    &#123;\n        std::string s1, s2;\n        std::cin &gt;&gt; s1 &gt;&gt; s2;\n        s = ++tot, t = tab[s2];\n        g0.emplace_back(), g1.emplace_back();\n        int p = tab[s1];\n        for (auto i : l[p])\n            g0[s].emplace_back(i, 1, 0), g1[i].emplace_back(s, 1, 0);\n    &#125;\n    std::vector&lt;int&gt; dis0(tot + 1, 0x3f3f3f3f), dis1(tot + 1, 0x3f3f3f3f);\n    auto BFS = [&amp;](decltype(g0) &amp;g, decltype(dis0) &amp;dis, int s) &#123;\n        std::deque&lt;int&gt; q;\n        std::vector&lt;int&gt; vis(tot + 1);\n        q.push_back(s), dis[s] = 0;\n        for (; !q.empty(); ) &#123;\n            int x = q.front();\n            q.pop_front();\n            if (vis[x])\n                continue;\n            vis[x] = 1;\n            for (auto [v, w1, w2] : g[x])\n                if (dis[x] + w1 &lt; dis[v]) &#123;\n                    dis[v] = dis[x] + w1;\n                    if (w1 == 0)\n                        q.push_front(v);\n                    else\n                        q.push_back(v);\n                &#125;\n        &#125;\n        return;\n    &#125;;\n    BFS(g0, dis0, s), BFS(g1, dis1, t);\n    std::cout &lt;&lt; dis0[t] &lt;&lt; &#39;\\n&#39;;\n    std::vector&lt;int&gt; deg(tot + 1);\n    std::vector&lt;std::vector&lt;std::pair&lt;int, int&gt; &gt; &gt; g(tot + 1);\n    for (int i = 1; i &lt;= tot; ++i)\n        for (auto [j, w1, w2] : g0[i])\n            if (dis0[i] + dis1[j] + w1 == dis0[t])\n                g[i].emplace_back(j, w2), ++deg[j];\n    std::queue&lt;int&gt; q;\n    for (int i = 1; i &lt;= tot; ++i)\n        if (!deg[i])\n            q.push(i);\n    std::vector&lt;int&gt; f(tot + 1);\n    for (; !q.empty(); ) &#123;\n        int x = q.front();\n        q.pop();\n        for (auto [v, w] : g[x]) &#123;\n            f[v] = std::max(f[v], f[x] + w);\n            if (!--deg[v])\n                q.push(v);\n        &#125;\n    &#125;\n    std::cout &lt;&lt; f[t] &lt;&lt; &#39;\\n&#39;;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"c---droga-do-domu\">C - Droga do domu</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P9402\" class=\"uri\">https://www.luogu.com.cn/problem/P9402</a></p>\n<ul>\n<li>è¿˜æ˜¯åšä¸€ä¸ªå’Œä¸Šä¸€é¢˜ç±»ä¼¼çš„ä¼˜åŒ–å»ºå›¾</li>\n<li>æ­¤å¤–å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ Dij ä¸Š DP äº†ã€‚<strong>å›¾æ²¡æœ‰ç¯</strong>ï¼Œç›´æ¥æ‹“æ‰‘å³å¯ã€‚</li>\n<li>å¯ä»¥æ»šåŠ¨ä¼˜åŒ–ç©ºé—´ï¼Œä½†ä¼¼ä¹å¹¶æ— å¿…è¦ã€‚ä»£ç ç•¥ã€‚</li>\n</ul>\n<hr />\n<h2 id=\"d---tickets-p\">D - Tickets P</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P7984\" class=\"uri\">https://www.luogu.com.cn/problem/P7984</a></p>\n<ul>\n<li>æ²¡ä»€ä¹ˆå¥½è¯´çš„çº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾ï¼Œéš¾ç‚¹åœ¨äºå¦‚ä½•åŒæ—¶è·å– <span class=\"math inline\">\\(1\\)</span> å’Œ <span class=\"math inline\">\\(N\\)</span> çš„ä¿¡æ¯</li>\n<li><p>å‘ç°ä»æŸä¸ªç‚¹èµ°åˆ° <span class=\"math inline\">\\(1\\)</span> å’Œ <span class=\"math inline\">\\(N\\)</span>ï¼Œæœ‰ä¸€ç§ä¸åŠ£çš„èµ°æ³•ï¼š</p>\n<img src=\"image.png\" /></li>\n<li><p>ç»´æŠ¤ä¸€ä¸‹æ¯ä¸ªç‚¹å•ç‹¬èµ°åˆ° <span class=\"math inline\">\\(1\\)</span>ï¼Œ<span class=\"math inline\">\\(N\\)</span> çš„æœ€å°ä»£ä»·å’ŒåŒæ—¶èµ°åˆ° <span class=\"math inline\">\\(1,N\\)</span> çš„æœ€å°ä»£ä»·</p>\nçœ‹åˆ°ä¸€ç§æ›´åŠ å¯¹çš„å†™æ³•æ˜¯<strong>ä»¤ <span class=\"math inline\">\\(f_u\\)</span> è¡¨ç¤º <span class=\"math inline\">\\(v\\)</span> çš„ç­”æ¡ˆï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ <span class=\"math inline\">\\(f_v+w(u,v)\\)</span> æ›´æ–° <span class=\"math inline\">\\(f_u\\)</span></strong>ã€‚</li>\n<li><p>é‚£ä¹ˆå¯ä»¥ä» <span class=\"math inline\">\\(1,N\\)</span> å‡ºå‘åšä¸€ä¸ª Dijã€‚ä»£ç ç•¥ã€‚</p></li>\n</ul>\n<hr />\n<h2 id=\"e---ç›‘ç‹±\">E - ç›‘ç‹±</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P9520\" class=\"uri\">https://www.luogu.com.cn/problem/P9520</a></p>\n<ul>\n<li><p>æ³¨æ„è¦èµ°ç®€å•è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å­˜åœ¨ç»•è·¯è®©é“çš„å¯èƒ½æ€§ã€‚å®¹æ˜“æ¨å‡ºï¼šè‹¥è¾“å…¥åˆæ³•ï¼Œæ€»èƒ½æ‰¾åˆ°ä¸€ç§æ–¹å¼ä½¿å¾—æ¯ä¸ªäººå—åˆ°çš„æŒ‡ä»¤æ˜¯è¿ç»­ç»™å‡ºçš„ã€‚</p>\n<p>P.S. è¿™ä¸ªç»“è®ºæŒªåˆ°å›¾ä¸Šå°±ä¸æˆç«‹äº†ï¼Œå¾ˆå®¹æ˜“ä¸¾å‡ºåä¾‹ã€‚</p>\n<p><img src=\"image-1.png\" /></p></li>\n<li>è‹¥ä¸€ä¸ªäººçš„èµ·ç‚¹ / ç»ˆç‚¹åœ¨å¦ä¸€ä¸ªäººçš„è·¯å¾„ä¸Šï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªäººä¹‹é—´å­˜åœ¨å…ˆåå…³ç³»ã€‚å»ºå›¾åæ£€æŸ¥æ˜¯å¦ä¸º DAG å³å¯ã€‚</li>\n<li><p>ä½†å»ºå›¾æ˜¾ç„¶æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œå®¹æ˜“æ„é€ å‡ºæ•°æ®ä½¿å¾—è¾¹æ•°æ¥åˆ° <span class=\"math inline\">\\(n^2\\)</span> çº§åˆ«ã€‚è€ƒè™‘ä¼˜åŒ–å»ºå›¾ã€‚</p>\n<p>å‘ç°å¯ä»¥ç”¨ä¸€ä¸ªæ ‘å‰– / å€å¢çš„ç»“æ„æ¥å»ºå›¾ã€‚</p>\nTipsï¼šè¿™ä¸€ç‚¹åŒæ ·æ˜¯ä¸€ä¸ªæ ‘ä¸Šè·¯å¾„é—®é¢˜ã€‚å‚è§ <a href=\"/20231117/#æ ‘ä¸Šé—®é¢˜\">æ ‘ä¸Šé—®é¢˜ï¼Œå€å¢å’Œæ ‘å‰–çš„é€‰æ‹©ï¼Ÿ</a></li>\n<li><p>è¿™é‡Œçš„è·¯å¾„è¦æ±‚ä¸¤ç«¯éƒ½æ˜¯å¼€çš„ï¼Œè¿™å°±å¯¼è‡´å€å¢å†™ç€å¾ˆå›°éš¾ï¼ˆè™½ç„¶æ ‘å‰–å¯èƒ½ä¹Ÿæ˜¯ï¼‰ï¼Œä¸æ’é™¤æˆ‘å†™ä¸‘äº†</p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int K = 19;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;01-02.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int T;\n    for (std::cin &gt;&gt; T; T--; ) &#123;\n        int n, m;\n        std::cin &gt;&gt; n;\n        std::vector&lt;std::vector&lt;int&gt; &gt; g1(n + 1);\n        std::vector&lt;int&gt; s(n + 1), t(n + 1);\n        for (int i = 1, x, y; i &lt; n; ++i) &#123;\n            std::cin &gt;&gt; x &gt;&gt; y;\n            g1[x].push_back(y), g1[y].push_back(x);\n        &#125;\n        std::cin &gt;&gt; m;\n        std::vector&lt;std::vector&lt;int&gt; &gt; g(m + 1);\n        std::vector&lt;std::pair&lt;int, int&gt; &gt; a(m + 1);\n        for (int i = 1; i &lt;= m; ++i) &#123;\n            std::cin &gt;&gt; a[i].first &gt;&gt; a[i].second;\n            s[a[i].first] = i;\n            t[a[i].second] = i;\n        &#125;\n        int cnt = m;\n        struct node &#123; int fa, i0, i1; &#125;;\n        std::vector&lt;std::array&lt;node, K + 1&gt; &gt; p(n + 1);\n        std::vector&lt;int&gt; i0(n + 1), i1(n + 1), dep(n + 1), deg(m + 1);\n        auto init = [&amp;](void) &#123;\n            g.emplace_back(), deg.emplace_back();\n            return ++cnt;\n        &#125;;\n        auto add = [&amp;](int x, int y) &#123;\n            g[x].push_back(y), ++deg[y];\n            return;\n        &#125;;\n        for (int i = 1; i &lt;= n; ++i)\n            i0[i] = init(), i1[i] = init();\n        std::function&lt;void(int, int)&gt; DFS = [&amp;](int x, int fa) &#123;\n            if (s[x])\n                add(s[x], i1[x]);\n            if (t[x])\n                add(i0[x], t[x]);\n            for (auto i : g1[x])\n                if (i != fa) &#123;\n                    dep[i] = dep[x] + 1;\n                    p[i][0].fa = x;\n                    p[i][0].i0 = init(), p[i][0].i1 = init();\n                    add(p[i][0].i0, i0[i]), add(i1[i], p[i][0].i1);\n                    for (int j = 1; j &lt;= K; ++j) &#123;\n                        p[i][j].fa = p[p[i][j - 1].fa][j - 1].fa;\n                        if (!p[i][j].fa)\n                            break;\n                        p[i][j].i0 = init(), p[i][j].i1 = init();\n                        add(p[i][j].i0, p[i][j - 1].i0);\n                        add(p[i][j].i0, p[p[i][j - 1].fa][j - 1].i0);\n                        add(p[i][j - 1].i1, p[i][j].i1);\n                        add(p[p[i][j - 1].fa][j - 1].i1, p[i][j].i1);\n                    &#125;\n                    DFS(i, x);\n                &#125;\n            return;\n        &#125;;\n        dep[1] = 1, DFS(1, -1);\n        for (int i = 1; i &lt;= m; ++i) &#123;\n            auto [x, y] = a[i];\n            if (x == y)\n                continue;\n            if (t[x])\n                add(i, t[x]);\n            if (s[y])\n                add(s[y], i);\n            if (dep[x] &lt; dep[y])\n                std::swap(x, y);\n            x = p[x][0].fa;\n            if (dep[x] &gt;= dep[y]) &#123;\n                for (int j = K; ~j; --j)\n                    if (dep[p[x][j].fa] &gt;= dep[y]) &#123;\n                        add(i, p[x][j].i0), add(p[x][j].i1, i);\n                        x = p[x][j].fa;\n                    &#125;\n                if (x == y)\n                    continue;\n                add(i, p[x][0].i0), add(p[x][0].i1, i);\n                x = p[x][0].fa;\n            &#125;\n            y = p[y][0].fa;\n            if (x != y) &#123;\n                for (int j = K; ~j; --j)\n                    if (p[x][j].fa != p[y][j].fa) &#123;\n                        add(i, p[x][j].i0), add(i, p[y][j].i0);\n                        add(p[x][j].i1, i), add(p[y][j].i1, i);\n                        x = p[x][j].fa, y = p[y][j].fa;\n                    &#125;\n                add(i, p[x][0].i0), add(i, p[y][0].i0);\n                add(p[x][0].i1, i), add(p[y][0].i1, i);\n                x = p[x][0].fa;\n            &#125;\n            add(i, i0[x]), add(i1[x], i);\n        &#125;\n        std::queue&lt;int&gt; q;\n        for (int i = 1; i &lt;= cnt; ++i)\n            if (!deg[i])\n                q.push(i);\n        int tot = 0;\n        for (; !q.empty(); ) &#123;\n            int x = q.front();\n            q.pop(), ++tot;\n            for (auto i : g[x])\n                if (!--deg[i])\n                    q.push(i);\n        &#125;\n        std::cout &lt;&lt; (tot == cnt ? &quot;Yes&quot; : &quot;No&quot;) &lt;&lt; &#39;\\n&#39;;\n    &#125;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n",
            "tags": [
                "DP",
                "äºŒåˆ†",
                "å€å¢",
                "è°ƒæ•´æ³•",
                "æœ€çŸ­è·¯"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250922/",
            "url": "https://xsc062.netlify.app/20250922/",
            "title": "æ‚é¢˜é€‰è°ˆ",
            "date_published": "2025-09-22T10:37:38.000Z",
            "content_html": "<p>æœ€è¿‘çš„å‡ åœº abc, arc, cf, æ¨¡æ‹Ÿèµ›é¢˜</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"g---set-list\">G - Set list</h2>\n<p><a href=\"https://atcoder.jp/contests/abc424/tasks/abc424_g\" class=\"uri\">https://atcoder.jp/contests/abc424/tasks/abc424_g</a></p>\n<hr />\n<h2 id=\"b---slime-swap\">B - Slime Swap</h2>\n<p><a href=\"https://atcoder.jp/contests/arc206/tasks/arc206_b\" class=\"uri\">https://atcoder.jp/contests/arc206/tasks/arc206_b</a></p>\n<hr />\n<h2 id=\"d---lis-lds\">D - LIS âˆ© LDS</h2>\n<p><a href=\"https://atcoder.jp/contests/arc206/tasks/arc206_d\" class=\"uri\">https://atcoder.jp/contests/arc206/tasks/arc206_d</a></p>\n<hr />\n<h2 id=\"bubble-sort\">#3761. Bubble Sort</h2>\n<p><a href=\"http://poj.org/problem?id=3761\" class=\"uri\">http://poj.org/problem?id=3761</a></p>\n<hr />\n<h2 id=\"f.-bubble-sort\">F. Bubble Sort</h2>\n<p><a href=\"https://codeforces.com/contest/2146/problem/F\" class=\"uri\">https://codeforces.com/contest/2146/problem/F</a></p>\n<hr />\n<h2 id=\"e.-limited-edition-shop\">E. Limited Edition Shop</h2>\n<p><a href=\"https://codeforces.com/contest/2151/problem/E\" class=\"uri\">https://codeforces.com/contest/2151/problem/E</a></p>\n<ul>\n<li>æ„é€ å‡ ä¸ª <span class=\"math inline\">\\(n=2,3\\)</span> çš„ä¾‹å­æ‰‹ç©ä¸€ä¸‹ï¼Œä¼šå‘ç°å¯¹äº <span class=\"math inline\">\\(a,b\\)</span> ä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœåœ¨ A é‡Œçš„ç›¸å¯¹é¡ºåºæ˜¯ abï¼Œåœ¨ B é‡Œçš„ç›¸å¯¹é¡ºåºæ˜¯ baï¼Œé‚£ä¹ˆè¦é€‰ b å°±å¿…é¡»é€‰ aã€‚</li>\n<li>é‚£ä¹ˆä¼šæƒ³åˆ°æŠŠ A å˜æˆ <span class=\"math inline\">\\(1\\sim n\\)</span>ï¼Œé‚£ä¹ˆå¯¹äº B ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœå…¶åæ–¹æœ‰æ›´å°çš„å…ƒç´ ï¼Œé‚£ä¹ˆå¿…é¡»é€‰äº†å®ƒæ‰èƒ½é€‰è¿™ä¸ªæ•°ã€‚</li>\n<li>è€ƒè™‘åœ¨ B ä¸­ DP æœ€åé€‰å‡ºæ¥çš„é›†åˆï¼Œé‚£ä¹ˆå¯¹äºå½“å‰çš„ <span class=\"math inline\">\\(x\\)</span>ï¼Œ<strong>è‹¥ä¸é€‰ï¼Œåˆ™ä¸å…è®¸ã€å·²é€‰é›†åˆã€ä¸­å­˜åœ¨ <span class=\"math inline\">\\(&gt;x\\)</span> çš„æ•°ã€‚</strong></li>\n<li><p>æ•…ä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤º DP åˆ° <span class=\"math inline\">\\(i\\)</span>ï¼Œå½“å‰å·²é€‰é›†åˆæœ€å¤§å€¼ä¸º <span class=\"math inline\">\\(j\\)</span> çš„æœ€å¤§é›†åˆå¤§å°ï¼Œé‚£ä¹ˆæœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\nf_{i,B_i}\\gets f_{i-1,j}+v, j&lt;B_i\\\\\nf_{i,j}\\gets f_{i-1, j}+v, j &gt; B_i\\\\\nf_{i,j}\\gets f_{i-1,j}, j &lt; B_i\n\\]</span></p></li>\n<li><p>æ˜¾ç„¶å¯ä»¥çº¿æ®µæ ‘ä¼˜åŒ–è½¬ç§»</p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxn = 2e5 + 5;\nconst long long inf = 1e18;\nstruct &#123;\n    int l, r;\n    long long u, d;\n&#125; t[maxn &lt;&lt; 2];\n#define lt (p &lt;&lt; 1)\n#define rt (lt | 1)\nvoid pushval(int p, long long v) &#123;\n    t[p].d += v, t[p].u += v;\n    return;\n&#125;\nvoid pushdown(int p) &#123;\n    pushval(lt, t[p].d), pushval(rt, t[p].d);\n    t[p].d = 0ll;\n    return;\n&#125;\nvoid pushup(int p) &#123;\n    t[p].u = std::max(t[lt].u, t[rt].u);\n    return;\n&#125;\nvoid bld(int p, int l, int r) &#123;\n    t[p].l = l, t[p].r = r;\n    t[p].u = -inf, t[p].d = 0ll;\n    if (l == r)\n        return;\n    int mid = (t[p].l + t[p].r) &gt;&gt; 1;\n    bld(lt, l, mid), bld(rt, mid + 1, r);\n    return;\n&#125;\nvoid upd(int p, int x, long long v) &#123;\n    t[p].u = std::max(t[p].u, v);\n    if (t[p].l == t[p].r)\n        return;\n    pushdown(p);\n    int mid = (t[p].l + t[p].r) &gt;&gt; 1;\n    if (x &lt;= mid)\n        upd(lt, x, v);\n    else\n        upd(rt, x, v);\n    return;\n&#125;\nvoid add(int p, int l, int r, long long v) &#123;\n    if (l &lt;= t[p].l &amp;&amp; t[p].r &lt;= r) &#123;\n        pushval(p, v);\n        return;\n    &#125;\n    pushdown(p);\n    int mid = (t[p].l + t[p].r) &gt;&gt; 1;\n    if (l &lt;= mid)\n        add(lt, l, r, v);\n    if (r &gt; mid)\n        add(rt, l, r, v);\n    pushup(p);\n    return;\n&#125;\nlong long ask(int p, int l, int r) &#123;\n    if (l &lt;= t[p].l &amp;&amp; t[p].r &lt;= r)\n        return t[p].u;\n    pushdown(p);\n    long long res = -inf;\n    int mid = (t[p].l + t[p].r) &gt;&gt; 1;\n    if (l &lt;= mid)\n        res = ask(lt, l, r);\n    if (r &gt; mid)\n        res = std::max(res, ask(rt, l, r));\n    return res;\n&#125;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int T;\n    for (std::cin &gt;&gt; T; T--; ) &#123;\n        int n;\n        std::cin &gt;&gt; n;\n        std::vector&lt;int&gt; w(n + 1), k(n + 1), a(n + 1), b(n + 1), tab(n + 1);\n        for (int i = 1; i &lt;= n; ++i)\n            std::cin &gt;&gt; w[i];\n        for (int i = 1; i &lt;= n; ++i)\n            std::cin &gt;&gt; a[i], tab[a[i]] = i;\n        for (int i = 1; i &lt;= n; ++i)\n            k[i] = w[a[i]];\n        for (int i = 1; i &lt;= n; ++i)\n            std::cin &gt;&gt; b[i], b[i] = tab[b[i]];\n        bld(1, 0, n), upd(1, 0, 0);\n        for (int i = 1; i &lt;= n; ++i) &#123;\n            if (b[i] != n)\n                add(1, b[i] + 1, n, k[b[i]]);\n            upd(1, b[i], ask(1, 0, b[i] - 1) + k[b[i]]);\n        &#125;\n        std::cout &lt;&lt; t[1].u &lt;&lt; &#39;\\n&#39;;\n    &#125;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"a.-å°çŒªç›–æˆ¿å­\">A. å°çŒªç›–æˆ¿å­</h2>\n<p><a href=\"https://www.becoder.com.cn/problem/51898\" class=\"uri\">https://www.becoder.com.cn/problem/51898</a></p>\n<blockquote>\n<p>ç»™å®šä¸€ä¸ª <span class=\"math inline\">\\(n\\times m\\)</span> çš„ 01 çŸ©é˜µï¼Œæ¯ä¸€è¡Œæœ‰ 2 ä¸ª 1 æˆ–æ²¡æœ‰ 1ã€‚ç°éœ€é€‰æ‹©ä¸¤ä¸ª<strong>ç›¸é‚»çš„</strong>è¡ŒåŒºé—´ï¼Œå¹¶ä¸º<strong>èŒƒå›´å†…çš„ç©ºè¡Œ</strong>é€‰æ‹©ä¸¤ä¸ªä½ç½®æ”¹ä¸º 1ï¼Œä½¿å¾—è¿™ä¸¤ä¸ªåŒºé—´æ˜¯å…¨ç­‰çš„ã€‚</p>\n<p>æ±‚å¯èƒ½çš„æ–¹æ¡ˆã€‚å½“ç©ºè¡Œçš„æ¶‚è‰²æ–¹å¼ä¸åŒæˆ–é€‰æ‹©èŒƒå›´ä¸åŒçœ‹ä½œä¸åŒçš„æ–¹æ¡ˆã€‚å¯¹ <span class=\"math inline\">\\(998244353\\)</span> å–æ¨¡ã€‚</p>\n<p><span class=\"math inline\">\\(n,m\\le 5000\\)</span>ã€‚</p>\n</blockquote>\n<ul>\n<li>ç¬¬ä¸€ååº”æ˜¯æšä¸¾åˆ†ç•Œçº¿ + ä¸Šç«¯ç‚¹ï¼Œå‘ç°æ²¡æœ‰åŠæ³•åšï¼šå½“ä¸Šç«¯ç‚¹ç§»åŠ¨çš„æ—¶å€™ï¼Œä¸‹éƒ¨çŸ©å½¢ä¼šæ•´ä½“å¹³ç§»ã€‚</li>\n<li><strong>è¿›ä¸€æ­¥è€ƒè™‘å¯¼è‡´è¿™ä¸ªé—®é¢˜çš„åŸå› </strong>ï¼Œæ„Ÿå—åˆ°ä¸€ä¸ªå› ç´ æ˜¯é•¿åº¦åœ¨å˜ã€‚</li>\n<li>æ•…å›ºå®šé•¿åº¦æšä¸¾ï¼Œå‰ç¼€å’Œç»Ÿè®¡ <span class=\"math inline\">\\(\\dfrac {m(m-1)}2\\)</span> çš„å¹‚æ¬¡å³å¯ã€‚</li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n    std::freopen(&quot;piggy.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;piggy.out&quot;, &quot;w&quot;, stdout);\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n    const auto stime = std::chrono::steady_clock::now();\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;std::array&lt;int, 2&gt; &gt; a(n + 1);\n    std::vector&lt;long long&gt; ps(n + 1);\n    const int s = m * (m - 1) / 2;\n    ps[0] = 1ll;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i][0] &gt;&gt; a[i][1];\n        ps[i] = ps[i - 1] * s % mod;\n    &#125;\n    auto res = 0ll;\n    for (int i = 1; i &lt;= n / 2; ++i) &#123;\n        std::vector&lt;int&gt; cnt0(n + 1), cnts(n + 1);\n        for (int u = 1; u &lt;= n - i; ++u) &#123;\n            int d = u + i;\n            if (!a[u][0] &amp;&amp; !a[d][0])\n                cnts[u] = 1;\n            else if (a[u][0] &amp;&amp; a[d][0] &amp;&amp; (a[u][0] != a[d][0] || a[u][1] != a[d][1]))\n                cnt0[u] = 1;\n            cnts[u] += cnts[u - 1], cnt0[u] += cnt0[u - 1];\n        &#125;\n        for (int u = 1; u &lt;= n - 2 * i + 1; ++u) &#123;\n            int ss = cnts[u + i - 1] - cnts[u - 1], s0 = cnt0[u + i - 1] - cnt0[u - 1];\n            if (!s0)\n                (res += ps[ss] % mod) %= mod;\n        &#125;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b.-æ¢ä¹˜æ—…è¡Œ\">B. æ¢ä¹˜æ—…è¡Œ</h2>\n<p><a href=\"https://www.becoder.com.cn/problem/51900\" class=\"uri\">https://www.becoder.com.cn/problem/51900</a></p>\n<ul>\n<li>æ‰‹ç©å¯ä»¥å‘ç°ã€ç¯ã€åœ¨é¢˜ç›®ä¸­æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ä¸œè¥¿</li>\n<li>é‡è¦æ€§è´¨ï¼šè€ƒè™‘ä¸€ä¸ªç¯ç¬¬ä¸€æ¬¡è¢«è®¿é—®çš„ç‚¹ï¼Œä¸€å®šä¼šä»è¿™ä¸ªç‚¹å‡ºå‘æŠŠè¿™ä¸ªç¯è®¿é—®ä¸€éï¼Œåè¯æ³•æ˜“è¯ã€‚</li>\n<li><p>æ•…å¯ä»¥æŠŠæ¯ä¸ªç¯ç»™ã€åˆ é™¤ã€ã€‚å¯ä»¥ç”¨ä¸‹å›¾æ¦‚æ‹¬æ‰€æœ‰æƒ…å†µã€‚</p>\n<p><img src=\"image.png\" /></p>\n<p>å‡è®¾å½“å‰ä»¥ <span class=\"math inline\">\\(s\\)</span> ä¸ºèµ·ç‚¹ï¼Œç»ˆç‚¹ä¸º <span class=\"math inline\">\\(t\\)</span>ï¼Œä¸”ä¹‹å‰å·²ç»åœ¨ä»¥ <span class=\"math inline\">\\(s&#39;\\)</span> ä¸ºèµ·ç‚¹æ—¶è®¿é—®è¿‡äº†ä¸€éƒ¨åˆ†è·¯å¾„ä¸Šçš„ç‚¹ã€‚</p>\n<p>é‚£ä¹ˆæ­¤æ—¶ <span class=\"math inline\">\\(m\\to t\\)</span> æ˜¯æœ‰ç­”æ¡ˆçš„ï¼Œè€Œ <span class=\"math inline\">\\(s\\to m\\)</span> éƒ½å¯ä»¥ç»§æ‰¿ <span class=\"math inline\">\\(m\\)</span> çš„ç­”æ¡ˆã€‚</p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::freopen(&quot;travel.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;travel.out&quot;, &quot;w&quot;, stdout);\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1);\n    std::vector&lt;std::vector&lt;int&gt;::iterator&gt; it(n + 1);\n    for (int i = 1, k; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; k;\n        for (int x; k--; )\n            std::cin &gt;&gt; x, g[i].push_back(x);\n        it[i] = g[i].begin();\n    &#125;\n    std::vector&lt;int&gt; res(n + 1), inq(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        if (!res[i]) &#123;\n            std::stack&lt;int&gt; st;\n            for (int x = i; ; ) &#123;\n                if (it[x] == g[x].end() || res[x]) &#123;\n                    if (!res[x])\n                        res[x] = x;\n                    res[i] = res[x];\n                    for (; !st.empty(); st.pop())\n                        res[st.top()] = res[x], inq[st.top()] = 0;\n                    break;\n                &#125;\n                st.push(x), inq[x] = 1, x = *it[x];\n                if (inq[x])\n                    for (int p = -1; p != x; ) &#123;\n                        p = st.top(), st.pop();\n                        inq[p] = 0, ++it[p];\n                    &#125;\n            &#125;\n        &#125;\n    for (int i = 1; i &lt;= n; ++i)\n        std::cout &lt;&lt; res[i] &lt;&lt; &#39;\\n&#39;;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"c.-ä¼˜ç¾çš„è¡—æ™¯\">C. ä¼˜ç¾çš„è¡—æ™¯</h2>\n<p>no link</p>\n<blockquote>\n<p>ç»™å®š <span class=\"math inline\">\\(n\\)</span> çš„æ’åˆ— <span class=\"math inline\">\\(a_{1\\cdots n}\\)</span>ï¼Œç°å®šä¹‰ã€ä¼˜ç¾å­æ®µã€<span class=\"math inline\">\\([l,r]\\)</span>ï¼šå­˜åœ¨ <span class=\"math inline\">\\(l\\le t&lt;r\\)</span>ï¼Œä½¿å¾— <span class=\"math inline\">\\(\\max\\{a_{l\\sim t}\\}&lt;\\min\\{a_{t+1\\sim r}\\}\\)</span>ã€‚</p>\n<p>æ±‚å‡ºè¯¥æ’åˆ—ã€ä¼˜ç¾å­æ®µã€çš„ä¸ªæ•°ï¼Œ<span class=\"math inline\">\\(n\\le 3\\times 10^5\\)</span>ã€‚</p>\n</blockquote>\n<ul>\n<li><p>ç”±ç»å…¸ trick å‡ºå‘ï¼Œä¸€ä¸ªæƒ³æ³•æ˜¯ä»å°åˆ°å¤§æšä¸¾åˆ†è§£å€¼ <span class=\"math inline\">\\(v\\)</span>ï¼Œå¹¶æŠŠ <span class=\"math inline\">\\(\\le v\\)</span> çš„å€¼æ¶‚æˆç™½è‰²ï¼Œå‰©ä¸‹çš„æ¶‚æˆé»‘è‰²ã€‚</p>\n<p>é‚£ä¹ˆæ­¤æ—¶ä¸€ä¸ªå‰ç™½åé»‘çš„å­æ®µæ˜¯ä¼˜ç¾çš„ã€‚</p></li>\n<li><p>ä»¤å€¼ä¸º <span class=\"math inline\">\\(v\\)</span> çš„å…ƒç´ å¿…é¡»å‚ä¸å­æ®µç»„æˆã€‚æšä¸¾ <span class=\"math inline\">\\(v\\)</span> æ—¶ï¼Œåºåˆ—æ¯ä¸ªç‚¹é¢œè‰²å·²çŸ¥ï¼Œå³ <span class=\"math inline\">\\(v\\)</span> æ‰€åœ¨çš„ä¼˜ç¾å­æ®µè¢«åŒ…å«äº <span class=\"math inline\">\\(v\\)</span> æ‰€åœ¨çš„ç™½é»‘å­æ®µä¸­ã€‚</p>\n<p>æ±‚å‡ºè¯¥å­æ®µï¼Œåˆ™åŒ…å« <span class=\"math inline\">\\(v\\)</span> çš„ä¼˜ç¾å­æ®µï¼Œå·¦å³ç«¯ç‚¹å„æœ‰èŒƒå›´ï¼Œä¸”ä¸ä¼šç›¸äº’å½±å“ã€‚</p></li>\n<li><p>æ­¤æ—¶ä¸å¯ç›´æ¥è®¡æ•°ï¼šä¸€ä¸ªä¼˜ç¾å­æ®µä¼šè¢«å…¶ä¸­æ‰€æœ‰åˆæ³•åˆ†å‰²ç‚¹ç»Ÿè®¡ã€‚æ•…åšä¸€ä¸ª <a href=\"https://www.luogu.com.cn/problem/P5490\">äºšç‰¹å…°è’‚æ–¯</a> å³å¯ã€‚</p>\n<p>å¦‚æœåƒæˆ‘ä¸€æ ·æ²¡æœ‰ç”šåŒºé—´é—®é¢˜ç»éªŒï¼Œå¯ä»¥ç”¨ 0 è¦†ç›–æ¬¡æ•°è¿™ä¸ª trick æ¥åå‘æ±‚ã€‚<del>å› è€Œè¢«ç¾¤å˜²äº†</del></p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxn = 3e5 + 5;\nstruct &#123;\n    int l, r, mn, u, d;\n&#125; t[maxn &lt;&lt; 2];\n#define lt (p &lt;&lt; 1)\n#define rt (lt | 1)\nvoid bld(int p, int l, int r) &#123;\n    t[p].l = l, t[p].r = r;\n    t[p].u = r - l + 1;\n    if (l == r)\n        return;\n    int mid = (l + r) &gt;&gt; 1;\n    bld(lt, l, mid), bld(rt, mid + 1, r);\n    return;\n&#125;\nvoid pushval(int p, int v) &#123;\n    t[p].d += v, t[p].mn += v;\n    return;\n&#125;\nvoid pushdown(int p) &#123;\n    pushval(lt, t[p].d), pushval(rt, t[p].d);\n    t[p].d = 0;\n    return;\n&#125;\nvoid pushup(int p) &#123;\n    t[p].u = 0;\n    t[p].mn = std::min(t[lt].mn, t[rt].mn);\n    if (t[lt].mn == t[p].mn)\n        t[p].u = t[lt].u;\n    if (t[rt].mn == t[p].mn)\n        t[p].u += t[rt].u;\n    return;\n&#125;\nvoid add(int p, int l, int r, int v) &#123;\n    if (l &lt;= t[p].l &amp;&amp; t[p].r &lt;= r) &#123;\n        pushval(p, v);\n        return;\n    &#125;\n    pushdown(p);\n    int mid = (t[p].l + t[p].r) &gt;&gt; 1;\n    if (l &lt;= mid)\n        add(lt, l, r, v);\n    if (r &gt; mid)\n        add(rt, l, r, v);\n    pushup(p);\n    return;\n&#125;\n#undef lt\n#undef rt\nint main() &#123;\n    std::freopen(&quot;street.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;street.out&quot;, &quot;w&quot;, stdout);\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n    const auto stime = std::chrono::steady_clock::now();\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; a(n + 1), tab(n + 1);\n    std::vector&lt;std::vector&lt;int&gt; &gt; mn(20, std::vector&lt;int&gt; (n + 1)), mx(20, std::vector&lt;int&gt; (n + 1));\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i];\n        tab[a[i]] = i, mn[0][i] = mx[0][i] = a[i];\n    &#125;\n    for (int j = 1; (1 &lt;&lt; j) &lt;= n; ++j)\n        for (int i = 1; i + (1 &lt;&lt; j) - 1 &lt;= n; ++i) &#123;\n            mn[j][i] = std::min(mn[j - 1][i], mn[j - 1][i + (1 &lt;&lt; (j - 1))]);\n            mx[j][i] = std::max(mx[j - 1][i], mx[j - 1][i + (1 &lt;&lt; (j - 1))]);\n        &#125;\n    auto askmn = [&amp;](int l, int r) &#123;\n        int k = std::__lg(r - l + 1);\n        return std::min(mn[k][l], mn[k][r - (1 &lt;&lt; k) + 1]);\n    &#125;;\n    auto askmx = [&amp;](int l, int r) &#123;\n        int k = std::__lg(r - l + 1);\n        return std::max(mx[k][l], mx[k][r - (1 &lt;&lt; k) + 1]);\n    &#125;;\n    auto res = 0ll;\n    std::vector&lt;std::vector&lt;std::tuple&lt;int, int, int&gt; &gt; &gt; t(n + 1);\n    auto ask1 = [&amp;](int x, int v) &#123; // æ‰¾åˆ° x å·¦ä¾§æœ€åä¸€ä¸ª &lt;= v çš„\n        int res = x;\n        for (int l = 1, r = x, mid; l &lt;= r; ) &#123;\n            mid = (l + r) &gt;&gt; 1;\n            if (askmx(mid, x) &lt;= v)\n                r = mid - 1, res = mid;\n            else\n                l = mid + 1;\n        &#125;\n        return res;\n    &#125;;\n    auto ask2 = [&amp;](int x, int v) &#123; // æ‰¾åˆ° x å³ä¾§ç¬¬ä¸€ä¸ª &gt; v çš„\n        int res = -1;\n        for (int l = x + 1, r = n, mid; l &lt;= r; ) &#123;\n            mid = (l + r) &gt;&gt; 1;\n            if (askmx(x, mid) &gt; v)\n                r = mid - 1, res = mid;\n            else\n                l = mid + 1;\n        &#125;\n        return res;\n    &#125;;\n    auto ask3 = [&amp;](int x, int v) &#123; // æ‰¾åˆ° x å³ä¾§æœ€åä¸€ä¸ª &gt; v çš„\n        int res = x;\n        for (int l = x, r = n, mid; l &lt;= r; ) &#123;\n            mid = (l + r) &gt;&gt; 1;\n            if (askmn(x, mid) &gt; v)\n                l = mid + 1, res = mid;\n            else\n                r = mid - 1;\n        &#125;\n        return res;\n    &#125;;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        int cr = ask1(tab[i], i), tl = ask2(tab[i], i);\n        if (tl != -1) &#123;\n            int tr = ask3(tl, i);\n            t[cr].emplace_back(1, tl, tr);\n            if (tab[i] != n)\n                t[tab[i] + 1].emplace_back(-1, tl, tr);\n        &#125;\n    &#125;\n    bld(1, 0, n);\n    std::vector&lt;int&gt; cnt(n + 1);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::sort(t[i].begin(), t[i].end(), std::greater&lt;std::tuple&lt;int, int, int&gt; &gt; ());\n        for (auto [k, l, r] : t[i])\n            add(1, l, r, k);\n        res += n + 1 - ::t[1].u;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n    return 0;\n&#125;</code></pre>\n</details>\n",
            "tags": [
                "DP"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250820/",
            "url": "https://xsc062.netlify.app/20250820/",
            "title": "æ‚é¢˜é€‰è°ˆ",
            "date_published": "2025-08-20T12:26:44.000Z",
            "content_html": "<p>å›°éš¾</p>\n<span id=\"more\"></span>\n<hr />\n<h3 id=\"b.-beautyæ‹†è´¡çŒ®\">B. beautyï¼ˆæ‹†è´¡çŒ®ï¼‰</h3>\n<p><a href=\"https://www.becoder.com.cn/contest/6513/problem/2\" class=\"uri\">https://www.becoder.com.cn/contest/6513/problem/2</a></p>\n<blockquote>\n<p>ç»™å®š <span class=\"math inline\">\\(n,V\\)</span>ï¼Œæ±‚å‡ºå¯¹äºæ‰€æœ‰é•¿åº¦ä¸º <span class=\"math inline\">\\(n\\)</span>ï¼Œå€¼åŸŸä¸º <span class=\"math inline\">\\([1,V]\\)</span> çš„åºåˆ— <span class=\"math inline\">\\(a_{1\\sim n}\\)</span>ï¼Œ<span class=\"math inline\">\\(\\sum_{i=1}^n |a_i-a_{n-i+1}|\\)</span> çš„å’Œã€‚</p>\n<p><span class=\"math inline\">\\(n,V\\le 5000\\)</span>ã€‚</p>\n</blockquote>\n<ul>\n<li>å®¹æ˜“æƒ³åˆ°ç®—è´¡çŒ®ï¼Œä¼šæœ‰ä¸€ä¸ª <span class=\"math inline\">\\(O(n^2V)\\)</span> çš„åšæ³•ã€‚ä½†æ˜¯æƒ³ <span class=\"math inline\">\\(O(nV)\\)</span> åšæ˜¯å¾ˆæŠ½è±¡çš„ï¼Œå’Œ <span class=\"math inline\">\\(O(n^2V)\\)</span> çš„æ€è·¯å·²ç»å¾ˆä¸ä¸€æ ·äº†</li>\n<li>ç»å…¸ trickï¼Œ<span class=\"math inline\">\\(a_{i+n/2}-a_i=\\sum\\limits_{x=0}^{+\\infty} [a_i\\le x&lt;a_{i+n/2}]\\)</span> æ‹†è´¡çŒ® ã€‚æ•…è¦ç®— <span class=\"math inline\">\\(a_{i}-a_{i+n/2}\\)</span>ï¼Œåªéœ€è¦å¯¹äºæ¯ä¸ª <span class=\"math inline\">\\(x\\in[a_i,a_{i+n/2})\\)</span> è®¡ç®—è´¡çŒ®ã€‚</li>\n<li>æšä¸¾ <span class=\"math inline\">\\(x\\in [1,V)\\)</span>ï¼Œå†æšä¸¾æœ€å¤§çš„ <span class=\"math inline\">\\(t\\)</span>ï¼Œæ»¡è¶³ <span class=\"math inline\">\\(a_t\\ge x\\)</span>ã€‚é‚£ä¹ˆæœ‰ <span class=\"math inline\">\\(t\\)</span> ä¸ª <span class=\"math inline\">\\(a_i\\le x\\)</span>ï¼ŒåŒæ—¶æœ‰ <span class=\"math inline\">\\(n-t\\)</span> ä¸ª <span class=\"math inline\">\\(a_i&gt;x\\)</span>ï¼›æ»¡è¶³ <span class=\"math inline\">\\(i\\le n/2\\)</span> çš„ <span class=\"math inline\">\\(a_{i},a_{i+n/2}\\)</span> å¯¹æ•°åº”è¯¥æ˜¯ <span class=\"math inline\">\\(\\min(t,n-t)\\)</span>ã€‚æ•…å¯¹äºä¸€ä¸ªç¡®å®šçš„åºåˆ—ï¼Œ<span class=\"math inline\">\\(x\\)</span> å…±æœ‰ <span class=\"math inline\">\\(\\min(t,n-t)\\)</span> çš„è´¡çŒ®ã€‚</li>\n<li>è€ƒè™‘è®¡æ•°æ»¡è¶³ <span class=\"math inline\">\\(a_t\\le x\\)</span> çš„ <span class=\"math inline\">\\(a\\)</span>ï¼Œè¿™è¦æ±‚ç¬¬ <span class=\"math inline\">\\(t\\)</span> å¤§çš„æ•° <span class=\"math inline\">\\(\\le x\\)</span> è€Œç¬¬ <span class=\"math inline\">\\(t+1\\)</span> å¤§çš„æ•° <span class=\"math inline\">\\(&gt;x\\)</span>ï¼Œä¹Ÿå³åœ¨ <span class=\"math inline\">\\([1,x]\\)</span> é‡Œæ‰¾ <span class=\"math inline\">\\(t\\)</span> ä¸ªæ•°å†åœ¨ <span class=\"math inline\">\\((x,V]\\)</span> é‡Œæ‰¾ <span class=\"math inline\">\\(n-t\\)</span> ä¸ªæ•°ï¼Œæ³¨æ„è¿˜è¦å†ä¹˜ä¸Šè¿™ä¸¤ç§æ•°æ‹¼èµ·æ¥çš„æ–¹æ¡ˆæ•°ã€‚</li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n    std::freopen(&quot;beauty.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;beauty.out&quot;, &quot;w&quot;, stdout);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int T;\n    std::vector&lt;long long&gt; fac(5001), inv(5001);\n    std::vector&lt;std::vector&lt;long long&gt; &gt; pw(5001, std::vector&lt;long long&gt; (5001));\n    fac[0] = inv[0] = 1ll;\n    for (int i = 1; i &lt;= 5000; ++i) &#123;\n        fac[i] = fac[i - 1] * i % mod;\n        pw[i][0] = 1ll;\n        for (int j = 1; j &lt;= 5000; ++j)\n            pw[i][j] = pw[i][j - 1] * i % mod;\n    &#125;\n    auto qkp = [](long long x, int y) &#123;\n        auto res(1ll);\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    inv[5000] = qkp(fac[5000], mod - 2);\n    for (int i = 4999; i; --i)\n        inv[i] = inv[i + 1] * (i + 1) % mod;\n    auto C = [&amp;](int n, int m) &#123;\n        return fac[n] * inv[m] % mod * inv[n - m] % mod;\n    &#125;;\n    for (std::cin &gt;&gt; T; T--; ) &#123;\n        int n, V;\n        std::cin &gt;&gt; n &gt;&gt; V;\n        auto res(0ll);\n        for (int x = 1; x &lt; V; ++x)\n            for (int t = 1; t &lt; n; ++t) &#123;\n                int k = std::min(t, n - t);\n                (res += k * pw[x][t] % mod * pw[V - x][n - t] % mod * C(n, t) % mod) %= mod;\n            &#125;\n        std::cout &lt;&lt; res * 2 % mod &lt;&lt; &#39;\\n&#39;;\n    &#125;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"c.-drink-barå®¹æ–¥-ååº\">C. Drink Barï¼ˆå®¹æ–¥ + ååºï¼‰</h3>\n<p><a href=\"https://www.luogu.com.cn/problem/AT_snuke21_j\" class=\"uri\">https://www.luogu.com.cn/problem/AT_snuke21_j</a></p>\n<ul>\n<li>ä¸‰ä¸ªå±æ€§éƒ½æ˜¯æ’åˆ—ï¼Œå¯ä»¥æ¨ç†å‡ºåªè¦ä¸¤ä¸ªä¸‰å…ƒç»„ä¸­ï¼Œä½œå‡ºè´¡çŒ®çš„å…ƒç´ ä¸å®Œå…¨ç›¸åŒï¼Œä¸¤ä¸ªä¸‰å…ƒç»„å°±ä¸åŒã€‚è®¨è®ºä½œå‡ºè´¡çŒ®çš„å…ƒç´ æ•°é‡ã€‚</li>\n<li>åªæœ‰ä¸€ä¸ªå…ƒç´ ä½œå‡ºè´¡çŒ®ï¼Œç­”æ¡ˆä¸º <span class=\"math inline\">\\(n\\)</span>ã€‚</li>\n<li>æœ‰ä¸¤ä¸ªå…ƒç´ ä½œå‡ºè´¡çŒ®ï¼Œä»»é€‰çš„è¯ç­”æ¡ˆä¸º <span class=\"math inline\">\\(C_n^2\\)</span>ï¼Œè¦å‡å»ä¸€ä¸ªå…ƒç´ ä¸¥æ ¼ä¼˜äºå¦ä¸€ä¸ªå…ƒç´ çš„æƒ…å†µï¼Œä¸‰ç»´ååºå³å¯ã€‚</li>\n<li><p>æœ‰ä¸‰ä¸ªå…ƒç´ ä½œå‡ºè´¡çŒ®ï¼Œæ˜¯ä¸ªæœ‰ç‚¹å¤æ‚çš„å®¹æ–¥ï¼Œä¸å¦¨è®¾ä¸‰å…ƒç»„ä¸º <span class=\"math inline\">\\((i,j,k)\\)</span>ï¼Œå…¶ä¸­è´¡çŒ®æ¬¡æ•°æœ€å¤šçš„ä¸º <span class=\"math inline\">\\(i\\)</span></p>\n<ol type=\"1\">\n<li><span class=\"math inline\">\\(i\\)</span> è´¡çŒ®äº† <span class=\"math inline\">\\(\\ge 1\\)</span> æ¬¡ï¼Œæ–¹æ¡ˆæ•°ä¸º <span class=\"math inline\">\\(C_n^3\\)</span></li>\n<li><span class=\"math inline\">\\(i\\)</span> è´¡çŒ®äº† <span class=\"math inline\">\\(\\ge 2\\)</span> æ¬¡ï¼Œæšä¸¾ä½œå‡ºä¸¤æ¬¡è´¡çŒ®çš„å±æ€§ï¼Œä»¥ <span class=\"math inline\">\\(a,b\\)</span> ä¸ºä¾‹ï¼Œé‚£ä¹ˆæœ‰ <span class=\"math inline\">\\(a_j,a_k&lt;a_i\\)</span>ï¼Œä»¥åŠ <span class=\"math inline\">\\(b_j,b_k&lt;b_i\\)</span>ï¼ŒäºŒç»´ååºå³å¯</li>\n<li><span class=\"math inline\">\\(i\\)</span> è´¡çŒ®äº† <span class=\"math inline\">\\(\\ge 3\\)</span> æ¬¡ï¼Œä¾ç„¶æ˜¯ä¸‰ç»´ååºï¼Œå¯ä»¥ç”¨ã€ä¸¤ä¸ªå…ƒç´ åšå‡ºè´¡çŒ®ã€ä¸­ cdq å¾—åˆ°çš„å€¼ç®—å‡ºç­”æ¡ˆã€‚è®°å¾—ä¹˜ 2ï¼Œå› ä¸ºè¢«å¤šå‡äº† 2 æ¬¡ã€‚</li>\n</ol></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    struct node &#123; int a, b, c, res; &#125;;\n    std::vector&lt;node&gt; a(n + 1);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i].a &gt;&gt; a[i].b &gt;&gt; a[i].c;\n        a[i].res = 0;\n    &#125;\n    long long res = n;\n    res += (long long)n * (n - 1) / 2;\n    std::vector&lt;int&gt; bit(n + 1);\n    auto lowbit = [](int x) &#123;\n        return x &amp; -x;\n    &#125;;\n    auto add = [&amp;](int x, int v) &#123;\n        for (; x &lt;= n; x += lowbit(x))\n            bit[x] += v;\n        return;\n    &#125;;\n    auto ask = [&amp;](int x) &#123;\n        int res = 0;\n        for (; x; x -= lowbit(x))\n            res += bit[x];\n        return res;\n    &#125;;\n    std::function&lt;void(int, int)&gt; calc = [&amp;](int l, int r) &#123;\n        if (l == r)\n            return;\n        int mid = (l + r) &gt;&gt; 1;\n        calc(l, mid), calc(mid + 1, r);\n        int j = l;\n        for (int i = mid + 1; i &lt;= r; ++i) &#123;\n            for (; j &lt;= mid &amp;&amp; a[j].b &lt; a[i].b; ++j)\n                add(a[j].c, 1);\n            a[i].res += ask(a[i].c);\n        &#125;\n        for (int i = l; i &lt; j; ++i)\n            add(a[i].c, -1);\n        std::inplace_merge(a.begin() + l, a.begin() + mid + 1, a.begin() + r + 1, [&amp;](node x, node y) &#123; return x.b &lt; y.b; &#125;);\n        return;\n    &#125;;\n    std::sort(a.begin() + 1, a.end(), [&amp;](node x, node y) &#123; return x.a &lt; y.a; &#125;);\n    calc(1, n);\n    for (int i = 1; i &lt;= n; ++i)\n        res -= a[i].res;\n    res += (long long)n * (n - 1) * (n - 2) / 6;\n    for (int k = 0; k &lt; 3; ++k) &#123;\n        std::sort(a.begin() + 1, a.end(), [&amp;](node x, node y) &#123; return x.a &lt; y.a; &#125;);\n        std::fill(bit.begin() + 1, bit.end(), 0);\n        for (int i = 1; i &lt;= n; ++i) &#123;\n            int t = ask(a[i].b);\n            res -= (long long)t * (t - 1) / 2;\n            add(a[i].b, 1);\n            std::tie(a[i].a, a[i].b, a[i].c) = std::make_tuple(a[i].b, a[i].c, a[i].a);\n        &#125;\n    &#125;\n    for (int i = 1; i &lt;= n; ++i)\n        res += (long long)a[i].res * (a[i].res - 1);\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"c.-æ˜Ÿç™½-by-ttpandasç¬›å¡å°”æ ‘-dsu-on-tree\">C. æ˜Ÿç™½ by TTpandaSï¼ˆç¬›å¡å°”æ ‘ + dsu on treeï¼‰</h3>\n<p><a href=\"/20250819/#æ˜Ÿç™½-by-ttpandasç¬›å¡å°”æ ‘-dsu-on-tree\">link</a></p>\n<hr />\n<h3 id=\"c.-isn\">C. isn</h3>\n<p><a href=\"https://hydro.ac/p/bzoj-P4361\" class=\"uri\">https://hydro.ac/p/bzoj-P4361</a></p>\n<ul>\n<li><p>æœ€åä¸€ä¸ªåˆ å»çš„ä¸€å®šæ˜¯è¿æ¥ <code>&gt;</code> çš„æ•°ï¼Œå¯ä»¥ DP è¿˜å‰©ä¸€ä¸ªæ•°æ²¡åˆ æ—¶å¯èƒ½çš„åºåˆ—ã€‚</p>\nä»¤ <span class=\"math inline\">\\(f_{i,j,0/1}\\)</span> è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ä¸º <span class=\"math inline\">\\(i\\)</span>ï¼Œåºåˆ—é•¿ä¸º <span class=\"math inline\">\\(j\\)</span>ï¼Œæœ€åä¸€ä¸ªè¢«åˆ å»çš„æ•°ï¼ˆæœªï¼‰è¢«ç¡®å®šçš„æ–¹æ¡ˆæ•°ã€‚<strong>æ³¨æ„ç¡®å®šæœ€åä¸€ä¸ªè¢«åˆ å»çš„æ•°è¦åœ¨è½¬ç§»è¿‡ç¨‹ä¸­è¿›è¡Œï¼Œè€Œä¸æ˜¯ä½œä¸ºä¸€ä¸ª DP èŠ‚ç‚¹</strong>ï¼Œå¾ˆå®¹æ˜“å‘ç°åè€…æ˜¯é”™çš„ã€‚</li>\n<li><p>ä¼˜åŒ–çš„æ€è·¯å°±ä¸ä¸€æ ·äº†ã€‚å› ä¸ºè¦ä¹˜ä¸Š <span class=\"math inline\">\\((n-j)!\\)</span>ï¼Œæ‰€ä»¥ <span class=\"math inline\">\\(j\\)</span> çš„è¿™ä¸€ç»´æ˜¯çœä¸æ‰çš„</p>\nè€ƒè™‘ä¸ç®¡æœ€åä¸€ä¸ªè¢«åˆ æ‰çš„æ•°ï¼Œç›´æ¥ä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ä¸º <span class=\"math inline\">\\(i\\)</span>ï¼Œåºåˆ—é•¿ä¸º <span class=\"math inline\">\\(j\\)</span> çš„æ–¹æ¡ˆæ•°ã€‚æœ‰ <span class=\"math inline\">\\(f_{i,j}=\\sum\\limits_{a_k\\le a_i}f_{k,j - 1}\\)</span>ï¼Œå¯ä»¥ DS ä¼˜åŒ–ã€‚ä½†è¿™æ ·ä¼šäº§ç”Ÿä¸åˆæ³•çš„æƒ…å†µã€‚</li>\n<li><p>è€ƒå¯Ÿä»€ä¹ˆæ ·çš„åºåˆ—åˆæ³•ï¼Œå‘ç°<strong>åˆ å»çš„æœ€åä¸€ä¸ªæ•°ä¸€å®šæ˜¯éæ³•çš„ï¼Œä¹Ÿå°±æ˜¯åŒ…å«ä¹‹çš„åºåˆ—éƒ½æ˜¯éæ³•çš„ï¼›åä¹‹æ˜“å¾—è¢«åˆæ³•åºåˆ—åŒ…å«çš„åºåˆ—éƒ½éæ³•</strong></p>\n<p>æ˜ç™½äº†è¿™ä¸€ç‚¹è¿‡åå°±ä¼šçŸ¥é“é•¿åº¦ä¸º <span class=\"math inline\">\\(j\\)</span> çš„åˆæ³•åºåˆ—ç³»æ•°éƒ½ä¸º <span class=\"math inline\">\\((n-j)!\\)</span></p>\n<p>æ•…å®¹æ–¥ï¼Œä»¤ <span class=\"math inline\">\\(g_i\\)</span> è¡¨ç¤ºåºåˆ—é•¿ä¸º <span class=\"math inline\">\\(i\\)</span> çš„æ–¹æ¡ˆæ•°ï¼Œ<span class=\"math inline\">\\(h_i\\)</span> è¡¨ç¤ºåºåˆ—é•¿ä¸º <span class=\"math inline\">\\(i\\)</span> çš„åˆæ³•æ–¹æ¡ˆæ•°ã€‚ä»å¼‚æˆ–è§’åº¦è€ƒè™‘ï¼Œæ˜“å¾— <span class=\"math inline\">\\(h_i=g_i-\\sum\\limits_{j=i+1}h_j\\times (j-i)!\\times C_j^i\\)</span>ã€‚</p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 1e9 + 7;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n    std::freopen(&quot;isn.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;isn.out&quot;, &quot;w&quot;, stdout);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; a(n + 1), l(1);\n    std::vector&lt;long long&gt; fac(n + 1), inv(n + 1);\n    fac[0] = inv[0] = 1ll;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i], l.push_back(a[i]);\n        fac[i] = fac[i - 1] * i % mod;\n    &#125;\n    auto qkp = [](long long x, int y) &#123;\n        auto res(1ll);\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    inv[n] = qkp(fac[n], mod - 2);\n    for (int i = n - 1; i; --i)\n        inv[i] = inv[i + 1] * (i + 1) % mod;\n    auto C = [&amp;](int n, int m) &#123;\n        return fac[n] * inv[m] % mod * inv[n - m] % mod;\n    &#125;;\n    std::sort(l.begin(), l.end());\n    l.erase(std::unique(l.begin(), l.end()), l.end());\n    for (int i = 0; i &lt;= n; ++i)\n        a[i] = std::lower_bound(l.begin(), l.end(), a[i]) - l.begin() + 1;\n    int m = (int)l.size();\n    std::vector&lt;std::vector&lt;long long&gt; &gt; bit(n + 1, std::vector&lt;long long&gt; (m + 1));\n    auto lowbit = [](int x) &#123;\n        return x &amp; -x;\n    &#125;;\n    auto add = [&amp;](int id, int x, long long v) &#123;\n        for (; x &lt;= m; x += lowbit(x))\n            (bit[id][x] += v) %= mod;\n        return;\n    &#125;;\n    auto ask = [&amp;](int id, int x) &#123;\n        auto res(0ll);\n        for (; x; x -= lowbit(x))\n            (res += bit[id][x]) %= mod;\n        return res;\n    &#125;;\n    std::vector&lt;long long&gt; g(n + 1), h(n + 1);\n    std::vector&lt;std::vector&lt;long long&gt; &gt; f(n + 1, std::vector&lt;long long&gt; (n + 1));\n    add(0, a[0], 1ll), f[0][0] = 1ll;\n    for (int i = 1; i &lt;= n; ++i)\n        for (int j = n; j; --j) &#123;\n            f[i][j] = ask(j - 1, a[i]);\n            add(j, a[i], f[i][j]);\n            (g[j] += f[i][j] * fac[n - j]) %= mod;\n        &#125;\n    auto res(0ll);\n    for (int i = n; i; --i) &#123;\n        h[i] = g[i];\n        for (int j = i + 1; j &lt;= n; ++j)\n            (h[i] += mod - h[j] * fac[j - i] % mod * C(j, i) % mod) %= mod;\n        (res += h[i]) %= mod;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"d.-thepowers\">D. ThePowers</h3>\n<p>TopCoder - 12185ï¼ŒåŸé¢˜äº¤ä¸äº†æ•…ä¸æ”¾é“¾æ¥äº†</p>\n<p><a href=\"https://www.becoder.com.cn/contest/6522/problem/4\" class=\"uri\">https://www.becoder.com.cn/contest/6522/problem/4</a></p>\n<blockquote>\n<p>ç»™å®š <span class=\"math inline\">\\(A,B\\)</span>ï¼Œå¯¹äºæ‰€æœ‰ <span class=\"math inline\">\\(X\\le A,Y\\le B\\)</span>ï¼Œæ±‚ <span class=\"math inline\">\\(X^Y\\)</span> çš„å¯èƒ½å–å€¼æ•°é‡ã€‚<span class=\"math inline\">\\(A,B\\le10^9\\)</span>ã€‚</p>\n</blockquote>\n<ul>\n<li>è€ƒè™‘ä»€ä¹ˆæ—¶å€™ç®—é‡ã€‚å‘ç°å½“ä¸”ä»…å½“ <span class=\"math inline\">\\(x^a=y^b\\)</span>ï¼Œæ­¤æ—¶è®° <span class=\"math inline\">\\(a&#39;=a\\div\\gcd(a,b),b&#39;=b\\div \\gcd(a,b)\\)</span>ï¼Œé‚£ä¹ˆ <span class=\"math inline\">\\(t=\\sqrt[a&#39;]x=\\sqrt[b&#39;]y\\)</span> ä¸ºæ•´ï¼ˆå†™æˆè´¨å› æ•°ä¹˜ç§¯æ˜¯æ˜“è¯çš„ï¼‰ï¼Œåˆ™ <span class=\"math inline\">\\(x=t^b,y=t^a\\)</span>ï¼Œæ˜¯åŒä¸€ä¸ªæ•°çš„ä¸åŒæ¬¡å¹‚</li>\n<li><p>æ•…æŠŠ <span class=\"math inline\">\\(A\\)</span> å†…æ‰€æœ‰æ•°åˆ†ç»„ï¼Œè®° <span class=\"math inline\">\\(S_x\\)</span> è¡¨ç¤ºæ‰€æœ‰ <span class=\"math inline\">\\(x\\)</span> çš„æ¬¡å¹‚ï¼Œå…¶ä¸­ <span class=\"math inline\">\\(x\\)</span> ä¸æ˜¯å…¶ä»–æ•°çš„æ¬¡å¹‚</p>\nå‘ç°ä¸€ä¸ªå¯¹äº <span class=\"math inline\">\\(&gt;\\sqrt A\\)</span> çš„æ•° <span class=\"math inline\">\\(y\\)</span>ï¼Œåªæœ‰å¯èƒ½å±äº <span class=\"math inline\">\\(S_y\\)</span>ï¼Œæˆ–ä¸€ä¸ª <span class=\"math inline\">\\(x\\le \\sqrt A\\)</span> çš„ <span class=\"math inline\">\\(S_x\\)</span>ã€‚æ¯ç»„æœ€å¤šæœ‰ <span class=\"math inline\">\\(30\\)</span> ä¸ªï¼Œæ•…æ‰«ä¸€é <span class=\"math inline\">\\(\\le\\sqrt A\\)</span> çš„æ•°å³å¯å®Œæˆåˆ†ç»„ã€‚</li>\n<li><p>è¿™æ ·å°±åªç”¨è€ƒè™‘åŒç»„å†…çš„è®¡æ•°ã€‚å³å¯¹äº <span class=\"math inline\">\\(x\\)</span> å’Œ <span class=\"math inline\">\\(p\\le |S_x|,y\\le B\\)</span>ï¼Œ<span class=\"math inline\">\\(x^{py}\\)</span> æœ‰å¤šå°‘ç§å–å€¼ï¼Œä¹Ÿå³ <span class=\"math inline\">\\(py\\)</span> æœ‰å¤šå°‘ç§å–å€¼</p>\nå‘ç°å› ä¸ºå€¼åŸŸæ˜¯è¿ç»­çš„ï¼Œå¯¹äºä¸€ä¸ª <span class=\"math inline\">\\(p\\)</span>ï¼Œåªè¦ <span class=\"math inline\">\\(pB\\)</span> èŒƒå›´å†…æŸä¸ªæ•°æ˜¯ <span class=\"math inline\">\\(p\\)</span> çš„å€æ•°å°±å¯ä»¥å–åˆ°ï¼Œæšä¸¾ <span class=\"math inline\">\\([(p-1)B+1,pB]\\)</span>ï¼Œå¯¹äºæ¯ä¸ª <span class=\"math inline\">\\(p\\)</span> å®¹æ–¥ï¼Œå°±éœ€è¦è®¡ç®— <span class=\"math inline\">\\(p\\sim |S_x|\\)</span> çš„æ¯ä¸ªå­é›†ï¼Œå¤æ‚åº¦ä¼šçˆ†ç‚¸ã€‚</li>\n<li><p>å¯¹äº <span class=\"math inline\">\\(x,y\\in[p,|S_x|]\\)</span>ï¼Œå¦‚æœ <span class=\"math inline\">\\(y\\)</span> æ˜¯ <span class=\"math inline\">\\(x\\)</span> çš„å€æ•°ï¼Œå°±å¯ä»¥ skipï¼Œåªåœ¨å‰©ä¸‹çš„å…ƒç´ é‡Œæšä¸¾å­é›†ï¼Œå¯ä»¥ä»£ç éªŒè¯ä¸€ä¸‹ <span class=\"math inline\">\\(30\\)</span> ä»¥å†…æœ€å¤šå‰©ä¸‹ <span class=\"math inline\">\\(15\\)</span> ä¸ªæ•°ï¼Œå¯ä»¥æ¥å—ï¼Œæ³¨æ„å­é›†ä¿¡æ¯ç±»ä¼¼é«˜ç»´å‰ç¼€å’Œåœ° <span class=\"math inline\">\\(O(1)\\)</span> æ±‚å°±è¡Œäº†</p></li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n    std::freopen(&quot;power.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;power.out&quot;, &quot;w&quot;, stdout);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n    const auto stime = std::chrono::steady_clock::now();\n#endif\n    long long A, B, mx = 1ll;\n    std::cin &gt;&gt; A &gt;&gt; B;\n    if (A == 1) &#123;\n        std::cout &lt;&lt; 1 &lt;&lt; &#39;\\n&#39;;\n        return 0;\n    &#125;\n    int cnt = 1;\n    long long res = 1ll;\n    for (; (mx + 1) * (mx + 1) &lt;= A; ++mx);\n    std::vector&lt;int&gt; tag(mx + 1);\n    for (int i = 2; i &lt;= mx; ++i)\n        if (!tag[i]) &#123;\n            int siz = 1;\n            for (long long j = i; j &lt;= A; j *= i, ++siz)\n                if (j &lt;= mx)\n                    tag[j] = 1;\n            cnt += --siz;\n            for (int j = 1; j &lt;= siz; ++j) &#123;\n                std::vector&lt;int&gt; p(&#123; j &#125;);\n                for (int k = j + 1; k &lt;= siz; ++k) &#123;\n                    bool flag = 1;\n                    for (auto l : p)\n                        if (k % l == 0) &#123;\n                            flag = 0;\n                            break;\n                        &#125;\n                    if (flag)\n                        p.push_back(k);\n                &#125;\n                int m = (int)p.size(), s = 1 &lt;&lt; m;\n                std::vector&lt;long long&gt; mul(s);\n                mul[0] = 1ll;\n                auto lcm = [&amp;](long long x, long long y) &#123;\n                    return x / std::__gcd(x, y) * y;\n                &#125;;\n                for (int k = 1; k &lt; s; ++k) &#123;\n                    mul[k] = lcm(p[std::__lg(k ^ ((k - 1) &amp; k))], mul[(k - 1) &amp; k]);\n                    if (__builtin_popcount(k) &amp; 1)\n                        res += j * B / mul[k] - (j - 1) * B / mul[k];\n                    else\n                        res -= j * B / mul[k] - (j - 1) * B / mul[k];\n                &#125;\n            &#125;\n        &#125;\n    res += (A - cnt) * B;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n#ifndef ONLINE_JUDGE\n    std::cerr &lt;&lt; std::fixed &lt;&lt; std::setprecision(6) &lt;&lt; std::chrono::duration&lt;double&gt; (std::chrono::steady_clock::now() - stime).count() &lt;&lt; &quot;s\\n&quot;;\n#endif\n    return 0;\n&#125;</code></pre>\n</details>\n<p>æœç´¢åšæ³•æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œå°±ä¸èµ˜è¿°äº†</p>\n",
            "tags": [
                "DP",
                "è®¡æ•°",
                "CDQ åˆ†æ²»"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250807/",
            "url": "https://xsc062.netlify.app/20250807/",
            "title": "å­¦ä¹ ç¬”è®°ï¼šåˆ†æ‹†æ•°ä¸ Ferrers å›¾",
            "date_published": "2025-08-07T08:20:45.000Z",
            "content_html": "<p>éœ€è¦çŸ¥é“æ¦‚å¿µå’Œæ±‚æ³•ï¼Œæœ‰ä¸€å®šçš„ç”¨å¤„</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"åˆ†æ‹†æ•°ä¸äº’å¼‚åˆ†æ‹†æ•°\">åˆ†æ‹†æ•°ä¸äº’å¼‚åˆ†æ‹†æ•°</h2>\n<p>è¦æ±‚ï¼šç»™å®šä¸€ä¸ªæ­£æ•´æ•° <span class=\"math inline\">\\(n\\)</span>ï¼Œè¦æ±‚å°†å…¶åˆ’åˆ†ä¸º <span class=\"math inline\">\\(m\\)</span> ä¸ªå¯é‡ / ä¸å¯é‡çš„æ­£æ•´æ•°ï¼Œé—®æœ¬è´¨ä¸åŒçš„æ–¹æ¡ˆæ•°ã€‚ï¼ˆæ˜¾ç„¶ <span class=\"math inline\">\\(m\\)</span> ä¸ <span class=\"math inline\">\\(\\sqrt n\\)</span> åŒé˜¶ã€‚ï¼‰</p>\n<p>ä¸å¦¨ä»¤åˆ’åˆ†ç»“æœå•è°ƒä¸é™ï¼Œåˆ™æœ‰ä¸¤ç§ DP è·¯å¾„ï¼š</p>\n<ul>\n<li><p>æ³•ä¸€ï¼šä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºæŠŠ <span class=\"math inline\">\\(i\\)</span> åˆ†æˆ <span class=\"math inline\">\\(j\\)</span> ä¸ªæ­£æ•´æ•°çš„æ–¹æ¡ˆæ•°ã€‚</p>\n<ul>\n<li>ä¸å¯é‡ï¼šè€ƒè™‘å°†è¿™ <span class=\"math inline\">\\(j\\)</span> ä¸ªæ•°å‡å» <span class=\"math inline\">\\(1\\)</span>ã€‚æœ€å¤šä¸€ä¸ªå…ƒç´ ç”± <span class=\"math inline\">\\(1\\)</span> å˜ä¸º <span class=\"math inline\">\\(0\\)</span>ï¼Œç»„æ•°å‡å°‘ <span class=\"math inline\">\\(1\\)</span>ï¼›å…¶ä»–æ—¶å€™è¿˜æ˜¯ <span class=\"math inline\">\\(j\\)</span> ç»„ã€‚æ•…äº‘ <span class=\"math inline\">\\(f_{i,j}=f_{i-j,j-1}+f_{i-j,j}\\)</span>ã€‚</li>\n<li>å¯é‡ï¼šå¦‚æœå­˜åœ¨ <span class=\"math inline\">\\(1\\)</span>ï¼Œå¯ä»¥åˆ é™¤ä¹‹ç„¶åè½¬ç§»ï¼›å¦åˆ™ä»æ•´ä½“å‡ <span class=\"math inline\">\\(1\\)</span> è½¬ç§»ã€‚æ•…æ›° <span class=\"math inline\">\\(f_{i,j}=f_{i-1,j-1}+f_{i-j,j}\\)</span>ã€‚</li>\n</ul>\nè¯¥è½¬ç§»æ–¹æ³•å”¯ä¸€æ€§å¾ˆæ˜¾ç„¶ã€‚<strong>æ³¨æ„åˆ°ç¬¬äºŒç»´åªå’Œ <span class=\"math inline\">\\(j,j-1\\)</span> æœ‰å…³ï¼›å¯ä»¥äº¤æ¢å‰åä¸¤ç»´é¡ºåºç„¶åæ»šåŠ¨ã€‚</strong></li>\n<li><p>æ³•äºŒï¼šä»¤ <span class=\"math inline\">\\(n=\\sum a_i\\)</span>ï¼Œå»ºç«‹ <span class=\"math inline\">\\(a\\)</span> çš„å·®åˆ†æ•°ç»„ <span class=\"math inline\">\\(d\\)</span>ï¼Œåˆ™æœ‰ <span class=\"math inline\">\\(n=\\sum\\limits_{i=1}^m \\sum\\limits_{j=1}^i c_j=\\sum\\limits_{i=1}^m (n-i+1)\\times a_i\\)</span>ã€‚å‘ç° <span class=\"math inline\">\\(a_i\\)</span> æ¯å¢å¤§ <span class=\"math inline\">\\(1\\)</span>ï¼Œç­”æ¡ˆä¼šå¢å¤§ <span class=\"math inline\">\\(n-i+1\\)</span>ã€‚æ•…è½¬åŒ–ä¸ºã€ç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªç‰©å“é‡é‡ä¸º <span class=\"math inline\">\\(n-i+1\\)</span>ã€çš„å®Œå…¨èƒŒåŒ…ã€‚</p>\n<ul>\n<li>ä¸å¯é‡ï¼šè¦æ±‚æ¯ä¸ªç‰©å“è‡³å°‘é€‰ä¸€æ¬¡ã€‚</li>\n<li>å¯é‡ï¼šæ— é™åˆ¶ã€‚</li>\n</ul>\n<p>è¯¥æ–¹æ³•å”¯ä¸€æ€§æ›´æ˜¾ç„¶ã€‚</p></li>\n</ul>\n<p>å¤æ‚åº¦å‡ä¸º <span class=\"math inline\">\\(O(nm)\\)</span>ï¼Œå³ <span class=\"math inline\">\\(O(V\\sqrt V)\\)</span>ã€‚</p>\n<h3 id=\"ä¾‹sets-of-complementary-sums\">ä¾‹ï¼šSets of Complementary Sums</h3>\n<p><a href=\"/20250723/#e.-sets-of-complementary-sums\">link</a></p>\n<h2 id=\"ferrers-å›¾\">Ferrers å›¾</h2>\n<p>å°† <span class=\"math inline\">\\(k\\)</span> ä¸ªåˆ†æ‹†å‡ºæ¥çš„æ•°ç”¨æ¨ªå‘æŸ±çŠ¶å›¾è¡¨ç¤ºå¹¶å•è°ƒä¸å¢æ’åˆ—ï¼Œå¾—åˆ° Ferrers å›¾ã€‚</p>\n<figure>\n<img src=\"image-1.png\" alt=\"ä¾‹ï¼š12=5+4+2+1 çš„ Ferrers å›¾ï¼ˆå›¾æº OI Wikiï¼‰\" /><figcaption>ä¾‹ï¼š<span class=\"math inline\">\\(12=5+4+2+1\\)</span> çš„ Ferrers å›¾ï¼ˆå›¾æº OI Wikiï¼‰</figcaption>\n</figure>\n<p>å°†å›¾åƒæ–œå‘ç¿»æŠ˜å¾—åˆ°ä¸€ç»„å…±è½­è§£ï¼ŒåŸå›¾ä¸­çš„ <span class=\"math inline\">\\(k\\)</span> å³ä¸ºå…±è½­è§£ä¸­çš„å…ƒç´ æœ€å€¼ã€‚æ•…äº¦å¯é™å®šåˆ†æ‹†ç»“æœçš„æœ€å€¼ä¸º <span class=\"math inline\">\\(k\\)</span>ï¼Œåˆ™ç»“æœä»ä¸º <span class=\"math inline\">\\(f_{n,k}\\)</span>ã€‚åŒæ—¶é€‚ç”¨äºåˆ†æ‹†æ•°ä¸äº’å¼‚åˆ†æ‹†æ•°ã€‚</p>\n<p>é¡ºå¸¦æä¸€å˜´æ¨è¡¨ï¼šæŠŠç‚¹æ›¿æ¢æˆ <span class=\"math inline\">\\(1\\sim n\\)</span>ï¼Œå¹¶ä½¿å¾—ä¸€ä¸ªç‚¹åŒæ—¶å¤§äºå·¦ä¾§å’Œä¸Šæ–¹çš„å€¼ã€‚</p>\n<p>ä¼¼ä¹å°±ä¸æ˜¯å¾ˆæœ‰ç”¨äº†ã€‚è®¡æ•°é¢˜å¯èƒ½ä¼šè€ƒã€‚</p>\n",
            "tags": [
                "DP"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250805/",
            "url": "https://xsc062.netlify.app/20250805/",
            "title": "æ‚é¢˜é€‰è°ˆï¼šçŠ¶å‹ DP",
            "date_published": "2025-08-05T06:33:55.000Z",
            "content_html": "<p>æ²¡è¡¥å®Œï¼ˆ1/3ï¼‰ï¼ŒåŠ¨ä½œè¿˜æ˜¯å¤ªæ…¢äº†</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"a---åªä¸è¿‡æ˜¯é•¿çš„é¢†å¸¦-2-just-long-neckties-2\">A - åªä¸è¿‡æ˜¯é•¿çš„é¢†å¸¦ 2 / Just Long Neckties 2</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P11665\" class=\"uri\">https://www.luogu.com.cn/problem/P11665</a></p>\n<p>éœ€è¦è§‚å¯Ÿåˆ°ï¼Œä»»æ„æ—¶åˆ» <span class=\"math inline\">\\(B\\)</span> ä¸­ä¸å­˜åœ¨é‡å¤å…ƒç´ ã€‚æŠŠ <span class=\"math inline\">\\(B\\)</span> å‹å‡ºæ¥ï¼Œä»¤ <span class=\"math inline\">\\(f_{i,S}\\)</span> è¡¨ç¤ºé€‰äº† <span class=\"math inline\">\\(i\\)</span>ï¼Œå½“å‰ <span class=\"math inline\">\\(B\\)</span> ä¸º <span class=\"math inline\">\\(S\\)</span> æ˜¯å¦å¯è¡Œï¼Œèƒ½å¤Ÿ <span class=\"math inline\">\\(O(n\\cdot 2^V)\\)</span>ã€‚å¯¹äºæŸä¸ª <span class=\"math inline\">\\(S\\)</span>ï¼Œåªå…³å¿ƒå®ƒæœ€è¿œèƒ½åˆ°è¾¾å“ªä¸ª <span class=\"math inline\">\\(i\\)</span>ï¼Œæ•…ä»¤ <span class=\"math inline\">\\(f_S\\)</span> è®°å½•ä¹‹ã€‚å¯¹äºæ¯ä¸€ä¸ª <span class=\"math inline\">\\(S\\)</span>ï¼Œéƒ½å¯ä»¥æ‰¾åˆ° <span class=\"math inline\">\\(f_S\\)</span> åç¬¬ä¸€å¯¹ <span class=\"math inline\">\\(a_i,a_{i+1}\\notin S\\)</span>ï¼Œç”¨å…¶åˆ·è¡¨ã€‚</p>\n<p>å‘ç°ã€æ‰¾ <span class=\"math inline\">\\(f_S\\)</span> åç¬¬ä¸€å¯¹éæ³•å…ƒç´ ã€æ˜¯å¾ˆæ…¢çš„ï¼Œè€ƒè™‘ä¼˜åŒ–ï¼›å¯¹äºæ¯ä¸ª <span class=\"math inline\">\\(i\\)</span> ç»´æŠ¤ <span class=\"math inline\">\\(p\\)</span> åœ¨å…¶åç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½® <span class=\"math inline\">\\(x\\)</span>ï¼Œå¯¹äºæ¯ä¸ª <span class=\"math inline\">\\(a_x=p\\)</span> ç»´æŠ¤ <span class=\"math inline\">\\(x\\)</span> åæ–¹ <span class=\"math inline\">\\(a_y=p,a_{y+1}=q\\)</span> ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œç›¸å½“äº<strong>å…ˆæ‰¾ <span class=\"math inline\">\\(p\\)</span> å†æ‰¾ <span class=\"math inline\">\\((p,q)\\)</span></strong>ï¼Œå°±å¯ä»¥åšåˆ° <span class=\"math inline\">\\(O(V^2\\cdot 2^V+n\\cdot V)\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; a(n + 1);\n    int V = 0;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i];\n        V = std::max(V, a[i]--);\n    &#125;\n    std::vector&lt;std::vector&lt;int&gt; &gt; tx(n + 1, std::vector&lt;int&gt; (V)), ty(n + 1, std::vector&lt;int&gt; (V));\n    std::vector&lt;int&gt; lp(V);\n    std::vector&lt;std::vector&lt;int&gt; &gt; lpq(V, std::vector&lt;int&gt; (V));\n    for (int i = n; ~i; --i) &#123;\n        if (i &amp;&amp; i != n)\n            lpq[a[i]][a[i + 1]] = i;\n        for (int j = 0; j &lt; V; ++j) &#123;\n            tx[i][j] = lp[j];\n            if (i != n)\n                ty[i][j] = lpq[a[i]][j];\n        &#125;\n        if (i != 0)\n            lp[a[i]] = i;\n    &#125;\n    int siz = 1 &lt;&lt; V, res = 21;\n    std::vector&lt;int&gt; f(siz);\n    for (int i = 0; i &lt; siz; ++i) &#123;\n        std::vector&lt;int&gt; p0, p1;\n        for (int j = 0; j &lt; V; ++j)\n            if ((i &gt;&gt; j) &amp; 1)\n                p1.push_back(j);\n            else\n                p0.push_back(j);\n        int j = n;\n        for (auto p : p0)\n            if (tx[f[i]][p])\n                for (auto q : p0)\n                    if (ty[tx[f[i]][p]][q])\n                        j = std::min(j, ty[tx[f[i]][p]][q]);\n        if (j != n) &#123;\n            f[i ^ (1 &lt;&lt; a[j])] = std::max(f[i ^ (1 &lt;&lt; a[j])], j);\n            f[i ^ (1 &lt;&lt; a[j + 1])] = std::max(f[i ^ (1 &lt;&lt; a[j + 1])], j + 1);\n            for (auto k : p1) &#123;\n                f[i ^ (1 &lt;&lt; k) ^ (1 &lt;&lt; a[j])] = std::max(f[i ^ (1 &lt;&lt; k) ^ (1 &lt;&lt; a[j])], j);\n                f[i ^ (1 &lt;&lt; k) ^ (1 &lt;&lt; a[j + 1])] = std::max(f[i ^ (1 &lt;&lt; k) ^ (1 &lt;&lt; a[j + 1])], j + 1);\n            &#125;\n        &#125;\n        else\n            res = std::min(res, __builtin_popcount(i));\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b---cut-and-reorder\">B - Cut and Reorder</h2>\n<p><a href=\"https://atcoder.jp/contests/abc328/tasks/abc328_g\" class=\"uri\">https://atcoder.jp/contests/abc328/tasks/abc328_g</a></p>\n<p>ä¸å¦¨å…ˆé‡æ’å†ä¿®æ”¹ï¼Œä»¤ <span class=\"math inline\">\\(f_{i,S}\\)</span> è¡¨ç¤ºå·²ç»é‡æ’å¥½æ–°åºåˆ—çš„å‰ <span class=\"math inline\">\\(i\\)</span> ä¸ªå…ƒç´ ï¼Œå¯¹åº”åŸåºåˆ—çŠ¶æ€ <span class=\"math inline\">\\(S\\)</span> çš„æœ€å°ä»£ä»·ã€‚æšä¸¾æ–°åŒºé—´å®¹æ˜“è½¬ç§»ã€‚å¯ä»¥å‘ç°æšä¸¾ <span class=\"math inline\">\\(i,S\\)</span> çš„å®é™…å¤æ‚åº¦ä¸º <span class=\"math inline\">\\(O(2^n)\\)</span>ï¼ˆç©ºé—´ä¹Ÿå¯ä»¥è¿™ä¹ˆä¼˜åŒ–ï¼‰ï¼Œé¢„å¤„ç†ä¹‹åæ€»æ—¶é—´å¤æ‚åº¦ <span class=\"math inline\">\\(O(n^2\\cdot 2^n)\\)</span>ï¼Œè·‘ä¸æ»¡ï¼Œå¯ä»¥é€šè¿‡ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 1e18;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    long long c;\n    std::cin &gt;&gt; n &gt;&gt; c;\n    std::vector&lt;long long&gt; a(n), b(n);\n    for (int i = 0; i &lt; n; ++i)\n        std::cin &gt;&gt; a[i];\n    for (int i = 0; i &lt; n; ++i)\n        std::cin &gt;&gt; b[i];\n    using arr = std::vector&lt;long long&gt;;\n    using brr = std::vector&lt;arr&gt;;\n    using crr = std::vector&lt;brr&gt;;\n    brr p(n, arr(n));\n    crr g(n, brr(n, arr(n)));\n    for (int l = 0; l &lt; n; ++l)\n        for (int r = l; r &lt; n; ++r) &#123;\n            for (int k = l; k &lt;= r; ++k)\n                p[l][r] ^= (1 &lt;&lt; k);\n            for (int R = r - l; R &lt; n; ++R)\n                for (int L = R, j = r; j &gt;= l; --L, --j)\n                    g[l][r][R] += std::abs(b[L] - a[j]);\n        &#125;\n    int siz = 1 &lt;&lt; n;\n    std::vector&lt;long long&gt; f(siz, inf);\n    f[0] = 0ll;\n    for (int j = 1; j &lt; siz; ++j) &#123;\n        int i = __builtin_popcount(j) - 1;\n        for (int r = 0; r &lt; n; ++r)\n            for (int l = r; ~l &amp;&amp; ((j &gt;&gt; l) &amp; 1); --l)\n                f[j] = std::min(f[j], f[j ^ p[l][r]] + g[l][r][i] + c);\n    &#125;\n    std::cout &lt;&lt; f[siz - 1] - c &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"c---electric-circuit\">C - Electric Circuit</h2>\n<p><a href=\"https://atcoder.jp/contests/abc321/tasks/abc321_g\" class=\"uri\">https://atcoder.jp/contests/abc321/tasks/abc321_g</a></p>\n<p>å¾ˆåƒ<a href=\"/20250430/#æœ‰æ ‡å·æ— å‘å›¾è®¡æ•°\">æ— å‘å›¾å®¹æ–¥</a>ï¼Ÿä»¤ <span class=\"math inline\">\\(f_S\\)</span> è¡¨ç¤ºè®© <span class=\"math inline\">\\(S\\)</span> å†…éƒ¨å®Œæˆé…å¯¹ï¼Œå¯ä»¥ä¸è¿é€šçš„æ–¹æ¡ˆæ•°ï¼Œé‚£ä¹ˆå½“ä¸”ä»…å½“ <span class=\"math inline\">\\(S\\)</span> å†…éƒ¨ç‚¹å‡ºã€å…¥åº¦ä¹‹å’Œç›¸ç­‰ï¼ˆè®°ä¸º <span class=\"math inline\">\\(cnt\\)</span>ï¼‰æ—¶ï¼Œ<span class=\"math inline\">\\(f_S\\)</span> æœ‰å€¼ <span class=\"math inline\">\\(cnt!\\)</span>ã€‚ç›¸ä¼¼åœ°ï¼Œè®¾ <span class=\"math inline\">\\(g_S\\)</span> è¡¨ç¤ºè®© <span class=\"math inline\">\\(S\\)</span> å®Œæˆé…å¯¹ï¼Œæˆä¸ºä¸€ä¸ªè¿é€šå—çš„æ–¹æ¡ˆæ•°ï¼Œå¾—åˆ° <span class=\"math inline\">\\(g_S=f_S-\\sum\\limits_{v\\in S} f_{S\\oplus v}\\cdot g_v\\)</span>ã€‚è®© <span class=\"math inline\">\\(v\\)</span> å¿…é¡»åŒ…å« <span class=\"math inline\">\\(S\\)</span> ä¸­ç¼–å·æœ€å°çš„ç‚¹å°±å¯ä»¥å»é‡ã€‚</p>\n<p>ä»è´¡çŒ®çš„è§’åº¦å‡ºå‘ï¼Œ<span class=\"math inline\">\\(S\\)</span> å¸¦æ¥çš„è´¡çŒ®å°±æ˜¯ <span class=\"math inline\">\\(g_S\\cdot f_{U\\oplus S}\\)</span>ï¼Œå…¶ä¸­ <span class=\"math inline\">\\(U\\)</span> æ˜¯å…¨é›†ã€‚æœ€åé™¤ä»¥ <span class=\"math inline\">\\(M!\\)</span> æ±‚å‡ºæœŸæœ›ã€‚</p>\n<p>å¤æ‚åº¦ <span class=\"math inline\">\\(O(3^n)\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;int&gt; ci(n), co(n);\n    for (int i = 1, x; i &lt;= m; ++i)\n        std::cin &gt;&gt; x, ++ci[x - 1];\n    for (int i = 1, x; i &lt;= m; ++i)\n        std::cin &gt;&gt; x, ++co[x - 1];\n    std::vector&lt;long long&gt; fac(m + 1);\n    fac[0] = 1ll;\n    for (int i = 1; i &lt;= m; ++i)\n        fac[i] = fac[i - 1] * i % mod;\n    auto qkp = [&amp;](long long x, int y) &#123;\n        auto res(1ll);\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    int siz = 1 &lt;&lt; n;\n    std::vector&lt;long long&gt; f(siz), g(siz);\n    for (int i = 1; i &lt; siz; ++i) &#123;\n        int si = 0, so = 0;\n        for (int j = 0; j &lt; n; ++j)\n            if ((i &gt;&gt; j) &amp; 1)\n                si += ci[j], so += co[j];\n        if (si == so)\n            f[i] = fac[si];\n    &#125;\n    auto res(0ll);\n    for (int i = 1; i &lt; siz; ++i) &#123;\n        g[i] = f[i];\n        int mn = 0;\n        for (int j = 0; j &lt; n; ++j)\n            if ((i &gt;&gt; j) &amp; 1) &#123;\n                mn = j;\n                break;\n            &#125;\n        int s = i ^ (1 &lt;&lt; mn);\n        (g[i] += mod - g[1 &lt;&lt; mn] * f[s] % mod) %= mod;\n        for (int j = (s - 1) &amp; s; j; j = (j - 1) &amp; s)\n            (g[i] += mod - g[j ^ (1 &lt;&lt; mn)] * f[s ^ j] % mod) %= mod;\n        if (i != siz - 1)\n            (res += g[i] * f[(siz - 1) ^ i]) %= mod;\n        else\n            (res += g[i]) %= mod;\n    &#125;\n    std::cout &lt;&lt; res * qkp(fac[m], mod - 2) % mod &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"d---count-grid-3-coloring\">D - Count Grid 3-coloring</h2>\n<p><a href=\"https://atcoder.jp/contests/abc379/tasks/abc379_g\" class=\"uri\">https://atcoder.jp/contests/abc379/tasks/abc379_g</a></p>\n<p>è½®å»“çº¿ DPã€‚æŠŠæ¯ä¸€åˆ—å·²ç»ç¡®å®šçš„æœ€é ä¸‹çš„å…ƒç´ å‹èµ·æ¥ï¼Œæ¯è¡Œé€ä¸ªç¡®å®šå³å¯ã€‚</p>\n<p>å‘ç°æœ‰æ•ˆçŠ¶æ€ä¸­åªèƒ½å®¹è®¸æœ€å¤šä¸€å¯¹ç›¸é‚»ç›¸åŒå…ƒç´ ï¼Œè¿™æ ·å¤æ‚åº¦å°±èƒ½é™ä¸‹æ¥äº†ã€‚æ³¨æ„ç‰¹åˆ¤ <span class=\"math inline\">\\(1\\times 1\\)</span> çš„æƒ…å†µã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::array&lt;int, 15&gt; p;\n    p[0] = 1;\n    for (int i = 1; i &lt; 15; ++i)\n        p[i] = p[i - 1] * 3;\n    std::vector&lt;std::vector&lt;int&gt; &gt; a;\n    if (n &gt;= m) &#123;\n        a.assign(n + 1, std::vector&lt;int&gt; (m + 1));\n        for (int i = 1; i &lt;= n; ++i) \n            for (int j = 1; j &lt;= m; ++j) &#123;\n                char t;\n                std::cin &gt;&gt; t, a[i][j] = (t == &#39;?&#39; ? -1 : t - &#39;1&#39;);\n            &#125;\n    &#125;\n    else &#123;\n        std::swap(n, m);\n        a.assign(n + 1, std::vector&lt;int&gt; (m + 1));\n        for (int i = 1; i &lt;= m; ++i)\n            for (int j = 1; j &lt;= n; ++j) &#123;\n                char t;\n                std::cin &gt;&gt; t, a[j][i] = (t == &#39;?&#39; ? -1 : t - &#39;1&#39;);\n            &#125;\n    &#125;\n    int siz = p[m];\n    using arr = std::vector&lt;long long&gt;;\n    using brr = std::vector&lt;arr&gt;;\n    using crr = std::vector&lt;brr&gt;;\n    std::vector&lt;int&gt; s, tab(siz, -1);\n    auto getv_1 = [&amp;](int j, int i) &#123;\n        return (j / p[i - 1]) % 3;\n    &#125;;\n    auto getv = [&amp;](int j, int i) &#123;\n        return (s[j] / p[i - 1]) % 3;\n    &#125;;\n    auto chg = [&amp;](int j, int i, int v) &#123;\n        return tab[s[j] - p[i - 1] * getv(j, i) + p[i - 1] * v];\n    &#125;;\n    auto out = [&amp;](int i) &#123;\n        std::string s;\n        for (int j = 1; j &lt;= m; ++j)\n            s += &#39;1&#39; + getv_1(i, j);\n        return s.c_str();\n    &#125;;\n    for (int i = 0; i &lt; siz; ++i) &#123;\n        s.push_back(i);\n        int cnt = 0;\n        for (int j = 2; j &lt;= m; ++j)\n            if (getv_1(i, j - 1) == getv_1(i, j) &amp;&amp; ++cnt &gt;= 2) &#123;\n                s.pop_back();\n                break;\n            &#125;\n    &#125;\n    for (int i = 0; i &lt; (int)s.size(); ++i)\n        tab[s[i]] = i;\n    siz = (int)s.size();\n    if (n == 1) &#123;\n        std::cout &lt;&lt; (a[1][1] == -1 ? 3 : 1) &lt;&lt; &#39;\\n&#39;;\n        return 0;\n    &#125;\n    crr f(n + 1, brr(m + 1, arr(siz)));\n    for (int i = 0; i &lt; siz; ++i)\n        if ([&amp;](int i, int s) &#123;\n            for (int j = 1; j &lt;= m; ++j) &#123;\n                if (a[i][j] != -1 &amp;&amp; a[i][j] != getv(s, j))\n                    return false;\n                if (j != 1 &amp;&amp; getv(s, j) == getv(s, j - 1))\n                    return false;\n            &#125;\n            return true;\n        &#125; (1, i)) &#123;\n            for (int p = 0; p &lt; 3; ++p)\n                if ((a[2][1] == -1 || a[2][1] == p) &amp;&amp; getv(i, 1) != p &amp;&amp; ~chg(i, 1, p))\n                    (++f[2][1][chg(i, 1, p)]) %= mod;\n        &#125;\n    for (int i = 2; i &lt;= n; ++i) &#123;\n        for (int k = 1; k &lt; m; ++k)\n            for (int j = 0; j &lt; siz; ++j)\n                if (f[i][k][j]) &#123;\n                    // printf(&quot;f[%d][%d][%s] = %lld\\n&quot;, i, k, out(s[j]), f[i][k][j]);\n                    for (int p = 0; p &lt; 3; ++p)\n                        if ((a[i][k + 1] == -1 || a[i][k + 1] == p) &amp;&amp; getv(j, k) != p &amp;&amp; getv(j, k + 1) != p &amp;&amp; ~chg(j, k + 1, p))\n                            (f[i][k + 1][chg(j, k + 1, p)] += f[i][k][j]) %= mod;\n                &#125;\n        for (int j = 0; j &lt; siz; ++j)\n            if (i != n &amp;&amp; f[i][m][j])\n                for (int p = 0; p &lt; 3; ++p)\n                    if ((a[i + 1][1] == -1 || a[i + 1][1] == p) &amp;&amp; getv(j, 1) != p &amp;&amp; ~chg(j, 1, p))\n                        (f[i + 1][1][chg(j, 1, p)] += f[i][m][j]) %= mod;\n    &#125;\n    auto res = 0ll;\n    for (int i = 0; i &lt; siz; ++i)\n        (res += f[n][m][i]) %= mod;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"e---pure-straight\">E - Pure Straight</h2>\n<p><a href=\"https://atcoder.jp/contests/arc126/tasks/arc126_d\" class=\"uri\">https://atcoder.jp/contests/arc126/tasks/arc126_d</a></p>\n<p>æ‰‹ç©å‘ç°åªè¦æœ€ç»ˆåºåˆ—ç¡®å®šï¼Œé‚£ä¹ˆç§»åŠ¨çš„é¡ºåºä¸å½±å“ç­”æ¡ˆã€‚æ•…è€ƒè™‘ç¡®å®šç›®æ ‡ä½ç½®å’Œç§»åŠ¨åºåˆ—ã€‚è€ƒè™‘ç»å¯¹å€¼çš„å‡ ä½•æ„ä¹‰ï¼Œä¸å¦¨ä»¤ç›®æ ‡å­åºåˆ—ä¸­å…ƒç´ é›†ä¸­åˆ°è¢«é€‰ä¸­ä½ç½®çš„ä¸­é—´å…ƒç´ ï¼Œæ­¤æ—¶çš„ä»£ä»·å¯ä»¥è®¡ç®—ã€‚ç”¨ç‚¹äºŒè¿›åˆ¶æŠ€å·§å’Œåº“å‡½æ•°å¯ä»¥ <span class=\"math inline\">\\(O(1)\\)</span> ç®—ä»£ä»·ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    int siz = 1 &lt;&lt; k;\n    std::vector&lt;int&gt; a(n + 1), f(siz, 0x3f3f3f3f);\n    auto out = [&amp;](int j) &#123;\n        std::string s;\n        for (int i = 0; i &lt; k; ++i)\n            s += (&#39;0&#39; + ((j &gt;&gt; i) &amp; 1));\n        return s.c_str();\n    &#125;;\n    f[0] = 0;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i], --a[i];\n        for (int j = siz - 1; j &gt;= 0; --j) &#123;\n            if (!((j &gt;&gt; a[i]) &amp; 1))\n                f[j | (1 &lt;&lt; a[i])] = std::min(f[j | (1 &lt;&lt; a[i])], f[j] + __builtin_popcount(j &amp; (~((1 &lt;&lt; a[i]) - 1))));\n            f[j] += std::min(__builtin_popcount(j), k - __builtin_popcount(j));\n        &#125;\n    &#125;\n    std::cout &lt;&lt; f[siz - 1] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"f---123-set\">F - 123 Set</h2>\n<p><a href=\"https://atcoder.jp/contests/arc184/tasks/arc184_b\" class=\"uri\">https://atcoder.jp/contests/arc184/tasks/arc184_b</a></p>\n<p>åšè¿‡ <a href=\"https://www.luogu.com.cn/problem/P3226\">é›†åˆé€‰æ•°</a>ï¼ˆè¿™ä¸ª trick è§è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œåº”è¯¥ä¸åªè¿™ä¸€é“ï¼Œä½†æˆ‘æƒ³ä¸èµ·æ¥äº†ï¼‰å¾ˆå®¹æ˜“æƒ³åˆ°ç”»ä¸€ä¸ªè¡¨æ ¼æˆ–è€… DAG å‡ºæ¥ï¼Œå…¶å®éƒ½èƒ½åš</p>\n<p>å¯¹äºè¡¨æ ¼å·¦ä¸Šè§’å’Œ DAG çš„æºç‚¹ï¼Œè‚¯å®šæ˜¯ä¸€ä¸ª <span class=\"math inline\">\\(x\\)</span>ï¼Œå…¶ä¸æ˜¯ <span class=\"math inline\">\\(2\\)</span> æˆ– <span class=\"math inline\">\\(3\\)</span> çš„å€æ•°ã€‚å¦‚æœç”»è¡¨ï¼Œæ¨ªä¹˜ 3 ç«–ä¹˜ 2ï¼Œè§‚å¯Ÿä¸€ä¸‹æ˜¯åŒ…å«äº† <span class=\"math inline\">\\(1\\sim n\\)</span> æ°å¥½ä¸€æ¬¡çš„å¾ˆå¤šä¸ªæ¨è¡¨ï¼ˆæ²¡ä»€ä¹ˆç”¨ï¼Œæä¸€å˜´è€Œå·²ï¼‰ï¼Œè€ƒè™‘è½¬åŒ–ç›®æ ‡ï¼Œå‘ç°æ˜¯ç”¨ä¸€ä¸ªä¸å¯æ—‹è½¬çš„å€’ L å½¢éª¨ç‰Œå¯å æ”¾åœ°é“ºæ»¡å¼‚å½¢è¡¨æ ¼ï¼Œå¯ä»¥è€ƒè™‘è½®å»“çº¿ DP</p>\n<p>å…·ä½“åœ°ï¼Œç”¨ 1 æ¥è¡¨ç¤ºæ‹è§’å¤„ï¼Œ0 è¡¨ç¤ºå…¶ä»–ï¼Œå æ”¾çš„æ—¶å€™ 1 çš„ä¼˜å…ˆçº§æ¯” 0 é«˜ï¼Œç„¶åå°±å¯ä»¥åšäº†ã€‚ä»¥ 3 ä¸ºè¡Œï¼Œæ‚²è§‚ä¼°è®¡å•ä¸ªè¡¨æ ¼å¤§æ¦‚æœ‰ <span class=\"math inline\">\\(31\\times 2^{19}\\)</span> ä¸ªçŠ¶æ€ï¼Œè¿ç®—æ¬¡æ•°å·®ä¸å¤š <span class=\"math inline\">\\(31\\times 19\\times 2^{19}\\)</span>ï¼›å†å‘ç°é•¿å¾—ä¸€æ¨¡ä¸€æ ·çš„è¡¨æ ¼è‚¯å®šæ–¹æ¡ˆæ•°æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæŠŠä»»æ„ä¸€ä¸ªè¡¨æ ¼å…¨éƒ¨é™¤ä»¥ <span class=\"math inline\">\\(x\\)</span>ï¼Œå°±ä¼šå¾—åˆ° <span class=\"math inline\">\\(n=10^9\\div x\\)</span> æ—¶ <span class=\"math inline\">\\(1\\)</span> ä¸ºå·¦ä¸Šè§’çš„æ¨è¡¨ï¼Œå°±æ˜¯è¯´é•¿ç›¸åªå’Œ <span class=\"math inline\">\\(10^9\\div x\\)</span> çš„å€¼æœ‰å…³ï¼Œå¯ä»¥æ•´é™¤åˆ†å— ğŸ˜± å¯é¢„è®¡çš„è·‘å¾—éå¸¸ä¸æ»¡ï¼Œå®è·µä¸‹æ¥æ˜¯å¯ä»¥è¿‡çš„ï¼ˆä½†æ˜¯å¾ˆæ…¢ï¼‰</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    auto calc = [&amp;](int r) &#123;\n        return r - r / 2 - r / 3 + r / 6;\n    &#125;;\n    auto dp = [&amp;](int lim) &#123;\n        if (lim == 1) &#123;\n            // printf(&quot;lim = 1, ret 1&quot;);\n            return 1;\n        &#125;\n        int n = 1, m = 1;\n        for (int k = 1; k * 2 &lt;= lim; ++n, k *= 2);\n        for (int k = 1; k * 3 &lt;= lim; ++m, k *= 3);\n        int siz = 1 &lt;&lt; m;\n        std::vector&lt;std::vector&lt;std::vector&lt;int&gt; &gt; &gt; f(2, std::vector&lt;std::vector&lt;int&gt; &gt; (2, std::vector&lt;int&gt; (siz))), p(n + 1, std::vector&lt;std::vector&lt;int&gt; &gt; (m));\n        std::vector&lt;std::vector&lt;std::vector&lt;std::pair&lt;int, int&gt; &gt; &gt; &gt; t(2, std::vector&lt;std::vector&lt;std::pair&lt;int, int&gt; &gt; &gt; (2, std::vector&lt;std::pair&lt;int, int&gt; &gt; (siz))); // sb\n        auto upd = [&amp;](int i, int k, int j, int v) &#123;\n            if (t[i &amp; 1][k &amp; 1][j] != std::make_pair(i, k)) &#123;\n                p[i][k].push_back(j);\n                t[i &amp; 1][k &amp; 1][j] = &#123; i, k &#125;, f[i &amp; 1][k &amp; 1][j] = v;\n            &#125;\n            else\n                f[i &amp; 1][k &amp; 1][j] = std::min(f[i &amp; 1][k &amp; 1][j], v);\n            return;\n        &#125;;\n        auto chg = [&amp;](int i, int j, int v) &#123;\n            return i ^ (((i &gt;&gt; j) &amp; 1) &lt;&lt; j) ^ (v &lt;&lt; j);\n        &#125;;\n        for (int i = 0; i &lt; siz; ++i) &#123;\n            bool flag = 0;\n            for (int j = 0; j &lt; m; ++j)\n                if (((i &gt;&gt; j) &amp; 1) || (j &amp;&amp; ((i &gt;&gt; (j - 1)) &amp; 1)));\n                else &#123;\n                    flag = 1;\n                    break;\n                &#125;\n            if (!flag)\n                upd(1, m - 1, i, __builtin_popcount(i));\n        &#125;\n        for (int i = 2; i &lt;= n; i++) &#123;\n            int m1 = 1;\n            for (int x = (1 &lt;&lt; (i - 1)); x * 3ll &lt;= lim; ++m1, x *= 3);\n            int siz1 = 1 &lt;&lt; m1;\n            for (auto j : p[i - 1][m - 1]) &#123;\n                if (j &amp; 1)\n                    upd(i, 0, chg(j &amp; (siz1 - 1), 0, 0), f[(i - 1) &amp; 1][(m - 1) &amp; 1][j]);\n                upd(i, 0, chg(j &amp; (siz1 - 1), 0, 1), f[(i - 1) &amp; 1][(m - 1) &amp; 1][j] + 1);\n            &#125;\n            m = m1, siz = siz1;\n            for (int k = 0; k &lt; m - 1; ++k)\n                for (auto j : p[i][k]) &#123;\n                    if (((j &gt;&gt; k) &amp; 1) || ((j &gt;&gt; (k + 1)) &amp; 1))\n                        upd(i, k + 1, chg(j, k + 1, 0), f[i &amp; 1][k &amp; 1][j]);\n                    upd(i, k + 1, chg(j, k + 1, 1), f[i &amp; 1][k &amp; 1][j] + 1);\n                &#125;\n        &#125;\n        int res = 0x3f3f3f3f;\n        for (auto i : p[n][m - 1])\n            res = std::min(res, f[n &amp; 1][(m - 1) &amp; 1][i]);\n        return res;\n    &#125;;\n    int res = 0;\n    for (int l = 1, r; l &lt;= n; l = r + 1) &#123;\n        r = n / (n / l);\n        if (calc(r) - calc(l - 1))\n            res += (calc(r) - calc(l - 1)) * dp(n / l);\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n",
            "tags": [
                "DP",
                "çŠ¶å‹"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250803/",
            "url": "https://xsc062.netlify.app/20250803/",
            "title": "æ‚é¢˜é€‰è°ˆï¼šæ ‘ DP",
            "date_published": "2025-08-03T03:44:54.000Z",
            "content_html": "<p>æ ‘ä¸Šçš„ DP ä»¥åŠ å’Œæ ‘æœ‰å…³çš„ DP</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"a---svjetlo\">A - Svjetlo</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P7163\" class=\"uri\">https://www.luogu.com.cn/problem/P7163</a></p>\n<p>å¾ˆå®¹æ˜“æƒ³åˆ°ä¸€ç§çŠ¶æ€è®¾è®¡ï¼Œå³ä»¤ <span class=\"math inline\">\\(f_{x,0/1/2}\\)</span> åˆ†åˆ«è¡¨ç¤ºæœ‰ <span class=\"math inline\">\\(0/1/2\\)</span> ä¸ªç«¯ç‚¹åœ¨å­æ ‘å†…éƒ¨çš„æƒ…å†µï¼›ç„¶åå°±å¼€å§‹æ€è€ƒï¼Œå¦‚ä½•æ»¡è¶³å¯¹äºå¼€å…³çŠ¶æ€çš„è¦æ±‚ï¼Ÿ</p>\n<p>è¿˜æ˜¯æƒ³å°‘äº†ã€‚å¦‚æœå†åŠ ä¸€ç»´ï¼Œä»ã€çŠ¶æ€ä¸ºå¼€æˆ–å…³ã€æ€è€ƒå°±ä¼šè½»æ¾å¾ˆå¤šï¼Œä»¤ <span class=\"math inline\">\\(f_{x,0/1/2,0/1}\\)</span> è¡¨ç¤ºæœ‰ <span class=\"math inline\">\\(0/1/2\\)</span> ä¸ªç«¯ç‚¹å†å­æ ‘å¤–éƒ¨ï¼Œä¸”å­æ ‘å†…æ“ä½œå®Œå <span class=\"math inline\">\\(x\\)</span> ä¸ºå…³ / å¼€çš„æœ€å°‘æ­¥æ•°ã€‚ç„¶ååˆ†ç±»è®¨è®ºè½¬ç§»æ–¹å¼å³å¯ã€‚</p>\n<p>ä¸€ä¸ªæ¯”è¾ƒæ–¹ä¾¿çš„è®¨è®ºæ–¹å¼æ˜¯ï¼Œå…ˆç¡®å®šæŸç§æƒ…å†µä¸‹ï¼Œè®¿é—® <span class=\"math inline\">\\(u\\)</span> ä¸ <span class=\"math inline\">\\(v\\)</span> çš„æ¬¡æ•°ï¼Œç„¶åå°±å¯ä»¥å¾—åˆ°å®ƒä»¬åŸæœ¬çš„çŠ¶æ€ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, rt = -1;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; a(n + 1);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        char t;\n        std::cin &gt;&gt; t;\n        a[i] = t - &#39;0&#39;;\n        if (!a[i])\n            rt = i;\n    &#125;\n    if (rt == -1) &#123;\n        std::cout &lt;&lt; 0 &lt;&lt; &#39;\\n&#39;;\n        return 0;\n    &#125;\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1);\n    for (int i = 1, x, y; i &lt; n; ++i) &#123;\n        std::cin &gt;&gt; x &gt;&gt; y;\n        g[x].push_back(y), g[y].push_back(x);\n    &#125;\n    std::vector&lt;int&gt; tag(n + 1);\n    std::function&lt;void(int, int)&gt; DFS = [&amp;](int x, int fa) &#123;\n        tag[x] = a[x];\n        for (auto i : g[x])\n            if (i != fa)\n                DFS(i, x), tag[x] &amp;= tag[i];\n        return;\n    &#125;;\n    DFS(rt, -1);\n    std::vector&lt;std::vector&lt;std::vector&lt;int&gt; &gt; &gt; f(n + 1, std::vector&lt;std::vector&lt;int&gt; &gt; (3, std::vector&lt;int&gt; (2, 0x3f3f3f3f)));\n    DFS = [&amp;](int x, int fa) &#123;\n        f[x][0][a[x]] = 0;\n        for (auto i : g[x])\n            if (i != fa &amp;&amp; !tag[i]) &#123;\n                DFS(i, x);\n                auto g = f[x];\n                f[x][0][0] = std::min(g[0][0] + f[i][0][1] + 4, g[0][1] + f[i][0][0] + 2);\n                f[x][0][1] = std::min(g[0][1] + f[i][0][1] + 4, g[0][0] + f[i][0][0] + 2);\n                f[x][1][0] = std::min(&#123; g[1][0] + f[i][0][1] + 4, g[1][1] + f[i][0][0] + 2, g[0][0] + f[i][1][0] + 3, g[0][1] + f[i][1][1] + 1 &#125;);\n                f[x][1][1] = std::min(&#123; g[1][1] + f[i][0][1] + 4, g[1][0] + f[i][0][0] + 2, g[0][1] + f[i][1][0] + 3, g[0][0] + f[i][1][1] + 1 &#125;);\n                f[x][2][0] = std::min(&#123; g[2][0] + f[i][0][1] + 4, g[2][1] + f[i][0][0] + 2, g[1][0] + f[i][1][1], g[1][1] + f[i][1][0] + 2, g[0][0] + f[i][2][1] + 4, g[0][1] + f[i][2][0] + 2 &#125;);\n                f[x][2][1] = std::min(&#123; g[2][1] + f[i][0][1] + 4, g[2][0] + f[i][0][0] + 2, g[1][1] + f[i][1][1], g[1][0] + f[i][1][0] + 2, g[0][1] + f[i][2][1] + 4, g[0][0] + f[i][2][0] + 2 &#125;);\n            &#125;\n        f[x][1][0] = std::min(f[x][1][0], f[x][0][1] + 1);\n        f[x][1][1] = std::min(f[x][1][1], f[x][0][0] + 1);\n        f[x][2][0] = std::min(f[x][2][0], f[x][1][0]);\n        f[x][2][1] = std::min(f[x][2][1], f[x][1][1]);\n        // for (int i = 0; i &lt; 3; ++i)\n        //     for (int j = 0; j &lt; 2; ++j)\n        //         printf(&quot;f[%d][%d][%d] = %d\\n&quot;, x, i, j, f[x][i][j]);\n        return;\n    &#125;;\n    DFS(rt, -1);\n    std::cout &lt;&lt; f[rt][2][1] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b---one-to-one\">B - One to One</h2>\n<p><a href=\"https://atcoder.jp/contests/arc140/tasks/arc140_d\" class=\"uri\">https://atcoder.jp/contests/arc140/tasks/arc140_d</a></p>\n<p>è§‚å¯ŸåŸå›¾ä¸Šè¿é€šå—ï¼Œå‘ç°è¦ä¹ˆæ˜¯æ²¡æœ‰æœªç¡®å®šè¾¹çš„åŸºç¯æ ‘ï¼Œè¦ä¹ˆæ˜¯æœ‰æ°å¥½ä¸€æ¡æœªç¡®å®šè¾¹çš„æ ‘ã€‚ç¼©ç‚¹ï¼Œä»»æ„ä¸ºæœªç¡®å®šè¾¹èµ‹å€¼ï¼Œè€ƒå¯Ÿæœ€åå¾—åˆ°çš„è¿é€šå—ï¼Œå‘ç°è¦ä¹ˆæ˜¯ä»¥ã€åŸºç¯æ ‘ç‚¹ã€ä¸ºæ ¹çš„æ ‘ï¼Œè¦ä¹ˆæ˜¯ä¸åŒ…å«ã€åŸºç¯æ ‘ç‚¹ã€çš„ï¼ˆå†…å‘ï¼‰åŸºç¯æ ‘ã€‚</p>\n<p>è¿™é‡Œè¦ç”¨åˆ°è´¡çŒ®çš„æ€æƒ³ã€‚è€ƒè™‘å°†å…¨å±€åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªéƒ¨åˆ†ï¼Œä¿è¯æ¯éƒ¨åˆ†çš„å•æ­¥ä»·å€¼æ˜¯å¯ç¡®å®šçš„ã€‚å°†ç¬¬ä¸€æ­¥ï¼Œå³å¯¹æ ‘å’ŒåŸºç¯æ ‘çš„è®¨è®ºæ‹†å¼€ï¼Œå¯¹äºæ ‘ï¼Œå…¶æ•°é‡ç¡®å®šï¼›å¯¹äºåŸºç¯æ ‘ï¼Œå‘ç°ç¯çš„æ•°é‡å³ä¸ºåŸºç¯æ ‘çš„æ•°é‡ï¼Œè¿›ä¸€æ­¥å°†æ‰€æœ‰æ­¥ä¸­çš„ã€ç¯ã€è¿™ä¸€ç±»åˆ†å¼€ï¼Œç»Ÿè®¡æˆç¯çš„æ–¹æ¡ˆæ•°å°±å¯ä»¥å¾—åˆ°åŸºç¯æ ‘çš„è´¡çŒ®ã€‚å…·ä½“åœ°ï¼Œä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> ä¸ºåœ¨å‰ <span class=\"math inline\">\\(i\\)</span> ä¸ªç‚¹ä¸­é€‰æ‹© <span class=\"math inline\">\\(j\\)</span> ä¸ªæˆä¸€ä¸ªç¯çš„æ–¹æ¡ˆæ•°ï¼Œåˆ™æœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\nf_{i,j}=f_{i-1,j}+f_{i-1,j-1}\\times siz_i\n\\]</span></p>\n<p>æœ€åè®¡ç®—æ¯ä¸ªç¯çš„è´¡çŒ®å³å¯ã€‚æ³¨æ„è¿˜è¦ç®—ä¸Šç¯å†…éƒ¨çš„æ’åˆ—ï¼ˆæ³¨æ„å¾ªç¯ä½ç§»ï¼‰ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; a(n + 1), tag(n + 1), s(n + 1, 1), fa(n + 1), siz(n + 1);\n    std::iota(fa.begin() + 1, fa.end(), 1);\n    std::function&lt;int(int)&gt; find = [&amp;](int x) &#123;\n        return x == fa[x] ? x : fa[x] = find(fa[x]);\n    &#125;;\n    auto merge = [&amp;](int x, int y) &#123;\n        x = find(x), y = find(y);\n        if (x != y) &#123;\n            tag[y] += tag[x];\n            s[y] += s[x];\n            fa[x] = y;\n        &#125;\n        return;\n    &#125;;\n    for (int i = 1; i &lt;= n; ++i)  &#123;\n        std::cin &gt;&gt; a[i], fa[i] = i;\n        if (a[i] == -1)\n            tag[i] = 1;\n        else\n            merge(i, a[i]);\n    &#125;\n    int cnt1 = 0, cnt2 = 0;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        cnt1 += (fa[i] == i &amp;&amp; !tag[i]);\n        if (fa[i] == i &amp;&amp; tag[i])\n            siz[++cnt2] = s[i];\n    &#125;\n    auto qkp = [&amp;](long long x, int y) &#123;\n        auto res(1ll);\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    auto res(cnt1 * qkp(n, cnt2) % mod);\n    std::vector&lt;std::vector&lt;long long&gt; &gt; f(cnt2 + 1, std::vector&lt;long long&gt; (cnt2 + 1));\n    f[0][0] = 1ll;\n    for (int i = 1; i &lt;= cnt2; ++i) &#123;\n        // printf(&quot;i = %d, siz = %d: \\n&quot;, i, siz[i]);\n        for (int j = 0; j &lt;= i; ++j) &#123;\n            f[i][j] = f[i - 1][j];\n            if (j != 0)\n                (f[i][j] += f[i - 1][j - 1] * siz[i]) %= mod;\n            // printf(&quot;  f[%d][%d] = %lld\\n&quot;, i, j, f[i][j]);\n        &#125;\n    &#125;\n    for (int i = 1; i &lt;= cnt2; ++i) &#123;\n        static auto fac(1ll);\n        (res += f[cnt2][i] * fac % mod * qkp(n, cnt2 - i) % mod) %= mod;\n        (fac *= i) %= mod;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"c---diameter-cuts\">C - Diameter Cuts</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1499/F\" class=\"uri\">https://codeforces.com/problemset/problem/1499/F</a></p>\n<p>ä»¤ <span class=\"math inline\">\\(f_{x,i}\\)</span> è¡¨ç¤º <span class=\"math inline\">\\(x\\)</span> ä¸Šçš„æœ€é•¿é“¾é•¿ä¸º <span class=\"math inline\">\\(i\\)</span> çš„æ–¹æ¡ˆæ•°ï¼Œå°±å¯ä»¥ç”¨ä¸€ä¸ªç±»ä¼¼èƒŒåŒ…çš„è¿‡ç¨‹æ±‚ç­”æ¡ˆäº†ã€‚å‘ç°è¿™ä¸ªèƒŒåŒ…æ»¡è¶³å¯ä»¥è¢«ä¼˜åŒ–çš„å½¢å¼ï¼Œæ•…èƒ½åœ¨ <span class=\"math inline\">\\(O(nk)\\)</span> å†…è§£å†³é—®é¢˜ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k, ++k;\n    if (k == 0) &#123;\n        std::cout &lt;&lt; 1 &lt;&lt; &#39;\\n&#39;;\n        return 0;\n    &#125;\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1);\n    for (int i = 1, x, y; i &lt; n; ++i) &#123;\n        std::cin &gt;&gt; x &gt;&gt; y;\n        g[x].push_back(y), g[y].push_back(x);\n    &#125;\n    std::vector&lt;int&gt; h(n + 1);\n    std::vector&lt;std::vector&lt;long long&gt; &gt; f(n + 1, std::vector&lt;long long&gt; (k + 1));\n    std::function&lt;void(int, int)&gt; DFS = [&amp;](int x, int fa) &#123;\n        f[x][1] = 1ll, h[x] = 1;\n        for (auto i : g[x])\n            if (i != fa) &#123;\n                DFS(i, x);\n                std::vector&lt;long long&gt; g(k + 1);\n                g.swap(f[x]);\n                for (int j = std::min(h[x], k); j; --j)\n                    for (int l = std::min(h[i], k - j); ~l; --l)\n                        (f[x][std::max(j, l + 1)] += g[j] * f[i][l] % mod) %= mod;\n                h[x] = std::max(h[x], h[i] + 1);\n            &#125;\n        for (int i = 1; i &lt;= h[x] &amp;&amp; i &lt;= k; ++i)\n            (f[x][0] += f[x][i]) %= mod;\n        // for (int i = 0; i &lt;= h[x] &amp;&amp; i &lt;= k; ++i)\n        //     printf(&quot;f[%d][%d] = %lld\\n&quot;, x, i, f[x][i]);\n        return;\n    &#125;;\n    DFS(1, -1);\n    auto res(0ll);\n    for (int i = 1; i &lt;= k; ++i)\n        (res += f[1][i]) %= mod;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"d---leaf-partition\">D - Leaf Partition</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1146/F\" class=\"uri\">https://codeforces.com/problemset/problem/1146/F</a></p>\n<p>å‡è®¾å·²ç»å®Œæˆåˆ†ç»„ï¼Œæ¬²åˆ¤å®šè¿™ç§æ–¹å¼æ˜¯å¦åˆæ³•ï¼Œå®¹æ˜“æƒ³åˆ°å¯¹æ¯ä¸€ç»„å¶å­å»ºç«‹è™šæ ‘ï¼Œåˆ™è¯¥åˆ†ç»„æ–¹å¼åˆæ³•ï¼Œå½“ä¸”ä»…å½“æ²¡æœ‰ä¸€ä¸ªç‚¹è¢«å¤šä¸ªè™šæ ‘å ç”¨ã€‚ä¹Ÿå³ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ€»çš„è™šæ ‘ä¸Šé€‰å‡ºä¸€äº›ç‚¹ï¼Œè®©å®ƒä»¬å¯ä»¥è¦†ç›–æ‰€æœ‰å¶å­ã€‚</p>\n<p>è™šæ ‘ä¸Š DPï¼Œå®¹æ˜“å‘ç°å½“ä¸”ä»…å½“å­˜åœ¨ <span class=\"math inline\">\\(\\ge 2\\)</span> ä¸ªå„¿å­æƒ³è¦åˆ†è¿›åŒä¸€ä¸ªè™šæ ‘æ—¶ï¼Œ<span class=\"math inline\">\\(i\\)</span> ä¼šè¢«é€‰åˆ°ã€‚æ•…ä»¤ <span class=\"math inline\">\\(f_{i, 0/1/2}\\)</span> è¡¨ç¤ºå½“å‰æœ‰ <span class=\"math inline\">\\(0/1/\\ge 2\\)</span> ä¸ªå„¿å­æƒ³è¦é€‰æ‹© <span class=\"math inline\">\\(i\\)</span> æ—¶çš„æ–¹æ¡ˆæ•°ï¼ŒDP å³å¯ã€‚</p>\n<p>åœ¨å®ç°çš„è¿‡ç¨‹ä¸­å°±ä¼šå‘ç°æ ¹æœ¬ä¸éœ€è¦æ±‚è™šæ ‘ï¼ŒåŸæ ‘ä¸Š DP å°±å¯ä»¥äº†ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; fa(n + 1);\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1);\n    for (int i = 2; i &lt;= n; ++i)\n        std::cin &gt;&gt; fa[i], g[fa[i]].push_back(i);\n    std::vector&lt;std::array&lt;long long, 3&gt; &gt; f(n + 1);\n    std::function&lt;void(int)&gt; DFS = [&amp;](int x) &#123;\n        if (g[x].empty())\n            f[x][2] = 1ll;\n        else\n            f[x][0] = 1ll;\n        for (auto i : g[x]) &#123;\n            DFS(i);\n            auto F0 = (f[i][0] + f[i][2]) % mod, F1 = (f[i][1] + f[i][2]) % mod;\n            f[x][2] = (f[x][2] * F0 % mod + f[x][2] * F1 % mod + f[x][1] * F1 % mod) % mod;\n            f[x][1] = (f[x][1] * F0 % mod + f[x][0] * F1 % mod) % mod;\n            (f[x][0] *= F0) %= mod;\n        &#125;\n        // printf(&quot;%d: %lld / %lld / %lld\\n&quot;, x, f[x][0], f[x][1], f[x][2]);\n        return;\n    &#125;;\n    DFS(1);\n    std::cout &lt;&lt; (f[1][0] + f[1][2]) % mod &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"e---uniformly-branched-trees\">E - Uniformly Branched Trees</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/724/F\" class=\"uri\">https://codeforces.com/problemset/problem/724/F</a></p>\n<p>æ„Ÿè§‰æ˜¯å¾ˆå¸¸è§çš„å¥—è·¯ï¼Œä½†æ˜¯æˆ‘ä¸ä¼š ğŸ˜±</p>\n<p>åœ¨æ‰‹ç©æ ·ä¾‹çš„æ—¶å€™å¯ä»¥æ„Ÿæ€§è®¤çŸ¥åˆ°ï¼Œæ¯ä¸ªæ ‘ä¼šè¢«æ¯ç§ç‚¹ä½œä¸ºæ ¹çš„æƒ…å†µç»Ÿè®¡ä¸€æ¬¡ã€‚ä¸”å¦‚æœå›ºå®šä»¥æŸç§ï¼ˆåŒ–å­¦ç¯å¢ƒï¼‰çš„ç‚¹ä¸ºæ ¹ï¼Œå¯ä»¥é€šè¿‡æŒ‰ siz ä»å°åˆ°å¤§æ’åˆ—å”¯ä¸€æ±‚è§£å‡ºè¯¥æ ‘ã€‚</p>\n<p>å‘ç°ä»¥é‡å¿ƒä¸ºæ ¹ï¼ˆå³é’¦å®šæ ¹ä¸ºé‡å¿ƒï¼‰å¯ä»¥å¸¦æ¥å¾ˆå¤šä¼˜ç¾çš„æ€§è´¨ã€‚å› ä¸º siz æ˜¯å¥½ç¡®å®šçš„ï¼Œä¸”æ˜¯å„¿å­çš„æ’åºä¾æ®ï¼Œæ‰€ä»¥é€‰é‡å¿ƒä¾¿äºç»Ÿè®¡ï¼ŒåŒæ—¶æ»¡è¶³æ¯ç§æ ‘æœ€å¤šè¢«ç»Ÿè®¡ä¸¤æ¬¡ï¼ˆå½“ä¸”ä»…å½“æœ‰ä¸¤ä¸ªé‡å¿ƒï¼‰ã€‚</p>\n<p>å‘ç°è¿™å°±å˜æˆäº†å¤šé‡é›†çš„ç»„åˆæ•°ï¼Œè®¾ <span class=\"math inline\">\\(f_{i,j,k}\\)</span> è¡¨ç¤ºå·²ç»èŠ±è´¹ <span class=\"math inline\">\\(i\\)</span> ä¸ªç‚¹ç»„æˆä¸€ä¸ªå­æ ‘ï¼Œå­æ ‘çš„æ ¹èŠ‚ç‚¹å½“å‰å·²ç»ç¡®è®¤äº† <span class=\"math inline\">\\(j\\)</span> ä¸ªå„¿å­ï¼Œæœ€é å³çš„ä¸€ä¸ª siz <span class=\"math inline\">\\(\\le k\\)</span> çš„æ–¹æ¡ˆæ•°ã€‚å¾—åˆ° <span class=\"math inline\">\\(f_{i,j,k}=\\sum_{x=0} f_{i-x\\cdot k,j-x,k-1}\\cdot \\binom{f_{k,d-1,k}+x-1}{x}\\)</span>ï¼ˆç›¸å½“äºå°† <span class=\"math inline\">\\(x\\)</span> ä¸ªæ— æ ‡å·çš„ä½ç½® / çƒåˆ†é…ç»™ <span class=\"math inline\">\\(f_{k,d-1,k}\\)</span> ä¸ªæœ‰æ ‡å·çš„é€‰é¡¹ / ç›’å­ï¼Œæ’æ¿å³å¯ï¼‰ã€‚</p>\n<p>è‹¥ <span class=\"math inline\">\\(n\\)</span> ä¸ºå¥‡æ•°ï¼Œåˆ™å¯ç›´æ¥è¾“å‡º <span class=\"math inline\">\\(f_{n,d,\\lfloor\\frac n2\\rfloor}\\)</span>ï¼›è‹¥ <span class=\"math inline\">\\(n\\)</span> ä¸ºå¶æ•°ï¼Œåˆ™å¯èƒ½å­˜åœ¨ä¸¤ä¸ªé‡å¿ƒï¼Œå³éœ€è¦ç»Ÿè®¡æ‹¥æœ‰ä¸¤ä¸ªé‡å¿ƒï¼Œä¸”ä»¥ä¸¤ä¸ªé‡å¿ƒåˆ†åˆ«ä¸ºæ ¹æ—¶é•¿ç›¸ä¸åŒçš„æ ‘ç§ç±»ã€‚è¿™ç§æƒ…å†µä¸‹æ˜¾ç„¶å­˜åœ¨ä¸€æ¡è¾¹ï¼Œå·¦å³ä¸¤è¾¹ siz ç›¸åŒä¸”é•¿ç›¸ä¸åŒã€‚æ•…æ•°é‡ä¸º <span class=\"math inline\">\\(\\binom{f_{\\lfloor \\frac n2\\rfloor, d-1,\\lfloor \\frac n2\\rfloor}}{2}\\)</span>ï¼Œå®¹æ–¥æ‰å³å¯ã€‚</p>\n<p>éœ€è¦ç‰¹åˆ¤ <span class=\"math inline\">\\(n\\le2\\)</span> çš„æƒ…å†µã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, d, mod;\n    std::cin &gt;&gt; n &gt;&gt; d &gt;&gt; mod;\n    if (n &lt;= 2) &#123;\n        std::cout &lt;&lt; 1 &lt;&lt; &#39;\\n&#39;;\n        return 0;\n    &#125;\n    using arr = std::vector&lt;long long&gt;;\n    using brr = std::vector&lt;arr&gt;;\n    using crr = std::vector&lt;brr&gt;;\n    auto qkp = [&amp;](long long x, int y) &#123;\n        auto res(1ll);\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    arr inv(d + 1);\n    inv[0] = inv[1] = 1ll;\n    auto fac = 1ll;\n    for (int i = 2; i &lt;= d; ++i) &#123;\n        (fac *= i) %= mod;\n        inv[i] = qkp(fac, mod - 2);\n    &#125;\n    auto C = [&amp;](long long n, int m) &#123;\n        if (m == 0)\n            return 1ll;\n        if (m &gt; n)\n            return 0ll;\n        auto res(1ll);\n        for (auto i = 0; i &lt; m; ++i)\n            (res *= n - i) %= mod;\n        return res * inv[m] % mod;\n    &#125;;\n    crr f(n + 1, brr(d + 1, arr(n / 2 + 1)));\n    f[1][0][0] = 1ll;\n    for (int i = 1; i &lt;= n; ++i)\n        for (int j = 0; j &lt;= d &amp;&amp; 1 + j &lt;= i; ++j) &#123;\n            for (int x = 0; x &lt;= j &amp;&amp; x &lt;= i; ++x)\n                f[i][j][1] += f[i - x][j - x][0];\n            f[i][j][1] %= mod;\n            for (int k = 2; k &lt;= n / 2; ++k) &#123;\n                // bool flag = (i == 10 &amp;&amp; j == 3 &amp;&amp; k == 3);\n                for (int x = 0; x &lt;= j &amp;&amp; x * k &lt;= i; ++x) &#123;\n                    f[i][j][k] += f[i - x * k][j - x][k - 1] * C(f[k][d - 1][k - 1] + x - 1, x);\n                    // if (flag)\n                    //     printf(&quot;x = %d, f[%d][%d][%d](%lld) * C(%lld, %d)(%lld)\\n&quot;, x, i - x * k, j - x, k - 1, f[i - x * k][j - x][k - 1], f[k][d - 1][k - 1] + x - 1, x, C(f[k][d - 1][k - 1] + x - 1, x));\n                &#125;\n                f[i][j][k] %= mod;\n            &#125;\n        &#125;\n    // for (int i = 1; i &lt;= n; ++i)\n    //     for (int j = 0; j &lt;= d &amp;&amp; j &lt;= i - 1; ++j, puts(&quot;&quot;))\n    //         for (int k = 0; k &lt;= n / 2; ++k) &#123;\n    //             printf(&quot;f[%d][%d][%d] = %lld\\n&quot;, i, j, k, f[i][j][k]);\n    //         &#125;\n    if (n &amp; 1)\n        std::cout &lt;&lt; f[n][d][n / 2] &lt;&lt; &#39;\\n&#39;;\n    else &#123;\n        auto res(f[n][d][n / 2]);\n        res = (res + mod - C(f[n / 2][d - 1][n / 2 - 1], 2)) % mod;\n        std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"a---dominant-indices\">A - Dominant Indices</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1009/F\" class=\"uri\">https://codeforces.com/problemset/problem/1009/F</a></p>\n<p>é•¿å‰–æ¿å­ï¼›éš¾ç‚¹åœ¨äºå¯èƒ½è¦å¤ä¹ ä¸€ä¸‹é•¿å‰–æ€ä¹ˆå†™ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1);\n    for (int i = 1, x, y; i &lt; n; ++i) &#123;\n        std::cin &gt;&gt; x &gt;&gt; y;\n        g[x].push_back(y), g[y].push_back(x);\n    &#125;\n    std::vector&lt;int&gt; h(n + 1), son(n + 1);\n    std::function&lt;void(int, int)&gt; DFS = [&amp;](int x, int fa) &#123;\n        h[x] = 1;\n        for (auto i : g[x])\n            if (i != fa) &#123;\n                DFS(i, x);\n                h[x] = std::max(h[x], h[i] + 1);\n                if (h[i] &gt; h[son[x]])\n                    son[x] = i;\n            &#125;\n        return;\n    &#125;;\n    DFS(1, -1);\n    std::vector&lt;int&gt; _f(2 * n + 1), res(n + 1);\n    auto pos(_f.begin());\n    std::vector&lt;decltype(pos)&gt; f(n + 1);\n    DFS = [&amp;](int x, int fa) &#123;\n        ++f[x][0];\n        if (!son[x]) &#123;\n            res[x] = 0;\n            return;\n        &#125;\n        f[son[x]] = std::next(f[x]);\n        DFS(son[x], x);\n        int mx = -std::max(std::make_pair(f[x][res[son[x]] + 1], -(res[son[x]] + 1)), std::make_pair(1, 0)).second;\n        for (auto i : g[x])\n            if (i != fa &amp;&amp; i != son[x]) &#123;\n                f[i] = pos, pos = std::next(pos, h[i] + 1);\n                DFS(i, x);\n                for (int j = 0; j &lt;= h[i]; ++j) &#123;\n                    f[x][j + 1] += f[i][j];\n                    if (j + 1 != mx &amp;&amp; std::make_pair(f[x][j + 1], -(j + 1)) &gt; std::make_pair(f[x][mx], -mx))\n                        mx = j + 1;\n                &#125;\n            &#125;\n        // printf(&quot;%d: &quot;, x);\n        // for (int i = 0; i &lt;= h[x]; ++i)\n        //     printf(&quot;%d &quot;, f[x][i]);\n        // puts(&quot;&quot;);\n        res[x] = mx;\n        return;\n    &#125;;\n    f[1] = pos, pos = std::next(pos, h[1]);\n    DFS(1, -1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cout &lt;&lt; res[i] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b---æ ‘ä¸Šå¼‚æˆ–\">B - æ ‘ä¸Šå¼‚æˆ–</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P9745\" class=\"uri\">https://www.luogu.com.cn/problem/P9745</a></p>\n<p>å’Œ <a href=\"#a---svjetlo\">Svjetlo</a> å¾ˆåƒï¼ŒæŠŠè¿é€šå—çš„å¼‚æˆ–å’Œæ”¾åˆ°çŠ¶æ€é‡Œï¼Œæ‹†ä½åä»¤ <span class=\"math inline\">\\(f_{i,j,0/1}\\)</span> è¡¨ç¤ºç‚¹ <span class=\"math inline\">\\(i\\)</span> æ‰€åœ¨çš„è¿é€šå—åœ¨ç¬¬ <span class=\"math inline\">\\(j\\)</span> ä½å¼‚æˆ–å’Œä¸º <span class=\"math inline\">\\(0/1\\)</span> çš„æƒå€¼ï¼ˆ<strong>ä¸è®¡ <span class=\"math inline\">\\(i\\)</span> æ‰€åœ¨è¿é€šå—</strong>ï¼‰ï¼Œè½¬ç§»å³å¯ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;long long&gt; a(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1);\n    for (int i = 2, x; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; x;\n        g[x].push_back(i), g[i].push_back(x);\n    &#125;\n    std::vector&lt;long long&gt; dp(n + 1);\n    std::vector&lt;std::array&lt;std::array&lt;long long, 2&gt;, 60&gt; &gt; f(n + 1);\n    std::function&lt;void(int, int)&gt; DFS = [&amp;](int x, int fa) &#123;\n        for (int i = 0; i &lt; 60; ++i)\n            f[x][i][(a[x] &gt;&gt; i) &amp; 1] = 1ll;\n        for (auto i : g[x])\n            if (i != fa) &#123;\n                DFS(i, x);\n                for (int j = 0; j &lt; 60; ++j) &#123;\n                    auto f1 = f[x][j];\n                    f[x][j][0] = (f1[0] * dp[i] % mod + f1[0] * f[i][j][0] % mod + f1[1] * f[i][j][1] % mod) % mod;\n                    f[x][j][1] = (f1[1] * dp[i] % mod + f1[0] * f[i][j][1] % mod + f1[1] * f[i][j][0] % mod) % mod;\n                &#125;\n            &#125;\n        for (int i = 0; i &lt; 60; ++i)\n            dp[x] += (1ll &lt;&lt; i) % mod * f[x][i][1] % mod;\n        dp[x] %= mod;\n        return;\n    &#125;;\n    DFS(1, -1);\n    std::cout &lt;&lt; dp[1] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"c---ä¸€ä¸ªç½‘çš„è·¯\">C - ä¸€ä¸ªç½‘çš„è·¯</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P8595\" class=\"uri\">https://www.luogu.com.cn/problem/P8595</a></p>\n<p>é¦–å…ˆéœ€è¦æ„è¯†åˆ°ï¼Œæ ‘å’Œé“¾çš„è¾¹æ•°æ˜¯ä¸€æ ·çš„ï¼Œç‚¸æ‰äº†å¤šå°‘æ¡è¾¹ï¼Œåœ¨ä¹‹åå°±ä¼šèŠ±å¤šå°‘ä»£ä»·è¡¥å›æ¥ã€‚æ•…ç‚¸ä¸€ä¸ªç‚¹çš„ä»£ä»·ä¸ºåº¦æ•° +1ã€‚å¯¹äºä¸€ä¸ªç‚¹ <span class=\"math inline\">\\(u\\)</span>ï¼Œåˆ†ä¸ºå››ç§å¯èƒ½æ€§ï¼š</p>\n<ul>\n<li>è¢«ç‚¸äº†ï¼Œå•ç‹¬ä½œä¸ºä¸€ä¸ªè¿é€šå—ã€‚</li>\n<li>æ²¡è¢«ç‚¸ï¼Œå„¿å­å…¨éƒ¨è¢«ç‚¸äº†ã€‚</li>\n<li>æ²¡è¢«ç‚¸ï¼Œæœ‰ 1 ä¸ªå„¿å­æ²¡è¢«ç‚¸ã€‚</li>\n<li>æ²¡è¢«ç‚¸ï¼Œæœ‰ 2 ä¸ªå„¿å­æ²¡è¢«ç‚¸ã€‚</li>\n</ul>\n<p>åˆ†åˆ«ç”¨ <span class=\"math inline\">\\(f_{u,0/1/2/3}\\)</span> ä»£è¡¨ä¸Šé¢å››ç§å¯èƒ½æ€§ï¼Œè½¬ç§»å³å¯ã€‚</p>\n<p>è´ºäº†ä¸ª freadï¼Œæ“¦è¾¹è·‘è¿‡äº†ã€‚è¿™ä¸ªä¸æ˜¯ <span class=\"math inline\">\\(O(n)\\)</span> çš„å—ï¼Ÿ</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int LEN = (1 &lt;&lt; 20);\n#ifdef ONLINE_JUDGE\nint nec(void) &#123;\n    static char buf[LEN], *p = buf, *e = buf;\n    if (p == e) &#123;\n        e = buf + fread(buf, 1, LEN, stdin);\n        if (e == buf) return EOF;\n        p = buf;\n    &#125;\n    return *p++;\n&#125;\n#else\n#define nec getchar\n\n#endif\nbool read(int &amp;x) &#123;\n    x = 0;\n    bool f = 0;\n    char ch = nec();\n    while (ch &lt; &#39;0&#39; || ch &gt; &#39;9&#39;) &#123;\n        if (ch == EOF) return 0;\n        if (ch == &#39;-&#39;) f = 1;\n        ch = nec();\n    &#125;\n    while (ch &gt;= &#39;0&#39; &amp;&amp; ch &lt;= &#39;9&#39;) &#123;\n        x = x * 10 + ch - &#39;0&#39;;\n        ch = nec();\n    &#125;\n    if (f) x = -x;\n    return 1;\n&#125;\nvoid print(int x) &#123;\n    if (x &lt; 0)\n        putchar(&#39;-&#39;), x = -x;\n    if (x &gt;= 10) print(x / 10);\n    putchar(x % 10 + &#39;0&#39;);\n    return;\n&#125;\nvoid print(int x, char ch) &#123;\n    print(x), putchar(ch);\n    return;\n&#125;\nint main() &#123;\n    int n, m;\n    read(n), read(m);\n    int res = (n - 1) - m;\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1);\n    for (int x, y; m--; ) &#123;\n        read(x), read(y);\n        g[x].push_back(y), g[y].push_back(x);\n    &#125;\n    std::vector&lt;int&gt; tag(n + 1);\n    std::vector&lt;std::array&lt;int, 4&gt; &gt; f(n + 1);\n    std::function&lt;void(int, int)&gt; DFS = [&amp;](int x, int fa) &#123;\n        tag[x] = 1;\n        f[x][0] = (fa != -1) + 1;\n        f[x][2] = f[x][3] = 0x3f3f3f3f;\n        for (auto i : g[x])\n            if (i != fa) &#123;\n                DFS(i, x);\n                f[x][3] = std::min(f[x][3] + f[i][0], f[x][2] + std::min(f[i][1], f[i][2]));\n                f[x][2] = std::min(f[x][2] + f[i][0], f[x][1] + std::min(f[i][1], f[i][2]));\n                f[x][1] += f[i][0];\n                f[x][0] += std::min(&#123; f[i][0] - 1, f[i][1], f[i][2], f[i][3] &#125;) + 1;\n            &#125;\n        return;\n    &#125;;\n    for (int i = 1; i &lt;= n; ++i)\n        if (!tag[i]) &#123;\n            DFS(i, -1);\n            res += *std::min_element(f[i].begin(), f[i].end());\n        &#125;\n    print(res, &#39;\\n&#39;);\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"d---éšæœºæ ‘\">D - éšæœºæ ‘</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P3830\" class=\"uri\">https://www.luogu.com.cn/problem/P3830</a></p>\n<p>å¯¹äºç¬¬ä¸€é—®ï¼Œä»¤ <span class=\"math inline\">\\(f_x\\)</span> è¡¨ç¤ºå…±æœ‰ <span class=\"math inline\">\\(x\\)</span> ä¸ªå¶å­æ—¶çš„æœŸæœ›æ·±åº¦ï¼Œä¸¤ä¸ªæ–°å¶å­çš„æœŸæœ›æ·±åº¦ä¸º <span class=\"math inline\">\\(f_{x-1}+1\\)</span>ï¼Œdelta ä¸º <span class=\"math inline\">\\(f_{x-1}+2\\)</span>ï¼Œæ•…æœ‰ <span class=\"math inline\">\\(f_x=\\dfrac {(x-1)f_{x-1}+f_{x-1}+2}x\\)</span>ï¼Œé€’æ¨å³å¯ã€‚</p>\n<p>å¯¹äºç¬¬äºŒé—®ï¼Œä»¤ <span class=\"math inline\">\\(f_{x,k}\\)</span> è¡¨ç¤ºæœ‰ <span class=\"math inline\">\\(x\\)</span> ä¸ªå¶å­ï¼Œæ·±åº¦ <span class=\"math inline\">\\(\\ge k\\)</span> çš„æ¦‚ç‡ï¼ˆä¸€ç§ç†è§£æ˜¯ä»æ•´æ•°æ¦‚ç‡å…¬å¼çš„è§’åº¦å‡ºå‘ï¼‰ã€‚åˆ™è€ƒè™‘æšä¸¾å·¦ã€å³å¶å­æ•°ï¼Œå¯¹äºå·¦ä¾§å¶å­æ•°ä¸º <span class=\"math inline\">\\(i\\)</span> çš„æƒ…å†µï¼Œ<strong>ä¸ºäº†å»é‡ï¼Œåªé€‰æ‹©æ·±åº¦ä¸º <span class=\"math inline\">\\(k-1\\)</span> çš„å¶å­å±•å¼€</strong>ã€‚åªè€ƒè™‘æŸç§ç»„åˆçš„å‡ºç°æ¦‚ç‡ï¼Œä¸º <span class=\"math inline\">\\(f_{i,k-1}+f_{x-i,k-1}-f_{i,k-1}\\cdot f_{x-i,k-1}\\)</span>ã€‚æ•°å½’å¯ä»¥è¯æ˜ï¼Œå¯¹äºä»»æ„ <span class=\"math inline\">\\(i\\)</span>ï¼Œæ·±åº¦ä¸º <span class=\"math inline\">\\(k-1\\)</span> çš„å¶å­è¢«é€‰ä¸­çš„æ¦‚ç‡å‡ä¸º <span class=\"math inline\">\\(\\dfrac 1{x-1}\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int q, n;\n    std::cin &gt;&gt; q &gt;&gt; n;\n    std::cout &lt;&lt; std::fixed &lt;&lt; std::setprecision(6);\n    if (q == 1) &#123;\n        std::vector&lt;double&gt; f(n + 1);\n        for (int i = 2; i &lt;= n; ++i)\n            f[i] = (f[i - 1] * (i - 1) + f[i - 1] + 2.) / i;\n        std::cout &lt;&lt; f[n] &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    else &#123;\n        std::vector&lt;std::vector&lt;double&gt; &gt; f(n + 1, std::vector&lt;double&gt; (n + 1));\n        for (int i = 1; i &lt;= n; ++i) &#123;\n            f[i][0] = 1.;\n            for (int j = 1; j &lt; i; ++j) &#123;\n                auto s(0.);\n                for (int k = 1; k &lt; i; ++k)\n                    s += f[k][j - 1] + f[i - k][j - 1] - f[k][j - 1] * f[i - k][j - 1];\n                f[i][j] = s / (i - 1);\n            &#125;\n        &#125;\n        auto res(0.);\n        for (int i = 1; i &lt; n; ++i)\n            res += f[n][i];\n        std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"e---complete-compress\">E - Complete Compress</h2>\n<p><a href=\"https://atcoder.jp/contests/agc034/tasks/agc034_e\" class=\"uri\">https://atcoder.jp/contests/agc034/tasks/agc034_e</a></p>\n<p>å¯¹äºé“¾ï¼Œå‘ç°å¯ä»¥æšä¸¾æœ€åèšé›†çš„ç‚¹ï¼Œç­”æ¡ˆä¸é…å¯¹æ–¹å¼æ— å…³ï¼Œcheck æ˜¯å¦èƒ½é…å¯¹å³å¯ã€‚</p>\n<p>å¦‚æœä¸æ˜¯é“¾ï¼Œåˆ™ç›¸æ¯”é“¾ï¼Œè¿˜å¯ä»¥é€‰æ‹©åŒä¸€å­æ ‘ä¸­ä¸å­˜åœ¨ç¥–å­™å…³ç³»çš„ä¸¤ä¸ªç‚¹ï¼Œå°†å®ƒä»¬éƒ½å‘ LCA ç§»ä¸€æ­¥ã€‚</p>\n<p>æ•…è€Œï¼Œå¯ä»¥åœ¨é“¾çš„åšæ³•ä¸Šæ‰“ä¸€ä¸ªè¡¥ä¸ï¼Œè§‚å¯Ÿåˆ°å…ˆã€å†…éƒ¨æ¶ˆåŒ–ã€ï¼Œå†åœ¨å­æ ‘é—´é…å¯¹ä¸€å®šä¸åŠ£ï¼Œä¸”ç­”æ¡ˆä»ç„¶å’Œé…å¯¹æ–¹å¼æ— å…³ã€‚æ•…ä»¤ <span class=\"math inline\">\\(f_x\\)</span> è¡¨ç¤ºç‚¹ <span class=\"math inline\">\\(x\\)</span> å†…æœ€å¤šæ¶ˆæ‰å¤šå°‘å¯¹ï¼Œå°±å¯ä»¥ check äº†ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 1e18;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;line_02.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; a(n + 1);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        char t;\n        std::cin &gt;&gt; t;\n        a[i] = t - &#39;0&#39;;\n    &#125;\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1);\n    for (int i = 1, x, y; i &lt; n; ++i) &#123;\n        std::cin &gt;&gt; x &gt;&gt; y;\n        g[x].push_back(y), g[y].push_back(x);\n    &#125;\n    auto res(inf);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::vector&lt;int&gt; s(n + 1);\n        std::vector&lt;long long&gt; f(n + 1), cnt(n + 1);\n        std::function&lt;void(int, int)&gt; DFS = [&amp;](int x, int fa) &#123;\n            s[x] = a[x];\n            int son = 0;\n            auto sum(0ll);\n            for (auto i : g[x])\n                if (i != fa) &#123;\n                    DFS(i, x), s[x] += s[i];\n                    sum += cnt[i];\n                    if (cnt[i] &gt; cnt[son])\n                        son = i;\n                &#125;\n            if (son) &#123;\n                if (cnt[son] * 2 &lt;= sum)\n                    f[x] = sum / 2;\n                else\n                    f[x] = sum - cnt[son] + std::min(f[son], (cnt[son] - (sum - cnt[son])) / 2);\n            &#125;\n            cnt[x] = sum;\n            if (x != i)\n                cnt[x] += s[x];\n            return;\n        &#125;;\n        DFS(i, -1);\n        if (cnt[i] % 2 == 0 &amp;&amp; f[i] == cnt[i] / 2)\n            res = std::min(res, cnt[i] / 2);\n    &#125;\n    if (res == inf)\n        std::cout &lt;&lt; -1 &lt;&lt; &#39;\\n&#39;;\n    else\n        std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n",
            "tags": [
                "DP",
                "æ ‘å½¢ DP",
                "é•¿é“¾å‰–åˆ†"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250715/",
            "url": "https://xsc062.netlify.app/20250715/",
            "title": "æ‚é¢˜é€‰è°ˆï¼šå†³ç­–å•è°ƒæ€§",
            "date_published": "2025-07-15T06:13:24.000Z",
            "content_html": "<p>ã€å¿ƒé™è‡ªç„¶å‡‰ã€å¤§æŠµæ˜¯å› ä¸ºæƒ…ç»ªå¹³å’Œæ—¶å‰¯äº¤æ„Ÿç¥ç»å…´å¥‹ï¼Œä½“æ¸©ç•¥æœ‰é™ä½å¯¼è‡´çš„ã€‚å—ï¼Ÿ</p>\n<span id=\"more\"></span>\n<p>å…¶å®æ˜¯å› ä¸ºå¿ƒè„åœè·³åè¡€æ¶²å¾ªç¯ç»ˆæ­¢ã€ä»£è°¢ä¸­æ–­ï¼Œå¯¼è‡´äº§çƒ­ä½äºæ•£çƒ­ï¼ˆï¼Ÿï¼‰</p>\n<hr />\n<h2 id=\"a---å¾é€”\">A - å¾é€”</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P4072\" class=\"uri\">https://www.luogu.com.cn/problem/P4072</a></p>\n<p>ç”¨å®Œå…¨å¹³æ–¹å…¬å¼å±•å¼€å¾—åˆ° <span class=\"math inline\">\\(m^2\\sigma^2=m\\left(\\sum {x_i}^2\\right)-S^2\\)</span>ï¼Œå…¶ä¸­ <span class=\"math inline\">\\(S\\)</span> ä¸ºæ±‚å’Œã€‚</p>\n<p>æ‰€ä»¥ç›®æ ‡æ˜¯æœ€å°åŒ– <span class=\"math inline\">\\(\\sum {x_i}^2\\)</span> è¿™ä¸ªä¸œè¥¿ã€‚ä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºç¬¬ <span class=\"math inline\">\\(i\\)</span> å¤©èµ°åˆ° <span class=\"math inline\">\\(j\\)</span>ï¼Œå¾—åˆ°ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\nf_{i,j}&amp;=\\min\\{f_{i-1,k}+(s_j-s_k)^2\\}\\\\\n&amp;=\\min\\{f_{i-1,k}-2\\times s_j\\times s_k+{s_k}^2\\}+{s_j}^2\n\\end{aligned}\n\\]</span></p>\n<p>æœ€åå¾—åˆ°çš„æ–œç‡å¼å­æ˜¯ <span class=\"math inline\">\\(\\dfrac {f_{i - 1, a}-f_{i - 1, b}+{s_a}^2-{s_b}^2}{2(s_a-s_b)}&lt;s_j\\)</span>ï¼Œç”±äº <span class=\"math inline\">\\(s_j\\)</span> å•å¢ï¼Œ<del>å•è°ƒé˜Ÿåˆ—ç»´æŠ¤é€’å‡æ–œç‡å³å¯</del> <strong>æ›´æ­£ï¼šæ˜¯é€’å¢æ–œç‡ã€‚åŸå› æ˜¯ <span class=\"math inline\">\\(&lt;\\)</span> æ˜¯å¼¹å‡ºæ¡ä»¶ï¼Œè€Œéä¿ç•™æ¡ä»¶â€¦â€¦</strong></p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 1e9;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;int&gt; a(n + 1);\n    std::vector&lt;long long&gt; s(n + 1);\n    auto sum(0ll);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i];\n        s[i] = s[i - 1] + a[i];\n        sum += a[i];\n    &#125;\n    std::vector&lt;std::vector&lt;long long&gt; &gt; f(m + 1, std::vector&lt;long long&gt; (n + 1, inf));\n    f[0][0] = 0ll;\n    for (int i = 1; i &lt;= m; ++i) &#123;\n        auto f1 = [&amp;](int a, int b) &#123;\n            return f[i - 1][a] - f[i - 1][b] + s[a] * s[a] - s[b] * s[b];\n        &#125;;\n        auto f2 = [&amp;](int a, int b) &#123;\n            return 2 * (s[a] - s[b]);\n        &#125;;\n        std::vector&lt;int&gt; q(n + 1);\n        int h = 0, t = -1;\n        q[++t] = i - 1;\n        for (int j = i; j &lt;= n; ++j) &#123;\n            for (; h &lt; t &amp;&amp; f1(q[h + 1], q[h]) &lt; s[j] * f2(q[h + 1], q[h]); ++h);\n            f[i][j] = f[i - 1][q[h]] + (s[j] - s[q[h]]) * (s[j] - s[q[h]]);\n            for (; h &lt; t &amp;&amp; f1(j, q[t]) * f2(q[t], q[t - 1]) &lt; f1(q[t], q[t - 1]) * f2(j, q[t]); --t);\n            q[++t] = j;\n        &#125;\n    &#125;\n    std::cout &lt;&lt; m * f[m][n] - sum * sum &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b---åˆ·é‡-iii\">B - åˆ·é‡ III</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P10074\" class=\"uri\">https://www.luogu.com.cn/problem/P10074</a></p>\n<p>å‘ç°æœ€åæƒ…å†µå°±æ˜¯æ¯æ¬¡ã€è¯•æ¢ã€éƒ½ä¸ä¸­çš„æƒ…å†µï¼Œå†è¯•æ¢ä¸­æœ€åçš„é‚£ä¸€ä¸ªã€‚ä¸ºå•¥å‘¢ï¼Œç›¸å½“äºæˆ‘ä»¬æ¯æ¬¡æ”»å‡»çš„ä¸€å®šæ˜¯æœªçŸ¥å…ƒç´ ä¸­è¡€æœ€å¤šçš„ä¸€ä¸ªã€‚æ—¢ç„¶å·²ç»è¯•æ¢å‡ºäº†æ¯”é˜ˆå€¼å¤§çš„æ‰€æœ‰å…ƒç´ ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæ”»å‡»çš„å°±ä¸€å®šæ˜¯é˜ˆå€¼æœ¬èº«ï¼Œå¦‚æœè¿™æ¬¡è·³è¿‡å®ƒï¼Œå®ƒå°±ä¼šæˆä¸ºä¸‹ä¸€æ¬¡è¯•æ¢å¤±è´¥çš„å…ƒç´ ã€‚è¿™æ˜¾ç„¶ä¸å¦‚ä¸€å¼€å§‹å°±ç›´æ¥ç”¨æ–°é˜ˆå€¼è¯•æ¢ã€‚</p>\n<p>ä»å¤§åˆ°å°æ’åºã€‚ä»¤ <span class=\"math inline\">\\(f_{j, i}\\)</span> è¡¨ç¤ºåªç¡®å®šäº†å‰ <span class=\"math inline\">\\(i\\)</span> å¤§çš„æ•°ï¼Œå·²ç»æ€äº† <span class=\"math inline\">\\(j\\)</span> ä¸ªäººçš„æœ€åæƒ…å†µæœ€å°ä»£ä»·ã€‚é‚£ä¹ˆæ˜¾ç„¶è¿™ä¸€æ¬¡çš„é˜ˆå€¼æ˜¯ <span class=\"math inline\">\\(a_i\\)</span>ã€‚éšä¾¿é€‰å‡ºä¸Šä¸€æ¬¡çš„é˜ˆå€¼ <span class=\"math inline\">\\(a_k\\)</span>ï¼Œé‚£ä¹ˆä¸­é—´è¿™ä¸€æ®µå¾…ç¡®å®šçš„å…ƒç´ æ•°é‡ä¸º <span class=\"math inline\">\\(i-k\\)</span>ã€‚é‚£ä¹ˆæœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\nf_{j, i}&amp;=\\min\\limits_{k&lt;i}\\{f_{j-1,k}+(i-k)\\times a_i\\}\\\\\n&amp;=\\min\\limits_{k&lt;i}\\{f_{j-1,k}-k\\times a_i\\}+i\\times a_i\n\\end{aligned}\n\\]</span></p>\n<p>ç»è¿‡éªŒè¯ï¼Œè™½ç„¶è¿™ä¸ªå¼å­å’Œé¢˜è§£é•¿å¾—ä¸ä¸€æ ·ï¼Œä½†æ˜¯æ˜¯å¯¹çš„ <del>å› ä¸ºæˆ‘ n^3 æš´åŠ› A äº†</del></p>\n<p>æ¨å‡ºæ–œä¼˜å½¢å¼ <span class=\"math inline\">\\(\\dfrac {f_{j-1,A}-f_{j-1,B}}{A-B}&lt;a_i\\)</span>ï¼Œä½†æˆ‘çš„æœ‹å‹ï¼Œ<span class=\"math inline\">\\(a_i\\)</span> æ˜¯é€’å‡çš„ã€‚æ‰€ä»¥ç”¨å•è°ƒæ ˆç»´æŠ¤é€’å¢æ–œç‡å³å¯ã€‚<del>æˆ–è€…ä½ ä¹Ÿå¯ä»¥å­¦ä¹  grisses æ‰“ä¸€ä¸ªå•è°ƒé˜Ÿåˆ—ä¸ŠäºŒåˆ†</del></p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 1e12;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;P10074_4.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;long long&gt; a(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    std::sort(a.begin() + 1, a.end(), std::greater&lt;long long&gt; ());\n    std::vector&lt;std::vector&lt;long long&gt; &gt; f(m + 1, std::vector&lt;long long&gt; (n + 1, inf));\n    f[0][0] = 0ll;\n    for (int j = 1; j &lt;= m; ++j) &#123;\n        std::vector&lt;int&gt; q(n + 1);\n        int t = -1;\n        q[++t] = j - 1;\n        auto f1 = [&amp;](int A, int B) &#123;\n            return f[j - 1][A] - f[j - 1][B];\n        &#125;;\n        auto f2 =[&amp;](int A, int B) &#123;\n            return A - B;\n        &#125;;\n        for (int i = j; i &lt;= n; ++i) &#123;\n            for (; t &gt;= 1 &amp;&amp; f1(q[t], q[t - 1]) &gt; a[i] * f2(q[t], q[t - 1]); --t);\n            f[j][i] = f[j - 1][q[t]] + (i - q[t]) * a[i];\n            for (; t &gt;= 1 &amp;&amp; f1(i, q[t]) * f2(q[t], q[t - 1]) &lt; f1(q[t], q[t - 1]) * f2(i, q[t]); --t);\n            q[++t] = i;\n        &#125;\n    &#125;\n    auto res(inf);\n    for (int i = m; i &lt;= n; ++i)\n        res = std::min(res, f[m][i]);\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"c---traka\">C - TRAKA</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P7747\" class=\"uri\">https://www.luogu.com.cn/problem/P7747</a></p>\n<p>ç¨å¾®æ‰‹ç©ä¸€ä¸‹å°±å¯ä»¥å‘ç°ï¼Œå‡å¦‚ç¬¬ <span class=\"math inline\">\\(j\\)</span> ä¸ªäººåœ¨ç¬¬ <span class=\"math inline\">\\(i\\)</span> æ¬¡çš„å·¥ä½œæ—¶é—´ä¸º <span class=\"math inline\">\\([L_{j,i},R_{j,i}]\\)</span>ï¼Œç¬¬ <span class=\"math inline\">\\(i-1\\)</span> æ¬¡ä¸º <span class=\"math inline\">\\([L_{j,i-1},R_{j,i-1}]\\)</span>ï¼Œé‚£ä¹ˆè¦æ±‚ <span class=\"math inline\">\\(L_{j,i}\\ge R_{j,i-1}\\)</span>ã€‚</p>\n<p>ä»¤ <span class=\"math inline\">\\(s_j\\)</span> ä¸º <span class=\"math inline\">\\(t\\)</span> çš„å‰ç¼€å’Œã€‚å‡è®¾ç¬¬ <span class=\"math inline\">\\(i-1\\)</span> æ¬¡åŠ å·¥äº <span class=\"math inline\">\\(x_{i-1}\\)</span> å¼€å§‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠä¸Šå¼è½¬å†™ä¸º <span class=\"math inline\">\\(x_{i}+s_{j-1}\\times f_{i}\\ge x_{i-1}+s_j\\times f_{i-1}\\)</span>ã€‚ä¹Ÿå³ <span class=\"math inline\">\\(x_i-x_{i-1}\\ge s_j\\times f_{i-1}-s_{j-1}\\times f_i\\)</span>ã€‚</p>\n<p>æ˜¾ç„¶éœ€è¦æ‰¾åˆ°ä¸€ä¸ª <span class=\"math inline\">\\(j\\)</span> ä½¿å¾— RSH å–å¾—æœ€å¤§å€¼ï¼›ç°åœ¨å°±å¯ä»¥è€ƒè™‘æ–œç‡ä¼˜åŒ–äº†ã€‚ç”±äºæ‰€æœ‰é¡¹éƒ½å’Œ <span class=\"math inline\">\\(i\\)</span> æœ‰å…³ï¼Œæƒ³åˆ°ä¸¤è¾¹åŒé™¤ <span class=\"math inline\">\\(f_{i}\\)</span> æ¶ˆæ‰ä¸€ä¸ª <span class=\"math inline\">\\(i\\)</span> æœ‰å…³çš„ç³»æ•°ï¼Œæœ€ååŒ–å‡ºæ¥çš„æ–œä¼˜å½¢å¼æ˜¯ <span class=\"math inline\">\\(\\dfrac {s_A-s_B}{s_{A-1}-s_{B-1}}&gt;\\dfrac {f_{i-1}}{f_i}\\)</span>ã€‚ç”±äº RSH ä¸å•è°ƒï¼ŒæŠŠæ‰€æœ‰ <span class=\"math inline\">\\(j\\)</span> å¡åˆ°é˜Ÿåˆ—é‡Œç»´æŠ¤é€’å‡æ–œç‡ï¼Œæ‰“äºŒåˆ†å³å¯ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;long long&gt; a(n + 1), w(m + 1), s(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i], s[i] = s[i - 1] + a[i];\n    for (int i = 1; i &lt;= m; ++i)\n        std::cin &gt;&gt; w[i];\n    std::vector&lt;long long&gt; f(m + 1);\n    std::vector&lt;int&gt; q(n + 1);\n    int h = 0, t = -1;\n    q[++t] = 1;\n    for (int i = 2; i &lt;= n; ++i) &#123;\n        for (; h &lt; t &amp;&amp; (s[i] - s[q[t]]) * (s[q[t] - 1] - s[q[t - 1] - 1]) &gt; (s[q[t]] - s[q[t - 1]]) * (s[i - 1] - s[q[t] - 1]); --t);\n        q[++t] = i;\n    &#125;\n    for (int i = 2; i &lt;= m; ++i) &#123;\n        int to = q[h];\n        for (int l = h + 1, r = t, mid; l &lt;= r; ) &#123;\n            mid = (l + r) &gt;&gt; 1;\n            if ((s[q[mid]] - s[q[mid - 1]]) * w[i - 1] &gt; w[i] * (s[q[mid] - 1] - s[q[mid - 1] - 1]))\n                to = q[mid], l = mid + 1;\n            else\n                r = mid - 1;\n        &#125;\n        f[i] = f[i - 1] + s[to] * w[i - 1] - s[to - 1] * w[i];\n    &#125;\n    std::cout &lt;&lt; f[m] + w[m] * s[n] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"d---æŸ æª¬\">D - æŸ æª¬</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P5504\" class=\"uri\">https://www.luogu.com.cn/problem/P5504</a></p>\n<ul>\n<li>è§‚å¯Ÿé›¶ï¼šåŸé—®é¢˜ã€ä»ä¸¤ç«¯å–ã€å¯ä»¥è½¬åŒ–ä¸ºåˆ†æ®µé—®é¢˜ï¼Œæ•…ä»å…¶ä¸­ä¸€ç«¯è€ƒè™‘å³å¯ã€‚</li>\n<li>è§‚å¯Ÿä¸€ï¼šè‹¥æœ‰ä¸€æ®µè¿ç»­çš„ <span class=\"math inline\">\\(x\\)</span>ï¼Œå®Œæ•´çš„æ¯”æ‹†å¼€çš„æ›´ä¼˜ã€‚</li>\n<li>è§‚å¯ŸäºŒï¼šå¦‚æœä¸€æ®µ <span class=\"math inline\">\\(x\\)</span> ä¸­å¤¹æ‚äº†ä¸€äº›å…¶ä»–å…ƒç´ ï¼Œé‚£ä¹ˆåœ¨å“ªé‡Œåˆ†æ®µæ˜¯è¯´ä¸å‡†çš„ã€‚</li>\n<li>è§‚å¯Ÿä¸‰ï¼šå¦‚æœé€‰å–çš„åŒºé—´æ˜¯ <span class=\"math inline\">\\([1,r]\\)</span>ï¼Œé‚£ä¹ˆè´ªå¿ƒåœ°æƒ³ï¼Œ<span class=\"math inline\">\\(a_r\\)</span> ä¸€å®šæ˜¯å…³é”®å€¼ï¼Œä¸ç„¶å– <span class=\"math inline\">\\(a_r\\)</span> å°±æµªè´¹äº†ã€‚</li>\n<li>è§‚å¯Ÿå››ï¼šå¦‚æœé€‰å–çš„åŒºé—´æ˜¯ <span class=\"math inline\">\\([l,r]\\)</span>ï¼Œé‚£ä¹ˆç”±è§‚å¯Ÿå››ï¼Œ<span class=\"math inline\">\\(a_l=a_r\\)</span>ï¼Œä¸”è¯¥å€¼ä¸ºå…³é”®å€¼ã€‚</li>\n</ul>\n<p>ç»“åˆè¿™å‡ ä¸ªè§‚å¯Ÿï¼Œä»¤ <span class=\"math inline\">\\(c_i\\)</span> è¡¨ç¤º <span class=\"math inline\">\\(a_i\\)</span> åœ¨ <span class=\"math inline\">\\([1,i]\\)</span> ä¸­å‡ºç°æ¬¡æ•°ï¼Œ<span class=\"math inline\">\\(f_i\\)</span> è¡¨ç¤ºè¿™ä¸€æ®µä»¥ <span class=\"math inline\">\\(i\\)</span> ç»“å°¾çš„æœ€å¤§ä»·å€¼ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\nf_i&amp;=\\max\\limits_{j&lt;i,a_{j+1}=a_i}\\{f_j+a_i\\times (c_i-c_{j + 1} + 1)^2\\}\\\\\n&amp;=\\max\\limits_{j&lt;i,a_{j+1}=a_i}\\{f_j+a_{j+1}\\times {c_{j+1}}^2-2\\times c_i\\times a_{j+1}\\times c_{j+1}-2\\times c_{j+1}\\times a_{j+1}\\}+a_i\\times(c_i-1)^2\n\\end{aligned}\n\\]</span></p>\n<p>ï¼ˆæ€ä¹ˆè¿™ä¹ˆå¤§ä¸€å †ã€‚ï¼‰æœ€åå¯ä»¥åŒ–å‡º <span class=\"math inline\">\\(\\dfrac {f_A-f_B+a_{A+1}\\cdot c_{A+1}\\cdot (c_{A+1}-2)-a_{B+1}\\cdot c_{B+1}\\cdot (c_{B+1}-2)}{2(c_{A+1} - c_{B+1})}&gt;c_i\\times a_i\\)</span>ã€‚å‘ç°å¯¹äºæ¯ä¸€ç§ <span class=\"math inline\">\\(a_i\\)</span>ï¼Œ<span class=\"math inline\">\\(c_i\\times a_i\\)</span> æ˜¯å•å¢çš„ã€‚å•è°ƒæ ˆç»´æŠ¤å³å¯ã€‚</p>\n<p><em>è¿™å…¶å®æé†’æˆ‘ä»¬å…³äºä»£æ¢çš„é—®é¢˜â€”â€”æ˜¾ç„¶ï¼Œå½“ä¸ <span class=\"math inline\">\\(i\\)</span> çš„é¡¹ã€ä¸ <span class=\"math inline\">\\(j\\)</span> æœ‰å…³çš„é¡¹ä¹‹é—´å­˜åœ¨ä»£æ¢å…³ç³»æ—¶ï¼Œåº”è¯¥å°½é‡å¾€ <span class=\"math inline\">\\(j\\)</span> çš„æ–¹å‘é ã€‚</em></p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;7.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;long long&gt; a(n + 1), c(n + 1), la(10001);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i];\n        c[i] = c[la[a[i]]] + 1, la[a[i]] = i;\n    &#125;\n    std::vector&lt;long long&gt; f(n + 1);\n    std::vector&lt;int&gt; _t(10001, -1);\n    std::vector&lt;std::vector&lt;int&gt; &gt; _q(10001);\n    auto f1 = [&amp;](int A, int B) &#123;\n        return f[A] - f[B] + a[A + 1] * c[A + 1] * (c[A + 1] - 2) - a[B + 1] * c[B + 1] * (c[B + 1] - 2);\n    &#125;;\n    auto f2 = [&amp;](int A, int B) &#123;\n        return 2 * (c[A + 1] - c[B + 1]);\n    &#125;;\n    ++_t[a[1]], _q[a[1]].push_back(0);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        &#123;\n            auto &amp;t = _t[a[i]];\n            auto &amp;q = _q[a[i]];\n            for (; t &gt;= 1 &amp;&amp; f1(q[t], q[t - 1]) &lt; c[i] * a[i] * f2(q[t], q[t - 1]); --t);\n            f[i] = f[q[t]] + a[i] * (c[i] - c[q[t] + 1] + 1) * (c[i] - c[q[t] + 1] + 1);\n        &#125;\n        if (i &lt; n) &#123;\n            auto &amp;t = _t[a[i + 1]];\n            auto &amp;q = _q[a[i + 1]];\n            for (; t &gt;= 1 &amp;&amp; f1(i, q[t]) * f2(q[t], q[t - 1]) &gt; f1(q[t], q[t - 1]) * f2(i, q[t]); --t);\n            q.resize(++t + 1), q[t] = i;\n        &#125;\n    &#125;\n    std::cout &lt;&lt; f[n] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"e---knapsack-with-diminishing-values\">E - Knapsack with Diminishing Values</h2>\n<p><a href=\"https://atcoder.jp/contests/abc373/tasks/abc373_f\" class=\"uri\">https://atcoder.jp/contests/abc373/tasks/abc373_f</a></p>\n<p>å‘ç°å’Œ <a href=\"/20250707-1/#ä¾‹å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–å¤šé‡èƒŒåŒ…\">å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–å¤šé‡èƒŒåŒ…</a> æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚</p>\n<p>ä¸å¦¨ä»¤ <span class=\"math inline\">\\(v_i\\)</span> è¡¨ç¤ºä½“ç§¯ï¼Œ<span class=\"math inline\">\\(w_i\\)</span> è¡¨ç¤ºä»·å€¼ã€‚å¯¹äºæ¯ä¸€ä¸ª <span class=\"math inline\">\\(i\\)</span>ï¼ŒæŠŠæ‰€æœ‰ä½“ç§¯æŒ‰æ¨¡ <span class=\"math inline\">\\(v_i\\)</span> çš„ä½™æ•°åˆ†ç±»ï¼Œè®¾ä¸º <span class=\"math inline\">\\(j\\cdot v_i+x\\)</span>ã€‚å¯¹äº <span class=\"math inline\">\\(k\\cdot v_i+x\\)</span>ï¼Œæœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\nf_{i,j\\cdot v_i+x}&amp;=\\max\\limits_{k&lt;j}\\{f_{i-1,k\\cdot v_i+x}+(j-k)\\cdot w_i-(j-k)^2\\}\\\\\n&amp;=\\max\\limits_{k&lt;j}\\{f_{i-1,k\\cdot v_i+x}-k\\cdot w_i-k^2+2\\times j\\times k\\}-j^2+j\\cdot w_i\n\\end{aligned}\n\\]</span></p>\n<p>åˆ™å¾—åˆ° <span class=\"math inline\">\\(\\dfrac {f_{i-1,A\\cdot v_i+x}-f_{i-1,B\\cdot v_i+x}+(B-A)\\cdot w_i - A^2+B^2}{2(B-A)}&lt;j\\)</span>ã€‚æ³¨æ„åˆ†æ¯ä¸ºè´Ÿã€‚æ€»ä¹‹å•è°ƒé˜Ÿåˆ—ç»´æŠ¤é€’å¢æ–œç‡å³å¯ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;long long&gt; v(n + 1), w(n + 1);\n    std::vector&lt;std::vector&lt;long long&gt; &gt; f(n + 1, std::vector&lt;long long&gt; (m + 1));\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; v[i] &gt;&gt; w[i];\n        for (int x = 0; x &lt; v[i]; ++x) &#123;\n            int h = 0, t = -1;\n            std::vector&lt;int&gt; q;\n            auto f1 = [&amp;](int A, int B) &#123;\n                return f[i - 1][A * v[i] + x] - f[i - 1][B * v[i] + x] + (B - A) * w[i] - A * A + B * B;\n            &#125;;\n            auto f2 = [&amp;](int A, int B) &#123;\n                return 2 * (B - A);\n            &#125;;\n            for (int j = 0, J = x; J &lt;= m; ++j, J += v[i]) &#123;\n                for (; h &lt; t &amp;&amp; f1(q[h + 1], q[h]) &gt; j * f2(q[h + 1], q[h]); ++h);\n                f[i][J] = f[i - 1][J];\n                if (h &lt;= t)\n                    f[i][J] = std::max(f[i][J], f[i - 1][q[h] * v[i] + x] + (j - q[h]) * w[i] - (j - q[h]) * (j - q[h]));\n                for (; h &lt; t &amp;&amp; f1(j, q[t]) * f2(q[t], q[t - 1]) &lt; f1(q[t], q[t - 1]) * f2(j, q[t]); --t);\n                q.resize(++t + 1), q[t] = j;\n            &#125;\n        &#125;\n    &#125;\n    std::cout &lt;&lt; f[n][m] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"f---managing-telephone-poles\">F - Managing Telephone Poles</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1575/M\" class=\"uri\">https://codeforces.com/problemset/problem/1575/M</a></p>\n<p>ï¼Ÿè§‚å¯Ÿåˆ°æ€§è´¨ç„¶åè¢«è‡ªå·±å¿½ç•¥äº†ã€‚éå¸¸å€¼å¾—æ‰¹è¯„ã€‚</p>\n<p>ä¸éš¾å†™å‡ºç±»ä¼¼æ–œç‡ä¼˜åŒ–çš„å¼å­ <span class=\"math inline\">\\(S(i,j)=\\min\\{ {x_k}^2-2\\times i\\times x_k+{y_k}^2-2\\times j \\times y_k\\}+i^2+j^2\\)</span>ã€‚</p>\n<p>ä¼šä¸‹æ„è¯†å°è¯•å›ºå®š <span class=\"math inline\">\\(i\\)</span>ï¼Œå°±å¯ä»¥ <span class=\"math inline\">\\(O(n^2m)\\)</span> å®Œæˆä»»åŠ¡ï¼Œä¼¼ä¹ä¸å¤ªè¡Œã€‚é¡ºç€è¿™ä¸ªæƒ³æ³•ä¼šè§‚å¯Ÿåˆ°ï¼Œå›ºå®š <span class=\"math inline\">\\(i\\)</span> ä¹‹åï¼Œæ¯ä¸€åˆ—çš„ poles ä¸­åªæœ‰å’Œç¬¬ <span class=\"math inline\">\\(i\\)</span> è¡Œæœ€è¿‘çš„æ‰ä¼šæœ‰è´¡çŒ®ã€‚</p>\n<p>è¿™ä¸ªæ˜¯å¥½åšçš„ï¼Œä¸”è¿™æ ·çš„ç›¸é‚»ç‚¹æ•°é‡æ˜¯ <span class=\"math inline\">\\(O(m)\\)</span> çš„ï¼›äºæ˜¯å°† <span class=\"math inline\">\\(i\\)</span> è§†ä¸ºå¸¸æ•°è¿›è¡Œå˜å½¢ï¼Œè‹¥å°†æ‰€æœ‰ poles æŒ‰ <span class=\"math inline\">\\(y\\)</span> ä»å°åˆ°å¤§æ’åºå°±èƒ½å¾—åˆ°æ–œç‡å½¢å¼ <span class=\"math inline\">\\(\\dfrac { {x_A}^2-{x_B}^2+{y_A}^2-{y_B}^2-2\\times i\\times(x_A-x_B)}{2(y_A-y_B)}&lt;j\\)</span>ã€‚ç»´æŠ¤é€’å¢æ–œç‡å°±èƒ½ <span class=\"math inline\">\\(O(n^2)\\)</span> å®Œæˆé—®é¢˜ã€‚</p>\n<p>é‚£ä¹ˆæ‰¾ç›¸é‚»ç‚¹è¿™ä¸€æ­¥å¤§å¯ä»¥æ‘†çƒ‚å†™äºŒåˆ†ã€‚æ‰€ä»¥æ€»å…±æ˜¯ <span class=\"math inline\">\\(O(nm\\log m)\\)</span> çš„ã€‚</p>\n<p>ä¸è¦åƒæˆ‘ä¸€æ ·æŠŠä¸¤è¾¹æœ€è¿‘çš„éƒ½åŠ è¿›é˜Ÿåˆ—ï¼Œä¸ç„¶ä½ ä¼šæœ‰åˆ†æ¯ä¸º <span class=\"math inline\">\\(0\\)</span> çš„æ–œç‡ <img src=\"/em/hsh.gif\" /></p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m, ++n, ++m;\n    std::vector&lt;std::vector&lt;int&gt; &gt; tag(n + 1, std::vector&lt;int&gt; (m + 1));\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(m + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        for (int j = 1; j &lt;= m; ++j) &#123;\n            char t;\n            std::cin &gt;&gt; t;\n            if (t == &#39;1&#39;)\n                g[j].push_back(i), tag[i][j] = 1;\n        &#125;\n    struct node &#123; long long x, y; &#125;;\n    auto res(0ll);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::vector&lt;node&gt; p;\n        for (int j = 1; j &lt;= m; ++j) &#123;\n            int to = std::lower_bound(g[j].begin(), g[j].end(), i) - g[j].begin();\n            if (to &lt; (int)g[j].size()) &#123;\n                p.push_back(&#123; g[j][to], j &#125;);\n                if (g[j][to] != i &amp;&amp; to != 0 &amp;&amp; g[j][to] - i &gt; i - g[j][to - 1])\n                    p.back() = &#123; g[j][to - 1], j &#125;;\n            &#125;\n            else if (to != 0)\n                p.push_back(&#123; g[j][to - 1], j &#125;);\n        &#125;\n        std::vector&lt;int&gt; q(m + 1);\n        int h = 0, t = -1;\n        auto f1 = [&amp;](node A, node B) &#123;\n            return A.x * A.x - B.x * B.x + A.y * A.y - B.y * B.y - 2 * i * (A.x - B.x);\n        &#125;;\n        auto f2 = [&amp;](node A, node B) &#123;\n            return 2 * (A.y - B.y);\n        &#125;;\n        for (int j = 0; j &lt; (int)p.size(); ++j) &#123;\n            for (; h &lt; t &amp;&amp; f1(p[j], p[q[t]]) * f2(p[q[t]], p[q[t - 1]]) &lt; f1(p[q[t]], p[q[t - 1]]) * f2(p[j], p[q[t]]); --t);\n            q[++t] = j;\n        &#125;\n        for (int j = 1; j &lt;= m; ++j) &#123;  \n            for (; h &lt; t &amp;&amp; f1(p[q[h + 1]], p[q[h]]) &lt; j * f2(p[q[h + 1]], p[q[h]]); ++h);\n            res += (p[q[h]].x - i) * (p[q[h]].x - i) + (p[q[h]].y - j) * (p[q[h]].y - j);\n        &#125;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"g---partition-game\">G - Partition Game</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1527/E\" class=\"uri\">https://codeforces.com/problemset/problem/1527/E</a></p>\n<p>å‘ç°ä¸å¤ªæ–œä¼˜ï¼Œç»ˆäºç»™æˆ‘æµ¸æ³¡äº†ä¸¤å¤©æ–œä¼˜å†…å®¹çš„å¤§è„‘åŠ äº†å‹ºæ–°çš„åº•ç‰©ã€‚</p>\n<p>ä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºç¬¬ <span class=\"math inline\">\\(i\\)</span> æ®µä»¥ <span class=\"math inline\">\\(j\\)</span> ç»“å°¾çš„æœ€å°ä»£ä»·ï¼›å¯¹ <span class=\"math inline\">\\(w\\)</span> å¥—ç”¨å››è¾¹å½¢ä¸ç­‰å¼å˜å¼ <span class=\"math inline\">\\(w(l-1,r+1)+w(l,r)\\ge w(l-1,r)+w(l,r+1)\\)</span> å‘ç°æˆç«‹ï¼ˆå…¶ä¸­å¤§å¤šæ•°æ—¶å€™èƒ½å–ç­‰ï¼›éƒ¨åˆ†ç‰¹æ®Šæƒ…å†µå–åˆ°å¤§äºå·ï¼‰ã€‚</p>\n<p>é‚£ä¹ˆå‘ç°å¯ä»¥ç”¨åˆ†æ²»ä¼˜åŒ–ã€‚å‘ç° <span class=\"math inline\">\\(w\\)</span> ä¸é‚£ä¹ˆèƒ½å¿«é€Ÿæ±‚ï¼›è¿˜æ˜¯å¥—ç”¨ <a href=\"/20250707-1/#ä¾‹yet-another-minimization-problem\">Yet Another Minimization Problem</a> ä¸­çš„æ–¹æ³•ï¼Œç”¨ç±»ä¼¼è«é˜Ÿçš„æ–¹å¼æ±‚è§£ã€‚</p>\n<p>å‘ç°è¿™ä¸ªè«é˜Ÿå¥—è·¯ä¹Ÿå¾ˆç†Ÿæ‚‰äº†ï¼Œç›´æ¥ç”¨åŒç«¯é˜Ÿåˆ—ç»´æŠ¤å³å¯ã€‚å¤æ‚åº¦ <span class=\"math inline\">\\(O(nk\\log n)\\)</span>ï¼Œçœ‹ç€ä¸å¤ªå®‰å…¨ã€‚ä½†æ³¨æ„åˆ°æˆ‘ä»¬åœ¨ 20 ä¸ªæœˆå‰çš„æäº¤ä¸­ä½¿ç”¨äº† <span class=\"math inline\">\\(O(nk\\log n)\\)</span> çš„çº¿æ®µæ ‘ï¼Œæ‰€ä»¥èƒ½è¿‡çš„å…„å¼Ÿã€‚</p>\n<details>\n<p>é‰´äº deque çš„æ—¶ç©ºå¸¸æ•°éƒ½å¤§å¾—å“äººï¼Œæ‰€ä»¥æˆ‘ç”¨é™æ€ vector æ¨¡æ‹Ÿ deque äº†ã€‚</p>\n<p>è·‘å¾—æ¯”æˆ‘ä¹‹å‰çº¿æ®µæ ‘çš„ä¸€åŠè¿˜å¿«ï¼Œå…„å¼Ÿã€‚</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int inf = 1e18;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;std::vector&lt;int&gt; &gt; pos(n + 1);\n    std::vector&lt;int&gt; a(n + 1), _h(n + 1), _t(n + 1, -1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i], pos[a[i]].push_back(i);\n    std::vector&lt;std::vector&lt;long long&gt; &gt; f(m + 1, std::vector&lt;long long&gt; (n + 1, inf));\n    f[0][0] = 0ll;\n    auto w = [&amp;](int ql, int qr) &#123;\n        static int l = 1, r = 0;\n        static auto res(0ll);\n        for (; l &gt; ql; ) &#123;\n            --l;\n            auto &amp;h = _h[a[l]], &amp;t = _t[a[l]];\n            auto &amp;q = pos[a[l]];\n            if (h &lt;= t)\n                res -= q[t] - q[h];\n            res += q[t] - q[--h];\n        &#125;\n        for (; r &gt; qr; ) &#123;\n            auto &amp;h = _h[a[r]], &amp;t = _t[a[r]];\n            auto &amp;q = pos[a[r]];\n            res -= q[t--] - q[h];\n            if (h &lt;= t)\n                res += q[t] - q[h];\n            --r;\n        &#125;\n        for (; r &lt; qr; ) &#123;\n            ++r;\n            auto &amp;h = _h[a[r]], &amp;t = _t[a[r]];\n            auto &amp;q = pos[a[r]];\n            if (h &lt;= t)\n                res -= q[t] - q[h];\n            res += q[++t] - q[h];\n        &#125;\n        for (; l &lt; ql; ) &#123;\n            auto &amp;h = _h[a[l]], &amp;t = _t[a[l]];\n            auto &amp;q = pos[a[l]];\n            res -= q[t] - q[h++];\n            if (h &lt;= t)\n                res += q[t] - q[h];\n            ++l;\n        &#125;\n        return res;\n    &#125;;\n    for (int t = 1; t &lt;= m; ++t) &#123;\n        std::function&lt;void(int, int, int, int)&gt; calc = [&amp;](int l, int r, int lp, int rp) &#123;\n            if (l &gt; r)\n                return;\n            if (l == r) &#123;\n                for (int i = lp; i &lt;= rp &amp;&amp; i &lt; l; ++i)\n                    f[t][l] = std::min(f[t][l], f[t - 1][i] + w(i + 1, l));\n                return;\n            &#125;\n            int mid = (l + r) &gt;&gt; 1, p = -1;\n            for (int i = lp; i &lt;= rp &amp;&amp; i &lt; mid; ++i)\n                if (f[t - 1][i] + w(i + 1, mid) &lt; f[t][mid])\n                    f[t][mid] = f[t - 1][i] + w(i + 1, mid), p = i;\n            calc(l, mid - 1, lp, p), calc(mid + 1, r, p, rp);\n            return;\n        &#125;;\n        calc(t, n, t - 1, n - 1);\n    &#125;\n    std::cout &lt;&lt; f[m][n] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"h---battle-lemmings\">H - Battle Lemmings</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1420/E\" class=\"uri\">https://codeforces.com/problemset/problem/1420/E</a></p>\n<p>å®¹æ˜“å‘ç° <span class=\"math inline\">\\(0\\)</span> çš„æ•°ç›®ä¸å˜ï¼Œç­”æ¡ˆå°±æ˜¯ <span class=\"math inline\">\\(0\\)</span> çš„å¯¹æ•° - è¿ç»­ <span class=\"math inline\">\\(0\\)</span> çš„å¯¹æ•°ã€‚</p>\n<p>ç„¶åæœ‰ä¸€ä¸ªæˆ‘ä»¬å¾ˆç†Ÿæ‚‰çš„ trickï¼Œéšä¾¿æ‰¾ä¸€ä¸ªç›®æ ‡åºåˆ—ï¼Œé‚£ä¹ˆèŠ±è´¹çš„æ“ä½œæ¬¡æ•°å°±æ˜¯æ¯ä¸ªå¯¹åº”çš„ <span class=\"math inline\">\\(1\\)</span> çš„ä½ç½®å·®ã€‚ä»¤ <span class=\"math inline\">\\(f_{i,j,k}\\)</span> è¡¨ç¤ºç”¨äº† <span class=\"math inline\">\\(i\\)</span> æ¬¡æ“ä½œã€<span class=\"math inline\">\\(j\\)</span> ä¸ª <span class=\"math inline\">\\(1\\)</span>ã€æœ€åä¸€ä¸ª <span class=\"math inline\">\\(1\\)</span> åœ¨ <span class=\"math inline\">\\(k\\)</span> çš„æœ€å°è¿ç»­ <span class=\"math inline\">\\(0\\)</span> å¯¹æ•°ã€‚é‚£ä¹ˆæœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\nf_{i,j,k}&amp;=\\min\\limits_{p&lt;k}\\left\\{f_{i-|k-pos_j|,j-1,p}+\\dfrac {(k-p-1)(k-p-2)}2\\right\\}\\\\\n&amp;=\\min\\left\\{f_{i-|k-pos_j|,j-1,p}-k\\cdot p+\\dfrac {p(p + 2)}2\\right\\}+\\dfrac {k^2-3k+2}2\n\\end{aligned}\n\\]</span></p>\n<p>å‘ç°è¿™ä¸ªå¼å­æ˜¯ <span class=\"math inline\">\\(O(n^5)\\)</span> çš„ï¼Œè€Œä¸”çœ‹èµ·æ¥å¾ˆæ–œä¼˜ï¼ŒåŒ–ä¸ºæ–œç‡å½¢å¼ <span class=\"math inline\">\\(\\dfrac{2\\times f_A-2\\times f_B+A(A+2)-B(B+2)}{2(A-B)}&lt;k\\)</span>ã€‚ç»´æŠ¤é€’å¢æ–œç‡å°±å¯ä»¥ <span class=\"math inline\">\\(O(n^4)\\)</span> åšäº†ã€‚</p>\n<p>Tipï¼šå½“æ—¶å†™ç€å†™ç€æ„£ä½äº†ï¼Œæ¯”å¦‚è¿™ä¸ª <span class=\"math inline\">\\(i-|k-pos_j|\\)</span> ä¸æ˜¯ä¸€ç›´åœ¨åŠ¨å—ã€‚è§£å†³æ–¹æ¡ˆï¼ŸåŒæ—¶ç»´æŠ¤å¾ˆå¤šä¸ªé˜Ÿåˆ—å³å¯ã€‚</p>\n<details>\n<p>æ³¨æ„è¿˜è¦æŠŠæœ€åä¸€ä¸ª <span class=\"math inline\">\\(1\\)</span> ä¹‹åè¿ç»­ <span class=\"math inline\">\\(0\\)</span> çš„ä»£ä»·ç®—ä¸Šã€‚</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 1e9;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; a(n + 1);\n    std::vector&lt;long long&gt; pos(1);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i];\n        if (a[i] == 1)\n            pos.push_back(i);\n    &#125;\n    int m = n * (n - 1) / 2;\n    std::vector&lt;std::vector&lt;std::vector&lt;long long&gt; &gt; &gt; f(pos.size(), std::vector&lt;std::vector&lt;long long&gt; &gt; (m + 1, std::vector&lt;long long&gt; (n + 1, inf)));\n    f[0][0][0] = 0ll;\n    for (int j = 1; j &lt; (int)pos.size(); ++j) &#123;\n        std::vector&lt;std::vector&lt;int&gt; &gt; _q(m + 1, std::vector&lt;int&gt; (n + 1));\n        std::vector&lt;int&gt; _h(m + 1), _t(m + 1, -1);\n        for (int k = 0; k &lt;= n; ++k)\n            for (int i = m; i &gt;= 0; --i) &#123;\n                if (i &gt;= std::abs(k - pos[j])) &#123;\n                    auto f1 = [&amp;](long long A, long long B) &#123;\n                        return 2 * f[j - 1][i - std::abs(k - pos[j])][A] - 2 * f[j - 1][i - std::abs(k - pos[j])][B] + A * (A + 2) - B * (B + 2);\n                    &#125;;\n                    auto f2 = [&amp;](long long A, long long B) &#123;\n                        return 2 * (A - B);\n                    &#125;;\n                    auto &amp;h = _h[i - std::abs(k - pos[j])], &amp;t = _t[i - std::abs(k - pos[j])];\n                    auto &amp;q = _q[i - std::abs(k - pos[j])];\n                    for (; h &lt; t &amp;&amp; f1(q[h + 1], q[h]) &lt; k * f2(q[h + 1], q[h]); ++h) &#123;&#125;\n                    if (h &lt;= t)\n                        f[j][i][k] = std::min(inf, f[j - 1][i - std::abs(k - pos[j])][q[h]] + (k - q[h] - 1) * (k - q[h] - 2) / 2);\n                &#125;\n                auto f1 = [&amp;](long long A, long long B) &#123;\n                    return 2 * f[j - 1][i][A] - 2 * f[j - 1][i][B] + A * (A + 2) - B * (B + 2);\n                &#125;;\n                auto f2 = [&amp;](long long A, long long B) &#123;\n                    return 2 * (A - B);\n                &#125;;\n                auto &amp;h = _h[i], &amp;t = _t[i];\n                auto &amp;q = _q[i];\n                for (; h &lt; t &amp;&amp; f1(k, q[t]) * f2(q[t], q[t - 1]) &lt; f1(q[t], q[t - 1]) * f2(k, q[t]); --t);\n                q[++t] = k;\n            &#125;\n    &#125;\n    auto res(-inf);\n    int cnt = n - (int)pos.size() + 1;\n    cnt = cnt * (cnt - 1) / 2;\n    for (int i = 0; i &lt;= m; ++i) &#123;\n        for (int k = 0; k &lt;= n; ++k)\n            res = std::max(res, cnt - f.back()[i][k] - (n - k) * (n - k - 1) / 2);\n        std::cout &lt;&lt; res &lt;&lt; &#39; &#39;;\n    &#125;\n    std::cout &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"a---yakiniku-restaurants\">A - Yakiniku Restaurants</h2>\n<p><a href=\"https://atcoder.jp/contests/arc067/tasks/arc067_d\" class=\"uri\">https://atcoder.jp/contests/arc067/tasks/arc067_d</a></p>\n<p>å‘ç°å›ºå®šå·¦å³ç«¯ç‚¹åï¼Œæ”¶ç›Šæ˜¯å¯ä»¥è´ªå¿ƒç®—çš„ï¼›ä¸‹æ„è¯†æƒ³åˆ°åªå›ºå®šå·¦ç«¯ç‚¹ï¼Œé‚£ä¹ˆå³ç«¯ç‚¹åº”è¯¥å°±å¯ä»¥ç”¨å•è°ƒé˜Ÿåˆ—ä¹‹ç±»çš„æä¸€æã€‚</p>\n<p>å…ˆæå‰æŠŠæ‰€æœ‰ä¸œè¥¿å¡åˆ°é˜Ÿåˆ—é‡Œã€‚å·¦ç«¯ç‚¹ä¸€å¼€å§‹åœ¨æœ€å³è¾¹ï¼›å¾€å·¦è¾¹åŠ¨ä¸€ä¸‹ä¹‹åï¼Œå°±å¯ä»¥æ›´æ–°æ¯ç§èœçš„é˜Ÿåˆ—ï¼›å‘ç°åœ¨æ‰€æœ‰å…ƒç´ ä¸­ä½œå†³ç­–ç‚¹çš„ä¸æ€»æ˜¯é˜Ÿå¤´ï¼›è¿™ä¸ªåœ°æ–¹ç”¨ <strong>å•è°ƒé€’å‡çš„å•è°ƒæ ˆ</strong> æ˜¯æå¥½çš„ã€‚è¿™é‡Œçš„å•è°ƒæ ˆå…¶å®å°±ç±»ä¼¼ <a href=\"/20250707-1/#ä¼˜åŒ–-dpå•è°ƒæ•°æ®ç»“æ„\">å››è¾¹å½¢ä¸ç­‰å¼ä¸­çš„å•è°ƒæ•°æ®ç»“æ„</a> äº†ã€‚</p>\n<p>ç»´æŠ¤å•è°ƒæ ˆä¸­æ¯ä¸ªå†³ç­–ç‚¹çš„å½±å“åŒºé—´ï¼›æ˜¾ç„¶æ¯ä¸ªå³ç«¯ç‚¹çš„ç­”æ¡ˆå˜åŒ–é‡ç›¸åŒï¼›ç”¨ä¸ªç±»ä¼¼äºå·®åˆ†çš„ä¸œè¥¿è®°å½•ä¸€ä¸‹å°±å¥½äº†ã€‚</p>\n<p>å¤æ‚åº¦ <span class=\"math inline\">\\(O(n^2)\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 1e18;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;long long&gt; s(n + 1), f(n + 1);\n    for (int i = 2; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; s[i], s[i] += s[i - 1];\n        f[i] = -s[i];\n    &#125;\n    std::vector&lt;std::vector&lt;int&gt; &gt; a(n + 1, std::vector&lt;int&gt; (m + 1));\n    for (int i = 1; i &lt;= n; ++i)\n        for (int j = 1; j &lt;= m; ++j)\n            std::cin &gt;&gt; a[i][j];\n    struct node &#123; int j, l, r; &#125;;\n    std::vector&lt;std::stack&lt;node&gt; &gt; _q(m + 1);\n    auto res(-inf);\n    for (int l = n; l; --l) &#123;\n        std::vector&lt;long long&gt; d(n + 1);\n        auto add = [&amp;](int l, int r, long long v) &#123;\n            d[l] += v;\n            if (r != n)\n                d[r + 1] -= v;\n            return;\n        &#125;;\n        for (int j = 1; j &lt;= m; ++j) &#123;\n            auto &amp;q = _q[j];\n            node now = &#123; j, l, l &#125;;\n            add(l, l, a[l][j]);\n            for (; !q.empty() &amp;&amp; a[l][j] &gt;= a[q.top().l][q.top().j]; q.pop()) &#123;\n                now.r = q.top().r;\n                add(q.top().l, q.top().r, a[l][j] - a[q.top().l][q.top().j]);\n            &#125;\n            q.push(now);\n        &#125;\n        std::partial_sum(d.begin() + 1, d.end(), d.begin() + 1);\n        for (int r = l; r &lt;= n; ++r) &#123;\n            f[r] += d[r];\n            res = std::max(res, f[r] + s[l]);\n        &#125;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b---jellyfish-and-miku\">B - Jellyfish and Miku</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1874/D\" class=\"uri\">https://codeforces.com/problemset/problem/1874/D</a></p>\n<p>å”‰æ•°åˆ—ã€‚å”‰æ¦‚ç»Ÿã€‚åœ¨æ•°å­¦è®²ä¹‰ä¸ŠæŠ˜ç£¨äº†æˆ‘ä¸€éä¹‹åè¿˜è¦åˆ°è¿™å„¿æ¥æŠ˜ç£¨æˆ‘ã€‚</p>\n<p>å‡è®¾å·²ç»çŸ¥é“äº† <span class=\"math inline\">\\(a\\)</span>ï¼Œè€ƒè™‘æ±‚æœŸæœ›æ­¥æ•°ã€‚è®¾ <span class=\"math inline\">\\(E_i\\)</span> ä¸ºä» <span class=\"math inline\">\\(i\\)</span> å‡ºå‘èµ°åˆ° <span class=\"math inline\">\\(n\\)</span> çš„æœŸæœ›æ­¥æ•°ã€‚é‚£ä¹ˆæœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\nE_i=\\begin{cases}\nE_1+1&amp;i=0\\\\\n0&amp;i=n\\\\\nE_i=(E_{i-1}+1)\\cdot \\dfrac {a_i}{a_{i+1}+a_i}+(E_{i+1}+1)\\cdot \\dfrac {a_{i+1}}{a_{i+1}+a_{i}}&amp;\\text{otherwise}\n\\end{cases}\n\\]</span></p>\n<p>ï¼ˆæç¤ºï¼šä»ã€<span class=\"math inline\">\\(i\\)</span> ä¸‹ä¸€æ­¥ä¼šèµ°å“ªä¸ªæ–¹å‘ã€è€ƒè™‘ã€‚ï¼‰</p>\n<p>æ¥ä¸‹æ¥å°±å¯ä»¥åˆ©ç”¨ä½ çš„é«˜ä¸­æ•°å­¦çŸ¥è¯†è¿›è¡Œä¸€ä¸ª <span class=\"math inline\">\\(f_0\\)</span> çš„æ±‚ï¼Œï¼ˆä¸€å †è¿‡ç¨‹ï¼‰ï¼Œå¾—åˆ° <span class=\"math inline\">\\(E_0=n+2\\times \\sum\\limits_{i=1}^n\\dfrac {\\sum_{j\\le i}a_j}{a_i}\\)</span>ï¼Œç„¶åæƒ³è¦æœ€å°åŒ–è¿™ä¸ªä¸œè¥¿ã€‚</p>\n<p>ä¸å¦¨ä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºåˆ° <span class=\"math inline\">\\(i\\)</span> æ—¶å·²ç»åˆ†é…èµ°äº† <span class=\"math inline\">\\(j\\)</span> ä½“ç§¯ï¼Œ<span class=\"math inline\">\\(\\sum_{k=1}^i \\dfrac {\\sum_{l\\le k}a_l}{a_k}\\)</span> çš„æœ€å°å€¼ï¼Œæœ‰ <span class=\"math inline\">\\(f_{i,j}=\\min\\limits_{k&lt;j}\\left\\{f_{i-1,k}+\\dfrac {k}{j - k}\\right\\}\\)</span>ã€‚å‘ç°å®ƒå¤§æŠµæ˜¯æ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼çš„ï¼ŒæŒ‰ç…§ <a href=\"/20250707-1/#d1d-dp-ä¼˜åŒ–\">2D/1D DP ä¼˜åŒ–çš„ç»“è®º</a>ï¼Œä»£å…¥ <span class=\"math inline\">\\(p_{i,j-1}&lt;p_{i,j}&lt;p_{i+1,j}\\)</span> å¯ä»¥ <span class=\"math inline\">\\(O(nm)\\)</span> è§£å†³é—®é¢˜ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;std::vector&lt;int&gt; &gt; p(n + 1, std::vector&lt;int&gt; (m + 1));\n    std::vector&lt;std::vector&lt;long double&gt; &gt; f(n + 1, std::vector&lt;long double&gt; (m + 1, 1e18));\n    f[0][0] = 0ll;\n    for (int j = 1; j &lt;= m; ++j)\n        for (int i = std::min(j, n); i; --i) &#123;\n            int to = ((i == std::min(j, n)) ? j : std::min(p[i + 1][j], j));\n            for (int k = p[i][j - 1]; k &lt;= to; ++k)\n                if (f[i - 1][k] + k * 1. / (j - k) &lt; f[i][j])\n                    f[i][j] = f[i - 1][k] + k * 1. / (j - k), p[i][j] = k;\n            // printf(&quot;f[%d][%d] = %Lf, p = %d\\n&quot;, i, j, f[i][j], p[i][j]);\n        &#125;\n    std::cout &lt;&lt; std::fixed &lt;&lt; std::setprecision(10) &lt;&lt; n + 2 * f[n][m] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"cut-the-sequence\">Cut the Sequence</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P10977\" class=\"uri\">https://www.luogu.com.cn/problem/P10977</a></p>\n<h1 id=\"é€šçŸ¥åŒºé—´æœ€å€¼-ä¸æ»¡è¶³-å››è¾¹å½¢ä¸ç­‰å¼\"><mark>é€šçŸ¥ï¼šåŒºé—´æœ€å€¼ ä¸æ»¡è¶³ å››è¾¹å½¢ä¸ç­‰å¼ã€‚</mark></h1>\n<p>å…¶å®åœ¨çŒœçš„æ—¶å€™æ˜¯ä¸¾äº†åä¾‹çš„ï¼Œä½†æ˜¯å¤§è„‘èç¼©äº†æ¨ç€æ¨ç€å¿˜è®°ç¬¦å·äº† ğŸ˜…</p>\n<p>çœ‹åˆ° <span class=\"math inline\">\\(f_i=\\min\\limits_{g(i)\\le j&lt;i}\\{f_j+\\max\\{a_{j+1\\sim i}\\}\\}\\)</span> è¿™ä¸ª <span class=\"math inline\">\\(j\\)</span> çš„èŒƒå›´å…¶å®æ˜¯æœ‰ç‚¹å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–çš„æ„Ÿè§‰çš„ï¼Œä½†è¿™ä¸ªæœ€å¤§å€¼ä¼ ç»Ÿçš„å•è°ƒé˜Ÿåˆ—ä¸æ˜¯å¾ˆå¯åšã€‚å¯ä»¥æ³¨æ„åˆ°æœ€å¤§å€¼è¿™ä¸€é¡¹æœ‰ç‚¹ <strong>å•è°ƒé˜Ÿåˆ—</strong> åç¼€æœ€å¤§å€¼çš„æ„Ÿè§‰ï¼ˆå®é™…ä¸Šå°±æ˜¯ï¼‰ï¼›ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯åˆ©ç”¨è¿™ä¸ªæœ€å¤§å€¼å½±å“çš„åŒºé—´ï¼Œç»´æŠ¤ <span class=\"math inline\">\\(f\\)</span> çš„çº¿æ®µæ ‘æ¥æš´åŠ›åšã€‚</p>\n<p>å¦ä¸€ä¸ªæ¯”è¾ƒç‰›çš„åšæ³•æ˜¯å‘ç°åŒä¸€ä¸ªä¸‹æ ‡çš„ <span class=\"math inline\">\\(f\\)</span> å’Œ <span class=\"math inline\">\\(a\\)</span> çš„å…³ç³»ã€‚é¦–å…ˆéœ€è¦æ³¨æ„åˆ° <span class=\"math inline\">\\(f\\)</span> å•è°ƒä¸é™ï¼›å¯¹äºåŒä¸€ä¸ª <span class=\"math inline\">\\(a\\)</span>ï¼Œèƒ½å–åˆ°çš„ <span class=\"math inline\">\\(f\\)</span> å°±æ˜¯æœ€é å‰çš„ï¼›ç»´æŠ¤ä¸€ä¸ª <span class=\"math inline\">\\(a\\)</span> çš„å•å‡é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå…±ç”¨åŒä¸€ä¸ª <span class=\"math inline\">\\(a\\)</span> çš„å°±æ˜¯ç›¸é‚»ä¸¤ä¸ªä¸‹æ ‡ä¹‹é—´çš„éƒ¨åˆ†ï¼Œå…¶æœ€ä¼˜å†³ç­–åœ¨èƒ½å–åˆ°çš„æœ€å‰ç«¯å–å¾—ï¼›éœ€è¦æ³¨æ„åˆ°é˜Ÿåˆ—é‡Œçš„è´¡çŒ®å¹¶ä¸å•è°ƒï¼Œéœ€è¦ç”¨ä¸€ä¸ª multiset æ¥å­˜å‚¨æ‰€æœ‰è´¡çŒ®å¹¶æŸ¥æ‰¾ã€æ›´æ–°ã€‚</p>\n<p>éœ€è¦æ³¨æ„å•è°ƒé˜Ÿåˆ—é‡ŒæŸä¸ªå…ƒç´  <span class=\"math inline\">\\(f_{q_i}\\)</span> ç»“åˆçš„å…¶å®æ˜¯ <span class=\"math inline\">\\(a_{q_{i+1}}\\)</span>ã€‚è¿˜éœ€è¦æ³¨æ„é˜Ÿå¤´çš„ç»´æŠ¤ï¼Œå¯èƒ½éœ€è¦ä¸€äº›å°å·§æ€ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;1.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;int&gt; a(n + 1);\n    std::vector&lt;long long&gt; s(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i], s[i] = s[i - 1] + a[i];\n    int h = 0, t = -1;\n    std::multiset&lt;long long&gt; st;\n    std::vector&lt;long long&gt; f(n + 1);\n    std::vector&lt;std::pair&lt;int, int&gt; &gt; q(n + 1);\n    q[++t] = &#123; 0, 0 &#125;, a[0] = 0x3f3f3f3f;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        for (; s[i] - s[q[h].second] &gt; m; ) &#123;\n            st.erase(st.find(f[q[h].second] + a[q[h + 1].first]));\n            if (++q[h].second &gt;= q[h + 1].first)\n                a[q[++h].first] = 0x3f3f3f3f;\n            else\n                st.insert(f[q[h].second] + a[q[h + 1].first]);\n        &#125;\n        for (; h &lt; t &amp;&amp; a[q[t].first] &lt;= a[i]; --t)\n            st.erase(st.find(f[q[t - 1].second] + a[q[t].first]));\n        st.insert(f[q[t].second] + a[i]), q[++t] = &#123; i, i &#125;;\n        f[i] = *st.begin();\n    &#125;\n    std::cout &lt;&lt; f[n] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n",
            "tags": [
                "æ–œç‡ä¼˜åŒ–",
                "DP",
                "å››è¾¹å½¢ä¸ç­‰å¼"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250712/",
            "url": "https://xsc062.netlify.app/20250712/",
            "title": "æ‚é¢˜é€‰è°ˆ",
            "date_published": "2025-07-12T07:36:52.000Z",
            "content_html": "<p>æˆ‘ç”Ÿå¾…æ˜æ—¥ï¼Œä¸‡äº‹æˆè¹‰è·ã€‚</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"town\">town</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6407/problem/1\" class=\"uri\">https://www.becoder.com.cn/contest/6407/problem/1</a></p>\n<blockquote>\n<p>ç»™å®šä¸€æ£µå¤§å°ä¸º <span class=\"math inline\">\\(n\\)</span> çš„æ ‘ï¼Œç‚¹æœ‰ç‚¹æƒï¼Œæ¬²å°†æ ‘åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªè¿é€šå—ï¼Œä½¿å¾—æ¯ä¸ªå—å†…çš„ç‚¹æƒå¼‚æˆ–å’Œéƒ½ä¸º <span class=\"math inline\">\\(x\\)</span>ï¼Œæ±‚æ–¹æ¡ˆæ•°ï¼Œæ¨¡ <span class=\"math inline\">\\(998244353\\)</span>ã€‚</p>\n<p><span class=\"math inline\">\\(n\\le 10^6,0\\le x\\le 10^9\\)</span>ã€‚</p>\n</blockquote>\n<p>è®° <span class=\"math inline\">\\(u\\)</span> å¼•å¯¼çš„å­æ ‘å¼‚æˆ–å’Œä¸º <span class=\"math inline\">\\(s_u\\)</span>ã€‚æŠŠè¿é€šå—è½¬åŒ–ä¸ºå¯¹æ–­è¾¹çš„è®¨è®ºã€‚è€ƒå¯Ÿä¸€æ¡æœ€æœ«ç«¯çš„è¾¹ï¼Œå…¶ä¸‹æ–¹å­æ ‘çš„å¼‚æˆ–å’Œä¸€å®šä¸º <span class=\"math inline\">\\(x\\)</span>ã€‚</p>\n<p>ç®€å•æ•°å½’å¯å¾—æ–­æ‰çš„æ¯ä¸€æ¡è¾¹ï¼Œå…¶ä¸‹æ–¹å­æ ‘å¼‚æˆ–å’Œä¸º <span class=\"math inline\">\\(x\\)</span> æˆ– <span class=\"math inline\">\\(0\\)</span>ï¼ˆé‚£ä¹ˆæ˜¾ç„¶æœ‰è§£çš„å……è¦æ¡ä»¶æ˜¯ <span class=\"math inline\">\\(s_1=0\\lor s_1=x\\)</span>ï¼‰ã€‚è€ƒè™‘æ ‘å½¢ DPï¼Œä»¤ <span class=\"math inline\">\\(f_{u,0/1}\\)</span> è¡¨ç¤ºå½“å‰ DP åˆ° <span class=\"math inline\">\\(u\\)</span> å­æ ‘å¤´ä¸Šé‚£æ¡è¾¹ï¼Œå®ƒè¿æ¥äº†ä¸€ä¸ªå¼‚æˆ–å’Œä¸º <span class=\"math inline\">\\(s_u\\)</span> ï¼ˆæˆ– <span class=\"math inline\">\\(s_u\\oplus x\\)</span>ï¼‰çš„è¿é€šå—çš„åˆæ³•æ–¹æ¡ˆæ•°ï¼Œåˆ†åˆ«ä»£è¡¨å·²ç»ã€æ–­ã€æ‰äº†å¶æ•° / å¥‡æ•°ä¸ªåˆæ³•è¿é€šå—ã€‚</p>\n<p>é¦–å…ˆè‡ªç„¶å¯ä»¥ä¸€æ¡è¾¹éƒ½ä¸æ–­ï¼Œ<span class=\"math inline\">\\(f_{u,0}=1\\)</span>ã€‚é‚£ä¹ˆæ›´æ–°å°±åº”ä¸ºï¼š</p>\n<p><span class=\"math display\">\\[\nf&#39;_{u,0}=f_{u,0}\\cdot f_{v,0}+f_{u,1}\\cdot f_{v,1}\\\\\nf&#39;_{u,1}=f_{u,0}\\cdot f_{v,1}+f_{u,1}\\cdot f_{v,0}\n\\]</span></p>\n<p>æ¥ç€ï¼Œå¦‚æœ <span class=\"math inline\">\\(s_u\\)</span> æ°å¥½ä¸º <span class=\"math inline\">\\(0\\)</span> æˆ– <span class=\"math inline\">\\(x\\)</span>ï¼Œè¿™æ¡è¾¹è¿æ¥çš„è¿é€šå—çš„å¼‚æˆ–å’Œå°±å¯ä»¥æ˜¯ <span class=\"math inline\">\\(x\\)</span>ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨è¿™æ¡è¾¹å¤„æ–­å¼€ï¼Œæä¾›ä¸€ä¸ªç©ºè¿é€šå—ï¼ˆåŠ å…¥å¼‚æˆ–å’Œä¸º <span class=\"math inline\">\\(0\\)</span> çš„æ–¹æ¡ˆï¼‰ã€‚</p>\n<p>æœ€åæ³¨æ„ <span class=\"math inline\">\\(x\\)</span> å¯èƒ½ä¸º <span class=\"math inline\">\\(0\\)</span>ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†â€”â€”æ¯ä¸ª <span class=\"math inline\">\\(s_u=0\\)</span> å¤„éƒ½å¯ä»¥æ–­å¼€ã€‚</p>\n<p>è¿™ä¸ª DP çŠ¶æ€å®åœ¨éå¸¸æ–°å¥‡ï¼›åŒæ—¶ DP å’Œåˆ è¾¹åˆæ˜¯åˆ†å¼€çš„ï¼Œæ˜¾å¾—éå¸¸å‰²è£‚ã€‚çœ‹ solã€å¬ grisses è®²è§£çš„æ—¶å€™éƒ½å®Œå…¨ä¸€å¤´é›¾æ°´ã€‚quack è¯´è¿™æ˜¯å› ä¸ºæˆ‘æ²¡åšè¿‡è¿é€šå— DP /ll</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;ex_town1.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;int&gt; a(n + 1), s(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1);\n    for (int i = 1, x, y; i &lt; n; ++i) &#123;\n        std::cin &gt;&gt; x &gt;&gt; y;\n        g[x].push_back(y), g[y].push_back(x);\n    &#125;\n    std::function&lt;void(int, int)&gt; DFS = [&amp;](int x, int fa) &#123;\n        s[x] = a[x];\n        for (auto i : g[x])\n            if (i != fa) &#123;\n                DFS(i, x);\n                s[x] ^= s[i];\n            &#125;\n        return;\n    &#125;;\n    DFS(1, -1);\n    if (s[1] != 0 &amp;&amp; s[1] != m) &#123;\n        std::cout &lt;&lt; 0 &lt;&lt; &#39;\\n&#39;;\n        return 0;\n    &#125;\n    if (m == 0) &#123;\n        auto res(1ll);\n        for (int i = 2; i &lt;= n; ++i)\n            if (s[i] == 0)\n                (res *= 2) %= mod;\n        std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    else &#123;\n        std::vector&lt;std::array&lt;long long, 2&gt; &gt; f(n + 1);\n        DFS = [&amp;](int x, int fa) &#123;\n            f[x][0] = 1ll;\n            for (auto i : g[x])\n                if (i != fa) &#123;\n                    DFS(i, x);\n                    std::tie(f[x][0], f[x][1]) = std::make_tuple((f[x][0] * f[i][0] + f[x][1] * f[i][1]) % mod, (f[x][0] * f[i][1] + f[x][1] * f[i][0]) % mod);\n                &#125;\n            if (x != 1) &#123;\n                if (s[x] == m)\n                    (f[x][1] += f[x][0]) %= mod;\n                if (s[x] == 0)\n                    (f[x][0] += f[x][1]) %= mod;\n            &#125;\n            // printf(&quot;f[%d][0] = %lld, f[%d][1] = %lld\\n&quot;, x, f[x][0], x, f[x][1]);\n            return;\n        &#125;;\n        DFS(1, -1);\n        std::cout &lt;&lt; (s[1] == m ? f[1][0] : f[1][1]) &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"perm\">perm</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6407/problem/3\" class=\"uri\">https://www.becoder.com.cn/contest/6407/problem/3</a></p>\n<blockquote>\n<p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º <span class=\"math inline\">\\(n\\)</span>ã€å…ƒç´ ä¸¤ä¸¤ä¸åŒçš„åºåˆ—ï¼Œä½ å¯ä»¥äº¤æ¢ä»»æ„ä¸¤ä¸ªå…ƒç´ ã€‚è¯•ä½¿ç”¨æœ€å°‘äº¤æ¢æ¬¡æ•°ä½¿å¾—åºåˆ—æœ‰åºï¼Œé—®æ–¹æ¡ˆæ•°ã€‚</p>\n<p><span class=\"math inline\">\\(n\\le 10^6\\)</span>ã€‚</p>\n</blockquote>\n<p>å¯¹äºä¸€ä¸ªä¸‹æ ‡ï¼Œå°†å®ƒå’Œå®ƒä¸Šé¢å…ƒç´ çš„ rank è¿æœ‰å‘è¾¹ï¼Œé‚£ä¹ˆæ¯ä¸ªä¸‹æ ‡çš„å‡ºã€å…¥åº¦éƒ½ä¸º <span class=\"math inline\">\\(1\\)</span>ï¼Œåˆ™å›¾ç”±è‹¥å¹²ä¸ªç®€å•ç¯ç»„æˆã€‚</p>\n<p>æ¥ç€ï¼Œè€ƒè™‘ä¸€æ¬¡ä»»æ„ä¸€æ¬¡äº¤æ¢ <span class=\"math inline\">\\((x,y)\\)</span> çš„æ“ä½œä¼šå¸¦æ¥ä»€ä¹ˆï¼š</p>\n<ul>\n<li><p>è‹¥ <span class=\"math inline\">\\(x,y\\)</span> ä¸åœ¨åŒä¸€ç¯ä¸Šï¼š</p>\nè¯¥æ“ä½œä½¿å¾— <span class=\"math inline\">\\(x,y\\)</span> æ‰€åœ¨çš„ç¯åˆä¸ºä¸€ä¸ªå¤§ç¯ã€‚</li>\n<li><p>è‹¥ <span class=\"math inline\">\\(x,y\\)</span> åœ¨åŒä¸€ç¯ä¸Šï¼š</p>\n<p>è¯¥æ“ä½œä½¿å¾—ç¯ä»¥ <span class=\"math inline\">\\(x,y\\)</span> ä¸ºåˆ†ç•Œçº¿è£‚æˆä¸¤ä¸ªå°ç¯ã€‚</p></li>\n</ul>\n<p>ä»¥å¾—åˆ° <span class=\"math inline\">\\(n\\)</span> ä¸ªè‡ªç¯ä¸ºç›®æ ‡ï¼Œæ•°å½’å¾—åˆ°ï¼Œå¯¹äºæœ€ä¼˜æ–¹æ¡ˆï¼Œå½“ä¸”ä»…å½“æ¯æ¬¡äº¤æ¢çš„ç›®æ ‡éƒ½åœ¨åŒä¸€ç¯ä¸Šã€‚</p>\n<p>è€ƒè™‘æ–¹æ¡ˆæ•°ã€‚æŠŠä¸€ä¸ªå¤§å°ä¸º <span class=\"math inline\">\\(k\\)</span> çš„ç¯ï¼Œæ¬²å°†å…¶æ‹†æˆ <span class=\"math inline\">\\(k\\)</span> ä¸ªè‡ªç¯ï¼Œå…±éœ€ <span class=\"math inline\">\\(k-1\\)</span> æ¬¡ <em>æœ‰åº</em> çš„æ‹†è§£ã€‚</p>\n<p>è€ƒè™‘ DPï¼Œä»¤ <span class=\"math inline\">\\(f_k\\)</span> ä¸ºæ–¹æ¡ˆæ•°ï¼Œé‚£ä¹ˆ <span class=\"math inline\">\\(f_k=\\dfrac {k\\sum\\limits_{j=1}^{k-1} f_j\\cdot f_{k-j}\\cdot C_{k-2}^j}2\\)</span>ã€‚å°è¯•æ‰“è¡¨ï¼Œï¼ˆæƒŠè®¶åœ°ï¼‰å‘ç° <span class=\"math inline\">\\(f_k=k^{k-2}\\)</span>ã€‚</p>\n<p>ä¸åŒçš„ç¯ä¹‹é—´çš„æ“ä½œå¯ä»¥äº¤é”™ï¼Œçœ‹ä½œå¤šé‡é›†æ’åˆ—å³å¯ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; a(n + 1), p(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i], p[i] = i;\n    std::sort(p.begin() + 1, p.end(), [&amp;](int i, int j) &#123; return a[i] &lt; a[j]; &#125;);\n    std::vector&lt;int&gt; f(n + 1), siz(n + 1, 1);\n    std::iota(f.begin() + 1, f.end(), 1);\n    std::function&lt;int(int)&gt; find = [&amp;](int x) &#123;\n        return x == f[x] ? x : f[x] = find(f[x]);\n    &#125;;\n    auto merge = [&amp;](int x, int y) &#123;\n        x = find(x), y = find(y);\n        if (x != y)\n            siz[y] += siz[x], f[x] = y;\n        return;\n    &#125;;\n    for (int i = 1; i &lt;= n; ++i)\n        merge(i, p[i]);\n    std::vector&lt;long long&gt; g(n + 1), fac(n + 1), inv(n + 1);\n    g[1] = g[2] = 1ll, fac[0] = inv[0] = 1ll;\n    for (int i = 1; i &lt;= n; ++i)\n        fac[i] = fac[i - 1] * i % mod;\n    auto qkp = [&amp;](long long x, int y) &#123;\n        auto res(1ll);\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    inv[n] = qkp(fac[n], mod - 2);\n    for (int i = n - 1; i; --i)\n        inv[i] = inv[i + 1] * (i + 1) % mod;\n    for (int i = 3; i &lt;= n; ++i)\n        g[i] = qkp(i, i - 2);\n    int cnt(0);\n    auto res(1ll);\n    for (int i = 1; i &lt;= n; ++i)\n        if (f[i] == i) &#123;\n            cnt += siz[i] - 1;\n            (res *= g[siz[i]]) %= mod;\n            (res *= inv[siz[i] - 1]) %= mod;\n        &#125;\n    (res *= fac[cnt]) %= mod;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"cf2122d-traffic-lights\">CF2122D Traffic Lights</h2>\n<p><a href=\"https://codeforces.com/contest/2122/problem/D\" class=\"uri\">https://codeforces.com/contest/2122/problem/D</a></p>\n<blockquote>\n<p>ç»™ä½ ä¸€ä¸ªç”± <span class=\"math inline\">\\(n\\)</span> ä¸ªé¡¶ç‚¹å’Œ <span class=\"math inline\">\\(m\\)</span> æ¡è¾¹ç»„æˆçš„ç®€å•æ— å‘è¿é€šå›¾ã€‚åœ¨é¡¶ç‚¹ <span class=\"math inline\">\\(1\\)</span> æœ‰ä¸€ä¸ªæ ‡è®°ã€‚è®¤ä¸ºåˆå§‹æ—¶é—´ä¸º <span class=\"math inline\">\\(t=0\\)</span>ï¼Œåœ¨ <span class=\"math inline\">\\(t\\)</span> ç§’åï¼Œå¦‚æœæ ‡è®°ä½äºç‚¹ <span class=\"math inline\">\\(u\\)</span> ï¼Œåˆ™å¿…é¡»æ‰§è¡Œä»¥ä¸‹æ“ä½œä¹‹ä¸€ï¼š</p>\n<ul>\n<li>ç­‰å¾…ä¸€ç§’ã€‚</li>\n<li>å°†æ ‡è®°æ²¿ <span class=\"math inline\">\\(u\\)</span> çš„ç¬¬ <span class=\"math inline\">\\((t \\bmod \\mathrm{deg}(u) + 1)\\)</span> æ¡è¾¹ç§»åŠ¨ï¼ŒèŠ±è´¹ä¸€ç§’ã€‚</li>\n</ul>\n<p>è®¡ç®—å°†æ ‡è®°ä»é¡¶ç‚¹ <span class=\"math inline\">\\(1\\)</span> ç§»åˆ°é¡¶ç‚¹ <span class=\"math inline\">\\(n\\)</span> æ‰€éœ€çš„æœ€çŸ­æ—¶é—´ï¼Œä»¥åŠåœ¨ä½¿æ€»æ—¶é—´æœ€å°åŒ–çš„åŒæ—¶æ‰€èƒ½è¾¾åˆ°çš„æœ€çŸ­ç­‰å¾…æ—¶é—´ã€‚<span class=\"math inline\">\\(m\\le 5\\times 10^5\\)</span>ã€‚</p>\n</blockquote>\n<p>èƒ½å¤Ÿå‘ç°è¿™æ˜¯ä¸€ä¸ªè¾¹æƒå’Œ dis æœ‰å…³çš„æœ€çŸ­è·¯ï¼Œæœ¬ç€åˆ†å±‚å›¾ä¸€ç±»çš„æƒ³æ³•ï¼Œè€ƒå¯Ÿç­”æ¡ˆçš„æœ€å€¼ã€‚å‘ç°ä¸€ä¸ªå¾ˆæ¾çš„ä¸Šç•Œæ˜¯ <span class=\"math inline\">\\(O(m)\\)</span>ï¼›å‘ç°å®é™…æƒ…å†µä¼šæ¯”è¿™ä¸ªä¹è§‚å¾—å¤šï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šè€ƒè™‘ç”¨ä¸€äº›æš´åŠ›åšæ³•è‰è¿‡å»äº†ã€‚</p>\n<p>å®é™…ä¸Šæœ‰ä¸€ä¸ªä¸Šç•Œæ˜¯ <span class=\"math inline\">\\(3n\\)</span>ï¼šå–ä¸€æ¡æœ€çŸ­è·¯ï¼Œåˆ™ä¸å­˜åœ¨è·¯å¾„å¤–çš„ç‚¹ï¼Œä¸è·¯å¾„ä¸Šè‡³å°‘å››ä¸ªç‚¹æœ‰è¿è¾¹ï¼Œå¦åˆ™å¯ä»¥æ›´æ–°æœ€çŸ­è·¯ã€‚è®¾æœ€çŸ­è·¯é•¿ <span class=\"math inline\">\\(k\\)</span>ï¼Œè®©æ¯æ¬¡ç­‰å¾…æ—¶é—´å–æ»¡ï¼Œè€ƒå¯Ÿç­”æ¡ˆå‘ç°ä¸º <span class=\"math inline\">\\(2k\\)</span>ï¼ˆè·¯å¾„ä¸Šç‚¹ä¹‹é—´ï¼‰ã€<span class=\"math inline\">\\(3(n-k)\\)</span>ï¼ˆè·¯å¾„ä¸Šä¸è·¯å¾„å¤–ï¼‰ï¼Œå…±ä¸º <span class=\"math inline\">\\(\\le 3n\\)</span>ã€‚è¿˜æœ‰ä¸€ä¸ªä¸Šç¡®ç•Œæ˜¯ <span class=\"math inline\">\\(2n-3\\)</span>ï¼Œå¯ä»¥æ¬£èµä¸€ä¸‹ <a href=\"https://codeforces.com/blog/entry/144876?#comment-1295568\" class=\"uri\">https://codeforces.com/blog/entry/144876?#comment-1295568</a>ï¼Œæˆ‘æ²¡çœ‹æ‡‚ ğŸ˜°</p>\n<p>æ€»ä¹‹å¯ä»¥çŒœåˆ°æš´åŠ› dij ä¸Š DP å¾—åˆ°â€¦â€¦ å•Šé¢˜è§£æ€ä¹ˆè¯´æ˜¯ <span class=\"math inline\">\\(O(n^2+m)\\)</span> çš„ã€‚åŸå› æ˜¯æ±‚å¾—ç­”æ¡ˆä¸Šç•Œä¹‹åå°±èƒ½æš´åŠ›æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹äº† ğŸ˜…</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int inf = 0x3f3f3f3f;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int T;\n    for (std::cin &gt;&gt; T; T--; ) &#123;\n        int n, m;\n        std::cin &gt;&gt; n &gt;&gt; m;\n        std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1);\n        for (int x, y; m--; ) &#123;\n            std::cin &gt;&gt; x &gt;&gt; y;\n            g[x].push_back(y), g[y].push_back(x);\n        &#125;\n        std::vector&lt;std::vector&lt;int&gt; &gt; dis(2, std::vector&lt;int&gt; (n + 1, inf));\n        dis[1][1] = 0;\n        for (int t = 0; ; ++t) &#123;\n            auto &amp;d = dis[t &amp; 1], &amp;la = dis[(t &amp; 1) ^ 1];\n            std::vector&lt;int&gt; (n + 1, inf).swap(d);\n            for (int i = 1; i &lt;= n; ++i) &#123;\n                int to = t % ((int)g[i].size());\n                d[g[i][to]] = std::min(d[g[i][to]], la[i]);\n                d[i] = std::min(d[i], la[i] + 1);\n            &#125;\n            if (d[n] != inf) &#123;\n                std::cout &lt;&lt; t + 1 &lt;&lt; &#39; &#39; &lt;&lt; d[n] &lt;&lt; &#39;\\n&#39;;\n                break;\n            &#125;\n        &#125;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"arc202a-merge-and-increment\">ARC202A Merge and Increment</h2>\n<p><a href=\"https://atcoder.jp/contests/arc202/tasks/arc202_a\" class=\"uri\">https://atcoder.jp/contests/arc202/tasks/arc202_a</a></p>\n<p>å‡è®¾ç›¸é‚»å…ƒç´ å…¨éƒ¨ä¸åŒï¼Œè‡³å°‘åœ¨å½“å‰è¿™ä¸€æ­¥æœ‰ä¸€ä¸ªå¾ˆæ˜¾ç„¶çš„ç­–ç•¥ï¼ˆè®°ä¸º <em>ç­–ç•¥ä¸€</em>ï¼‰æ˜¯é€‰å…¨å±€æœ€å°å€¼ï¼ŒæŠŠå®ƒå’Œå®ƒå·¦è¾¹ã€å³è¾¹æ›´å°çš„ä¸€ä¸ª merge èµ·æ¥ã€‚</p>\n<p>æ³¨æ„åˆ°å¦‚æœå½“å‰å…¨å±€æœ€å°å€¼æœ‰ç›¸é‚»çš„å¶æ•°ä¸ªï¼Œå¯ä»¥æŠŠç›¸é‚»é¡¹åˆå¹¶ä¸€æ¬¡ï¼Œå¾—åˆ°é•¿åº¦å‡åŠçš„åŒºé—´ï¼Œä¸€å®šä¸åŠ£ï¼ˆè®°ä¸º <em>ç­–ç•¥äºŒ</em>ï¼‰ï¼›å‡å¦‚å½“å‰å…¨å±€æœ€å°å€¼å­˜åœ¨ç›¸é‚»çš„å¥‡æ•°ä¸ªï¼Œå¾ˆå®¹æ˜“æ³¨æ„åˆ°æœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼š</p>\n<ol type=\"1\">\n<li>é€‰å–å¶æ•°ä¸ªåº”ç”¨ç­–ç•¥äºŒï¼Œå‰©ä½™ä¸€ä¸ªåº”ç”¨ç­–ç•¥ä¸€ã€‚</li>\n<li>èŠ±ä¸€æ­¥ï¼Œè¡¥ä¸€ä¸ªå…¨å±€æœ€å°å€¼ï¼Œè½¬åŒ–ä¸ºç­–ç•¥äºŒã€‚</li>\n</ol>\n<p>å¾ˆå®¹æ˜“å‘ç°ç¬¬äºŒç§æ–¹å¼ä¸€å®šä¸åŠ£ ğŸ˜…ã€‚æ¨¡æ‹Ÿå³å¯ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int T;\n    for (std::cin &gt;&gt; T; T--; ) &#123;\n        int n;\n        std::cin &gt;&gt; n;\n        std::vector&lt;std::pair&lt;int, int&gt; &gt; a(1);\n        &#123;\n            for (int i = 1, x; i &lt;= n; ++i) &#123;\n                std::cin &gt;&gt; x;\n                if (x != a.back().first)\n                    a.emplace_back(x, 1);\n                else\n                    ++a.back().second;\n            &#125;\n            n = (int)a.size() - 1;\n        &#125;\n        std::vector&lt;int&gt; pre(n + 2), nex(n + 1), tag(n + 1);\n        std::priority_queue&lt;std::pair&lt;int, int&gt;, std::vector&lt;std::pair&lt;int, int&gt; &gt;, std::greater&lt;std::pair&lt;int, int&gt; &gt; &gt; q;\n        for (int i = 1; i &lt;= n; ++i) &#123;\n            q.emplace(a[i].first, i);\n            pre[i] = i - 1, nex[i] = i + 1;\n        &#125;\n        nex[0] = 1, pre[n + 1] = n;\n        auto del = [&amp;](int i) &#123;\n            tag[i] = 1;\n            pre[nex[i]] = pre[i], nex[pre[i]] = nex[i];\n            return;\n        &#125;;\n        auto res(0ll);\n        for (; (int)q.size() &gt; 1;) &#123;\n            auto [x, id] = q.top();\n            q.pop();\n            if (tag[id] || a[id].first != x)\n                continue;\n            if (a[id].second == 1) &#123;\n                if (!pre[id] || (nex[id] != n + 1 &amp;&amp; a[nex[id]].first &lt;= a[pre[id]].first))\n                    res += a[nex[id]].first - x, a[id].first = a[nex[id]].first;\n                else\n                    res += a[pre[id]].first - x, a[id].first = a[pre[id]].first;\n            &#125;\n            else &#123;\n                if (a[id].second &amp; 1)\n                    ++res, ++a[id].second;\n                ++a[id].first, a[id].second /= 2;\n            &#125;\n            if (pre[id] &amp;&amp; a[id].first == a[pre[id]].first)\n                a[id].second += a[pre[id]].second, del(pre[id]);\n            if (nex[id] != n + 1 &amp;&amp; a[id].first == a[nex[id]].first)\n                a[id].second += a[nex[id]].second, del(nex[id]);\n            q.emplace(a[id].first, id);\n        &#125;\n        &#123;\n            auto [x, id] = q.top();\n            for ( ; a[id].second != 1; ) &#123;\n                if (a[id].second &amp; 1)\n                    ++res, ++a[id].second;\n                ++a[id].first, a[id].second /= 2;\n            &#125;\n        &#125;\n        std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n",
            "tags": [
                "DP",
                "æ ‘å½¢ DP",
                "è´ªå¿ƒ"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250709/",
            "url": "https://xsc062.netlify.app/20250709/",
            "title": "æ‚é¢˜é€‰è°ˆï¼šDP å‡¸ä¼˜åŒ–",
            "date_published": "2025-07-09T13:59:41.000Z",
            "content_html": "<p>Stewartâ€™s theoremï¼šåœ¨çº¿æ®µ <span class=\"math inline\">\\(AB\\)</span> ä¸Šå–ä¸€ç‚¹ <span class=\"math inline\">\\(M\\)</span>ï¼Œä½¿å¾— <span class=\"math inline\">\\(\\vec{AB}=\\lambda \\vec{AM}\\)</span>ã€‚åœ¨ <span class=\"math inline\">\\(AB\\)</span> ä¸Šæ–¹ä»»å–ä¸€ç‚¹ <span class=\"math inline\">\\(P\\)</span>ï¼Œåˆ™æœ‰ <span class=\"math inline\">\\(PM^2=(1-\\lambda) PA^2+\\lambda PB^2-\\lambda(1-\\lambda) AB^2\\)</span>ã€‚</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"d.-akvizna\">D. Akvizna</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6393/problem/4\" class=\"uri\">https://www.becoder.com.cn/contest/6393/problem/4</a></p>\n<p>å…¶å®åˆ°è¿™é‡Œåº”è¯¥å‘ç°äº†ï¼ŒWQS çš„å¥–åŠ±éƒ½ä»¥ä¸€æ¬¡é¡¹ç³»æ•°å‡ºç°ï¼ŒåŸå› ä¹Ÿå¾ˆæ˜¾ç„¶ï¼Œå¥–åŠ±çš„å¯¹è±¡æ˜¯ä¸€æ¬¡é¡¹ç³»æ•°å˜›ã€‚æ­¤å¤–ï¼ŒWQS å†…å±‚ DP æ•°ç»„çš„ç»´åº¦éƒ½åº”å’Œæ“ä½œæ¬¡æ•°æ— å…³ï¼Œè€Œ DP å€¼åº”ä¸ºæœ€å¤§æ”¶ç›Šã€‚è¿™ä¸ªä¹Ÿå¾ˆæ˜¾ç„¶ã€‚</p>\n<p>ä»¤ä¸€è½®æ¯”èµ›çš„æƒ©ç½šæ˜¯ <span class=\"math inline\">\\(mid\\)</span> ç„¶åäºŒåˆ†ã€‚ä»¤ <span class=\"math inline\">\\(f_{j}\\)</span> è¡¨ç¤ºå‰©ä½™äººæ•°ä¸º <span class=\"math inline\">\\(j\\)</span> æ—¶çš„æœ€å¤§æ”¶ç›Šï¼Œé‚£ä¹ˆæœ‰ <span class=\"math inline\">\\(f_{j}=\\max\\limits_{k\\ge j}\\left\\{f_k+\\frac {k-j}k\\right\\}-mid\\)</span>ã€‚æœ€ååœ¨ <span class=\"math inline\">\\(f_0\\)</span> å¤„æ‰¾ç­”æ¡ˆå³å¯ã€‚</p>\n<p>ç„¶åå°±å‘ç°ä¸€ä¸ªå¾ˆå¯æ€•çš„é—®é¢˜ï¼Œå†…å±‚ DP å’‹å†™ã€‚å‘ç°æŠŠ <span class=\"math inline\">\\(\\frac {k-j}k\\)</span> æ”¹å†™æˆ <span class=\"math inline\">\\(1-\\frac jk\\)</span> åå‡ºç°äº¤å‰é¡¹ï¼Œè€ƒè™‘æ–œä¼˜ã€‚ä»¤ <span class=\"math inline\">\\(a&lt;b\\)</span>ï¼Œé‚£ä¹ˆ <span class=\"math inline\">\\(a\\)</span> ä¼˜äº <span class=\"math inline\">\\(b\\)</span> å½“ä¸”ä»…å½“ <span class=\"math inline\">\\(\\dfrac {f_a-f_b}{\\frac 1a - \\frac 1b} &gt; j\\)</span>ã€‚ç»´æŠ¤å•å‡çš„æ–œç‡å³å¯ã€‚</p>\n<details>\n<p>ç¬‘è¯ï¼šäºŒåˆ† 50 æ¬¡ä¸å¤Ÿï¼Œéœ€è¦ 60 æ¬¡ã€‚</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    double l = 0., r = 1e5, mid;\n    auto calc = [&amp;](double mid) &#123;\n        std::vector&lt;double&gt; f(n + 1, -1e18);\n        f[n] = 0.;\n        int h = 1, t = 0;\n        std::vector&lt;int&gt; q(n + 1), p(n + 1);\n        q[++t] = n;\n        // printf(&quot;mid = %.3lf: \\n&quot;, mid);\n        for (int i = n - 1; ~i; --i) &#123;\n            for (; h &lt; t &amp;&amp; (f[q[h + 1]] - f[q[h]]) / (1. / q[h + 1] - 1. / q[h]) &gt;= i; ++h);\n            f[i] = f[q[h]] + 1. - i * 1.0 / q[h] - mid, p[i] = p[q[h]] + 1;\n            // printf(&quot;  %d: f = %.3lf, p = %d, q[h] = %d(%.3lf / %d)\\n&quot;, i, f[i], p[i], q[h], f[q[h]], p[q[h]]);\n            if (i) &#123;\n                for (; h &lt; t &amp;&amp; (f[i] - f[q[t]]) / (1. / i - 1. / q[t]) &gt;= (f[q[t]] - f[q[t - 1]]) / (1. / q[t] - 1. / q[t - 1]); --t);\n                q[++t] = i;\n            &#125;\n        &#125;\n        // printf(&quot;res = %.3lf\\n&quot;, f[0] + p[0] * mid);\n        return std::make_pair(f[0], p[0]);\n    &#125;;\n    // calc(0.);\n    // return 0;\n    double res(0.);\n    for (int i = 1; i &lt;= 60; ++i) &#123;\n        mid = (l + r) / 2.;\n        auto t(calc(mid));\n        if (t.second &gt;= k)\n            l = mid, res = t.first + k * mid;\n        else\n            r = mid;\n    &#125;\n    std::cout &lt;&lt; std::fixed &lt;&lt; std::setprecision(8) &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"e.-poborcy-podatkowi\">E. Poborcy podatkowi</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6393/problem/5\" class=\"uri\">https://www.becoder.com.cn/contest/6393/problem/5</a></p>\n<p>é¦–å…ˆä»¤ <span class=\"math inline\">\\(f_{u,l}(i),l=0,1,2,3\\)</span> è¡¨ç¤ºåœ¨ <span class=\"math inline\">\\(u\\)</span> ä¸ŠæŒ‚äº†é•¿åº¦ä¸º <span class=\"math inline\">\\(l\\)</span> çš„åŠæ¡é“¾ï¼Œå…±æœ‰ <span class=\"math inline\">\\(i\\)</span> æ¡æ•´é“¾çš„æœ€å¤§æ”¶ç›Šã€‚</p>\n<p>å¯ä»¥è§‚å¯Ÿåˆ°æ˜¯å‡¸çš„ã€‚é‚£ä¹ˆä¸éš¾å‘ç°éœ€è¦é—µå¯å¤«æ–¯åŸºå’Œï¼Œè€ƒè™‘ <span class=\"math inline\">\\(u\\)</span> ä½ç½®ä¸Šçš„åˆå¹¶ã€‚<strong>é¦–å…ˆéœ€è¦æ³¨æ„åˆ°å„¿å­ä¸Šé•¿åº¦ä¸º <span class=\"math inline\">\\(l\\)</span> çš„é“¾åˆ°çˆ¶äº²ä¸Šä¼šå˜æˆ <span class=\"math inline\">\\(l+1\\)</span></strong>ã€‚æ˜¾ç„¶æ¯æ¡å¯ä»¥ä¸é€‰ï¼›å¦‚æœé€‰äº† <span class=\"math inline\">\\(cnt_a\\)</span> æ¡é•¿åº¦ä¸º <span class=\"math inline\">\\(a\\)</span> çš„åŠé“¾ï¼Œé‚£ä¹ˆåˆå¹¶å‡ºæ¥çš„ç»“æœæ˜¯ <span class=\"math inline\">\\(cnt_1-cnt_3\\)</span> æ¡é•¿åº¦ä¸º <span class=\"math inline\">\\(1\\)</span> æˆ– <span class=\"math inline\">\\(3\\)</span> çš„é“¾ã€<span class=\"math inline\">\\(cnt_2\\bmod 2\\)</span> æ¡é•¿åº¦ä¸º <span class=\"math inline\">\\(2\\)</span> çš„é“¾ï¼Œå¹¶ä¸”è¦æ±‚ä¸¤è€…ä¸åŒæ—¶å‡ºç°ã€‚å‘ç°è¿™ä¸ªä¸œè¥¿åŸºæœ¬ä¸Šå¤„ç†ä¸äº†ã€‚</p>\n<p>æ¥ç€æ³¨æ„åˆ°è¿™ä¸ªå½¢å¼æœ‰ç‚¹åƒèƒŒåŒ…ã€‚ä½†æ€ä¹ˆå¤„ç† <span class=\"math inline\">\\(cnt_1\\)</span> å’Œ <span class=\"math inline\">\\(cnt_3\\)</span> é…å¯¹çš„è¿™ä¸ªè¦æ±‚å‘¢ï¼Ÿæœ‰ä¸ªéå¸¸ç²¾å¦™çš„åœ¨ç‰©å“ä½“ç§¯ä¸Šåšæ–‡ç« çš„æ–¹æ³•ï¼š</p>\n<p>é¦–å…ˆæ³¨æ„åˆ°æˆ‘ä»¬æœ€åçš„æŸ¥è¯¢çš„ç­”æ¡ˆè‚¯å®šè¦æ±‚æŠŠæ‰€æœ‰å„¿å­ç”¨å®Œã€‚é‚£ä¹ˆä¸å¦¨è®¾ä½“ç§¯ä¹‹å’Œä¸ºå„¿å­æ€»æ•° <span class=\"math inline\">\\(tot\\)</span>ã€‚æ¥ç€ï¼Œå¯¹ <span class=\"math inline\">\\(cnt_0\\)</span>ï¼ˆåŒæ—¶ä¹Ÿæ˜¯ <span class=\"math inline\">\\(cnt_4\\)</span>ï¼‰æ²¡æœ‰é™åˆ¶ï¼Œç›´æ¥ä»¤å…¶ä½“ç§¯ä¸º <span class=\"math inline\">\\(1\\)</span>ã€‚<span class=\"math inline\">\\(cnt_2\\)</span> å•ç‹¬å¤„ç†ï¼ˆç­‰ä¼šå„¿ä¼šè¯´ï¼‰ï¼Œä¸ºäº†ä¸å¯¹ç°åœ¨çš„é—®é¢˜äº§ç”Ÿå½±å“ä¹Ÿä»¤å…¶ä½“ç§¯ä¸º <span class=\"math inline\">\\(1\\)</span>ã€‚å¯¹äº <span class=\"math inline\">\\(cnt_1\\)</span> å’Œ <span class=\"math inline\">\\(cnt_3\\)</span>ï¼Œæ˜¾ç„¶ä¸¤è€…å¹³å‡ä½“ç§¯éœ€è¦ä¸º <span class=\"math inline\">\\(1\\)</span>ï¼›ä½ å¯ä»¥ä»¤ <span class=\"math inline\">\\(cnt_3\\)</span> ä½“ç§¯ä¸º <span class=\"math inline\">\\(2\\)</span>ï¼Œä»¤ <span class=\"math inline\">\\(cnt_1\\)</span> ä½“ç§¯ä¸º <span class=\"math inline\">\\(0\\)</span>ã€‚</p>\n<p>æ¥ä¸‹æ¥å°±æœ‰ä¸ªå¾ˆå¥½çš„æ€§è´¨ï¼š<span class=\"math inline\">\\(cnt_1\\)</span> å¿…é¡»å’Œ <span class=\"math inline\">\\(cnt_3\\)</span> é…å¯¹æ‰èƒ½è®©å¹³å‡ä½“ç§¯ä¸º <span class=\"math inline\">\\(1\\)</span>ã€‚åœ¨ <span class=\"math inline\">\\(tot\\)</span> å¤„æŸ¥æ‰¾çš„ç­”æ¡ˆï¼Œç”± <span class=\"math inline\">\\(x\\)</span> ä¸ªä½“ç§¯ä¸ä¸º <span class=\"math inline\">\\(0\\)</span> çš„ç‰©å“å’Œ <span class=\"math inline\">\\(tot-x\\)</span> ä¸ªä½“ç§¯ä¸º <span class=\"math inline\">\\(0\\)</span> çš„ç‰©å“ï¼ˆ<span class=\"math inline\">\\(cnt_1\\)</span>ï¼‰ç»„æˆï¼ŒåŸå› æ˜¯èƒŒåŒ…ä¼šè´ªå¿ƒåœ°åœ¨æ‰€æœ‰ã€å‰©ä½™ã€çš„åˆ†ç»„ä¸­é€‰æ‹©ä½“ç§¯ä¸º <span class=\"math inline\">\\(0\\)</span> çš„ä¸€é¡¹ã€‚å†è®¡ç®—ä¸€ä¸‹ <span class=\"math inline\">\\(cnt_3\\)</span>ï¼Œå‘ç°æ˜¾ç„¶ä¸º <span class=\"math inline\">\\(tot-x\\)</span>ã€‚ç¬¦åˆç›®çš„ã€‚</p>\n<p>åœ¨ <span class=\"math inline\">\\(dp_{tot}\\)</span> å¤„æŸ¥æ‰¾å¯ä»¥æ‰¾åˆ° <span class=\"math inline\">\\(cnt_1=cnt_3\\)</span> æ—¶çš„ç­”æ¡ˆï¼›åŒç†ï¼Œåœ¨ <span class=\"math inline\">\\(dp_{tot-1},dp_{tot1+1}\\)</span> å¤„å¯ä»¥æŸ¥æ‰¾åˆ° <span class=\"math inline\">\\(cnt_1=cnt_3\\pm 1\\)</span> çš„ç­”æ¡ˆã€‚</p>\n<p>æ¥ä¸‹æ¥å†è€ƒè™‘ <span class=\"math inline\">\\(cnt_2\\)</span>ï¼Œè§£å†³ã€<span class=\"math inline\">\\(cnt\\bmod2=1\\)</span> å’Œ <span class=\"math inline\">\\(cnt_1\\ne cnt_3\\)</span> ä¸èƒ½åŒæ—¶æˆç«‹ã€çš„é™åˆ¶ã€‚é‚£å¤ªå¥½äº†ï¼Œç›´æ¥å¤šå¼€ä¸€ç»´è®°å½• <span class=\"math inline\">\\(cnt_2\\bmod 2\\)</span> å³å¯ã€‚</p>\n<p>å•Šå•Šå¤ªå¦™äº†ã€‚åƒåˆ©ç”¨ä½“ç§¯ä¸º <span class=\"math inline\">\\(-1,1\\)</span> çš„éšæœºæ•°æ®èƒŒåŒ…æœŸæœ›æœ€å¤§ä½“ç§¯ä¸è¶…è¿‡ <span class=\"math inline\">\\(\\sqrt V\\)</span> çš„é‚£ä¸ªæ–¹æ³•ï¼Œæ˜¾ç„¶å°±æ²¡æœ‰åŠæ³•åˆ©ç”¨å‡¸æ€§äº†ã€‚æ‰€ä»¥è¿™æˆ–è®¸æ˜¯é—µå¯å¤«æ–¯åŸºå’Œåšæ³•çš„å”¯ä¸€è§£ï¼Ÿ</p>\n<p>éœ€è¦çŸ¥é“ï¼Œå¦‚æœè®¾ <span class=\"math inline\">\\(cnt_1\\)</span> ä¸º <span class=\"math inline\">\\(2\\)</span> è€Œ <span class=\"math inline\">\\(cnt_3\\)</span> ä¸º <span class=\"math inline\">\\(0\\)</span>ï¼Œå§‹ç»ˆä¼šå‡ºä¸€äº›é—®é¢˜ã€‚è¿™ä¸ªæˆ‘å’Œ yly è®¨è®ºäº†ä¸€ä¸‹æ²¡å•¥ç»“æœã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 1e12;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;1.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;std::vector&lt;std::pair&lt;int, int&gt; &gt; &gt; g(n + 1);\n    for (int i = 1, x, y, w; i &lt; n; ++i) &#123;\n        std::cin &gt;&gt; x &gt;&gt; y &gt;&gt; w;\n        g[x].emplace_back(y, w), g[y].emplace_back(x, w);\n    &#125;\n    using arr = std::vector&lt;long long&gt;;\n    std::vector&lt;arr&gt; f(n + 1, arr(4));\n    struct node &#123;\n        std::vector&lt;arr&gt; f;\n        node(): f(2) &#123;&#125;\n        node(std::vector&lt;arr&gt; f1): f(f1) &#123;&#125;\n        arr&amp; operator[](int q) &#123;\n            return f[q];\n        &#125;\n    &#125;;\n    auto getmax = [&amp;](arr p, arr q) &#123;\n        arr res(p);\n        if (q.size() &gt; p.size())\n            res.resize(q.size());\n        for (int i = 0; i &lt; (int)q.size(); ++i)\n            res[i] = std::max(res[i], q[i]);\n        return res;\n    &#125;;\n    auto merge = [&amp;](arr &amp;p, arr &amp;q) &#123;\n        arr res(p.size() + q.size() - 1), dp(p.size()), dq(q.size());\n        std::adjacent_difference(p.begin(), p.end(), dp.begin());\n        std::adjacent_difference(q.begin(), q.end(), dq.begin());\n        std::merge(dp.begin() + 1, dp.end(), dq.begin() + 1, dq.end(), res.begin() + 1, std::greater&lt;long long&gt; ());\n        res[0] = p[0] + q[0];\n        std::partial_sum(res.begin(), res.end(), res.begin());\n        return res;\n    &#125;; \n    std::function&lt;void(int, int)&gt; DFS = [&amp;](int x, int fa) &#123;\n        if ((int)g[x].size() == 1 &amp;&amp; x != 1) &#123;\n            f[x][1] = f[x][2] = f[x][3] = -inf;\n            return;\n        &#125;\n        int tot = (int)g[x].size() - (x != 1);\n        std::vector&lt;arr&gt; w1(1), w2(1);\n        for (auto [i, w] : g[x])\n            if (i != fa) &#123;\n                DFS(i, x);\n                w1.push_back(&#123; f[i][0] + w, std::max(f[i][0], f[i][3] + w), f[i][2] + w &#125;);\n                w2.push_back(&#123; -inf, f[i][1] + w &#125;);\n            &#125;\n        auto fun = [&amp;](arr &amp;p, arr &amp;q) &#123;\n            arr res(p.size() + q.size() - 1, -inf);\n            for (int ip = 0; ip &lt; 2; ++ip)\n                for (int iq = 0; iq &lt; 2; ++iq) &#123;\n                    arr tp, tq;\n                    for (int i = ip; i &lt; (int)p.size(); i += 2)\n                        tp.push_back(p[i]);\n                    for (int i = iq; i &lt; (int)q.size(); i += 2)\n                        tq.push_back(q[i]);\n                    auto t = merge(tp, tq);\n                    for (int i = 0; i &lt; (int)t.size(); ++i)\n                        if (i * 2 + ip + iq &lt; (int)res.size())\n                            res[i * 2 + ip + iq] = std::max(res[i * 2 + ip + iq], t[i]);\n                &#125;\n            return res;\n        &#125;; \n        std::function&lt;node(int, int)&gt; calc = [&amp;](int l, int r) &#123;\n            if (l == r)\n                return node(&#123; w1[l], w2[l] &#125;);\n            int mid = (l + r) &gt;&gt; 1;\n            node t1(calc(l, mid)), t2(calc(mid + 1, r));\n            return node(&#123; getmax(fun(t1[0], t2[0]), fun(t1[1], t2[1])),\n                          getmax(fun(t1[0], t2[1]), fun(t1[1], t2[0])) &#125;);\n        &#125;;\n        auto t(calc(1, tot));\n        f[x][0] = t[0][tot], f[x][1] = t[0][tot - 1], f[x][2] = t[1][tot], f[x][3] = t[0][tot + 1];\n        return;\n    &#125;;\n    DFS(1, -1);\n    std::cout &lt;&lt; f[1][0] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n",
            "tags": [
                "DP",
                "DP ä¼˜åŒ–"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250707-1/",
            "url": "https://xsc062.netlify.app/20250707-1/",
            "title": "å­¦ä¹ ç¬”è®°ï¼šå†³ç­–å•è°ƒæ€§",
            "date_published": "2025-07-07T13:23:01.000Z",
            "content_html": "<p>ç­‰å’Œçº¿ï¼šåœ¨çº¿æ®µ <span class=\"math inline\">\\(AB\\)</span> ä¸Šå–ä¸€ç‚¹ <span class=\"math inline\">\\(M\\)</span>ï¼Œä½¿å¾— <span class=\"math inline\">\\(\\vec{AB}=\\lambda \\vec{AM}\\)</span>ã€‚åœ¨ <span class=\"math inline\">\\(AB\\)</span> ä¸Šæ–¹ä»»å–ä¸€ç‚¹ <span class=\"math inline\">\\(P\\)</span>ï¼Œåˆ™æœ‰ <span class=\"math inline\">\\(\\vec{PM}=(1-\\lambda) \\vec{PA}+\\lambda \\vec{PB}\\)</span>ã€‚</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"ä»€ä¹ˆæ˜¯-xdyd-dp\">ä»€ä¹ˆæ˜¯ xD/yD DP</h2>\n<p>å³ DP æ•°ç»„å…±æœ‰ <span class=\"math inline\">\\(x\\)</span> ç»´ï¼Œä¸€æ¬¡è½¬ç§»å¤æ‚åº¦ä¸º <span class=\"math inline\">\\(O(n^y)\\)</span>ã€‚</p>\n<p><del>ä¸ºä»€ä¹ˆè¦ç»™ä¸€å¥è¯å•å¼€ä¸€ä¸ªæ ‡é¢˜</del></p>\n<p>ä¸‹é¢è®¾é€šå¼ <span class=\"math inline\">\\(f_i=\\max\\left\\{f_j+w(i,j)\\right\\}\\)</span>ã€‚</p>\n<hr />\n<h2 id=\"å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–-dp\">å•è°ƒé˜Ÿåˆ—ä¼˜åŒ– DP</h2>\n<p><span class=\"math inline\">\\(w(i,j)\\)</span> ä»…åŒ…å« <span class=\"math inline\">\\(i,j\\)</span> çš„æœ€é«˜ä¸€æ¬¡é¡¹ã€‚</p>\n<ul>\n<li>å¦‚æœè¦æ±‚ <span class=\"math inline\">\\(j\\in [1,i]\\)</span>ï¼Œå‰ç¼€æœ€å°å€¼å³å¯ã€‚</li>\n<li>è‹¥ <span class=\"math inline\">\\(j\\)</span> çš„å–å€¼èŒƒå›´åœ¨åˆ°å¤„ä¹±åŠ¨ï¼Œå¯ä»¥å†™ DS =_=</li>\n<li><p>è‹¥ <span class=\"math inline\">\\(j\\)</span> çš„å–å€¼èŒƒå›´ <span class=\"math inline\">\\([l,r]\\)</span> éšç€ <span class=\"math inline\">\\(i\\)</span> å¢å¤§è€Œ <span class=\"math inline\">\\(l,r\\)</span> éƒ½ä¸å‡å°ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å•è°ƒé˜Ÿåˆ—ã€‚</p>\n<p>é¡ºå¸¦ä¸€æï¼Œå’Œè¿™ç§çš„å•è°ƒé˜Ÿåˆ—ç”¨æ³•ç›¸ä¼¼çš„ã€å•è°ƒæ ˆã€ä¸»è¦åœ¨æ–œä¼˜é‡Œå‡ºç°ã€‚</p></li>\n</ul>\n<p>å…·ä½“è¿‡ç¨‹è¢« grizzly bear åƒæ‰äº† <img src=\"/em/eat.gif\" /></p>\n<h3 id=\"ä¾‹å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–å¤šé‡èƒŒåŒ…\">ä¾‹ï¼šå•è°ƒé˜Ÿåˆ—ä¼˜åŒ–å¤šé‡èƒŒåŒ…</h3>\n<p>æœ´ç´ çš„å¤šé‡èƒŒåŒ…å¼å­æ˜¯ <span class=\"math inline\">\\(f_{i,j}=\\max\\left\\{f_{i-1,j-k\\times v_i}+k\\times w_i\\right\\}\\)</span>ï¼Œå› ä¸º <span class=\"math inline\">\\(i\\)</span> å’Œæ•´ä¸ªå¼å­æ— å…³ï¼Œæ‰€ä»¥æ˜¯å…³äº <span class=\"math inline\">\\(j\\)</span> çš„ 1D/1Dã€‚</p>\n<p>ä¸ºäº†å¥—ç”¨å•è°ƒé˜Ÿåˆ—ï¼Œéœ€è¦æŠŠæŸ¥è¯¢çš„é¡¹å˜æˆè¿ç»­çš„ã€‚å‘ç° <span class=\"math inline\">\\(j-k\\times v_i\\)</span> å’Œ <span class=\"math inline\">\\(j\\)</span> å…³äº <span class=\"math inline\">\\(v_i\\)</span> åŒä½™ï¼›ä¸”éšç€ <span class=\"math inline\">\\(k\\)</span> çš„å¢å¤§ï¼ŒæŸ¥è¯¢çš„ä½ç½®ä¸æ–­ç§»åŠ¨ <span class=\"math inline\">\\(v_i\\)</span>ã€‚é‚£ä¹ˆä¸å¦¨æŠŠæ‰€æœ‰ <span class=\"math inline\">\\(j\\)</span> æŒ‰ç…§æ¨¡ <span class=\"math inline\">\\(v_i\\)</span> çš„ä½™æ•°åˆ†å¼€åšã€‚å…·ä½“åœ°ï¼Œä¸å¦¨è®¾ <span class=\"math inline\">\\(j=a\\times v_i+b\\)</span>ï¼Œå°† <span class=\"math inline\">\\(j-k\\times v_i\\)</span> æ›¿æ¢ä¸ºä½™æ•°å†™æ³•ï¼Œé‚£ä¹ˆæœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\nf_{i,j}&amp;=\\max\\{f_{i-1,x\\times v_i+b}+(a-x)\\times v_i\\}\\\\\n&amp;=\\max\\{f_{i-1,x\\times v_i+b}-x\\times v_i\\}+a\\times v_i\n\\end{aligned}\n\\]</span></p>\n<p>é™åˆ¶ <span class=\"math inline\">\\((a-x)\\)</span> çš„å–å€¼ä¸è¶…è¿‡ç‰©å“æ•°ï¼Œåœ¨ä¸åŒæ¨¡æ•°ä¸‹æŒ‰ <span class=\"math inline\">\\(x\\)</span> ä»å°åˆ°å¤§å°† <span class=\"math inline\">\\(j\\)</span> è¿™ä¸€ç»´è¿›è¡Œå•è°ƒé˜Ÿåˆ—ä¼˜åŒ–å³å¯ã€‚å®¹æ˜“å‘ç°ä¼šä¸é‡ä¸æ¼æšä¸¾æ‰€æœ‰ä½“ç§¯ï¼›å¤æ‚åº¦ <span class=\"math inline\">\\(O(nV)\\)</span>ã€‚</p>\n<hr />\n<h2 id=\"æ–œç‡ä¼˜åŒ–-dp\">æ–œç‡ä¼˜åŒ– DP</h2>\n<p>è‹¥ <span class=\"math inline\">\\(w(i,j)\\)</span> ç§å«æœ‰ <span class=\"math inline\">\\(i,j\\)</span> çš„äº¤å‰é¡¹ï¼Œå¯ä»¥è€ƒè™‘æ–œä¼˜ã€‚</p>\n<p>å…·ä½“è¿‡ç¨‹ï¼Œï¼ˆå¦‚æœä½ æ„¿æ„ï¼‰ï¼Œå¯ä»¥çœ‹è¿™ç¯‡ <a href=\"/20210214/\">å››å¹´åŠå‰çš„åšå®¢</a>ã€‚</p>\n<p>å…³äºç¬¦å·ç­‰é—®é¢˜ï¼Œåˆ†äº«ä¸€ä¸‹æˆ‘çš„åšæ³•ï¼š</p>\n<ul>\n<li><p>å•è°ƒé˜Ÿåˆ—ç»´æŠ¤ï¼šé€‚ç”¨äºç¬¦å·å’Œå³ä¾§æ–œç‡è¦æ±‚å•è°ƒæ€§ç›¸åçš„æƒ…å†µã€‚</p>\n<ul>\n<li>é¦–å…ˆï¼Œè®¨è®ºé˜Ÿå¤´ç»´æŠ¤ã€‚ä¸å¦¨å‡è®¾ <span class=\"math inline\">\\(a\\)</span> ä¸ºé˜Ÿå¤´ç¬¬äºŒä¸ªå…ƒç´ ï¼Œ<span class=\"math inline\">\\(b\\)</span> ä¸ºé˜Ÿå¤´ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</li>\n<li>å¦‚æœé˜Ÿå¤´ <span class=\"math inline\">\\(b\\)</span> éœ€è¦è¢«å¼¹å‡ºï¼Œè¯´æ˜ <span class=\"math inline\">\\(a\\)</span> ä¼˜äº <span class=\"math inline\">\\(b\\)</span>ï¼›å‡è®¾å¼å­è¦æ±‚ maxï¼Œåˆ™ç”¨ <span class=\"math inline\">\\(a\\)</span> è½¬ç§»å¾—åˆ°çš„ç­”æ¡ˆ &gt; ç”¨ <span class=\"math inline\">\\(b\\)</span> è½¬ç§»å¾—åˆ°çš„ç­”æ¡ˆã€‚</li>\n<li>åŒ–å¼å­ï¼Œæ³¨æ„ <span class=\"math inline\">\\(a&gt;b\\)</span>ï¼›ä¸”è´Ÿæ•°ä¹˜é™¤è¦å˜å·ã€‚</li>\n<li><p>æœ€åå¾—åˆ°çš„å¼å­ä¸­é—´çš„ä¸ç­‰å·å°±å†³å®šäº†éœ€è¦ç»´æŠ¤çš„æ–œç‡å•è°ƒæƒ…å†µã€‚ä»¥æ­¤å†³å®šé˜Ÿå°¾ç»´æŠ¤æ–¹å¼å³å¯ã€‚</p>\n<strong>æ³¨æ„è¿™ä¸ªå¼å­çš„ä¸ç­‰å·ä½“ç°çš„æ˜¯å¼¹å‡ºæ¡ä»¶ï¼›ä¿ç•™æ¡ä»¶å’Œå…¶ç›¸å</strong> <img src=\"/em/ll.gif\" /></li>\n</ul></li>\n<li><p>å•è°ƒæ ˆç»´æŠ¤ï¼šé€‚ç”¨äºç¬¦å·å’Œå³ä¾§æ–œç‡è¦æ±‚å•è°ƒæ€§ç›¸åŒçš„æƒ…å†µï¼›éœ€è¦æ¸…æ¥šï¼Œç»´æŠ¤åˆæ³•æ€§ã€ç»´æŠ¤å•è°ƒå’Œå–ç­”æ¡ˆéƒ½åœ¨æ ˆé¡¶è¿›è¡Œã€‚</p>\n<ul>\n<li>é¦–å…ˆï¼Œéƒ½çŸ¥é“è¦ç”¨å•è°ƒæ ˆäº†ï¼Œè¯´æ˜æ–œä¼˜å½¢å¼å·²ç»è¢«åŒ–å‡ºæ¥äº†ï¼›ä»¥æ­¤ç»´æŠ¤åˆæ³•æ€§å³å¯ã€‚</li>\n<li>ç»´æŠ¤ä¸€ä¸ªä»åº•åˆ°é¡¶ï¼Œã€ä¼˜ã€å¾—è¶Šæ¥è¶Šå°çš„æ–œç‡åºåˆ—ã€‚æ‰¾åˆ°ä»æ›´ä¼˜åˆ°æ›´åŠ£çš„ä¸´ç•Œç‚¹ï¼Œæ›´æ–°ç­”æ¡ˆã€‚</li>\n</ul></li>\n</ul>\n<p>å•Šï¼Œæœç„¶é«˜ä¸­æ–‡åŒ–å­¦ç§‘æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ç®—æ˜¯æ˜ç™½ä¸ºä»€ä¹ˆæˆ‘å°å­¦ / åˆä¸­åŸºæœ¬æ²¡å¼„æ‡‚è¿‡æ–œä¼˜ï¼Œè€Œæ—è¾¹çš„å¤§ä½¬å·²ç»åœ¨ä¹±æ€äº† <img src=\"/em/hsh.gif\" /></p>\n<hr />\n<p>ç°åœ¨å‡è®¾æ­£åœ¨ç»´æŠ¤ä¸€ä¸ªä¸Šå‡¸åŒ…ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›æ€è€ƒï¼š</p>\n<ul>\n<li><p>å¦‚æœæŸ¥è¯¢åŒºé—´ä¸å•å¢ï¼Ÿ</p>\næä¸äº†å•Šè¿™ä¸ªã€‚åºŸäº†ã€‚</li>\n<li><p>æŸ¥è¯¢çš„æ–œç‡ä¸å•å¢ï¼Ÿ</p>\nå†™ä¸ªäºŒåˆ† + å•è°ƒæ ˆã€‚å‚è§ <a href=\"https://www.luogu.com.cn/problem/P5785\">ä»»åŠ¡å®‰æ’</a>ã€<a href=\"#ä¾‹traka\">TRAKA</a>ã€‚</li>\n<li><p>åŠ å…¥æ–œç‡çš„ä½ç½®ä¸å•å¢ï¼Ÿ</p>\n<p>æè¶… / CDQ / å¹³è¡¡æ ‘ã€‚</p></li>\n</ul>\n<hr />\n<h2 id=\"å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–-dp\">å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ– DP</h2>\n<h3 id=\"å…³äºå››è¾¹å½¢ä¸ç­‰å¼\">å…³äºå››è¾¹å½¢ä¸ç­‰å¼</h3>\n<p>å¯¹äºä»£ä»·çŸ©é˜µ <span class=\"math inline\">\\(w\\)</span> å’Œå®šä¹‰åŸŸå†… <span class=\"math inline\">\\(\\forall\\,a\\le b\\le c\\le d\\)</span>ï¼Œè‹¥ <span class=\"math inline\">\\(w(a,d)+w(b,c)\\ge w(a,c)+w(b,d)\\)</span>ï¼Œè®¤ä¸º <span class=\"math inline\">\\(w\\)</span> æ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼ã€‚ç®€è®°ä¸ºé‡å å¤§äºäº¤å‰ã€‚</p>\n<p>å‘½åæ¥æºæ˜¯å››è¾¹å½¢å¯¹è§’çº¿ä¹‹å’Œå¤§äºå¯¹è¾¹ä¹‹å’Œï¼›å°†æ’å¤§äºæ”¹ä¸ºæ’å°äºä¹Ÿèƒ½å¾—åˆ°ç›¸ä¼¼çš„æ€§è´¨ã€‚</p>\n<p>å°±ä¼šå‘ç°å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–å’Œæ–œä¼˜å…¶å®æ˜¯å››è¾¹å½¢ä¸ç­‰å¼çš„ç‰¹åŒ–ï¼Œå¯¼è‡´å®ƒä»¬å¯ä»¥å°‘ä¸€ä¸ª logã€‚</p>\n<hr />\n<h3 id=\"æ€§è´¨\">æ€§è´¨</h3>\n<p>ç”¨äºè¯æ˜ï¼š</p>\n<ul>\n<li>å¯¹äºä»»æ„ <span class=\"math inline\">\\(c\\le l\\le r\\)</span>ï¼Œè‹¥ <span class=\"math inline\">\\(w(l-c,r+c) + w(l,r)\\le w(l-c,r)+ w(l,r+c)\\)</span>ï¼Œåˆ™ <span class=\"math inline\">\\(w\\)</span> æ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼ã€‚</li>\n</ul>\n<p>ç”¨äºé¢˜ç›®ï¼š</p>\n<ul>\n<li><strong>æ€§è´¨ä¸€</strong>ï¼šè‹¥ <span class=\"math inline\">\\(f_i\\)</span> æ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼ï¼ˆæˆ–å…¶åå¼ï¼‰ï¼Œé‚£ä¹ˆæœ€ä¼˜å†³ç­–ç‚¹ <span class=\"math inline\">\\(p_i\\)</span> ä¸ <span class=\"math inline\">\\(i\\)</span> æœ‰å•è°ƒå…³ç³»ã€‚</li>\n<li><strong>æ€§è´¨äºŒ</strong>ï¼šå½“ <span class=\"math inline\">\\(i\\)</span> å˜åŒ–æ—¶ï¼Œæ¯ä¸ª <span class=\"math inline\">\\(j\\)</span> å¸¦æ¥è´¡çŒ®çš„ç›¸å¯¹å¤§å° rank ä¸å˜ã€‚äº¦ä½œï¼šè‹¥ <span class=\"math inline\">\\(j_1\\)</span> ç›¸å¯¹äº <span class=\"math inline\">\\(j_2\\)</span> å¯¹ <span class=\"math inline\">\\(i\\)</span> æ›´ä¼˜ï¼Œå¯¹äºä»»æ„ <span class=\"math inline\">\\(i&#39;\\)</span>ï¼Œ<span class=\"math inline\">\\(j_1\\)</span> ç›¸å¯¹äº <span class=\"math inline\">\\(j_2\\)</span> å¯¹ <span class=\"math inline\">\\(i&#39;\\)</span> æ›´ä¼˜ã€‚</li>\n</ul>\n<hr />\n<h3 id=\"åœ¨ä¼˜åŒ–-dp-ä¹‹å‰\">åœ¨ä¼˜åŒ– DP ä¹‹å‰</h3>\n<ul>\n<li><p>é¦–å…ˆæˆ‘å¿…é¡»è¦æä¸€å˜´ã€‚ç”±äºæˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦ã€å››è¾¹å½¢ä¸ç­‰å¼ã€æ˜¯åœ¨å››å¹´å‰ï¼Œçœ‹åˆ°ã€çŸ³å­åˆå¹¶çš„ <span class=\"math inline\">\\(n^2\\)</span> åšæ³•ã€æ—¶ã€‚ç„¶è€Œï¼Œè¿™ä¸€é¢˜çš„ DP æœ¬èº«æœ‰ä¸€ä¸ªç‰¹æ®Šæ€§è´¨ï¼Œå³è´¡çŒ®æ˜¯ä¸€ä¸ªä»¥å†³ç­–ç‚¹ä¸ºæå€¼çš„å‡¸å‡½æ•°ï¼›è¿™ç›´æ¥å¯¼è‡´æˆ‘è¯¯ä»¥ä¸ºè¿™æ˜¯å››è¾¹å½¢ä¸ç­‰å¼æœ¬èº«å¸¦æ¥çš„æ€§è´¨ï¼Œå¯¼è‡´æˆ‘åœ¨ç†è§£ä¸Šæµªè´¹äº†å¾ˆå¤šæ—¶é—´ã€‚<strong>å››è¾¹å½¢ä¸ç­‰å¼å¸¦æ¥çš„æ€§è´¨ï¼Œåªæœ‰ä¸Šè¿°ä¸¤æ¡ï¼</strong></p>\nå½“ç„¶è¿™ä¹Ÿå‘Šè¯‰æˆ‘ä»¬ï¼Œå¦‚æœä½ å‘ç°ã€è´¡çŒ®æ˜¯ä¸€ä¸ªä»¥å†³ç­–ç‚¹ä¸ºæå€¼çš„å‡¸å‡½æ•°ã€ï¼Œä½ å°±å¯ä»¥ç”¨ç±»ä¼¼çŸ³å­åˆå¹¶ä¸­çš„çº¿æ€§è½¬ç§»å®Œæˆé—®é¢˜ã€‚</li>\n<li><p>ã€æ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼ã€å¹¶ä¸èƒ½ç­‰ä»·äºã€å†³ç­–å•è°ƒæ€§ã€ã€‚å†³ç­–å•è°ƒæ€§å¹¶ä¸å…·å¤‡æ€§è´¨äºŒã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåªæ»¡è¶³å†³ç­–å•è°ƒæ€§ï¼Œåªæœ‰æœ€ä¼˜å†³ç­–ç‚¹æ˜¯å•è°ƒçš„ï¼Œä½†è´¡çŒ®å‡½æ•°éšç€ <span class=\"math inline\">\\(i\\)</span> çš„å˜åŒ–ï¼Œå…¶å½¢çŠ¶ä¼šæœ‰å¾ˆå¤§çš„å˜åŠ¨ã€‚</p></li>\n</ul>\n<hr />\n<h3 id=\"ä¼˜åŒ–-dpåˆ†æ²»\">ä¼˜åŒ– DPï¼šåˆ†æ²»</h3>\n<p>ä¸»è¦é€‚ç”¨äº <span class=\"math inline\">\\(f_{i}=g_j+w(j,i)\\)</span> çš„åœºæ™¯ï¼Œå…¶ä¸­ <span class=\"math inline\">\\(g\\)</span> æ˜¯ä¸ <span class=\"math inline\">\\(f\\)</span> æ— å…³çš„å‡½æ•°ã€‚</p>\n<p>å¯¹äºåˆ†æ²»èŒƒå›´ <span class=\"math inline\">\\([l,r]\\)</span> å’Œå…¶å†³ç­–ç‚¹èŒƒå›´ <span class=\"math inline\">\\([L_p,R_p]\\)</span>ï¼Œé¦–å…ˆæŠŠæš´åŠ› <span class=\"math inline\">\\(mid\\)</span> çš„å†³ç­–ç‚¹ <span class=\"math inline\">\\(p_{mid}\\)</span> æ‰¾å‡ºæ¥ã€‚</p>\n<p>æ¥ç€å¯¹äº <span class=\"math inline\">\\([l,mid)\\)</span> å’Œ <span class=\"math inline\">\\((mid,R]\\)</span>ï¼Œåˆ†åˆ«åœ¨ <span class=\"math inline\">\\([L_p,p_{mid}]\\)</span> å’Œ <span class=\"math inline\">\\([p_{mid},R_p]\\)</span> é‡Œæ‰¾å†³ç­–ç‚¹ï¼ˆæ³¨æ„ä¸¤è¾¹éƒ½æ˜¯é—­çš„ï¼‰ã€‚é€’å½’åœ°åšã€‚</p>\n<p>è¿™æ—¶å€™ä½ è‚¯å®šå°±ä¼šæ€€ç–‘äº†ï¼Œä¸»æ’­ä¸»æ’­ï¼Œè™½ç„¶ä½ çš„åŒºé—´æ¯æ¬¡åœ¨å‡åŠï¼Œä½†å†³ç­–ç‚¹èŒƒå›´å¹¶ä¸æ˜¯å‡åˆ†çš„ï¼Œè¿˜ä¼šè¢«å…±ç”¨ï¼Œå¤æ‚åº¦çœŸçš„å¯¹å—ï¼Ÿ</p>\n<p>å¯¹çš„å…„å¼Ÿï¼Œå¯¹çš„ã€‚è§‚å¯Ÿæœç´¢æ ‘ï¼Œä½ ä¼šå‘ç°è™½ç„¶ <span class=\"math inline\">\\(p_{mid}\\)</span> ä¼šè¢«ç»™ä¸¤ä¸ªå„¿å­å…±ç”¨ï¼Œä½†æ˜¯åœ¨ä»»ä½•ä¸€å±‚ä¸­ï¼Œè¢«é‡å¤ç»è¿‡çš„ç‚¹åªä¼šå‡ºç°åœ¨ä¸¤ä¸ªåŒºé—´çš„äº¤ç•Œå¤„ã€‚ä¹Ÿå°±æ˜¯è¯´æ¯æ•´å±‚å¤§æ¦‚éå† <span class=\"math inline\">\\(2n\\)</span> æ¬¡ã€‚æ˜¯ä¸æ˜¯å¾ˆå¯¹äº†ã€‚</p>\n<hr />\n<h4 id=\"ä¾‹yet-another-minimization-problem\">ä¾‹ï¼šYet Another Minimization Problem</h4>\n<p><a href=\"https://codeforces.com/problemset/problem/868/F\" class=\"uri\">https://codeforces.com/problemset/problem/868/F</a></p>\n<details>\n<p><summary>æˆ‘çš„å¤©å“ªï¼æ˜¯ç½•è§çš„å››çº§æ ‡é¢˜ï¼</summary></p>\n<p>ç¬‘ç‚¹è§£æï¼šè¿™ä¸ªäººå› ä¸ºæ‡’å¾—å†™ CSS æ‰€ä»¥åªå†™äº†ç»å¸¸ç”¨çš„ h2 å’Œ h3 çš„æ ·å¼ï¼Œç°åœ¨è¿«ä¸å¾—å·²ç”¨ h4 è¢«å€’é€¼å»å†™äº† h4 çš„ CSSã€‚</p>\n</details>\n<p>å‘ç° <span class=\"math inline\">\\(k\\le 20\\)</span>ï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨å†™ WQS äºŒåˆ†ã€‚ä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºç¬¬ <span class=\"math inline\">\\(i\\)</span> æ®µåˆ†åœ¨ <span class=\"math inline\">\\(j\\)</span> å¤„çš„ä»£ä»·ï¼Œé‚£ä¹ˆæœ‰ <span class=\"math inline\">\\(f_{i,j}=\\min\\{f_{i-1,l}+w(l+1,j)\\}\\)</span>ï¼Œåˆ†æ²»è§£å†³ã€‚</p>\n<p>æ¥ç€å‘ç°é—®é¢˜ï¼š<span class=\"math inline\">\\(w(l+1,j)\\)</span> å¹¶ä¸èƒ½å¾ˆå¿«åœ°æ±‚å‡ºæ¥ï¼›ç„¶åæ³¨æ„åˆ°è¿™ä¸ªä»£ä»·çš„å½¢å¼å¾ˆè«é˜Ÿï¼ˆå…¶å®åœ¨çœ‹åˆ°è¿™ä¸ªé¢˜çš„æ—¶å€™å°±ä¼šæœ‰è«é˜Ÿçš„æƒ³æ³•ï¼‰ï¼Œè€ƒè™‘ä½¿ç”¨è«é˜Ÿç§»åŠ¨ç«¯ç‚¹çš„æ–¹å¼è§£å†³é—®é¢˜ã€‚ç”±äºåˆ†æ²»ä¸­æŸ¥è¯¢çš„åŒºé—´ä¸¤ç«¯å•å¢ï¼Œæ¯å±‚çš„æ€»ç§»åŠ¨æ¬¡æ•°æ˜¯ <span class=\"math inline\">\\(O(n)\\)</span> çš„ï¼Œæ€»å¤æ‚åº¦å°±æ˜¯ <span class=\"math inline\">\\(O(nk\\log n)\\)</span> çš„ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 1e12;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    std::vector&lt;int&gt; a(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    std::vector&lt;long long&gt; cnt(n + 1);\n    std::vector&lt;std::vector&lt;int&gt; &gt; p(k + 1, std::vector&lt;int&gt; (n + 1));\n    std::vector&lt;std::vector&lt;long long&gt; &gt; f(k + 1, std::vector&lt;long long&gt; (n + 1, inf));\n    auto w = [&amp;](int l, int r) &#123;\n        static int L = 1, R = 0;\n        static long long res = 0ll;\n        for (; L &gt; l; --L, res -= cnt[a[L]] * (cnt[a[L]] - 1) / 2, ++cnt[a[L]], res += cnt[a[L]] * (cnt[a[L]] - 1) / 2);\n        for (; R &gt; r; res -= cnt[a[R]] * (cnt[a[R]] - 1) / 2, --cnt[a[R]], res += cnt[a[R]] * (cnt[a[R]] - 1) / 2, --R);\n        for (; R &lt; r; ++R, res -= cnt[a[R]] * (cnt[a[R]] - 1) / 2, ++cnt[a[R]], res += cnt[a[R]] * (cnt[a[R]] - 1) / 2);\n        for (; L &lt; l; res -= cnt[a[L]] * (cnt[a[L]] - 1) / 2, --cnt[a[L]], res += cnt[a[L]] * (cnt[a[L]] - 1) / 2, ++L);\n        return res;\n    &#125;;\n    f[0][0] = 0ll;\n    for (int t = 1; t &lt;= k; ++t) &#123;\n        std::function&lt;void(int, int, int, int)&gt; calc = [&amp;](int l, int r, int lp, int rp) &#123;\n            if (l &gt; r)\n                return;\n            if (l == r) &#123;\n                for (int i = lp; i &lt;= rp &amp;&amp; i &lt; l; ++i)\n                    if (f[t - 1][i] + w(i + 1, l) &lt; f[t][l])\n                        f[t][l] = f[t - 1][i] + w(i + 1, l), p[t][l] = i;\n                return;\n            &#125;\n            int mid = (l + r) &gt;&gt; 1;\n            for (int i = lp; i &lt;= rp &amp;&amp; i &lt; mid; ++i)\n                if (f[t - 1][i] + w(i + 1, mid) &lt; f[t][mid])\n                    f[t][mid] = f[t - 1][i] + w(i + 1, mid), p[t][mid] = i;\n            calc(l, mid - 1, lp, p[t][mid]), calc(mid + 1, r, p[t][mid], rp);\n            return;\n        &#125;;\n        calc(1, n, 0, n - 1);\n    &#125;\n    std::cout &lt;&lt; f[k][n] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"ä¼˜åŒ–-dpå•è°ƒæ•°æ®ç»“æ„\">ä¼˜åŒ– DPï¼šå•è°ƒæ•°æ®ç»“æ„</h3>\n<p>æœ‰çš„æ—¶å€™ä¼šå‡ºç° <span class=\"math inline\">\\(f_{i}=f_{j}+w(j,i)\\)</span> çš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯ <span class=\"math inline\">\\(f\\)</span> çš„å–å€¼ä¸è‡ªå·±æœ‰å…³ã€‚</p>\n<p>è¿™ç§æƒ…å†µæˆ‘ä»¬é€šå¸¸é€‰æ‹©å¡«è¡¨æ³•ï¼Œæ±‚å‡º <span class=\"math inline\">\\(f_i\\)</span> åæ‰¾åˆ° <span class=\"math inline\">\\(i\\)</span> æ˜¯å“ªäº›ç‚¹çš„æœ€ä¼˜å†³ç­–ï¼ˆé‚£ä¹ˆæ˜¾ç„¶è¿™äº›ç‚¹æ˜¯ä¸€æ®µè¿ç»­åŒºé—´ï¼‰ã€‚ç”¨ <span class=\"math inline\">\\((i,l_i,r_i)\\)</span> è¿™ä¸ªä¸‰å…ƒç»„è¡¨ç¤ºå½“å‰ç®—å‡ºæ¥çš„ <span class=\"math inline\">\\(i\\)</span> ç®¡è¾–çš„èŒƒå›´ã€‚</p>\n<p>è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿç»“åˆæ€§è´¨äºŒï¼Œæ¯å½“æˆ‘ä»¬æ‰‹ä¸Šæ‹¿åˆ°ä¸€ä¸ªæ–°çš„ <span class=\"math inline\">\\(i\\)</span>ï¼Œé‚£ä¹ˆæ¨å‡ºæ¥å…¶ç®¡è¾–èŒƒå›´å³ç«¯ç‚¹å°±ä¼šæ˜¯ <span class=\"math inline\">\\(n\\)</span>ã€‚æ¥ç€æƒ³åŠæ³•æ‰¾åˆ°å·¦ç«¯ç‚¹ï¼ŒåŒæ ·åˆ©ç”¨æ€§è´¨äºŒï¼ŒäºŒåˆ†å‡ºæœ€é å·¦çš„ä¸€ä¸ª <span class=\"math inline\">\\(j\\)</span>ï¼Œæ»¡è¶³ä¹‹å‰ç®—å‡ºæ¥çš„å†³ç­–ç‚¹æ²¡æœ‰ <span class=\"math inline\">\\(i\\)</span> ä¼˜ï¼Œé‚£ä¹ˆ <span class=\"math inline\">\\([j,n]\\)</span> å°±æ˜¯å½“å‰æ¡ä»¶ä¸‹ <span class=\"math inline\">\\(i\\)</span> çš„ç®¡è¾–èŒƒå›´ã€‚</p>\n<p>åœ¨é˜Ÿåˆ—é‡ŒåŠ å…¥å½“å‰ç‰ˆæœ¬çš„æ•´ä¸ªä¸‰å…ƒç»„åºåˆ—å°±å¯ä»¥æ–¹ä¾¿åœ°å®Œæˆè¿™ä¸ªè¿‡ç¨‹ã€‚ä¸ºå¯»æ‰¾å½“å‰å…ƒç´ çš„ç­”æ¡ˆï¼Œéœ€è¦å°†é˜Ÿå¤´ä¸Šï¼Œç®¡è¾–èŒƒå›´å®Œå…¨æ—©äºå½“å‰å…ƒç´ çš„å¼¹å‡ºå»ã€‚ç”±äºç»´æŠ¤çš„è¿‡ç¨‹å’Œå•è°ƒé˜Ÿåˆ—å¾ˆåƒï¼Œæ‰€ä»¥ä¹Ÿæœ‰äººç›´æ¥æŠŠè¿™é‡Œçš„é˜Ÿåˆ—å«å•è°ƒé˜Ÿåˆ—ã€‚</p>\n<p>è§†é¢˜ç›®ä¸åŒï¼Œä¹Ÿå¯èƒ½ç”¨åˆ°å•è°ƒæ ˆï¼Œä¹Ÿæœ‰å¯èƒ½ä¸ç”¨äºŒåˆ†ï¼ˆä¾‹å¦‚æ»¡è¶³å‰ä¸¤ç§ç‰¹åŒ–çš„æƒ…å†µï¼‰ã€‚goto <a href=\"/20250715/#a---yakiniku-restaurants\">Yakiniku Restaurants</a>ã€‚</p>\n<hr />\n<h4 id=\"ä¾‹è¯—äººå°g\">ä¾‹ï¼šè¯—äººå°G</h4>\n<p><a href=\"https://www.luogu.com.cn/problem/P1912\" class=\"uri\">https://www.luogu.com.cn/problem/P1912</a></p>\n<p><del>æˆ‘è§‰å¾—ç»™å‡ºå­—ç¬¦ä¸²å†…å®¹çš„å”¯ä¸€ä»·å€¼æ˜¯è®©å‡ºé¢˜äººæ¬£èµç™½æ—¥ä¾å±±å°½</del></p>\n<p>ä»¤ <span class=\"math inline\">\\(f_{j}\\)</span> ä¸ºæŸä¸€è¡Œåˆ†åœ¨ç¬¬ <span class=\"math inline\">\\(j\\)</span> å¥å¤„çš„ä»£ä»·ï¼Œé‚£ä¹ˆæœ‰ <span class=\"math inline\">\\(f_{j}=\\min\\limits_{k&lt;j}\\left\\{f_{k}+|(s_j-s_k+j-k-1)-L|^P\\right\\}\\)</span>ã€‚</p>\n<p>é‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘å•è°ƒé˜Ÿåˆ— + äºŒåˆ†äº†ã€‚éœ€è¦æ³¨æ„æ— ç©·å¤§ä¹‹é—´çš„å¤§å°æ¯”è¾ƒï¼Œæˆ‘å†™è¿™ä¸ªå†™çº¢æ¸©äº†ï¼Œç›´æ¥ç”¨æŒ‡æ•°é¡¹ç›¸å¯¹å¤§å°æ¥ä»£æ›¿äº†ï¼Œä¼¼ä¹å¯ä»¥è¿‡ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 1000000000000000001ll;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;P1912_2.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int T;\n    for (std::cin &gt;&gt; T; T--; ) &#123;\n        int n, l, p;\n        std::cin &gt;&gt; n &gt;&gt; l &gt;&gt; p;\n        long long to;\n        switch (p) &#123; // ä¼šæœ‰ç²¾åº¦é—®é¢˜\n        case 1:\n            to = 1e18;\n            break;\n        case 2:\n            to = 1e9;\n            break;\n        case 3:\n            to = 1e6;\n            break;\n        case 4:\n            to = 31622;\n            break;\n        case 5:\n            to = 3981;\n            break;\n        case 6:\n            to = 1e3;\n            break;\n        case 7:\n            to = 372;\n            break;\n        case 8:\n            to = 177;\n            break;\n        case 9:\n            to = 100;\n            break;\n        default:\n            to = 63;\n            break;\n        &#125;\n        std::vector&lt;int&gt; s(n + 1);\n        std::vector&lt;std::string&gt; a(n + 1);\n        for (int i = 1; i &lt;= n; ++i)\n            std::cin &gt;&gt; a[i], s[i] = (int)a[i].length();\n        std::partial_sum(s.begin() + 1, s.end(), s.begin() + 1);\n        struct node &#123; int i, l, r; &#125;;\n        std::vector&lt;node&gt; q(n + 1);\n        int h = 0, t = -1;\n        q[++t] = &#123; 0, 1, n &#125;;\n        auto qkp = [&amp;](long long x, int y) &#123;\n            if (x &gt; to)\n                return inf;\n            auto res(1ll);\n            for (; y--; res *= x);\n            return res;\n        &#125;;\n        std::vector&lt;int&gt; pre(n + 1);\n        std::vector&lt;long long&gt; f(n + 1);\n        auto calc = [&amp;](int k, int j) &#123;\n            return std::min(inf, f[k] + qkp(std::abs(s[j] - s[k] + j - k - 1 - l), p));\n        &#125;;\n        auto less = [&amp;](int k1, int j1, int k2, int j2) &#123;\n            auto t1(calc(k1, j1)), t2(calc(k2, j2));\n            if (t1 == inf &amp;&amp; t2 == inf)\n                return std::abs(s[j1] - s[k1] + j1 - k1 - 1 - l) &lt; std::abs(s[j2] - s[k2] + j2 - k2 - 1 - l);\n            return t1 &lt; t2;\n        &#125;;\n        for (int i = 1; i &lt;= n; ++i) &#123;\n            for (; h &lt;= t &amp;&amp; q[h].r &lt; i; ++h);\n            f[i] = calc(q[h].i, i), pre[i] = q[h].i;\n            for (; h &lt;= t &amp;&amp; q[t].l &gt; i &amp;&amp; less(i, q[t].l, q[t].i, q[t].l); --t)\n                q[t - 1].r = q[t].r;\n            for (int l = std::max(q[t].l, i + 1), r = q[t].r, mid; l &lt;= r; ) &#123;\n                mid = (l + r) &gt;&gt; 1;\n                if (less(i, mid, q[t].i, mid))\n                    r = q[t].r = mid - 1, q[t + 1] = &#123; i, mid, n &#125;;\n                else\n                    l = mid + 1;\n            &#125;\n            if (q[t + 1].i == i)\n                ++t;\n        &#125;\n        if (f[n] &gt;= inf)\n            std::cout &lt;&lt; &quot;Too hard to arrange&quot; &lt;&lt; &#39;\\n&#39;;\n        else &#123;\n            std::cout &lt;&lt; f[n] &lt;&lt; &#39;\\n&#39;;\n            std::function&lt;void(int)&gt; print = [&amp;](int x) &#123;\n                if (x == 0)\n                    return;\n                print(pre[x]);\n                for (int i = pre[x] + 1; i &lt;= x; ++i) &#123;\n                    std::cout &lt;&lt; a[i];\n                    if (i != x)\n                        std::cout &lt;&lt; &#39; &#39;;\n                &#125;\n                std::cout &lt;&lt; &#39;\\n&#39;;\n                return;\n            &#125;;\n            print(n);\n        &#125;\n        std::cout &lt;&lt; &quot;--------------------&quot;;\n        if (T)\n            std::cout &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<p>éœ€è¦æ³¨æ„ï¼Œæœ¬é¢˜ä¹Ÿå¯ä»¥å†åŠ ä¸€ä¸ªã€æ°å¥½åˆ† <span class=\"math inline\">\\(k\\)</span> æ®µã€çš„é™åˆ¶ï¼Œç›´æ¥åœ¨å¤–å±‚å¥—ä¸€ä¸ª WQS äºŒåˆ†å°±å¥½äº†ï¼Œå‚è§ <a href=\"https://www.luogu.com.cn/problem/P6246\">é‚®å±€ åŠ å¼ºç‰ˆ åŠ å¼ºç‰ˆ</a>ã€‚</p>\n<h3 id=\"d1d-dp-ä¼˜åŒ–\">2D/1D DP ä¼˜åŒ–</h3>\n<p>è‹¥å­˜åœ¨ <span class=\"math inline\">\\(f(i,j)=\\min\\limits_{k&lt;j} f(i-1,k)+w(k+1,j)\\)</span>ï¼Œä¸” <span class=\"math inline\">\\(w\\)</span> æ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼ï¼š</p>\n<ul>\n<li><p>è®¾ <span class=\"math inline\">\\(p(i,j)\\)</span> ä¸ºæœ€ä¼˜å†³ç­–ç‚¹ï¼Œé‚£ä¹ˆæœ‰ <span class=\"math inline\">\\(p(i,j)\\le p(i,j+1)\\le p(i+1,j+1)\\)</span>ï¼Œäº¦ä½œ <span class=\"math inline\">\\(p(i,j-1)\\le p(i,j)\\le p(i+1,j)\\)</span>ã€‚</p>\n<p>æ­¤æ—¶å¯ä»¥ <span class=\"math inline\">\\(O(nm)\\)</span> è§£å†³é—®é¢˜ï¼š</p>\n<p><img src=\"image.png\" /></p></li>\n<li><p>è‹¥ <span class=\"math inline\">\\(i\\)</span> å›ºå®šï¼Œ<span class=\"math inline\">\\(f_i(j)\\)</span> ä¸ºå‡¸å‡½æ•°ã€‚ï¼ˆä¾‹ï¼šé‚®å±€ åŠ å¼ºç‰ˆ åŠ å¼ºç‰ˆï¼‰</p>\n<p>goto <a href=\"/20250707/\">DP å‡¸ä¼˜åŒ–</a>ã€‚</p></li>\n</ul>\n",
            "tags": [
                "DP",
                "DP ä¼˜åŒ–"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250707/",
            "url": "https://xsc062.netlify.app/20250707/",
            "title": "å­¦ä¹ ç¬”è®°ï¼šDP å‡¸ä¼˜åŒ–",
            "date_published": "2025-07-07T06:10:02.000Z",
            "content_html": "<p>è¢œï¼Œè¿™ç¯‡æ–‡ç« ä¸€ä¸‹å­åˆ›å»ºäº†ä¸‰ä¸ªæ–° tagã€‚</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"ä»€ä¹ˆæ˜¯å‡¸å‡½æ•°\">ä»€ä¹ˆæ˜¯å‡¸å‡½æ•°</h2>\n<h3 id=\"å®šä¹‰\">å®šä¹‰</h3>\n<p>åœ¨ä¿¡æ¯å­¦ä¸­ç ”ç©¶çš„å‡¸å‡½æ•°å¤§æŠµæ˜¯åªåœ¨æ­£æ•´æ•°åŸŸä¸Šæœ‰å®šä¹‰çš„ï¼Œæ‰€ä»¥åªèƒ½ç›´æ¥æ‘’å¼ƒå¯¼å‡½æ•°çš„æ¦‚å¿µäº†ã€‚</p>\n<p>è‹¥æ–œç‡é€’å¢ï¼Œæ¢è¨€ä¹‹ï¼Œå·®åˆ†æ•°ç»„é€’å¢ï¼Œè®¤ä¸ºå‡½æ•°æ˜¯å‡¸çš„ï¼ˆå¥½åç›´è§‰ï¼‰ã€‚</p>\n<p>æˆ–è€…çœ‹çœ‹ç¬¦å·åŒ–çš„å®šä¹‰ï¼šè‹¥å¯¹äºä»»æ„ <span class=\"math inline\">\\(\\lambda\\in[0,1]\\)</span>ï¼Œå‡½æ•° <span class=\"math inline\">\\(f(x)\\)</span> å‡æ»¡è¶³ï¼š</p>\n<p><span class=\"math display\">\\[\nf(\\lambda x+(1-\\lambda) y)\\le \\lambda f(x)+(1-\\lambda) f(y).\n\\]</span></p>\n<p>æˆ–ç­‰ä»·åœ°ï¼š</p>\n<p><span class=\"math display\">\\[\nf(x)-f(x - 1)\\le f(x + 1) - f(x)\n\\]</span></p>\n<p>é‚£ä¹ˆè®¤ä¸º <span class=\"math inline\">\\(f\\)</span> æ˜¯å‡¸å‡½æ•°ã€‚</p>\n<p>å› ä¸ºå‡¹å‡¸åœ¨æ€§è´¨ä¸Šæ²¡åŒºåˆ«ï¼Œæ‰€ä»¥ <strong>ä¸‹æ–‡æ–½è¡Œæš´æ”¿ï¼Œå°†å‡¹å‡½æ•°å’Œå‡¸å‡½æ•°ç»Ÿç§°ä¸ºå‡¸å‡½æ•°</strong>ã€‚</p>\n<hr />\n<h3 id=\"åˆ¤å®š\">åˆ¤å®š</h3>\n<p>å¯¹äºå…·ä½“æƒ…å¢ƒä¸‹çš„é—®é¢˜ï¼Œæ€ä¹ˆåˆ¤æ–­ DP æ•°ç»„æ˜¯å¦å…³äºå…¶æŸä¸€ç»´ä¸ºå‡¸å‡½æ•°ï¼Ÿ</p>\n<ul>\n<li>ç›¸ä¿¡ç›¸ä¿¡çš„åŠ›é‡ï¼ˆæœ€å¸¸ç”¨ï¼‰ã€‚</li>\n<li><p>å¯¹äºåˆ†æ®µé—®é¢˜ï¼Œè¯æ˜åˆ†å‡ºæ¥çš„æ¯ä¸€æ®µæ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼ã€‚</p>\n<em>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ•°å­¦ä¸Šä¸è®¤ä¸ºæ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼èƒ½å¤Ÿæ¨å‡ºå‡½æ•°ä¸ºå‡¸ã€‚ä½†è¿™æ˜¯ä¿¡æ¯å­¦.jpg</em></li>\n<li><p>å…¶ç”±ä¸¤ä¸ªå‡¸å‡½æ•°çº¿æ€§ç›¸åŠ å¾—åˆ°ï¼š</p>\n<p>å¯¹äº <span class=\"math inline\">\\(\\forall\\, \\lambda,\\mu\\ge 0\\)</span> å’Œå‡¸å‡½æ•° <span class=\"math inline\">\\(f,g\\)</span>ï¼Œè‹¥ <span class=\"math inline\">\\(h=\\lambda f+\\mu g\\)</span>ï¼Œåˆ™ <span class=\"math inline\">\\(h\\)</span> ä¸ºå‡¸å‡½æ•°ã€‚</p>\næ­¤å¤–ï¼Œæ­¤æ—¶ <span class=\"math inline\">\\(h\\)</span> çš„å·®åˆ†æ•°ç»„å’Œ <span class=\"math inline\">\\(f,g\\)</span> å·®åˆ†æ•°ç»„ä¹Ÿæ»¡è¶³ä¸Šè¿°å…³ç³»ã€‚</li>\n<li>å…¶æ˜¯ä¸¤ä¸ªå‡¸å‡½æ•°çš„ <a href=\"#é—µå¯å¤«æ–¯åŸºå’Œ\">é—µå¯å¤«æ–¯åŸºå’Œ</a>ã€‚</li>\n<li><p>å…¶ç”±ä¸¤ä¸ªå‡¸å‡½æ•°çº¿æ€§ max å¾—åˆ°ã€‚</p>\n<p>å¯¹äºä¸¤ä¸ªå‡¸å‡½æ•°çš„çº¿æ€§ minï¼Œä¸€èˆ¬ä¸æ˜¯å‡¸å‡½æ•°ï¼Œç”šè‡³å¯èƒ½æ˜¯å‡¹çš„ã€‚</p></li>\n</ul>\n<hr />\n<h3 id=\"æ€§è´¨\">æ€§è´¨</h3>\n<ul>\n<li>æœ€å€¼ä¸ºå”¯ä¸€æå€¼ã€‚</li>\n<li>æ–œç‡ / å·®åˆ†æ•°ç»„å…·æœ‰å•è°ƒæ€§ã€‚</li>\n</ul>\n<p>åœ¨è§£é¢˜ä¸­ä¸»è¦ç”¨åˆ°çš„å¤§æ¦‚å°±æ˜¯ä¸Šé¢ä¸¤æ¡ã€‚</p>\n<hr />\n<h2 id=\"wqs-äºŒåˆ†\">WQS äºŒåˆ†</h2>\n<h3 id=\"ä¸»è¦ä»»åŠ¡\">ä¸»è¦ä»»åŠ¡</h3>\n<blockquote>\n<p>ä¾‹ï¼šæŠŠ <span class=\"math inline\">\\(a_{1\\sim n}\\)</span> åˆ†ä¸ºæ°å¥½ <span class=\"math inline\">\\(k\\)</span> æ®µï¼Œæ¯æ®µçš„ä»£ä»·ä¸º <span class=\"math inline\">\\(sum^2+c\\)</span>ï¼ˆ<span class=\"math inline\">\\(c\\)</span> ä¸ºç»™å®šçš„å¸¸æ•°ï¼‰ï¼Œé—®æœ€å°ä»£ä»·ã€‚<span class=\"math inline\">\\(n\\le 2\\times 10^5,a_i\\le 10^9\\)</span>ã€‚</p>\n</blockquote>\n<p>å¦‚æœå¯¹æ®µæ•°æ²¡æœ‰è¦æ±‚ï¼Œå¯ä»¥ç”¨æ–œä¼˜ <span class=\"math inline\">\\(O(n)\\)</span> åšã€‚</p>\n<p>åŠ ä¸Šäº† <span class=\"math inline\">\\(k\\)</span> çš„é™åˆ¶ï¼ŒDP å˜æˆäºŒç»´çš„ï¼Œä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºåœ¨ <span class=\"math inline\">\\(i\\)</span> å¤„åˆ†ç¬¬ <span class=\"math inline\">\\(j\\)</span> æ®µï¼Œå¯ä»¥åœ¨ç¬¬ä¸€ç»´æ–œç‡ä¼˜åŒ–ï¼Œåšåˆ° <span class=\"math inline\">\\(O(nk)\\)</span>ï¼›äº¦æˆ–å‘ç° <span class=\"math inline\">\\((i,j)\\)</span> æœ‰å†³ç­–å•è°ƒæ€§ï¼Œç„¶åå››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–åˆ° <span class=\"math inline\">\\(O(n^2)\\)</span>ã€‚</p>\n<p>æˆ‘ä»¬å‘ç° <span class=\"math inline\">\\(f\\)</span> å…³äº <span class=\"math inline\">\\(j\\)</span> è¿™ä¸€ç»´æ˜¯å‡¸çš„ï¼ˆè€Œéä¸Šæ–‡çš„ <span class=\"math inline\">\\((i,j)\\)</span>ï¼‰ï¼Œæ•…å°† <span class=\"math inline\">\\(f(n,j)\\)</span> å…³äº <span class=\"math inline\">\\(j\\)</span> çš„å‡½æ•°æå–å‡ºæ¥ï¼ˆè®°ä¸º <span class=\"math inline\">\\(f_n(j)\\)</span>ï¼‰ã€‚å‘ç°åªæœ‰æœ€é«˜ç‚¹æ˜¯å¯ä»¥ä¸€æ¬¡æ–œä¼˜å¿«é€Ÿæ±‚å‡ºæ¥çš„ï¼Œæ•…å¯ä»¥è®¤ä¸ºåœ¨å½“å‰å¤æ‚åº¦é™åˆ¶ä¸‹ï¼Œæ•´ä¸ªå‡½æ•°é™¤äº†æœ€é«˜ç‚¹ä»¥å¤–éƒ½æ˜¯æœªçŸ¥çš„ï¼ˆæ³¨æ„å¯ä»¥åœ¨ DP æ—¶è®°å½•æå€¼ç‚¹çš„æ¨ªåæ ‡ï¼Œå³åˆ†äº†å‡ æ®µï¼‰ã€‚</p>\n<p>æˆ‘ä»¬ç»™æ¯ä¸ª <span class=\"math inline\">\\(f_n(j)\\)</span> åŠ ä¸Š <span class=\"math inline\">\\(\\alpha\\cdot j\\)</span>ï¼ˆåœ¨æœ¬é¢˜ä¸­å³å°† <span class=\"math inline\">\\(c\\gets c+k\\)</span>ï¼‰ï¼Œå‹‰å¼ºå¯ä»¥è®¤ä¸º <span class=\"math inline\">\\(\\alpha\\cdot j\\)</span> æ˜¯å‡¸çš„ï¼Œæ‰€ä»¥æ–°å‡½æ•° <span class=\"math inline\">\\(f&#39;_n(j)\\)</span> ä¹Ÿæ˜¯å‡¸çš„ã€‚è‹¥ <span class=\"math inline\">\\(k&gt;0\\)</span>ï¼Œå¯ä»¥æ„Ÿå—åˆ°æå€¼ç‚¹å‘å·¦åç§»ï¼Œä¸”éšç€ <span class=\"math inline\">\\(k\\)</span> çš„å¢å¤§ï¼Œæå€¼ç‚¹ä¸ä¼šå³ç§»ï¼›<span class=\"math inline\">\\(k&lt;0\\)</span> æ—¶åŒç†ã€‚</p>\n<p>ç»“åˆå‡ ä½•è§‚ç‚¹ï¼Œåœ¨ <span class=\"math inline\">\\(f_n\\)</span> ä¸Šçš„æå€¼ç‚¹å¯ä»¥ç”¨æ–œç‡ä¸º <span class=\"math inline\">\\(0\\)</span> çš„ç›´çº¿åˆ‡åˆ°ï¼›è€ŒåŠ ä¸Š <span class=\"math inline\">\\(\\alpha\\cdot j\\)</span> çš„è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯åˆ‡çº¿æ–œç‡å‡å» <span class=\"math inline\">\\(\\alpha\\)</span> çš„è¿‡ç¨‹ã€‚ç›¸å½“äºä»¤åˆ‡çº¿æ–œç‡ä¸º <span class=\"math inline\">\\(-\\alpha\\)</span>ï¼Œçœ‹çœ‹èƒ½åˆ‡åˆ°å“ªé‡Œã€‚</p>\n<p>æ•…å¯ä»¥äºŒåˆ†ä¸€ä¸ªåˆé€‚çš„ <span class=\"math inline\">\\(k\\)</span>ï¼Œä½¿å¾—æå€¼ç‚¹çš„æ¨ªåæ ‡ä¸º <span class=\"math inline\">\\(k\\)</span>ã€‚æ­¤æ—¶ <span class=\"math inline\">\\(f&#39;_n(k)-\\alpha\\cdot k\\)</span> å³ä¸ºå¾…æ±‚ã€‚</p>\n<hr />\n<p>WQS äºŒåˆ†å‚ä¸çš„é—®é¢˜ä¸€èˆ¬ä»¥å¦‚ä¸‹å½¢å¼å‘ˆç°ï¼š</p>\n<blockquote>\n<p>ç»™å®šåºåˆ—ï¼Œå°†å…¶æ°å¥½åˆ†ä¸º <span class=\"math inline\">\\(k\\)</span> æ®µ / æ°å¥½é€‰ <span class=\"math inline\">\\(k\\)</span> ä¸ªï¼Œæ±‚æœ€å¤§ / æœ€å°ä»£ä»·ã€‚</p>\n</blockquote>\n<p>é¢˜ç›®è¦æ±‚æœ€å¤§ / æœ€å°å€¼ä¸€èˆ¬èƒ½å¤Ÿåæ˜ å‡½æ•°çš„å‡¹å‡¸æ€§ï¼Œå¯ä»¥æ ¹æ®è¿™ä¸€ç‚¹æ¥çŒœã€‚</p>\n<hr />\n<h3 id=\"ç»†èŠ‚å¤„ç†\">ç»†èŠ‚å¤„ç†</h3>\n<p>è€ƒè™‘å¦‚ä¸‹å‡¸å‡½æ•°ï¼š</p>\n<p><img src=\"1.png\" /></p>\n<ul>\n<li>æ˜¾ç„¶å¯¹äºã€å‡¸å‡ºæ¥ã€çš„ç‚¹ï¼ˆå³å›¾ä¸­é™¤äº† <span class=\"math inline\">\\(E,H\\)</span> ä»¥å¤–çš„ç‚¹ï¼‰ï¼Œèƒ½åˆ‡åˆ°çš„ç›´çº¿æ–œç‡ä¸ºä¸€ä¸ªèŒƒå›´ï¼›è€Œä½äºç›´çº¿ä¸Šçš„ç‚¹ï¼ˆé€”ä¸­ <span class=\"math inline\">\\(E,H\\)</span>ï¼‰ï¼Œèƒ½åˆ‡åˆ°çš„ç›´çº¿æ–œç‡æ›´æ˜¯å®šæ­»äº†ã€‚æ‰€ä»¥è¿™è¦æ±‚ä½ çš„äºŒåˆ†ç²¾åº¦éœ€è¦ç•¥é«˜ä¸€ç‚¹ã€‚</li>\n<li><p>å¯¹äº <span class=\"math inline\">\\(E\\)</span>ï¼ˆæˆ– <span class=\"math inline\">\\(H\\)</span>ï¼‰ï¼Œä¸èƒ½æ‰¾åˆ°åªè¿‡å®ƒä¸€ç‚¹çš„åˆ‡çº¿ã€‚æ ¹æ® DP çš„å†™æ³•ï¼Œè®°å½•çš„æ¨ªåæ ‡å¯èƒ½æ˜¯æœ€å°çš„ <span class=\"math inline\">\\(D\\)</span>ï¼Œä¹Ÿå¯èƒ½æ˜¯æœ€å¤§çš„ <span class=\"math inline\">\\(F\\)</span>ï¼Œæ­¤æ—¶ä½ å¯ä»¥ï¼š</p>\n<ul>\n<li>åŒæ—¶è®°å½•æœ€å°å’Œæœ€å¤§çš„æ¨ªåæ ‡ï¼Œçœ‹çœ‹ <span class=\"math inline\">\\(k\\)</span> åœ¨ä¸åœ¨ä¸­é—´ã€‚</li>\n<li><p>é¢˜ç›®è¦æ±‚æœ€å¤§ä»£ä»·æ—¶ï¼Œè®°å½•æœ€å¤§æ¨ªåæ ‡ï¼ŒäºŒåˆ†åˆ°ä¸€ä¸ªæå€¼ç‚¹ <span class=\"math inline\">\\(k&#39;\\ge k\\)</span> æ—¶ï¼Œæ˜¾ç„¶ <span class=\"math inline\">\\(\\alpha&#39;\\ge \\alpha\\)</span>ï¼Œç”¨ <span class=\"math inline\">\\(f&#39;_n(k&#39;)-\\alpha&#39;\\cdot k\\)</span> æ›´æ–°ç­”æ¡ˆï¼ˆæ˜¯èµ‹å€¼è€Œä¸æ˜¯å–æœ€å€¼ï¼‰ï¼›æ±‚æœ€å°ä»£ä»·æ—¶åŒç†ã€‚</p>\n<p>ä¸»è¦æ˜¯éœ€è¦è®°ä½æ–œç‡æ˜¯ <span class=\"math inline\">\\(\\alpha\\)</span> çš„ç›¸åæ•°ï¼Œ<del>å®åœ¨æä¸æ¸…å¯¹åº”å…³ç³»å¯ä»¥éƒ½è¯•ä¸€è¯•</del></p></li>\n</ul></li>\n</ul>\n<hr />\n<h3 id=\"ä¾‹ç§æ ‘\">ä¾‹ï¼šç§æ ‘</h3>\n<p><a href=\"https://www.luogu.com.cn/problem/P1484\" class=\"uri\">https://www.luogu.com.cn/problem/P1484</a></p>\n<p>é¦–å…ˆï¼Œå‡½æ•°æ˜¯å‡¸çš„â€”â€”æ„Ÿæ€§ç†è§£å³å¯ã€‚</p>\n<p>æ¥ç€ï¼Œè¦æ±‚çš„æ˜¯ <span class=\"math inline\">\\(\\le k\\)</span> æ—¶çš„æœ€å€¼ã€‚åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š<span class=\"math inline\">\\(k\\)</span> æ˜¯å¦å³äºåŸå‡½æ•°æå€¼ç‚¹ã€‚</p>\n<ul>\n<li>è‹¥ <span class=\"math inline\">\\(k\\)</span> å³äºåŸå‡½æ•°æå€¼ç‚¹ï¼Œåˆ™åŸå‡½æ•°æå€¼ç‚¹ä¸ºç­”æ¡ˆã€‚</li>\n<li>å¦åˆ™ï¼Œ<span class=\"math inline\">\\(k\\)</span> ä¸ºç­”æ¡ˆã€‚</li>\n</ul>\n<p>å¥½æ¶ˆæ¯æ˜¯æ•´æ•°åŸŸä¸Šä¸€å®šæœ‰è§£ï¼ˆæœ€åç­”æ¡ˆä¸ºæ•´ã€å€’æ¨å³å¯ï¼‰ï¼Œæ‰€ä»¥ä¸ç”¨æ‰“æµ®ç‚¹æ•°äºŒåˆ†äº†ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int lim = 1e6;\nconst long long inf = 1e18;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    std::vector&lt;long long&gt; a(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    auto calc = [&amp;](int c) &#123;\n        std::vector&lt;std::pair&lt;long long, int&gt; &gt; f(n + 1);\n        auto mx = f.front();\n        auto upd = [&amp;](auto &amp;x, auto y) &#123;\n            if (y.first &gt; x.first || (y.first == x.first &amp;&amp; y.second &lt; x.second))\n                x = y;\n            return;\n        &#125;;\n        for (int i = 1; i &lt;= n; ++i) &#123;\n            f[i].first = mx.first + a[i] + c;\n            f[i].second = mx.second + 1;\n            upd(mx, f[i - 1]);\n        &#125;\n        upd(mx, f[n]);\n        return mx;\n    &#125;;\n    auto t(calc(0));\n    if (t.second &lt;= k) &#123;\n        std::cout &lt;&lt; t.first &lt;&lt; &#39;\\n&#39;;\n        return 0;\n    &#125;\n    auto res(-inf);\n    for (int l = -lim, r = lim, mid; l &lt;= r; ) &#123;\n        mid = (l + r) &gt;&gt; 1;\n        auto t = calc(mid);\n        if (t.second &lt;= k)\n            res = t.first - (long long)mid * k, l = mid + 1;\n        else\n            r = mid - 1;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"ä¾‹raper\">ä¾‹ï¼šRaper</h3>\n<p><a href=\"https://www.luogu.com.cn/problem/P4694\" class=\"uri\">https://www.luogu.com.cn/problem/P4694</a></p>\n<p>ç»™æ‰€æœ‰å…‰ç›˜é™„ä¸€ä¸ªå¥–åŠ± <span class=\"math inline\">\\(mid\\)</span>ï¼Œè¿›è¡Œ WQS äºŒåˆ†ã€‚</p>\n<p>ç„¶åå†…å±‚å°±å’Œ <a href=\"#ä¾‹åºåˆ—-sequence\">sequence</a> å·®å¾—ä¸æ˜¯ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥è€ƒè™‘åæ‚”è´ªå¿ƒã€‚ï¼ˆï¼Ÿï¼‰</p>\n<p>æŠŠè·¯è¿‡çš„ <span class=\"math inline\">\\(-a_j\\)</span> ä¸¢åˆ°å¤§æ ¹å †é‡Œï¼Œå°è¯•å’Œ <span class=\"math inline\">\\(b_i\\)</span> é…å¯¹ã€‚å¦‚æœ <span class=\"math inline\">\\(mid-a_i-b_i\\ge 0\\)</span> é‚£ä¹ˆæš‚æ—¶é…å¯¹ï¼Œé¡ºä¾¿æŠŠ <span class=\"math inline\">\\(b_i-mid\\)</span> ä¸¢è¿›å»ç”¨äºåæ‚”ï¼Œè‹¥ <span class=\"math inline\">\\(b_{i&#39;}\\)</span> é€‰ä¸­äº† <span class=\"math inline\">\\(b_i-mid\\)</span> è¯´æ˜åæ‚”ï¼Œå°† <span class=\"math inline\">\\(a_j\\)</span> ä¸ <span class=\"math inline\">\\(b_{i&#39;}\\)</span> é…å¯¹ã€‚</p>\n<p>è´ªå¿ƒçš„æ—¶å€™éœ€è¦è®°å½•å·²ç»é…çš„å¯¹æ•°ï¼Œä¼˜å…ˆé˜Ÿåˆ—ä¸­éœ€è¦å¯¹ <span class=\"math inline\">\\(-a_j\\)</span> å’Œ <span class=\"math inline\">\\(b_i-mid\\)</span> æ‰“æ ‡è®°è¿›è¡ŒåŒºåˆ†ï¼ŒåŒ¹é…åˆ°å‰è€…æ—¶æ‰å¢åŠ æˆåŠŸå¯¹æ•°ã€‚</p>\n<p>å‘ç°æ•´æ•°åŸŸä¸Šä»ç„¶å¿…æœ‰è§£ï¼ˆç­”æ¡ˆä¸ºæ•´ï¼Œå€’æ¨ï¼‰ï¼Œä¸ç”¨æ‰“æµ®ç‚¹æ•°äºŒåˆ† neiher.</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 2e9 + 5;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    std::vector&lt;int&gt; a(n + 1), b(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; b[i];\n    auto calc = [&amp;](long long mid) &#123;\n        std::priority_queue&lt;std::pair&lt;long long, int&gt; &gt; q;\n        int cnt = 0;\n        auto res(0ll);\n        for (int i = 1; i &lt;= n; ++i) &#123;\n            q.emplace(-a[i], 1);\n            auto [v, ty] = q.top();\n            if (mid + v - b[i] &gt;= 0) &#123;\n                q.pop(), cnt += ty;\n                res += mid + v - b[i], q.emplace(b[i] - mid, 0);\n            &#125;\n        &#125;\n        return std::make_pair(cnt, res);\n    &#125;;\n    auto res(inf);\n    for (long long l = 1ll, r = inf, mid; l &lt;= r; ) &#123;\n        mid = (l + r) &gt;&gt; 1;\n        auto t(calc(mid));\n        if (t.first &gt;= k)\n            r = mid - 1, res = -(t.second - k * mid);\n        else\n            l = mid + 1;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"åŒºé—´åˆ†æ‹†é—®é¢˜\">åŒºé—´åˆ†æ‹†é—®é¢˜</h3>\n<p>ç›®æ ‡ï¼šå°è¯•å°† <span class=\"math inline\">\\(a_{1\\sim n}\\)</span> åˆ†å‰²æˆæ°å¥½ <span class=\"math inline\">\\(k\\)</span> æ®µï¼Œå®šä¹‰ <span class=\"math inline\">\\(w(i,j)\\)</span> ä¸ºå°† <span class=\"math inline\">\\([i,j]\\)</span> ä½œä¸ºä¸€æ®µçš„ä»£ä»·ï¼Œæ±‚ä»£ä»·æœ€å€¼ã€‚å…¶ä¸­ <span class=\"math inline\">\\(w(i,j)\\)</span> æ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼ã€‚</p>\n<p>ä¸å¦¨è®¾æ±‚æœ€å°ä»£ä»·ã€‚å®šä¹‰ <span class=\"math inline\">\\(f(i,j)\\)</span> åœ¨ <span class=\"math inline\">\\(i\\)</span> å¤„åˆ†ç¬¬ <span class=\"math inline\">\\(j\\)</span> æ®µï¼Œé‚£ä¹ˆæœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\nf(i,j)=\\min(f(i-1,p-1)+w(p,j)).\n\\]</span></p>\n<blockquote>\n<p>æœ‰å®šç†ï¼šè‹¥ <span class=\"math inline\">\\(w(i,j)\\)</span> æ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼ï¼Œé‚£ä¹ˆæœ‰ <span class=\"math inline\">\\(f(i-1,j)\\le f(i,j)\\le f(i,j+1)\\)</span>ï¼Œä» <span class=\"math inline\">\\(f\\)</span> å®šä¹‰å‡ºå‘å¾ˆå¥½æ„Ÿæ€§ç†è§£ã€‚</p>\n</blockquote>\n<p>é‚£ä¹ˆå¯ä»¥ä»è¿™ä¸€ç‚¹å‡ºå‘ï¼Œ<span class=\"math inline\">\\(p\\)</span> è¿™ä¸€ç»´å°±å¯ä»¥è¢«æ‘Šæ‰ï¼Œåšåˆ° <span class=\"math inline\">\\(O(n(n+m))\\)</span>ã€‚</p>\n<blockquote>\n<p>æœ‰å®šç†ï¼šè‹¥ <span class=\"math inline\">\\(w(i,j)\\)</span> æ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼ï¼Œé‚£ä¹ˆ <span class=\"math inline\">\\(f_i(j)\\)</span> æ˜¯å‡¸å‡½æ•°ã€‚</p>\n</blockquote>\n<p>é‚£å¾ˆå¥½äº†ã€‚ç›´æ¥å†²åˆº WQS å³å¯ã€‚</p>\n<hr />\n<h2 id=\"é—µå¯å¤«æ–¯åŸºå’Œ\">é—µå¯å¤«æ–¯åŸºå’Œ</h2>\n<p>ç»™å®šä¸¤ä¸ªå‡¸å‡½æ•°ï¼ˆå½“ç„¶æ˜¯æŒ‡ OI ä¸­é‚£ç§é•¿å¾—å¾ˆç›´çš„å‡½æ•°ï¼‰ï¼Œå°†å®ƒä»¬çš„ã€è¾¹ã€æ‹†ä¸‹æ¥è¿‡åï¼Œä»¥æŸç§æ–¹å¼æ‹¼åœ¨ä¸€èµ·ï¼Œä½¿å¾—æœ€åå¾—åˆ°ä¸€ä¸ªæ–°çš„å‡¸å‡½æ•°ã€‚</p>\n<p>æŒ‰æ¯æ¡ã€è¾¹ã€çš„æ–œç‡å½’å¹¶ä¸€ä¸‹å°±å¯ä»¥å¾—åˆ°ï¼Œæ˜¾ç„¶ç­”æ¡ˆå­˜åœ¨ä¸”å”¯ä¸€ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºé—µå¯å¤«æ–¯åŸºå’Œã€‚å¯ä»¥å‘ç°è¿™æ˜¯ä¸€ç§æœ€å€¼ - åŠ å·ç§¯ã€‚</p>\n<p>å‡è®¾æˆ‘ä»¬è¦æ±‚çš„ DP æ•°ç»„æ˜¯ä¸¤ä¸ªå·²çŸ¥çš„å­æ•°ç»„ä»¥ç±»ä¼¼çš„æ–¹æ³•å·èµ·æ¥çš„ï¼Œæœ€åè¦æ±‚å®Œæ•´çš„ DP æ•°ç»„ï¼ˆè€Œé WQS ä¸­çš„å•ç‚¹å€¼ï¼‰ï¼Œå°±å¯ä»¥è€ƒè™‘é—µå¯å¤«æ–¯åŸºå’Œã€‚</p>\n<p>å‘ç°è¿™ä¸ªç»“æ„æ˜¯å¾ˆé€‚åˆå½’å¹¶çš„ï¼Œä½¿ç”¨å½’å¹¶è¦æ±‚çŠ¶æ€ä¸­å«æœ‰ç‰ˆæœ¬ç»´ã€å› å˜é‡ç»´ã€‚</p>\n<hr />\n<h3 id=\"ä¾‹its-mooin-time-p\">ä¾‹ï¼šIt's Mooin' Time P</h3>\n<p><a href=\"https://www.luogu.com.cn/problem/P11459\" class=\"uri\">https://www.luogu.com.cn/problem/P11459</a></p>\n<p>å®šä¹‰ <span class=\"math inline\">\\(w_i\\)</span> ä¸ºå°† <span class=\"math inline\">\\([i,i+L)\\)</span> æ”¹ä¸º <code>MOO</code> çš„ä»£ä»·ï¼Œé—®é¢˜è½¬åŒ–ä¸ºé€‰å– <span class=\"math inline\">\\(1\\sim \\frac nL\\)</span> ä¸ªä¸é‡åŒºé—´çš„æœ€å°ä»£ä»·å’Œã€‚</p>\n<p>å°è¯•å½’å¹¶ï¼Œæ¯æ¬¡å°† <span class=\"math inline\">\\([l,mid]\\)</span> å’Œ <span class=\"math inline\">\\((mid, r]\\)</span> å·èµ·æ¥ã€‚ä½†æ˜¯ä¼šæœ‰ä¸€ç‚¹é—®é¢˜ï¼šå¦‚æœæ°å¥½æœ‰åŒºé—´å¡åœ¨ä¸­é—´å‘¢ï¼Ÿ</p>\n<p>å¯ä»¥ä»¤ <span class=\"math inline\">\\(f_{l,r,0/1/2,0/1/2}(i)\\)</span> è¡¨ç¤ºåœ¨ <span class=\"math inline\">\\([l,r]\\)</span> å†…é€‰äº† <span class=\"math inline\">\\(i\\)</span> ä¸ª <code>MOO</code>ï¼Œä¸”ä¸¤ä¾§æœ€è¿œçš„è¢«é€‰ç‚¹è·ç¦»ç«¯ç‚¹ä¸º <span class=\"math inline\">\\(0/1/\\ge 2\\)</span> çš„ DP å€¼ã€‚ç„¶åå¯ä»¥è¿›è¡Œç›¸åº”çš„è®¨è®ºã€å¹³ç§»ã€é—µå¯å¤«æ–¯åŸºå’Œï¼Œæœ€åå°†æ‰€æœ‰æƒ…å†µçº¿æ€§å– max å¾—åˆ°è¿™ä¸€å±‚çš„ç­”æ¡ˆï¼Œå®¹æ˜“å‘ç°å¾—åˆ°çš„ç­”æ¡ˆä¹Ÿæ˜¯å‡¸çš„ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 1e18;\nint L;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; L &gt;&gt; n;\n    std::vector&lt;int&gt; a(n + 1);\n    std::vector&lt;char&gt; t(n + 1);\n    std::vector&lt;long long&gt; w(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; t[i];\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    for (int i = 1; i &lt;= n - L + 1; ++i) &#123;\n        w[i] = a[i] * (t[i] != &#39;M&#39;);\n        for (int j = i + 1; j &lt; i + L; ++j)\n            w[i] += a[j] * (t[j] != &#39;O&#39;);\n        // printf(&quot;[%d, %d]: %lld\\n&quot;, i, i + L - 1, w[i]);\n    &#125;\n    if (L == 1) &#123;\n        std::sort(w.begin() + 1, w.end());\n        auto s(0ll);\n        for (int i = 1; i &lt;= n; ++i) &#123;\n            s += w[i];\n            std::cout &lt;&lt; s &lt;&lt; &#39;\\n&#39;;\n        &#125;\n        return 0;\n    &#125;\n    using arr = std::vector&lt;long long&gt;;\n    using brr = std::vector&lt;arr&gt;;\n    using crr = std::vector&lt;brr&gt;;\n    struct node &#123;\n        crr f;\n        node(int len): f(L, brr(L, arr(len, inf))) &#123;\n            for (int i = 0; i &lt; L; ++i)\n                for (int j = 0; j &lt; L; ++j)\n                    f[i][j][0] = 0ll;\n            return;\n        &#125;\n        brr&amp; operator[] (int q) &#123; return f[q]; &#125;\n    &#125;;\n    auto upd = [&amp;](arr &amp;x, arr y) &#123;\n        if (x.size() &lt; y.size())\n            x.resize(y.size(), inf);\n        for (int i = 0; i &lt; (int)y.size(); ++i)\n            x[i] = std::min(x[i], y[i]);\n        return;\n    &#125;;\n    auto merge = [&amp;](arr l, arr r) &#123;\n        arr out((int)(l.size() + r.size()) - 1), dl(l.size()), dr(r.size());\n        for (int i = 1; i &lt; (int)l.size(); ++i)\n            dl[i] = l[i] - l[i - 1];\n        for (int i = 1; i &lt; (int)r.size(); ++i)\n            dr[i] = r[i] - r[i - 1];\n        std::merge(dl.begin() + 1, dl.end(), dr.begin() + 1, dr.end(), out.begin() + 1);\n        out[0] = l[0] + r[0];\n        std::partial_sum(out.begin(), out.end(), out.begin());\n        return out;\n    &#125;;\n    std::function&lt;node(int, int)&gt; calc = [&amp;](int l, int r) &#123;\n        if (r - l + 1 &lt; 2 * L) &#123;\n            node res(1);\n            for (int ll = 0; ll &lt; L; ++ll)\n                for (int rr = 0; rr &lt; L; ++rr)\n                    if (l + ll &lt;= r - rr - L + 1) &#123;\n                        res[ll][rr].resize(2, inf);\n                        for (int i = l + ll; i &lt;= r - rr - L + 1; ++i)\n                            res[ll][rr][1] = std::min(res[ll][rr][1], w[i]);\n                        // printf(&quot;[%d, %d]: (%d, %d) = %lld\\n&quot;, l, r, ll, rr, res[ll][rr][1]);\n                    &#125;\n            // for (int i = 0; i &lt; L; ++i)\n            //     if (l + i + L - 1 &lt;= r) &#123;\n            //         printf(&quot;[%d, %d]: (%d, %d) = %lld\\n&quot;, l, r, i, r - (l + i + L - 1), w[l + i]);\n            //         res[i][r - (l + i + L - 1)].emplace_back(w[l + i]);\n            //     &#125;\n            return res;\n        &#125;   \n        int mid = (l + r) &gt;&gt; 1;\n        node tl(calc(l, mid)), tr(calc(mid + 1, r)), res((r - l + 1) / L + 1);\n        for (int ll = 0; ll &lt; L; ++ll)\n            for (int rr = 0; rr &lt; L; ++rr)\n                res[ll][rr] = merge(tl[ll][0], tr[0][rr]);\n        for (int ll = 0; ll &lt; L; ++ll)\n            for (int rr = 0; rr &lt; L; ++rr)\n                for (int i = 1; i &lt; L &amp;&amp; i &lt; mid; ++i)\n                    upd(res[ll][rr], merge(merge(tl[ll][i], tr[L - i][rr]), &#123; 0, w[mid - i + 1] &#125;));\n        for (int ll = 0; ll &lt; L; ++ll)\n            for (int rr = L - 1; rr; --rr)\n                upd(res[ll][rr - 1], res[ll][rr]);\n        for (int rr = 0; rr &lt; L; ++rr)\n            for (int ll = L - 1; ll; --ll)\n                upd(res[ll - 1][rr], res[ll][rr]);\n        // for (int i = 0; i &lt; L; ++i)\n        //     for (int j = 0; j &lt; L; ++j) &#123;\n        //         printf(&quot;  (%d, %d): &quot;, i, j);\n        //         for (auto p : res[i][j])\n        //             printf(&quot;%lld &quot;, p);\n        //         puts(&quot;&quot;);\n        //     &#125;\n        return res;\n    &#125;;\n    auto res(calc(1, n));\n    for (int i = 1; i &lt;= n / L; ++i)\n        std::cout &lt;&lt; res[0][0][i] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"ä¾‹å‡äºº\">ä¾‹ï¼šå‡äºº</h3>\n<p><a href=\"https://www.becoder.com.cn/problem/47728\" class=\"uri\">https://www.becoder.com.cn/problem/47728</a></p>\n<p>ä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºå‰ <span class=\"math inline\">\\(i\\)</span> ç»„é€‰å®Œå äº† <span class=\"math inline\">\\(j\\)</span> ä½“ç§¯çš„æœ€å¤§ä»·å€¼ã€‚é‚£ä¹ˆæœ‰ <span class=\"math inline\">\\(f_{i,j}=\\max\\{f_{i-1,k}+a_{i,j-k}\\}\\)</span>ã€‚</p>\n<p><em>è¢œï¼Œè¿™ä¸ªä¸œè¥¿å¥½å‡¸çš„æ ·å­ï¼å•Šï¼Ÿå±…ç„¶ä¸æ˜¯å‡¸çš„ï¼Ÿ</em></p>\n<p>äº‹å®ä¸Šï¼Œæœ‰ç»“è®ºï¼šè‹¥å¹²ä¸ªä½“ç§¯ä¸º <span class=\"math inline\">\\(0\\sim 4\\)</span> çš„ç‰©å“åšèƒŒåŒ…ï¼Œå¯ä»¥å‡‘å‡ºå€¼åŸŸå†…ä»»æ„ <span class=\"math inline\">\\(24\\)</span> çš„å€æ•°ã€‚æ‰€ä»¥å…ˆæŠŠä½“ç§¯å…¨éƒ¨ <span class=\"math inline\">\\(-1\\)</span>ï¼Œç„¶åå°±å¯ä»¥å¾—åˆ°ä½“ç§¯ä¸º <span class=\"math inline\">\\(0\\sim 4\\)</span> çš„ç‰©å“ã€‚ç„¶åä¼šå‘ç°ä»–ä»¬æŒ‰ç…§æ¨¡ <span class=\"math inline\">\\(12\\)</span> çš„ä½™æ•°åˆ†åˆ«æ˜¯å‡¸çš„ã€‚</p>\n<p>èƒ½æ„Ÿå—åˆ°æ¶æ„äº†ã€‚ç„¶åå°±å¯ä»¥æšä¸¾ä½“ç§¯ï¼Œå†é—µå¯å¤«æ–¯åŸºå’Œäº†ã€‚åŒæ ·éœ€è¦åœ¨çŠ¶æ€ä¸­å¼•å…¥ä½œä¸ºç‰ˆæœ¬å·çš„ <span class=\"math inline\">\\([l,r]\\)</span> ç»´ï¼Œæ˜¾ç„¶å› å˜é‡æ˜¯ä½“ç§¯ã€ç‰ˆæœ¬å·æ˜¯ç»„æ•°ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 1e18;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;fake2.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m = 0;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; siz(n + 1);\n    std::vector&lt;std::vector&lt;int&gt; &gt; a(n + 1);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; siz[i], m += siz[i];\n        a[i].resize(siz[i] + 1);\n        for (int j = 1; j &lt;= siz[i]; ++j)\n            std::cin &gt;&gt; a[i][j];\n    &#125;\n    using arr = std::vector&lt;long long&gt;;\n    struct node &#123;\n        std::vector&lt;arr&gt; f;\n        node(): f(12) &#123;&#125;\n        arr &amp;operator[] (int q) &#123;\n            return f[q];\n        &#125;\n    &#125;;\n    auto merge = [&amp;](arr &amp;p, arr &amp;q) &#123;\n        arr res((int)(p.size() + q.size()) - 1), dp(p.size()), dq(q.size());\n        std::adjacent_difference(p.begin(), p.end(), dp.begin());\n        std::adjacent_difference(q.begin(), q.end(), dq.begin());\n        std::merge(dp.begin() + 1, dp.end(), dq.begin() + 1, dq.end(), res.begin() + 1, std::greater&lt;long long&gt; ());\n        res[0] = p[0] + q[0];\n        std::partial_sum(res.begin(), res.end(), res.begin());\n        return res;\n    &#125;;\n    auto upd = [&amp;](arr y, arr &amp;x, int tag) &#123;\n        if (tag)\n            y.insert(y.begin(), -inf);\n        if (y.size() &gt; x.size())\n            x.resize(y.size(), -inf);\n        for (int i = 0; i &lt; (int)y.size(); ++i)\n            x[i] = std::max(x[i], y[i]);\n        return;\n    &#125;;\n    std::function&lt;node(int, int)&gt; calc = [&amp;](int l, int r) &#123;\n        if (l == r) &#123;\n            node res;\n            for (int i = 1; i &lt;= siz[l]; ++i)\n                res[i - 1].push_back(a[l][i]);\n            return res;\n        &#125;\n        int mid = (l + r) &gt;&gt; 1;\n        node tl(calc(l, mid)), tr(calc(mid + 1, r)), res;\n        for (int p = 0; p &lt; 12; ++p)\n            for (int q = 0; q &lt; 12; ++q)\n                if (!tl[p].empty() &amp;&amp; !tr[q].empty())\n                    upd(merge(tl[p], tr[q]), res[(p + q) % 12], p + q &gt;= 12);\n        return res;\n    &#125;;\n    auto res(calc(1, n));\n    for (int i = 0; i &lt;= m - n; ++i)\n        std::cout &lt;&lt; res[i % 12][i / 12] &lt;&lt; &#39; &#39;;\n    std::cout &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"slope-trick\">slope trick</h2>\n<p>å¯¹äºä¸€ä¸ª OI ä¸­çš„å‡¸å‡½æ•°ï¼Œå®ƒæ˜¯ç”±ä¸€äº›æ–œç‡å•è°ƒçš„çº¿æ®µæ‹¼æ¥æˆçš„å›¾å½¢ã€‚</p>\n<p>åœ¨è¿™ä¸ªå‰æä¸‹ï¼Œå‘ç°å¯ä»¥ç”¨æ•´ä¸ªå‡½æ•°çš„å·¦ / å³ç«¯ç‚¹å€¼ï¼ˆæˆªè·ï¼‰å’Œ <span class=\"math inline\">\\((n-1)\\)</span> ä¸ªæ–œç‡ / å·®åˆ†ä¿¡æ¯æè¿°å‡½æ•°ã€‚è€Œè¿™æœ‰æ—¶æ¯”ç›´æ¥ç»´æŠ¤ <span class=\"math inline\">\\(n\\)</span> ä¸ªç‚¹å€¼æœ‰ç€æ›´ä¼˜ç¾çš„æ€§è´¨ï¼Œå”¤å…¶ä¸º slope trickã€‚</p>\n<p>ä¾‹å¦‚ï¼Œå…³äºæ–œç‡åºåˆ—ï¼Œå¦‚æœå®šä¹‰åŸŸä¸å¤§ï¼Œå¯ä»¥ç›´æ¥ç»´æŠ¤ï¼›å¦‚æœå®ƒçš„å˜åŒ–æ¬¡æ•°ä¸å¤šï¼Œå¯ä»¥åˆ©ç”¨å®ƒçš„å•è°ƒæ€§è´¨ï¼Œç”¨å•è°ƒæ•°æ®ç»“æ„ç»´æŠ¤ï¼›å¦‚æœå®ƒçš„å€¼åŸŸå¾ˆå°ï¼Œå¯ä»¥ç›´æ¥ç»´æŠ¤æ‹ç‚¹ã€‚</p>\n<p>æ³¨æ„å‰ä¸¤ç§æ–¹æ³•ä¸€èˆ¬å…³æ³¨æ¨ªåæ ‡å¯¹åº”çš„å‡½æ•°å€¼ï¼Œæ‰€ä»¥è‡ªå˜é‡ä¸€èˆ¬æ˜¯å’Œæ“ä½œæ¬¡æ•°ä¸€ç±»æœ‰å…³çš„ï¼›è€Œè¿™é‡Œå…³æ³¨å‡½æ•°æœ€å€¼è€Œå¼±åŒ–äº†å…·ä½“æ¨ªåæ ‡ï¼Œæ“ä½œæ¬¡æ•°ä¸€èˆ¬ä¼šä½œä¸ºå¾…æœ€ä¼˜åŒ–çš„å› å˜é‡ï¼Œä¾‹å¦‚ï¼š</p>\n<ul>\n<li>æˆ‘æƒ³è¦å°†æ•°åˆ—é€šè¿‡è‹¥å¹²æ¬¡å•ç‚¹ä¿®æ”¹ä½¿åºåˆ—å•è°ƒï¼Œä½†ä¸å…³å¿ƒåºåˆ—æœ€ç»ˆå½¢æ€ï¼Œé—®æœ€å°æ“ä½œæ¬¡æ•°ã€‚</li>\n<li>æˆ‘æƒ³è¦è®©æ ‘ä¸Šæ‰€æœ‰å¶å­åˆ°æ ¹çš„è·¯å¾„è¾¹æƒå’Œç›¸ç­‰ï¼Œä½†ä¸å…³å¿ƒè¿™ä¸ªå€¼æ˜¯å¤šå°‘ï¼Œé—®æœ€å°æ“ä½œæ¬¡æ•°ã€‚</li>\n</ul>\n<p>ä¸‹é¢ä¾æ¬¡è§£å†³ä¸Šè¿°é—®é¢˜ã€‚</p>\n<hr />\n<h3 id=\"ä¾‹åºåˆ—-sequence\">ä¾‹ï¼šåºåˆ— sequence</h3>\n<p><a href=\"https://www.luogu.com.cn/problem/P4597\" class=\"uri\">https://www.luogu.com.cn/problem/P4597</a></p>\n<p>æš´åŠ›åœ°ï¼Œä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤º <span class=\"math inline\">\\(a_i\\)</span> æœ€ç»ˆè¢«ä¿®æ”¹ä¸º <span class=\"math inline\">\\(j\\)</span>ï¼Œå®¹æ˜“å†™å‡º DP å¼å­ <span class=\"math inline\">\\(f_{i,j}=\\min\\limits_{k\\le j}\\{f_{i-1,k}\\}+|a_i-j|\\)</span>ã€‚</p>\n<p>ç„¶åå°±ä¼šå‘ç°å®ƒçš„å®šä¹‰åŸŸå®åœ¨æ˜¯å¤ªå¤§äº†ï¼é‚£å¦‚æœå…³æ³¨æ–œç‡çš„å˜åŒ–æƒ…å†µå‘¢ï¼Ÿ</p>\n<p>ä»¤ <span class=\"math inline\">\\(f_{i-1}(k)\\)</span> çš„æå€¼ç‚¹ä¸º <span class=\"math inline\">\\(k_m\\)</span>ï¼Œåˆ†ç±»è®¨è®ºæ‹†ç»å¯¹å€¼å’Œ minï¼š</p>\n<ul>\n<li><p>å½“ <span class=\"math inline\">\\(j\\le a_i\\)</span> æ—¶ï¼Œ<span class=\"math inline\">\\(f_i(j)=\\min\\limits_{k\\le j}\\{f_{i-1}(k)\\}+a_i - j\\)</span>ã€‚</p>\n<ul>\n<li>å½“ <span class=\"math inline\">\\(j &lt; k_m\\)</span> æ—¶ï¼Œ<span class=\"math inline\">\\(f_i(j)=f_{i-1}(j)+a_i-j\\)</span>ï¼Œæ–œç‡ç›¸å¯¹äº <span class=\"math inline\">\\(f_{i-1}(j)\\)</span> æ•´ä½“å‡ <span class=\"math inline\">\\(1\\)</span>ã€‚<del>æˆ‘å°±è¯´å¯¼æ•°æ²¡ç™½å­¦å§</del></li>\n<li>å½“ <span class=\"math inline\">\\(j \\ge k_m\\)</span> æ—¶ï¼Œ<span class=\"math inline\">\\(f_i(j)=f_{i-1}(k_m)+a_i-j\\)</span>ï¼Œæ–œç‡ä¸º <span class=\"math inline\">\\(-1\\)</span>ã€‚</li>\n</ul></li>\n<li><p>å½“ <span class=\"math inline\">\\(j &gt; a_i\\)</span> æ—¶ï¼Œ<span class=\"math inline\">\\(f_i(j)=\\min\\limits_{k\\le j}\\{f_{i-1}(k)\\}+j-a_i\\)</span>ã€‚</p>\n<ul>\n<li>å½“ <span class=\"math inline\">\\(j &lt; k_m\\)</span> æ—¶ï¼Œ<span class=\"math inline\">\\(f_i(j)=f_{i-1}(j)+j-a_i\\)</span>ï¼Œæ–œç‡ç›¸å¯¹äº <span class=\"math inline\">\\(f_{i-1}(j)\\)</span> æ•´ä½“åŠ  <span class=\"math inline\">\\(1\\)</span>ã€‚</li>\n<li>å½“ <span class=\"math inline\">\\(j\\ge k_m\\)</span> æ—¶ï¼Œ<span class=\"math inline\">\\(f_i(j) = f_{i-1}(k_m)+j-a_i\\)</span>ï¼Œæ–œç‡ä¸º <span class=\"math inline\">\\(1\\)</span>ã€‚</li>\n</ul></li>\n</ul>\n<p>å¦‚æœç°åœ¨æˆ‘ä»¬æä¸€ä¸ªæ”¯æŒåŒºé—´åŠ æ–œç‡ã€åŒºé—´æ¨å¹³æ–œç‡ä¸”ç»´æŠ¤åŒºé—´å‡½æ•°æœ€å€¼ç‚¹çš„æ•°æ®ç»“æ„ï¼Œé‚£å°±å¤ªé€†å¤©äº†ã€‚ä¸€ä¸ªç»å…¸çš„è§£å†³æ–¹æ¡ˆæ˜¯ç”¨å †ç»´æŠ¤çº¿æ®µæ–œç‡çš„å·®åˆ†ï¼ˆä¹Ÿå°±æ˜¯å·®åˆ†çš„å·®åˆ†ï¼‰ã€‚</p>\n<p>å‘ç°æ•´ä½“ä¿®æ”¹æ¬¡æ•°æ˜¯ <span class=\"math inline\">\\(O(n)\\)</span> çš„ï¼Œä¸”å¦‚æœåªçœ‹æ¯” <span class=\"math inline\">\\(k_m\\)</span> æ›´å·¦çš„ <span class=\"math inline\">\\(j\\)</span>ï¼ˆæ›´é å³çš„å·²ç»ä¸æå€¼æ— å…³æ‰€ä»¥ä¸ç”¨ç»´æŠ¤ï¼‰ï¼Œé‚£ä¹ˆå°±åªéœ€è¦ç»´æŠ¤åŒºé—´å‡æ³•ã€‚</p>\n<p>å¦‚æœå°†ä¸€æ¬¡åŒºé—´å‰ç¼€å‡æ³•çœ‹ä½œä¸€æ¬¡å‰ç¼€å³ç«¯ç‚¹å…¥é˜Ÿï¼Œæ˜¾ç„¶å·¦ä¾§æŸç‚¹ <span class=\"math inline\">\\(a\\)</span> çš„å®é™…è¢«å‡æ¬¡æ•°ä¸º <span class=\"math inline\">\\(a\\)</span> å…¥é˜Ÿçš„æ¬¡æ•° + æ‰€æœ‰å³äº <span class=\"math inline\">\\(a\\)</span> ç‚¹çš„å…ƒç´ çš„å…¥é˜Ÿæ¬¡æ•°ã€‚ç”¨å¤§æ ¹å †ç»´æŠ¤è¿™äº›å…ƒç´ ï¼Œå°±å¯ä»¥å¿«é€Ÿç»´æŠ¤æ•´ä¸ªæ–œç‡åºåˆ—ã€‚ä¾‹å¦‚ <code>3 2 2 1</code>ï¼Œä»£è¡¨ <span class=\"math inline\">\\(3\\)</span> å¤„æ–œç‡ä¸º <span class=\"math inline\">\\(-1\\)</span>ï¼Œ<span class=\"math inline\">\\(2\\)</span> å¤„æ–œç‡ä¸º <span class=\"math inline\">\\(-3\\)</span>ï¼Œ<span class=\"math inline\">\\(1\\)</span> å¤„æ–œç‡ä¸º <span class=\"math inline\">\\(-4\\)</span>ã€‚</p>\n<ul>\n<li><p>å½“ <span class=\"math inline\">\\(a_i\\ge k_m\\)</span> æ—¶ï¼ˆå®¹æ˜“å‘ç°å®ƒä¼šæˆä¸ºæ–°çš„ <span class=\"math inline\">\\(k_m\\)</span>ï¼‰ï¼Œç›´æ¥æŠŠ <span class=\"math inline\">\\(a_i\\)</span> åŠ å…¥å¤§æ ¹å †ï¼Œå°±å¯ä»¥æŠŠ <span class=\"math inline\">\\(\\le a_i\\)</span> çš„æ‰€æœ‰ä½ç½®æ–œç‡å‡å» <span class=\"math inline\">\\(1\\)</span>ã€‚</p>\nä»€ä¹ˆä½ é—®åœ¨ <span class=\"math inline\">\\(k_m\\)</span> å’Œ <span class=\"math inline\">\\(a_i\\)</span> ä¹‹é—´çš„æ¨å¹³æ€ä¹ˆåŠï¼Ÿç”±äºå”¯ä¸€å³äºå®ƒä»¬çš„æ‹ç‚¹ <span class=\"math inline\">\\(a_i\\)</span> å…¥äº†ä¸€æ¬¡é˜Ÿï¼Œæ‰€ä»¥ä¸­é—´çš„å…ƒç´ æ–œç‡è‡ªç„¶æ˜¯ <span class=\"math inline\">\\(-1\\)</span> å•Šã€‚</li>\n<li><p>å½“ <span class=\"math inline\">\\(a_i&lt;k_m\\)</span> æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p>\n<ol type=\"1\">\n<li>å°† <span class=\"math inline\">\\(a_i\\)</span> ä»¥å·¦çš„ä½ç½®æ–œç‡å‡å» <span class=\"math inline\">\\(1\\)</span>ï¼Œç›´æ¥å°† <span class=\"math inline\">\\(a_i\\)</span> å…¥é˜Ÿå³å¯ã€‚</li>\n<li>å°† <span class=\"math inline\">\\(a_i\\)</span> å’Œ <span class=\"math inline\">\\(k_m\\)</span> ä¹‹é—´çš„ä½ç½®æ–œç‡åŠ ä¸Š <span class=\"math inline\">\\(1\\)</span>ï¼ŒæŠŠ <span class=\"math inline\">\\(k_m\\)</span> å¼¹å‡ºï¼ˆå¤ªå¥½äº†å°±åœ¨é˜Ÿé¦–ï¼‰å†æŠŠ <span class=\"math inline\">\\(a_i\\)</span> åŠ å…¥å³å¯ã€‚ç”±äº <span class=\"math inline\">\\(k_m\\)</span> æ˜¾ç„¶æ˜¯ä¸€ä¸ªæ‹ç‚¹ï¼Œæ‰€ä»¥åˆ é™¤ <span class=\"math inline\">\\(k_m\\)</span> å¹¶éè™šç©ºç´¢æ•Œï¼Œä½†æ³¨æ„ <span class=\"math inline\">\\(k_m\\)</span> å¯èƒ½ä¼šå˜åŒ–æˆå…¶åç»§ã€‚</li>\n</ol></li>\n</ul>\n<p>å…¶å®å°±ä¼šå‘ç°è¿˜æœ‰ä¸€äº›æœ‰è¶£çš„å°æ€§è´¨ï¼Œæ¯”å¦‚ <span class=\"math inline\">\\(k_m\\)</span> ä¸é˜Ÿé¦–ç­‰ä»·ï¼ˆç”¨äºå®ç°ï¼‰ï¼›<span class=\"math inline\">\\(k_m\\)</span> å³ä¾§æ–œç‡å…¨éƒ¨ä¸º <span class=\"math inline\">\\(1\\)</span>ï¼Œä¹Ÿæ˜¯å”¯ä¸€å¯ä»¥å–åˆ°çš„æ­£æ–œç‡ã€‚</p>\n<details>\n<p>è¢œå†™èµ·æ¥å¥½ç®€å•ã€‚</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; a(n + 1);\n    long long res = 0ll;\n    std::priority_queue&lt;int&gt; q;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i];\n        if (i == 1 || a[i] &gt;= q.top())\n            q.push(a[i]);\n        else &#123;\n            res += q.top() - a[i];\n            q.pop(), q.push(a[i]), q.push(a[i]);\n        &#125;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"ä¾‹çƒŸèŠ±è¡¨æ¼”\">ä¾‹ï¼šçƒŸèŠ±è¡¨æ¼”</h3>\n<p><a href=\"https://www.luogu.com.cn/problem/P3642\" class=\"uri\">https://www.luogu.com.cn/problem/P3642</a></p>\n<p>è®¾ <span class=\"math inline\">\\(f_{u,d}\\)</span> è¡¨ç¤ºåœ¨ <span class=\"math inline\">\\(u\\)</span> å­æ ‘ä¸­æ‰€æœ‰å¶å­è·æ ¹å‡ä¸º <span class=\"math inline\">\\(d\\)</span> çš„æœ€å°ä»£ä»·ã€‚é‚£ä¹ˆæœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\nf_{u,d}=\\sum\\limits_{(v, w)\\in u}\\min\\limits_{0\\le w&#39;\\le d}\\{f_{v,d-w&#39;}+|w-w&#39;|\\}.\n\\]</span></p>\n<p>å¯ä»¥å½’çº³è¯æ˜ <span class=\"math inline\">\\(f_{u,d}\\)</span> ä¸ºå‡¸ï¼›å’Œä¸Šä¸€é¢˜ç›¸ä¼¼åœ°ï¼Œè€ƒè™‘ç”¨ <span class=\"math inline\">\\(f_v\\)</span> çš„å †å¾—åˆ° <span class=\"math inline\">\\(f_u\\)</span> çš„å †ã€‚</p>\n<p>é¦–å…ˆæœ€å¤–å±‚æ˜¯ä¸€ä¸ªçº¿æ€§åŠ ï¼Œè¿™å…¶å®å°±æ˜¯æŠŠå·®åˆ†æ•°ç»„ / æ–œç‡åŠ èµ·æ¥ï¼Œæ”¾åˆ°æˆ‘ä»¬è¿™ä¸ªå †é‡Œé¢å°±æ˜¯åˆå¹¶ä¸¤ä¸ªå †ã€‚è™½ç„¶ä½ å¯èƒ½å’Œæˆ‘ä¸€æ ·ä¸è®¤è¯†å¯å¹¶å †ï¼Œä½†æ˜¯ä½ å¯ä»¥å’Œæˆ‘ä¸€æ ·ä¸ä¼š pd_dsã€‚</p>\n<p>å†çœ‹å†…å±‚ï¼Œå‘ç°å’Œä¸Šä¸€é¢˜é•¿å¾—åƒä½†å…¶å®ä¸ä¸€æ ·ï¼Œå‘œå‘œå‘œã€‚å‘ç° <span class=\"math inline\">\\(|w-w&#39;|\\)</span> æ˜¯ä¸€ä¸ªå·¦å³æ–œç‡åˆ†åˆ«ä¸º <span class=\"math inline\">\\(-1,1\\)</span> çš„åˆ†æ®µå‡½æ•°ï¼Œè€Œå·¦è¾¹ç±»æ¯”å¯å¾—æ–œç‡æœ€å¤§ä¸º <span class=\"math inline\">\\(1\\)</span>ã€‚</p>\n<p>ç”±é—µå¯å¤«æ–¯åŸºå’Œï¼Œå†…å±‚å‡½æ•°æ–œç‡ <span class=\"math inline\">\\(&lt;-1\\)</span> çš„éƒ¨åˆ†æ¥è‡ª <span class=\"math inline\">\\(f_{v,d-w&#39;}\\)</span>ï¼›<span class=\"math inline\">\\(=-1\\)</span> çš„éƒ¨åˆ†æ¥è‡ª <span class=\"math inline\">\\(f_{v,d-w&#39;}\\)</span> å’Œ <span class=\"math inline\">\\(|w-w&#39;|\\)</span> çš„å·¦åŠè¾¹ï¼ˆæ„Ÿè°¢ <span class=\"math inline\">\\(w&#39;\\)</span> æ˜¯æœ‰ä¸‹ç¡®ç•Œçš„ï¼‰ï¼›<span class=\"math inline\">\\(=0\\)</span> çš„éƒ¨åˆ†æ¥è‡ª <span class=\"math inline\">\\(f_{v,d-w&#39;}\\)</span>ï¼›<span class=\"math inline\">\\(&gt;0\\)</span> çš„éƒ¨åˆ†æˆ‘ä»¬ä¸å…³å¿ƒã€‚</p>\n<p>æœ€ç»ˆå‡½æ•°å›¾åƒçš„å˜åŒ–ï¼šæ°´å¹³éƒ¨åˆ†çš„å·¦ç«¯ç‚¹å³ç§»äº† <span class=\"math inline\">\\(w\\)</span>ã€‚æ‰¾åˆ° <span class=\"math inline\">\\(f_{v,d}\\)</span> ä¸­çš„æ°´å¹³çº¿æ®µå’Œæ–œç‡ä¸º <span class=\"math inline\">\\(1\\)</span> çš„çº¿æ®µï¼Œä»¤å…¶åœ¨å †ä¸­çš„å€¼ <span class=\"math inline\">\\(+w\\)</span> å°±èƒ½è¾¾åˆ°å¹³ç§»çš„ç›®çš„ã€‚</p>\n<p>ä½†éœ€è¦æ³¨æ„ï¼Œæ­¤æ—¶ä»ç„¶éœ€è¦ <strong>ä¿ç•™å†…å±‚å‡½æ•°ä¸­æ–œç‡ä¸º <span class=\"math inline\">\\(1\\)</span> çš„éƒ¨åˆ†ï¼Œä½†æ–œç‡ <span class=\"math inline\">\\(&gt;1\\)</span> çš„éƒ¨åˆ†è¢«åˆ é™¤</strong>ã€‚åŸå› å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>ç»å¯¹å€¼å‡½æ•°ä¸å†…å±‚å‡½æ•°å®šä¹‰åŸŸç›¸åŒï¼Œä½œé—µå¯å¤«æ–¯åŸºå’Œåï¼Œæ–œç‡ä¸º <span class=\"math inline\">\\(1\\)</span> çš„å³ä¾§çº¿æ®µä¼šå°† <span class=\"math inline\">\\(f_{v,d-w&#39;}\\)</span> ä¸­åŸæœ‰çš„ <span class=\"math inline\">\\(&gt;1\\)</span> çš„éƒ¨åˆ†ã€æŒ¤ã€å‡ºå®šä¹‰åŸŸï¼Œæ•…å¯ä»¥å°†å…¶ç›´æ¥åˆ é™¤ã€‚</li>\n<li>æ–œç‡ä¸º <span class=\"math inline\">\\(1\\)</span> çš„éƒ¨åˆ†ï¼Œè™½ç„¶å¯¹å†…å±‚å‡½æ•°ä¸­æå€¼ç‚¹æ— è´¡çŒ®ï¼Œä½†åœ¨å¤–å±‚å‡½æ•°ä¸­æå€¼ç‚¹å¯èƒ½å‘å³åç§»ï¼Œæ­¤æ—¶ä¼šå¯¹å…¶äº§ç”Ÿå½±å“ï¼Œéœ€è¦ç»´æŠ¤ã€‚</li>\n</ul>\n<p>å®¹æ˜“å‘ç°ç”±äº <span class=\"math inline\">\\(w&#39;\\)</span> çš„å–å€¼ä¸Šé™æ˜¯ <span class=\"math inline\">\\(d\\)</span>ï¼Œä½† <span class=\"math inline\">\\(d\\)</span> æ²¡æœ‰ä¸Šç•Œï¼Œæ‰€ä»¥æ¯ä¸ªå†…å±‚å‡½æ•°çš„å³ä¾§éƒ½ä¸€å®šæ˜¯ä¸€æ¡æ–œç‡ä¸º <span class=\"math inline\">\\(1\\)</span> çš„å°„çº¿ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªå¤–å±‚å‡½æ•°ä¸€å®šæœ‰ï¼ˆå„¿å­ä¸ªæ•°ï¼‰ä¸ªæ‹ç‚¹ï¼ˆå †ä¸­å…ƒç´ ï¼‰ï¼Œå¼¹å‡ºè¿™ä¹ˆå¤šä¸ªå°±å¯ä»¥åˆ é™¤å¤–å±‚å‡½æ•°ä¸­æ–œç‡ <span class=\"math inline\">\\(&gt;1\\)</span> çš„çº¿æ®µï¼Œé¡ºä¾¿æ‰¾åˆ°æ–œç‡ä¸º <span class=\"math inline\">\\(0\\)</span> å’Œ <span class=\"math inline\">\\(1\\)</span> çš„çº¿æ®µã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\n#include &lt;ext/pb_ds/priority_queue.hpp&gt;\nconst int inf= 0x3f3f3f3f;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m, n += m;\n    std::vector&lt;std::vector&lt;std::pair&lt;int, int&gt; &gt; &gt; g(n + 1);\n    auto res(0ll);\n    for (int i = 2, fa, w; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; fa &gt;&gt; w, res += w;\n        g[fa].emplace_back(i, w);\n    &#125;\n    std::vector&lt;__gnu_pbds::priority_queue&lt;long long&gt; &gt; q(n + 1);\n    std::function&lt;void(int)&gt; DFS = [&amp;](int x) &#123;\n        if (g[x].empty())\n            q[x].push(0), q[x].push(0);\n        else\n            for (auto [i, w] : g[x]) &#123;\n                DFS(i);\n                for (int j = 1; j &lt; (int)g[i].size(); ++j)\n                    q[i].pop();\n                long long t1 = q[i].top(), t0;\n                q[i].pop(), t0 = q[i].top(), q[i].pop();\n                q[i].push(t1 + w), q[i].push(t0 + w);\n                q[x].join(q[i]);\n            &#125;\n        // fprintf(stderr, &quot;size(%d) = %d\\n&quot;, x, (int)q[x].size());\n        return;\n    &#125;;\n    DFS(1);\n    for (int i = 1; i &lt;= (int)g[1].size(); ++i)\n        q[1].pop();\n    for (; !q[1].empty(); q[1].pop())\n        res -= q[1].top();\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"ä¾‹buy-low-sell-high\">ä¾‹ï¼šBuy Low Sell High</h3>\n<p><a href=\"https://codeforces.com/problemset/problem/865/D\" class=\"uri\">https://codeforces.com/problemset/problem/865/D</a></p>\n<p>ä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºåœ¨ç¬¬ <span class=\"math inline\">\\(i\\)</span> å¤©ç»“æŸåæŒæœ‰ <span class=\"math inline\">\\(j\\)</span> æ”¯è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Šã€‚åˆ™ <span class=\"math inline\">\\(f_{i,j}=\\max\\{f_{i-1,j},f_{i-1,j-1}-a_i,f_{i-1,j+1}+a_i\\}\\)</span>ã€‚</p>\n<p>ï¼ˆç”±äºè¿™é‡Œå’Œ max æœ‰å…³æ‰€ä»¥éœ€è¦ç²¾ç»†æè¿°å‡¹å‡¸äº†ï¼‰å‘ç°å°±æ˜¯æŠŠä¸‰ä¸ªï¼ˆå¯èƒ½ï¼‰ç»è¿‡å¹³ç§»çš„ï¼ˆå¯èƒ½ï¼‰å‡¹çš„å‡½æ•°åšçº¿æ€§ maxã€‚è™½ç„¶å®é™…ä¸Šçš„ç»“è®ºã€å‡½æ•°åœ¨æ•´ç‚¹ä¸Šæ˜¯å‡¹çš„ã€ä¸ç®—å¤ªæ˜¾ç„¶ï¼Œä½†æ˜¯å¯ä»¥çŒœæ˜¯å‡¹çš„ã€‚</p>\n<p>çº¿æ€§ max åœ¨ slope trick ä¸­æ˜¯ä¸å¤ªèƒ½ä½“ç°çš„ï¼Œä½†æˆ‘ä»¬å‘ç°è¿™é‡Œæ˜¯åŒä¸€ä¸ªå‡¹å‡½æ•°å‘å·¦ä¸Šã€å³ä¸‹å¹³ç§»åŒä¸€ä¸ªå‘é‡ï¼Œå¸Œæœ›å¾—åˆ°æ–°çš„å‡¹å‡½æ•°ä¸ç®¡æ˜¯ä»å·®åˆ†è§’åº¦è¿˜æ˜¯å›¾è±¡ï¼Œéƒ½èƒ½å¾—åˆ°æ–°å‡½æ•°ç”±å·¦ä¸Šéƒ¨åˆ†æ–œç‡ <span class=\"math inline\">\\(&gt;-a_i\\)</span> çš„çº¿æ®µã€ä¸¤æ®µæ–œç‡ <span class=\"math inline\">\\(=-a_i\\)</span> çš„çº¿æ®µã€å³ä¸‹éƒ¨åˆ†æ–œç‡ <span class=\"math inline\">\\(&lt;-a_i\\)</span> çš„çº¿æ®µç»„æˆã€‚æ­¤å¤–ï¼Œç”±äºå‘å·¦ä¸Šå¹³ç§»çš„å‡½æ•°æœ‰ä¸€å¤„ç¦»å¼€äº†å®šä¹‰åŸŸï¼Œè¿˜éœ€å°†å…¶å‰”é™¤ã€‚</p>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“ <span class=\"math inline\">\\(-a_i\\)</span> æ¯”æœ€å°æ–œç‡è¿˜è¦å°æ—¶ä¼šæœ‰å˜åŒ–ï¼Œå¯ä»¥ç”»å›¾çœ‹ä¸€ä¸‹ã€‚</p>\n<p><img src=\"2.png\" /></p>\n<p>å‘ç°å®šä¹‰åŸŸæ˜¯ç›¸å¯¹å°çš„ï¼ˆ<span class=\"math inline\">\\(0\\le j\\le n\\)</span>ï¼‰ï¼Œæ•…ç”¨ä¼˜å…ˆé˜Ÿåˆ—ç»´æŠ¤æ•´ä¸ªæ–œç‡åºåˆ—å°±å¯ä»¥å¿«é€Ÿæ’å…¥ä¸¤ä¸ª <span class=\"math inline\">\\(k=-a_i\\)</span> çš„çº¿æ®µã€‚å®¹æ˜“å‘ç°é¡¶ç‚¹åœ¨ <span class=\"math inline\">\\(j=0\\)</span> å¤„å–å¾—ï¼ˆä»å›¾è±¡å’Œå®šä¹‰éƒ½æ˜“çŸ¥ï¼‰ï¼Œæœ€å³ä¾§æ˜¯åªä¹°ä¸å–çš„æœ€åŠ£æ–¹æ¡ˆï¼Œå¯ä»¥å€’æ¨ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; a(n + 1);\n    auto res = 0ll;\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i], res -= a[i];\n    std::priority_queue&lt;int&gt; q;\n    q.push(-a[1]);\n    for (int i = 2; i &lt;= n; ++i)\n        if (a[i] &lt; -q.top())\n            q.push(-a[i]);\n        else\n            q.pop(), q.push(-a[i]), q.push(-a[i]);\n    for (; !q.empty(); res -= q.top(), q.pop());\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n",
            "tags": [
                "DP",
                "åæ‚”è´ªå¿ƒ",
                "DP ä¼˜åŒ–"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250526/",
            "url": "https://xsc062.netlify.app/20250526/",
            "title": "æ‚é¢˜é€‰è°ˆï¼šå¤šç»´ DP",
            "date_published": "2025-05-26T07:05:53.000Z",
            "content_html": "<p>ä¸Šæ¥¼å¬åˆ°æœ‰äººåœ¨å“¼ <em>Climbing on the Trees</em>ï¼Œä¸Šæ¥å¬åˆ°éš”å£ç­åœ¨æ”¾ <em>Burn the House Down</em>ï¼Œæœç„¶æ˜¥å¤©æ˜¯ AJR çš„å­£èŠ‚ï¼ˆï¼‰</p>\n<span id=\"more\"></span>\n<hr />\n<p>ä¸»è¦æ˜¯å¤šç»´ DP ç‰¹æœ‰çš„ä¼˜åŒ–ï¼</p>\n<h2 id=\"åˆ†æ­¥è½¬ç§»\">åˆ†æ­¥è½¬ç§»</h2>\n<p>å¦‚æœçŠ¶æ€çš„è‹¥å¹²ç»´ä¹‹é—´åªå­˜åœ¨å¾ˆå¼±çš„è”ç³»ï¼Œå¯ä»¥åˆ†æ­¥è½¬ç§»æ¯ä¸€ç»´ã€‚</p>\n<p>å‡è®¾æœ‰äºŒç»´çŠ¶æ€è½¬ç§» <span class=\"math inline\">\\((a,b)\\to (a&#39;,b&#39;)\\)</span>ï¼Œã€å¾ˆå¼±çš„è”ç³»ã€ä¸¾ä¾‹ï¼š</p>\n<ol type=\"1\">\n<li>DP å€¼ä¸­åŒ…å« <span class=\"math inline\">\\(w(a&#39;,b&#39;)\\)</span>ï¼Œä½†ä¸åŒ…å«è¯¸å¦‚ <span class=\"math inline\">\\(w(a&#39;,b),w(a,b&#39;)\\)</span> ä¹‹ç±»ã€‚ä¹Ÿå³è¯¥å€¼çš„æ±‚è§£ä¸ä¾èµ–äºä¸Šä¸€ä¸ªçŠ¶æ€ã€ä¸ä¾èµ–äºè½¬ç§»ã€‚</li>\n<li>å¯¹äº <span class=\"math inline\">\\((a&#39;,b&#39;)\\)</span> çš„å–å€¼æœ‰é™åˆ¶ï¼Œæ¯”å¦‚ <span class=\"math inline\">\\((114,514)\\)</span> ä¸èƒ½å–åˆ°ä¹‹ç±»ã€‚æ˜¾ç„¶è¿™ä¹Ÿä¸ä¾èµ–äºä¸Šä¸€ä¸ªçŠ¶æ€ã€ä¸ä¾èµ–äºè½¬ç§»ã€‚</li>\n<li>ç¬¦å·é™åˆ¶ï¼ˆå¦‚è½¬ç§»é—´ä¸º <span class=\"math inline\">\\(+\\)</span>ï¼ŒçŠ¶æ€é—´ä¸º <span class=\"math inline\">\\(\\times\\)</span> ä¹‹ç±»ï¼‰ï¼Œåœ¨è®¡æ•°ä¸­å¸¸å‡ºç°ã€‚</li>\n<li>ä¸€ä¸ªå˜åŠ¨çš„æ—¶å€™å¦ä¸€ä¸ªå¿…é¡»ä¹Ÿä¸€èµ·åŠ¨ã€‚</li>\n</ol>\n<p>æ³¨æ„ï¼æœ‰çš„æ—¶å€™ä¸€ä¸ªçŠ¶æ€ä¹Ÿå¯ä»¥æ‹†æˆä¸¤ä¸ªçŠ¶æ€ï¼Œç„¶ååˆ†æ­¥è½¬ç§»ã€‚</p>\n<hr />\n<h3 id=\"ä¾‹é¢˜ç»å…¸é¢˜\">ä¾‹é¢˜ï¼šç»å…¸é¢˜</h3>\n<blockquote>\n<p>ç»™å®š <span class=\"math inline\">\\(w_{N\\times M}\\)</span>ï¼Œæ±‚ <span class=\"math inline\">\\((A,B)_{1\\sim K}\\)</span>ï¼Œæœ€å¤§åŒ– <span class=\"math inline\">\\(\\sum\\limits_{i=1}^K w_{A_i,B_i}+w_{A_{i-1},A_i}+w_{B_{i-1},B_i}\\)</span> çš„å€¼ã€‚</p>\n</blockquote>\n<p>å‘ç°å¦‚æœè®¾ <span class=\"math inline\">\\(f_{i,a,b}\\)</span> è¡¨ç¤º <span class=\"math inline\">\\((A,B)_i=(a,b)\\)</span> çš„è¯ï¼Œè½¬ç§»å°±ä¼šè¾¾åˆ°å¯è§‚çš„ <span class=\"math inline\">\\(O(N\\times M)\\)</span>ï¼›ä½†å‘ç°é‡Œé¢çš„ <span class=\"math inline\">\\(A\\)</span> å’Œ <span class=\"math inline\">\\(B\\)</span> å…¶å®æ²¡ä»€ä¹ˆæœ‰æœºè”ç³»ï¼›å”¯ä¸€çš„è”ç³» <span class=\"math inline\">\\(w_{A_i,B_i}\\)</span>ï¼ˆä¸Šé¢ã€å¾ˆå¼±çš„è”ç³»ã€ä¸­çš„ç¬¬ä¸€ã€å››ç§æƒ…å†µï¼‰ã€‚å› æ­¤åˆ†å¸ƒè½¬ç§»ï¼š</p>\n<p><span class=\"math display\">\\[\nf&#39;_{a&#39;,b}\\gets \\max\\limits_a f_{a,b}+w_{a&#39;,a}\\\\\nf_{a&#39;,b&#39;}\\gets \\max\\limits_b f&#39;_{a&#39;, b} + w_{b,b&#39;}+w_{a&#39;,b&#39;}\n\\]</span></p>\n<p>ç”±æ­¤ä¾¿ä¼˜åŒ–è½¬ç§»å¤æ‚åº¦åˆ° <span class=\"math inline\">\\(O(N+M)\\)</span>ã€‚</p>\n<hr />\n<h3 id=\"ä¾‹é¢˜å½©ç¯æ™šä¼š\">ä¾‹é¢˜ï¼šå½©ç¯æ™šä¼š</h3>\n<p>goto <a href=\"/20250407/#e---kdoi-11å½©ç¯æ™šä¼š\">link</a>ã€‚</p>\n<p>Tipsï¼šå‘ç° <span class=\"math inline\">\\(l_1,l_2\\)</span> ä¹‹é—´ä¹Ÿæ²¡å•¥æœ‰æœºè”ç³»ï¼ˆä¸Šé¢ã€å¾ˆå¼±çš„è”ç³»ã€ä¸­çš„ç¬¬ä¸‰ã€å››ç§æƒ…å†µï¼‰ï¼Œæ•…åˆ†æ­¥è½¬ç§»ã€‚</p>\n<hr />\n<h3 id=\"ä¾‹é¢˜åºåˆ—å¦™å¦™å€¼\">ä¾‹é¢˜ï¼šåºåˆ—å¦™å¦™å€¼</h3>\n<p><a href=\"https://uoj.ac/problem/549\" class=\"uri\">https://uoj.ac/problem/549</a></p>\n<p>æœ´ç´ åœ°ï¼Œè®¾ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºåœ¨ç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªå¤„åˆ†ç¬¬ <span class=\"math inline\">\\(j\\)</span> æ®µçš„æœ€å¤§ä»·å€¼ï¼Œæ˜¾ç„¶æœ‰ <span class=\"math inline\">\\(O(k\\times n^2)\\)</span>ï¼Œä¸”å¹¶æ²¡æœ‰ä¼˜åŒ–çš„ç©ºé—´ã€‚</p>\n<p>è€ƒè™‘åˆ©ç”¨ <span class=\"math inline\">\\(a_i\\)</span> å¾ˆå°è¿™ä¸€æ¡ä»¶ï¼Œå‘ç°ä¸Šä¸€æ¡æ— æ³•ä¼˜åŒ–æ˜¯å› ä¸ºè¦è·å– <span class=\"math inline\">\\(sum_{i}\\)</span> çš„å€¼ï¼›é‚£ä¹ˆæŠŠ <span class=\"math inline\">\\(sum_i\\)</span> å¡åˆ°çŠ¶æ€é‡Œã€‚è®¾ <span class=\"math inline\">\\(f_{s&#39;,j}\\)</span> è¡¨ç¤º <span class=\"math inline\">\\(sum=s&#39;\\)</span> æ—¶ï¼Œåˆ†äº† <span class=\"math inline\">\\(j\\)</span> æ®µçš„æœ€å¤§ä»·å€¼ã€‚åŒæ ·å¯ä»¥ <span class=\"math inline\">\\(O(k\\cdot n^2)\\)</span>ã€‚</p>\n<p>æ¥ä¸‹æ¥æœ‰ä¸¤ä¸ªç†è§£è¿™ä¸ªä¼˜åŒ–çš„è§’åº¦ï¼š</p>\n<ol type=\"1\">\n<li><p>ä»å¹³è¡¡è§’åº¦ï¼ŒåŸé—®é¢˜ç­‰ä»·äº <span class=\"math inline\">\\(O(1)\\)</span> æ›´æ–° <span class=\"math inline\">\\((s,j)\\)</span> å¤„çš„æœ€å¤§å€¼ï¼Œ<span class=\"math inline\">\\(O(v)\\)</span> æŸ¥æ‰¾ <span class=\"math inline\">\\(j-1\\)</span> å¤„çš„æœ€å¤§å€¼ï¼›æŠŠ <span class=\"math inline\">\\(s\\)</span> æ‹†æˆå‰ <span class=\"math inline\">\\(8\\)</span> ä½ã€å <span class=\"math inline\">\\(8\\)</span> ä½ä¸¤ä¸ª partï¼Œå½“æ›´æ–°</p>\n<p>å¯¹äºä¿®æ”¹ï¼šç›¸å½“äºå›ºå®šå‰ <span class=\"math inline\">\\(8\\)</span> ä½ <span class=\"math inline\">\\(s\\)</span>ï¼Œæšä¸¾å <span class=\"math inline\">\\(8\\)</span> ä½ <span class=\"math inline\">\\(x\\)</span>ï¼Œå¹¶æ›´æ–° <span class=\"math inline\">\\((s,x)\\)</span>ã€‚</p>\nå¯¹äºæŸ¥è¯¢ï¼šç›¸å½“äºå›ºå®šå <span class=\"math inline\">\\(8\\)</span> ä½ <span class=\"math inline\">\\(x\\)</span>ï¼Œæšä¸¾å‰ <span class=\"math inline\">\\(8\\)</span> ä½ <span class=\"math inline\">\\(s\\)</span>ï¼Œå¹¶æŸ¥è¯¢ <span class=\"math inline\">\\((s,x)\\)</span>ã€‚</li>\n<li><p>ä»åˆ†æ­¥è½¬ç§»è§’åº¦ï¼Œç”±äºã€ç°æ—¶åˆ»ã€çš„è´¡çŒ®æ˜¯æŒ‰ä½çš„ï¼ŒäºŒè¿›åˆ¶çŠ¶æ€çš„å‰ <span class=\"math inline\">\\(8\\)</span> ä½å’Œå <span class=\"math inline\">\\(8\\)</span> ä½æ²¡å•¥æœ‰æœºè”ç³»ï¼Œæ•…ç›´æ¥æ‹†å¼€ï¼Œå…ˆè½¬ç§»å‰ <span class=\"math inline\">\\(8\\)</span> ä½ï¼Œå†è½¬ç§»å <span class=\"math inline\">\\(8\\)</span> ä½ã€‚</p></li>\n</ol>\n<p>è¿™æ ·å°±è¢«ä¼˜åŒ–ä¸º <span class=\"math inline\">\\(O(k\\cdot n\\times \\sqrt v)\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxv = 1 &lt;&lt; 8;\nconst int inf = 0x3f3f3f3f;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    using arr = std::vector&lt;int&gt;;\n    using brr = std::vector&lt;arr&gt;;\n    using crr = std::vector&lt;brr&gt;;\n    arr s(n + 1), tag0(maxv), d0;\n    crr f(maxv, brr(maxv, arr(k + 1, inf))), g(maxv, brr(maxv, arr(k + 1, inf)));\n    f[0][0][0] = 0;\n    for (int j = 0; j &lt; maxv; ++j)\n        g[0][j][1] = j;\n    tag0[0] = 1, d0.push_back(0);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; s[i], s[i] ^= s[i - 1];\n        int p0 = s[i] &gt;&gt; 8, p1 = s[i] &amp; ((1 &lt;&lt; 8) - 1);\n        for (int j = k; j; --j) &#123;\n            for (auto a : d0)\n                f[p0][p1][j] = std::min(f[p0][p1][j], g[a][p1][j] + ((a ^ p0) &lt;&lt; 8));\n            // printf(&quot;f[%d][%d][%d] = %d\\n&quot;, p0, p1, j, f[p0][p1][j]);\n            if (j != k)\n                for (int a = 0; a &lt; maxv; ++a)\n                    g[p0][a][j + 1] = std::min(g[p0][a][j + 1], f[p0][p1][j] + (a ^ p1));\n        &#125;\n        if (i &gt;= k)\n            std::cout &lt;&lt; f[p0][p1][k] &lt;&lt; &#39; &#39;;\n        if (!tag0[p0])\n            tag0[p0] = 1, d0.push_back(p0);\n    &#125;\n    std::cout &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"å‰²è£‚\">å‰²è£‚</h2>\n<p>å¦‚æœçŠ¶æ€çš„è‹¥å¹²ç»´ä¹‹é—´è¿æ— æœºè”ç³»éƒ½æ²¡äº†ï¼Œå¯ä»¥ç›´æ¥æŠŠ DP æ•°ç»„æ‹†å¼€ï¼Œå„è‡ªè½¬ç§»å„è‡ªçš„ã€‚</p>\n<p>æœ€åç­”æ¡ˆçš„æ‹¼æ¥ï¼Œå¯èƒ½æ˜¯æšä¸¾ã€ç›´æ¥æ‹¼ã€ç”¨ä¸€ä¸ªè½¬ç§»å¦ä¸€ä¸ªä¹‹ç±»ã€‚</p>\n<hr />\n<h3 id=\"ä¾‹é¢˜ç»å…¸é¢˜-1\">ä¾‹é¢˜ï¼šç»å…¸é¢˜</h3>\n<blockquote>\n<p>ç»™å®š <span class=\"math inline\">\\(w_{N\\times M}\\)</span>ï¼Œæ±‚ <span class=\"math inline\">\\((A,B)_{1\\sim K}\\)</span>ï¼Œæœ€å¤§åŒ– <span class=\"math inline\">\\(\\sum\\limits_{i=1}^K w_{A_{i-1},A_i}+w_{B_{i-1},B_i}\\)</span> çš„å€¼ã€‚</p>\n</blockquote>\n<p>å…ˆ DP å‡ºæ¥ <span class=\"math inline\">\\(A\\)</span>ï¼Œå† DP å‡ºæ¥ <span class=\"math inline\">\\(B\\)</span>ï¼Œç›´æ¥ç›¸åŠ å³å¯ã€‚</p>\n<hr />\n<h3 id=\"ä¾‹é¢˜mnogomet\">ä¾‹é¢˜ï¼šMNOGOMET</h3>\n<p><a href=\"https://www.luogu.com.cn/problem/P7648\" class=\"uri\">https://www.luogu.com.cn/problem/P7648</a></p>\n<p>æƒ³åˆ°è®¾ <span class=\"math inline\">\\(f_{t,i,a,b}\\)</span> è¡¨ç¤ºã€è¿‡å»äº† <span class=\"math inline\">\\(t\\)</span> ç§’ï¼Œä¸”çƒåœ¨çƒå‘˜ <span class=\"math inline\">\\(i\\)</span> æ‰‹ä¸Šï¼Œä¸”ä¸¤ä¸ªé˜Ÿä¼å¾—åˆ†åˆ†åˆ«ä¸º <span class=\"math inline\">\\(a,b\\)</span>ã€çš„æ¦‚ç‡ã€‚é‚£ä¹ˆæšä¸¾çƒä¸Šä¸€æ¬¡åœ¨è°æ‰‹ä¸Šï¼Œæœ‰ç¾è§‚çš„ <span class=\"math inline\">\\(O(T\\cdot N^2R^2)\\)</span>ã€‚</p>\n<p>å‘ç°æ¯”åˆ†å˜åŠ¨æ—¶ï¼ˆä¸ŠåŠä¸ªæ—¶åˆ»å®Œæˆå°„é—¨å¹¶ä¼ çƒï¼‰çƒä¸€å®šåœ¨æŸä¸ªé˜Ÿçš„ <span class=\"math inline\">\\(1\\)</span> å·æ‰‹ä¸Šï¼›<span class=\"math inline\">\\(i\\)</span> è¿™ä¸€ç»´å’Œ <span class=\"math inline\">\\(a,b\\)</span> ä¹Ÿæ²¡æœ‰ç›¸äº’çš„å¹²æ‰°ï¼›æ•…å¯ä»¥å°† <span class=\"math inline\">\\(i\\)</span> æå–å‡ºæ¥ï¼ˆä½œä¸ºå¯¹æ¯”ï¼Œå°„é—¨å’Œå¤ºçƒã€ä¼ çƒéƒ½ä¼šå½±å“ <span class=\"math inline\">\\(t\\)</span>ï¼Œæ‰€ä»¥åˆ†è£‚å‡ºæ¥çš„çŠ¶æ€ä¸­å¿…é¡»åŒ…å« <span class=\"math inline\">\\(t\\)</span>ï¼‰ã€‚å…·ä½“åœ°ï¼š</p>\n<ol type=\"1\">\n<li><p>ä»¤ <span class=\"math inline\">\\(g_{t,0/1,i}\\)</span> è¡¨ç¤ºã€ä¸€å¼€å§‹çƒåœ¨å“ªä¸ªçƒé˜Ÿçš„ <span class=\"math inline\">\\(1\\)</span> å·ï¼ŒèŠ±è´¹ <span class=\"math inline\">\\(t\\)</span> ç§’ï¼Œä¸”æ²¡äººå°„é—¨ï¼Œä¸”çƒåœ¨çƒå‘˜ <span class=\"math inline\">\\(i\\)</span> æ‰‹ä¸Šã€çš„æ¦‚ç‡ã€‚å‘ç°å¯ä»¥ <span class=\"math inline\">\\(O(T\\times N^2)\\)</span> è®¡ç®—ã€‚</p>\n<p>å½“ç„¶è¿™é‡Œå°±æ˜¯æ¡ä»¶æ¦‚ç‡äº†ã€‚å…¶ä¸­ã€ä¸€å¼€å§‹çƒåœ¨å“ªä¸ªçƒé˜Ÿçš„ <span class=\"math inline\">\\(1\\)</span> å·ã€å°±æ˜¯æ¡ä»¶ã€‚</p>\nå†é¢„å¤„ç†å¯ä»¥å¾—åˆ° <span class=\"math inline\">\\(G_{t,0/1,0/1,0/1}\\)</span> è¡¨ç¤ºã€ä¸€å¼€å§‹çƒåœ¨å“ªä¸ªçƒé˜Ÿçš„ <span class=\"math inline\">\\(1\\)</span> å·ï¼ŒèŠ±è´¹ <span class=\"math inline\">\\(t\\)</span> ç§’ï¼Œå“ªä¸ªçƒé˜Ÿå°„é—¨ï¼Œï¼ˆæ²¡ï¼‰å°„è¿›ã€çš„æ¦‚ç‡ã€‚</li>\n<li><p>ä»¤ <span class=\"math inline\">\\(f_{t,0/1,a,b}\\)</span> è¡¨ç¤ºã€è¿‡å»äº† <span class=\"math inline\">\\(t\\)</span> ç§’ï¼Œçƒåœ¨å“ªä¸ªé˜Ÿçš„ <span class=\"math inline\">\\(1\\)</span> å·ï¼Œä¸”å¾—åˆ†ä¸º <span class=\"math inline\">\\(a,b\\)</span>ã€çš„æ¦‚ç‡ã€‚æšä¸¾è·ç¦»ä¸Šä¸€æ¬¡å°„é—¨çš„æ—¶é—´ï¼Œå¯ä»¥ <span class=\"math inline\">\\(O(T^2\\times R^2)\\)</span> å®Œæˆè½¬ç§»ã€‚</p></li>\n</ol>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, r, T;\n    std::cin &gt;&gt; n &gt;&gt; r &gt;&gt; T;\n    using arr = std::vector&lt;double&gt;;\n    using brr = std::vector&lt;arr&gt;;\n    using crr = std::vector&lt;brr&gt;;\n    brr p(2 * n + 1, arr(2)), pp(2 * n + 1, arr(2 * n + 1));\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; p[i][1], p[i][0] = 1. - p[i][1];\n        int ss, sd;\n        std::cin &gt;&gt; ss &gt;&gt; sd;\n        double P = 1. / (ss + sd + 1);\n        p[i][0] *= P, p[i][1] *= P;\n        for (int x; ss--; pp[i][x] = P)\n            std::cin &gt;&gt; x;\n        for (int x; sd--; pp[i][x + n] = P)\n            std::cin &gt;&gt; x;\n    &#125;\n    for (int i = n + 1; i &lt;= 2 * n; ++i) &#123;\n        std::cin &gt;&gt; p[i][1], p[i][0] = 1. - p[i][1];\n        int ss, sd;\n        std::cin &gt;&gt; ss &gt;&gt; sd;\n        double P = 1. / (ss + sd + 1);\n        p[i][0] *= P, p[i][1] *= P;\n        for (int x; ss--; pp[i][x + n] = P)\n            std::cin &gt;&gt; x;\n        for (int x; sd--; pp[i][x] = P)\n            std::cin &gt;&gt; x;\n    &#125;\n    brr s(T + 1, arr(2));\n    crr g(T + 1, brr(2, arr(2 * n + 1)));\n    std::vector&lt;crr&gt; G(T + 1, crr(2, brr(2, arr(2)))), f(T + 1, crr(2, brr(r + 1, arr(r + 1))));\n    g[0][0][1] = g[0][1][n + 1] = 1.;\n    for (int t = 1; t &lt;= T; ++t) &#123;\n        for (int f1 = 0; f1 &lt;= 1; ++f1)\n            for (int i = 1; i &lt;= 2 * n; ++i) &#123;\n                G[t][f1][i &gt; n][0] += g[t - 1][f1][i] * p[i][0];\n                G[t][f1][i &gt; n][1] += g[t - 1][f1][i] * p[i][1];\n                for (int j = 1; j &lt;= 2 * n; ++j)\n                    if (j != i)\n                        g[t][f1][i] += pp[j][i] * g[t - 1][f1][j];\n                // printf(&quot;spend %ds, start from %d, now at %d: %.10lf\\n&quot;, t, 1 + f1 * n, i, g[t][f1][i]);\n                s[t][f1] += g[t][f1][i];\n            &#125;\n    &#125;\n    // puts(&quot;------------------------------------&quot;);\n    // for (int t = 1; t &lt;= T; ++t) &#123;\n    //     for (int f1 = 0; f1 &lt;= 1; ++f1)\n    //         for (int f2 = 0; f2 &lt;= 1; ++f2)\n    //             for (int f3 = 0; f3 &lt;= 1; ++f3)\n    //                 printf(&quot;spend %ds, start from %d, %d shoots, STATUS: %d, P = %.10lf\\n&quot;, t, 1 + f1 * n, 1 + f2, f3, G[t][f1][f2][f3]);\n    // &#125;\n    // puts(&quot;------------------------------------&quot;);\n    f[0][0][0][0] = 1.;\n    for (int t = 0; t &lt; T; ++t)\n        for (int f1 = 0; f1 &lt;= 1; ++f1)\n            for (int a = 0; a &lt; r; ++a)\n                for (int b = 0; b &lt; r; ++b) &#123;\n                    for (int t1 = 1; t + t1 &lt;= T; ++t1) &#123;\n                        f[t + t1][0][a][b] += f[t][f1][a][b] * G[t1][f1][1][0];\n                        f[t + t1][0][a][b + 1] += f[t][f1][a][b] * G[t1][f1][1][1];\n                        f[t + t1][1][a][b] += f[t][f1][a][b] * G[t1][f1][0][0];\n                        f[t + t1][1][a + 1][b] += f[t][f1][a][b] * G[t1][f1][0][1];\n                        if (t + t1 == T)\n                            f[T][0][a][b] += f[t][f1][a][b] * s[t1][f1];\n                    &#125;\n                &#125;\n    // for (int t = 0; t &lt;= T; ++t)\n    //     for (int f1 = 0; f1 &lt;= 1; ++f1)\n    //         for (int a = 0; a &lt;= r; ++a)\n    //             for (int b = 0; b &lt;= r; ++b)\n    //                 if (f[t][f1][a][b] &gt; 1e-10)\n    //                     printf(&quot;%ds later, %d shoots, %d : %d, P = %.10lf\\n&quot;, t, 1 + !f1 * n, a, b, f[t][f1][a][b]);\n    std::cout &lt;&lt; std::fixed &lt;&lt; std::setprecision(10);\n    for (int a = 0; a &lt;= r; ++a) &#123;\n        for (int b = 0; b &lt;= r; ++b) &#123;\n            if (a == r &amp;&amp; b == r)\n                continue;\n            double res(0.);\n            if (a == r)\n                for (int t = r; t &lt;= T; ++t)\n                    res += f[t][1][r][b];\n            else if (b == r)\n                for (int t = r; t &lt;= T; ++t)\n                    res += f[t][0][a][r];\n            else\n                res = f[T][0][a][b] + f[T][1][a][b];\n            std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n        &#125;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n",
            "tags": [
                "DP",
                "DP ä¼˜åŒ–"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250510/",
            "url": "https://xsc062.netlify.app/20250510/",
            "title": "æ‚é¢˜é€‰è°ˆ",
            "date_published": "2025-05-10T02:18:21.000Z",
            "content_html": "<p>å•Šå•Šã€‚å°å°æ¡ã€‚</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"a---pass-to-next\">A - Pass to Next</h2>\n<p><a href=\"https://atcoder.jp/contests/arc124/tasks/arc124_e\" class=\"uri\">https://atcoder.jp/contests/arc124/tasks/arc124_e</a></p>\n<p>æ„Ÿè§‰å…¶ä»–ä¸€äº›é¢˜è§£è®²å¾—ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šï¼Œè¿™é‡Œå‚è€ƒäº† <a href=\"https://blog.csdn.net/weixin_43960287/article/details/119140590\">XJX çš„æ–‡ç« </a>ã€‚</p>\n<p>è¦æ±‚çš„ç­”æ¡ˆæ˜¯ <span class=\"math inline\">\\(\\prod a&#39;_i\\)</span>ï¼Œ<mark>å‘ç°è¿ç®—æ˜¯ä¹˜æ³•ï¼Œæ¯”è¾ƒæ€ªï¼›ç”±æ­¤è€ƒè™‘è½¬åŒ–ä¸ºæ–¹æ¡ˆæ•°ï¼Œä¹Ÿå°±æ˜¯å‡è®¾æ¯ä¸ªäººæœ‰ <span class=\"math inline\">\\(a&#39;_i\\)</span> ä¸ªäº’ä¸ç›¸åŒçš„çƒï¼Œæ¯ä¸ªäººåœ¨å…¶ä¸­é€‰å‡ºæ°å¥½ä¸€ä¸ªçš„æ–¹æ¡ˆæ•°</mark>ã€‚</p>\n<p>è€ƒè™‘ DPã€‚å‘ç°æ¯ä¸ªäººæ‰‹ä¸Šçš„çƒåˆ†ä¸ºã€è‡ªå·±çš„ã€å’Œã€å·¦è¾¹çš„äººä¼ è¿‡æ¥çš„ã€ä¸¤ç§ç±»å‹ï¼›<mark>æ˜¾ç„¶ç¬¬äºŒç§ä¼šæœ‰æ¥è‡ªä¸Šä¸€ä¸ªäººçš„é™åˆ¶ï¼Œè€ƒè™‘æŠŠç¬¬äºŒç§åœ¨ä¸Šä¸€ä¸ªäººå°±å®Œæˆæ±‚è§£</mark>ã€‚å…·ä½“åœ°ï¼Œè®¾ <span class=\"math inline\">\\(f_{i,0}\\)</span> è¡¨ç¤ºç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªäººé€‰å–è‡ªå·±çš„çƒï¼Œä½†åªè®°å½• <span class=\"math inline\">\\(1\\sim i-1\\)</span> çš„æ–¹æ¡ˆï¼›<span class=\"math inline\">\\(f_{i,1}\\)</span> è¡¨ç¤ºç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªäººé€‰å–ç¬¬ <span class=\"math inline\">\\(i-1\\)</span> ä¸ªäººçš„çƒï¼Œå¹¶è®°å…¥ç­”æ¡ˆçš„æ–¹æ¡ˆã€‚<em>ä½ å¯èƒ½éœ€è¦æ³¨æ„åˆ°ï¼šæœ€åä¸€ä¸ªè¢«è®°å…¥æ–¹æ¡ˆçš„çƒæ¥è‡ªç¬¬ <span class=\"math inline\">\\(i-1\\)</span> ä¸ªäºº</em>ã€‚</p>\n<p>ä½†è¿™æ ·ä¼šæœ‰ä¸ªå°é—®é¢˜ã€‚æˆ‘ä»¬è®©æ‰€æœ‰äººå¤šå¾€å³è¾¹ä¼ ä¸€ä¸ªçƒï¼Œé‚£ä¹ˆåœ¨æˆ‘ä»¬çš„è¿™ç§åˆ†å‰²æ–¹æ³•çœ‹æ¥æ˜¯ä¸ä¸€æ ·çš„å±€é¢ï¼›ä½†å®é™…ä¸Šå®ƒä»¬æ˜¯ç­‰ä»·çš„ã€‚ä»æ¯ä¸ªäººä¼ å‡ºäº†å¤šå°‘ä¸ªçƒï¼ˆè®¾ä¸º <span class=\"math inline\">\\(x_i\\)</span>ï¼‰çš„è§’åº¦æ¥çœ‹ï¼Œå¯¹äº <span class=\"math inline\">\\(\\min\\{x_n\\}\\ne 0\\)</span>ï¼Œåªéœ€è¦ä¸æ–­æ‰§è¡Œ <span class=\"math inline\">\\(\\forall\\, x_i\\gets x_i-1\\)</span> å°±å¯ä»¥åœ¨å±€é¢ä¸å˜çš„æƒ…å†µä¸‹ä½¿ <span class=\"math inline\">\\(\\min\\{x_n\\}\\ne 0\\)</span>ã€‚è¿™æ˜¯åœ¨è¯´ï¼Œå¯ä»¥è®© <span class=\"math inline\">\\(\\min\\{x_n\\}\\ne 0\\)</span> çš„æ–¹æ¡ˆå’Œç»ˆå±€ä¸€ä¸€å¯¹åº”ã€‚</p>\n<p>å‘ç°å¯ä»¥å®¹æ–¥ï¼šé’¦å®š <span class=\"math inline\">\\(x_i\\ge 1\\)</span>ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªäººå¿…é¡»å¾€å³ä¼ è‡³å°‘ä¸€ä¸ªï¼Œç›¸ä¼¼åœ°ç®—ä¸€éå°±èƒ½å¾—åˆ°éæ³•æ–¹æ¡ˆã€‚</p>\n<p>è€ƒè™‘è½¬ç§»ï¼Œä»¤ <span class=\"math inline\">\\(x_i\\)</span> å¯é€‰æœ€å°å€¼ä¸º <span class=\"math inline\">\\(l\\)</span>ï¼Œæœ‰ï¼š</p>\n<ul>\n<li><span class=\"math inline\">\\(f_{i+1,0}\\gets f_{i,0}\\)</span>ï¼šå°†ç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªäººæœªè¢«è®°å…¥çš„è‡ªå·±çš„çƒè®°å…¥ï¼Œçƒæ•°å¯èƒ½ä¸º <span class=\"math inline\">\\([0,a_i-l]\\)</span>ã€‚ç­‰å·®æ•°åˆ—æ±‚å’Œå³å¯ã€‚</li>\n<li><span class=\"math inline\">\\(f_{i+1,0}\\gets f_{i,1}\\)</span>ï¼šæ²¡æœ‰çƒéœ€è¦è¢«è®°å…¥ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µå¯¹åº”å¤šç§ <span class=\"math inline\">\\(x_i\\)</span>ã€‚å…·ä½“åœ°ï¼Œ<span class=\"math inline\">\\(x_i\\in [l,a_i]\\)</span>ã€‚å…±æœ‰ <span class=\"math inline\">\\(a_i-l+1\\)</span> ç§æ–¹æ¡ˆã€‚</li>\n<li><span class=\"math inline\">\\(f_{i+1,1}\\gets f_{i,0}\\)</span>ï¼šå°†ç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªäººçš„ <span class=\"math inline\">\\(a_i\\)</span> ä¸ªçƒåˆ†ç»™ <span class=\"math inline\">\\(i\\)</span> å’Œ <span class=\"math inline\">\\(i+1\\)</span>ã€‚å…±æœ‰ <span class=\"math inline\">\\(x_i\\cdot (a_i-x_i)\\)</span> ç§å¯èƒ½ï¼Œä¹Ÿå°±æ˜¯ <span class=\"math inline\">\\(\\left(a_i\\cdot \\sum_{x_i=l}^{a_i} x_i\\right)-\\left(\\sum_{x_i=l}^{a_i}{x_i}^2\\right)\\)</span> ç§æ–¹æ¡ˆã€‚</li>\n<li><span class=\"math inline\">\\(f_{i+1,1}\\gets f_{i,1}\\)</span>ï¼šå°†ç¬¬ <span class=\"math inline\">\\(i+1\\)</span> ä¸ªäººå¾—åˆ°çš„ç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªäººçš„çƒè®°å…¥ï¼ŒåŒç¬¬ä¸€æ¡ã€‚</li>\n</ul>\n<p>ç ´ç¯ä¸ºé“¾ï¼Œåˆ†åˆ«é’¦å®šç¬¬ä¸€ä¸ªäººæ˜¯ç”¨è‡ªå·±çš„çƒè¿˜æ˜¯ä¸Šä¸€ä¸ªäººçš„çƒæ¥è§£å†³é—®é¢˜ï¼ˆå¿…é¡»å¯¹äºä¸¤ç§å¯èƒ½æ€§åˆ†å¼€è®¡ç®—ï¼›å¦åˆ™å°±ä¸çŸ¥é“ç­”æ¡ˆåº”è¯¥å– <span class=\"math inline\">\\(f_{n,0}\\)</span> è¿˜æ˜¯ <span class=\"math inline\">\\(f_{n,1}\\)</span>ï¼‰ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353, inv2 = (mod + 1) &gt;&gt; 1, inv6 = 166374059;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;long long&gt; a(n);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i % n];\n    auto sum = [&amp;](long long r) &#123;\n        return r * (r + 1) % mod * inv2 % mod;\n    &#125;;\n    auto sum2 = [&amp;](long long r) &#123;\n        return r * (r + 1) % mod * (2 * r % mod + 1) % mod * inv6 % mod;\n    &#125;;\n    std::vector&lt;std::vector&lt;long long&gt; &gt; f0(n, std::vector&lt;long long&gt; (2)), f1(n, std::vector&lt;long long&gt; (2));\n    auto calc = [&amp;](long long l, std::vector&lt;std::vector&lt;long long&gt; &gt; &amp;f) &#123;\n        f[0][0] = 1ll;\n        for (int i = 0; i &lt; n; ++i) &#123;\n            int j = (i + 1) % n;\n            f[j][0] = f[i][0] * sum(a[i] - l) % mod;\n            (f[j][0] += f[i][1] * (a[i] - l + 1)) %= mod;\n            f[j][1] = f[i][0] * (a[i] * sum(a[i]) % mod - sum2(a[i])) % mod;\n            (f[j][1] += f[i][1] * sum(a[i]) % mod) %= mod;\n            // printf(&quot;0, l = %lld, f[%d]: %lld / %lld\\n&quot;, l, j, f[j][0], f[j][1]);\n        &#125;\n        auto res(f[0][0]);\n        f.assign(n, std::vector&lt;long long&gt; (2));\n        f[0][1] = 1ll;\n        for (int i = 0; i &lt; n; ++i) &#123;\n            int j = (i + 1) % n;\n            f[j][0] = f[i][0] * sum(a[i] - l) % mod;\n            (f[j][0] += f[i][1] * (a[i] - l + 1)) %= mod;\n            f[j][1] = f[i][0] * (a[i] * sum(a[i]) % mod - sum2(a[i])) % mod;\n            (f[j][1] += f[i][1] * sum(a[i]) % mod) %= mod;\n            // printf(&quot;1, l = %lld, f[%d]: %lld / %lld\\n&quot;, l, j, f[j][0], f[j][1]);\n        &#125;\n        return (res + f[0][1]) % mod;\n    &#125;;\n    std::cout &lt;&lt; (calc(0, f0) + mod - calc(1, f1)) % mod &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b---ç»¿å®çŸ³ä¹‹å²›\">B - ç»¿å®çŸ³ä¹‹å²›</h2>\n<p><a href=\"https://loj.ac/p/6406\" class=\"uri\">https://loj.ac/p/6406</a></p>\n<p>å› ä¸ºåªå…³å¿ƒæœ€ç»ˆçŠ¶æ€ï¼ŒåŸé¢˜å¯ä»¥è½¬åŒ–ä¸ºï¼šå°† <span class=\"math inline\">\\(d\\)</span> åˆ†æˆ <span class=\"math inline\">\\(n\\)</span> ä¸ªéè´Ÿæ•´æ•°ï¼Œå‰ <span class=\"math inline\">\\(r\\)</span> å¤§æ•°ä¹‹å’Œçš„æœŸæœ›ï¼ˆå½“ç„¶ä½ éœ€è¦åŠ ä¸Šåˆå§‹çš„ <span class=\"math inline\">\\(r\\)</span> ä¸ªï¼‰ã€‚</p>\n<p>å…³äºéè´Ÿæ•´æ•°æ‹†åˆ†ï¼šè®¾ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºå°† <span class=\"math inline\">\\(i\\)</span> åˆ†æˆ <span class=\"math inline\">\\(j\\)</span> ä¸ª <strong>éè´Ÿæ•´æ•°</strong> çš„æ–¹æ¡ˆï¼Œé’¦å®šå…¶ä¸­æ°æœ‰ <span class=\"math inline\">\\(k\\)</span> ä¸ª <strong>æ­£æ•´æ•°</strong> è¿›è¡Œè½¬ç§»ï¼Œç»™è¿™ <span class=\"math inline\">\\(k\\)</span> ä¸ªæ•°å…ˆåˆ†ä¸€ä¸ª <span class=\"math inline\">\\(1\\)</span>ï¼Œåˆ™ <span class=\"math inline\">\\(f_{i,j}=\\sum\\limits_{k=0}^{\\min(i,j)} C_j^k\\cdot f_{i-k,k}\\)</span>ã€‚</p>\n<p>å†è®¾ <span class=\"math inline\">\\(g_{i,j}\\)</span> è¡¨ç¤ºå°† <span class=\"math inline\">\\(i\\)</span> åˆ†æˆ <span class=\"math inline\">\\(j\\)</span> ä¸ªéè´Ÿæ•´æ•°çš„æ‰€æœ‰æ–¹æ¡ˆä¸­ã€å‰ <span class=\"math inline\">\\(r\\)</span> å¤§çš„æ•°ä¹‹å’Œã€‚ç±»ä¼¼åœ°ï¼Œæœ‰ <span class=\"math inline\">\\(g_{i,j}=\\sum\\limits_{k=0}^{\\min(i,j)} C_j^k\\cdot (g_{i-k,k}+\\min(k,r)\\cdot f_{i-k,k})\\)</span>ã€‚å…¶ä¸­ï¼Œ<span class=\"math inline\">\\(\\min(k,r)\\)</span> çš„æ¥æºæ˜¯ï¼Œåªæœ‰ <span class=\"math inline\">\\(k\\)</span> ä¸ªæ•°æœ‰å€¼ï¼Œå‰ <span class=\"math inline\">\\(r\\)</span> å¤§çš„æ•°ä¸€å®šåœ¨è¿™ <span class=\"math inline\">\\(k\\)</span> ä¸ªæ•°é‡Œé¢ã€‚</p>\n<p>ç­”æ¡ˆä¸º <span class=\"math inline\">\\(\\dfrac {g_{d,n}}{f_{d,n}}+r\\)</span>ï¼Œå¤æ‚åº¦ <span class=\"math inline\">\\(O(n^3)\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, d, r;\n    std::cin &gt;&gt; n &gt;&gt; d &gt;&gt; r;\n    using arr = std::vector&lt;double&gt;;\n    std::vector&lt;arr&gt; f(d + 1, arr(n + 1)), g(d + 1, arr(n + 1)), C(n + 1, arr(n + 1));\n    for (int i = 0; i &lt;= n; ++i) &#123;\n        C[i][0] = 1.;\n        for (int j = 1; j &lt;= i; ++j)\n            C[i][j] = C[i - 1][j - 1] + C[i - 1][j];\n    &#125;\n    f[0].assign(n + 1, 1.);\n    for (int i = 1; i &lt;= d; ++i)\n        for (int j = 1; j &lt;= n; ++j) &#123;\n            for (int k = 1; k &lt;= i &amp;&amp; k &lt;= j; ++k) &#123;\n                f[i][j] += C[j][k] * f[i - k][k];\n                g[i][j] += C[j][k] * (g[i - k][k] + std::min(k, r) * f[i - k][k]);\n                // printf(&quot;  k = %d, %.0lf + %.0lf\\n&quot;, k, C[j][k] * g[i - k][k], std::min(k, r) * f[i - k][k]);\n            &#125;\n            // printf(&quot;f[%d][%d] = %.0lf, g[%d][%d] = %.0lf\\n&quot;, i, j, f[i][j], i, j, g[i][j]);\n        &#125;\n    std::cout &lt;&lt; std::fixed &lt;&lt; std::setprecision(8) &lt;&lt; g[d][n] / f[d][n] + r &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"c---uddered-but-not-herd-g\">C - Uddered but not Herd G</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P7296\" class=\"uri\">https://www.luogu.com.cn/problem/P7296</a></p>\n<p>ç»™æ¯ä¸ªå­—æ¯åˆ†é…ä¸€ä¸ªæ ‡å· <span class=\"math inline\">\\(x\\)</span>ï¼Œé‚£ä¹ˆæœ€å°æ®µæ•°å°±æ˜¯ <span class=\"math inline\">\\(\\sum \\left[x_i\\ge x_{i+1}\\right]\\)</span>ã€‚</p>\n<p>è€ƒè™‘çŠ¶å‹å®Œæˆæ˜ å°„æ“ä½œï¼Œä»¤ <span class=\"math inline\">\\(f_{s}\\)</span> è¡¨ç¤ºç»™æ ‡å· <span class=\"math inline\">\\(1\\sim |s|\\)</span> åˆ†é…å­—æ¯åï¼Œå ç”¨å­—ç¬¦é›† <span class=\"math inline\">\\(s\\)</span> çš„æ–¹æ¡ˆæ•°ï¼Œé‚£ä¹ˆå°±èƒ½ <span class=\"math inline\">\\(O(1)\\)</span> å¾—åˆ°è´¡çŒ®â€”â€”åªéœ€é¢„å¤„ç†å‡º <span class=\"math inline\">\\(f_{c, s}\\)</span> è¡¨ç¤ºåˆ†é…åˆ°å­—æ¯ <span class=\"math inline\">\\(c\\)</span> æ—¶ï¼Œå·²ç»å…ˆç»™ <span class=\"math inline\">\\(s\\)</span> ä¸­å­—æ¯åˆ†é…äº†æ›´å°æ ‡å·æ—¶çš„è´¡çŒ®ã€‚</p>\n<p>æ³¨æ„å­—ç¬¦é›†å¤§å°åªæœ‰ <span class=\"math inline\">\\(20\\)</span>ï¼Œå¯ä»¥ <span class=\"math inline\">\\(O(|S|\\cdot 2^{|S|})\\)</span> è§£å†³é—®é¢˜ï¼Œ<mark>æ³¨æ„åˆ°é¢„å¤„ç†çš„å†…å®¹æ˜¯ç±»é«˜ç»´å‰ç¼€æœ€å€¼çš„å½¢å¼ï¼Œå¯ä»¥é€’æ¨é™ä½å¤æ‚åº¦</mark>ã€‚</p>\n<details>\n<pre data-line=\"26-28\" class=\"cpp language-cpp\"><code data-line=\"26-28\" class=\"cpp language-cpp\">#include &lt;bits/stdc++.h>\nconst int inf = 0x3f3f3f3f;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(\".in\", \"r\", stdin);\n    std::freopen(\".out\", \"w\", stdout);\n#endif\n    int n;\n    std::string t;\n    std::cin >> t, n = (int)t.length(), t = \"#\" + t;\n    std::vector&lt;int> a, tag(26, -1), s(n + 1);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        if (tag[t[i] - 'a'] == -1)\n            tag[t[i] - 'a'] = (int)a.size(), a.push_back(t[i] - 'a');\n        s[i] = tag[t[i] - 'a'];\n    &#125;\n    int m = (int)a.size(), siz = 1 &lt;&lt; m;\n    std::vector&lt;std::vector&lt;int> > cnt(m, std::vector&lt;int> (m));\n    for (int i = 1; i &lt; n; ++i)\n        ++cnt[s[i]][s[i + 1]];\n    std::vector&lt;std::vector&lt;int> > g(m, std::vector&lt;int> (siz));\n    for (int i = 0; i &lt; m; ++i)\n        for (int k = 0; k &lt; m; ++k) // æ³¨æ„è¿™é‡Œç›¸å½“äºæ˜¯é’¦å®šä» k å¤„è½¬ç§»\n            for (int j = (1 &lt;&lt; k); j &lt; (2 &lt;&lt; k); ++j) // æšä¸¾çš„æ˜¯ k ä½ä¸º 1 çš„æ‰€æœ‰æ•°ï¼›è¿™ä¸¤å±‚å¾ªç¯çš„å¤æ‚åº¦ä¸º O(siz)\n                g[i][j] = g[i][j ^ (1 &lt;&lt; k)] + cnt[i][k]; // ç›®çš„æ˜¯æ­¤å¤„çš„å†…å­˜è¿ç»­è®¿é—®ä¼˜åŒ–ï¼ŒæŠŠ ^ çœ‹ä½œ - åº”è¯¥å°±èƒ½ç†è§£ä¸ºä»€ä¹ˆç¬¬äºŒç»´æ˜¯è¿ç»­çš„\n    std::vector&lt;int> f(siz, inf);\n    f[0] = 1;\n    for (int i = 1; i &lt; siz; ++i)\n        for (int j = 0; j &lt; m; ++j)\n            if ((i >> j) & 1)\n                f[i] = std::min(f[i], f[i ^ (1 &lt;&lt; j)] + g[j][i]);\n    std::cout &lt;&lt; f[siz - 1] &lt;&lt; '\\n';\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"d---min-max-subarrays-p\">D - Min Max Subarrays P</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P11845\" class=\"uri\">https://www.luogu.com.cn/problem/P11845</a></p>\n<p>å…ˆè€ƒè™‘ <span class=\"math inline\">\\(01\\)</span> åºåˆ—çš„ç­”æ¡ˆï¼šå¦‚æœåºåˆ—ä¸­å­˜åœ¨ç›¸é‚»çš„ <span class=\"math inline\">\\(2\\)</span> ä¸ª <span class=\"math inline\">\\(1\\)</span>ï¼Œæ€»èƒ½ä¿è¯æœ€åçš„ä¸€ä¸ªæ˜¯ <span class=\"math inline\">\\(1\\)</span>ã€‚</p>\n<p>å¦‚æœåºåˆ—ä¸­å­˜åœ¨ <span class=\"math inline\">\\(\\ge 3\\)</span> ä¸ª <span class=\"math inline\">\\(1\\)</span>ï¼Œå¯ä»¥ç‰ºç‰²å…¶ä¸­çš„ä¸€äº›ä½¿å¾— <span class=\"math inline\">\\(2\\)</span> ä¸ª <span class=\"math inline\">\\(1\\)</span> ç›¸é‚»ã€‚</p>\n<p>å½“åºåˆ—ä¸­åªæœ‰ <span class=\"math inline\">\\(2\\)</span> ä¸ª <span class=\"math inline\">\\(1\\)</span> æ—¶ï¼Œåªæœ‰å› ä¸ºå‰©ä¸‹çš„ <span class=\"math inline\">\\(0\\)</span> ä¸å¤ªå¤Ÿï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•éšæ„ã€ä¸Šä¸‹å…¶æ‰‹ã€æ—¶ä¸èƒ½å°† <span class=\"math inline\">\\(2\\)</span> ä¸ª <span class=\"math inline\">\\(1\\)</span> æŒªåˆ°ä¸€èµ·ã€‚</p>\n<p>ä»¤ä¸¤ä¸ª <span class=\"math inline\">\\(1\\)</span> ä¸ºåºåˆ—æœ€å¤§å€¼ä¸æ¬¡å¤§å€¼ï¼Œæš´æœå¤„ç†åºåˆ—é•¿åº¦è¾ƒå°çš„æƒ…å†µï¼Œå‰©ä¸‹çš„ç›´æ¥ç”¨å¥‡å¶æ€§åˆ¤æ–­ä¸¤ä¸ª <span class=\"math inline\">\\(1\\)</span> å–å“ªä¸ªã€‚</p>\n<hr />\n<h2 id=\"a---mst-on-line\">A - MST on Line++</h2>\n<p><a href=\"https://atcoder.jp/contests/arc167/tasks/arc167_c\" class=\"uri\">https://atcoder.jp/contests/arc167/tasks/arc167_c</a></p>\n<p>ç›¸å½“äºæŠŠ <span class=\"math inline\">\\(a\\)</span> æ‰“ä¹±ç„¶åå¤„ç†åŸé—®é¢˜ã€‚è€ƒè™‘æ¯ä¸ª <span class=\"math inline\">\\(a_i\\)</span> çš„è´¡çŒ®æ¬¡æ•°ã€‚æ¨¡æ‹Ÿ Kruskal è¿è¾¹ï¼Œä»å°åˆ°å¤§æŠŠç‚¹ <span class=\"math inline\">\\(a_i\\)</span> åŠ å…¥å›¾ï¼Œ<span class=\"math inline\">\\(a_i\\)</span> å¯ä»¥å‘ <span class=\"math inline\">\\(a_{[i-K,i+K]}\\)</span> å†…æ‰€æœ‰è¿é€šå—è¿è¾¹ã€‚</p>\n<p>è¿é€šå—æ•°é‡å½“ä¸”ä»…å½“ <span class=\"math inline\">\\([i-K,i)\\)</span> å†…æœ€é å³çš„ç‚¹å’Œ <span class=\"math inline\">\\((i, i+K]\\)</span> å†…æœ€é å·¦çš„ç‚¹è·ç¦» <span class=\"math inline\">\\(&gt;K\\)</span> æ—¶ä¸º <span class=\"math inline\">\\(2\\)</span>ï¼Œå…¶ä½™æƒ…å†µä¸º <span class=\"math inline\">\\(1\\)</span>ã€‚</p>\n<p>ä½†è¦æ˜¯ä»è¿™ä¸ªè§’åº¦æƒ³è¿™ä¸ªé¢˜å°±ä¸å¤ªå¥½åšäº†ã€‚æ­£ç¡®çš„æƒ³æ³•åº”è¯¥æ˜¯<mark>æ‹†åˆ†ä¸ºã€è‹¥ <span class=\"math inline\">\\([i-K,i)\\)</span> ä¸­æœ‰ç‚¹ï¼Œè´¡çŒ®æ¬¡æ•° <span class=\"math inline\">\\(+1\\)</span>ã€å’Œã€è‹¥ <span class=\"math inline\">\\((i,i+K]\\)</span> ä¸­æœ‰ç‚¹ <span class=\"math inline\">\\(j\\)</span> æ»¡è¶³ <span class=\"math inline\">\\([j-K,j)\\)</span> ä¸­æ— ç‚¹ï¼Œè´¡çŒ®æ¬¡æ•° <span class=\"math inline\">\\(+1\\)</span>ã€</mark>ã€‚å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œè´¡çŒ®æ¬¡æ•°å°†å‰ <span class=\"math inline\">\\(i-1\\)</span> å¤§çš„æ•°åˆ†é…è‡³å°‘ä¸€ä¸ªåˆ° <span class=\"math inline\">\\([i-K,i)\\)</span> ä¸­çš„æ–¹æ¡ˆæ•°ï¼›å¯¹äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œæšä¸¾ <span class=\"math inline\">\\(j\\)</span>ï¼Œè´¡çŒ®æ¬¡æ•°ä¸ºå°†å‰ <span class=\"math inline\">\\(i-1\\)</span> å¤§çš„æ•°åˆ†é…åˆ° <span class=\"math inline\">\\(j\\)</span> å’Œ <span class=\"math inline\">\\([1,j-K)\\cup (j, n]\\)</span> ä¸­çš„æ–¹æ¡ˆæ•°ã€‚</p>\n<details>\n<p>å®ç°çš„æ—¶å€™åƒä¸‡æ³¨æ„å¾ªç¯å˜é‡æšä¸¾çš„æ˜¯ä½ç½®è¿˜æ˜¯å€¼ï¼ä¸ç„¶ä½ ä¼šè°ƒå¾—å¾ˆç—›è‹¦ã€‚</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;03-max-01.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    std::vector&lt;int&gt; a(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    std::sort(a.begin() + 1, a.end());\n    std::vector&lt;long long&gt; fac(n + 1), inv(n + 1);\n    fac[0] = inv[0] = 1ll;\n    for (int i = 1; i &lt;= n; ++i)\n        fac[i] = fac[i - 1] * i % mod;\n    auto qkp = [](long long x, int y) &#123;\n        auto res(1ll);\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    inv[n] = qkp(fac[n], mod - 2);\n    for (int i = n - 1; i; --i)\n        inv[i] = inv[i + 1] * (i + 1) % mod;\n    auto A = [&amp;](int n, int m) &#123;\n        if (n &lt; m)\n            return 0ll;\n        return fac[n] * inv[n - m] % mod;\n    &#125;;\n    auto C = [&amp;](int n, int m) &#123;\n        return A(n, m) * inv[m] % mod;\n    &#125;;\n    long long res = 0ll;\n    for (int i = 2; i &lt;= n; ++i) &#123;\n        for (int j = 1; j &lt;= n; ++j)\n            (res += a[i] * (fac[n - 1] + mod - A(n - 1 - (j - std::max(1, j - k)), i - 1) * fac[n - i] % mod) % mod) %= mod;\n        for (int j = 2; j &lt;= n; ++j)\n            (res += a[i] * C(i - 1, i - 2) % mod * C(j - std::max(1, j - k), 1) % mod * A(n - (j - std::max(1, j - k) + 1), i - 2) % mod * fac[n - i] % mod) %= mod;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b---existence-counting\">B - Existence Counting</h2>\n<p><a href=\"https://atcoder.jp/contests/arc174/tasks/arc174_e\" class=\"uri\">https://atcoder.jp/contests/arc174/tasks/arc174_e</a></p>\n<p>å‘ç°å¯ä»¥åˆ†ç±»è®¨è®ºã€‚å‡è®¾ <span class=\"math inline\">\\(a&#39;\\)</span> ä¸­ç¬¬ä¸€ä¸ªå¼‚äº <span class=\"math inline\">\\(a\\)</span> çš„ä½ç½®ä¸º <span class=\"math inline\">\\(i\\)</span>ï¼Œ<span class=\"math inline\">\\(x\\)</span> åœ¨ <span class=\"math inline\">\\(a\\)</span> ä¸­ä½ç½®ä¸º <span class=\"math inline\">\\(pos_x\\)</span>ï¼ˆä¸å­˜åœ¨åˆ™ <span class=\"math inline\">\\(pos_x=k+1\\)</span>ï¼‰ã€‚ä»¤ <span class=\"math inline\">\\(f_i\\)</span> ä¸ºè‹¥ <span class=\"math inline\">\\(1\\sim i-1\\)</span> å‡ç›¸åŒï¼Œ<span class=\"math inline\">\\(i\\)</span> ä½ç½®å¯é€‰çš„é€‰é¡¹æ•°ã€‚åˆ™ <span class=\"math inline\">\\(x\\)</span> å‡ºç°çš„æ¬¡æ•°ï¼š</p>\n<table>\n<colgroup>\n<col style=\"width: 25%\" />\n<col style=\"width: 25%\" />\n<col style=\"width: 25%\" />\n<col style=\"width: 25%\" />\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th style=\"text-align: center;\"></th>\n<th style=\"text-align: center;\"><span class=\"math inline\">\\(pos_x&lt;i\\)</span></th>\n<th style=\"text-align: center;\"><span class=\"math inline\">\\(pos_x=i\\)</span></th>\n<th style=\"text-align: center;\"><span class=\"math inline\">\\(pos_x&gt;i,i&lt;k\\)</span></th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td style=\"text-align: center;\"><span class=\"math inline\">\\(x\\le a_i\\)</span></td>\n<td style=\"text-align: center;\"><span class=\"math inline\">\\(1+f_i\\cdot A_{n-i}^{k-i}\\)</span></td>\n<td style=\"text-align: center;\"><span class=\"math inline\">\\(f_i\\cdot C_{k-i}^1\\cdot A_{n-i-1}^{k-i-1}\\)</span></td>\n<td style=\"text-align: center;\"><span class=\"math inline\">\\((f_i-1)\\cdot C_{k-i}^1\\cdot A_{n-i-1}^{k-i-1}+A_{n-i}^{k-i}\\)</span></td>\n</tr>\n<tr class=\"even\">\n<td style=\"text-align: center;\"><span class=\"math inline\">\\(x&gt;a_i\\)</span></td>\n<td style=\"text-align: center;\"><span class=\"math inline\">\\(f_i\\cdot A_{n-i}^{k-i}\\)</span></td>\n<td style=\"text-align: center;\"><span class=\"math inline\">\\(0\\)</span></td>\n<td style=\"text-align: center;\"><span class=\"math inline\">\\(f_i\\cdot C_{k-i}^1\\cdot A_{n-i-1}^{k-i-1}\\)</span></td>\n</tr>\n</tbody>\n</table>\n<p>æ•…ï¼Œå¯¹äºä»»æ„ <span class=\"math inline\">\\(x\\)</span>ï¼Œç­”æ¡ˆä¸ºï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\n&amp;1+\\left(\\sum_{i=pos_x+1}^k f_i\\cdot A_{n-i}^{k-i}\\right)\n+\\sum_{i=1}^{pos_x} (f_i-[x&lt; a_i])\\cdot C_{k-i}^1\\cdot A_{n-i-1}^{k-i-1}+[x&lt; a_i]\\cdot A_{n-i}^{k-i}\\\\\n=&amp;1+\\left(\\sum_{i=pos_x+1}^k f_i\\cdot A_{n-i}^{k-i}\\right)\n+\\left(\\sum_{i=1}^{pos_x} f_i\\cdot C_{k-i}^1\\cdot A_{n-i-1}^{k-i-1}\\right)+\\sum_{i=1,a_i&gt; x}^{pos_x}A_{n-i}^{k-i}-C_{k-i}^1\\cdot A_{n-i-1}^{k-i-1}\\\\\n\\end{aligned}\n\\]</span></p>\n<p>é¢„å¤„ç†å‡º <span class=\"math inline\">\\(f_i=\\sum\\limits_{j=i+1}^k [a_j&lt; a_i]\\)</span>ï¼ˆéœ€è¦æ•°æ®ç»“æ„ï¼‰ã€<span class=\"math inline\">\\(g_i=\\sum\\limits_{j=1}^i f_j\\cdot A_{n-j}^{k-j}\\)</span> å’Œ <span class=\"math inline\">\\(h_j=\\sum\\limits_{j=1}^i f_i\\cdot C_{k-i}^1\\cdot A_{n-i-1}^{k-i-1}\\)</span>ï¼Œå†ç”¨æ•°æ®ç»“æ„è®¡ç®— <span class=\"math inline\">\\(\\sum\\limits_{i=1,a_i&gt;x}^{pos_x}C_{k-i}^1\\cdot A_{n-i-1}^{k-i-1} - A_{n-i}^{k-i}\\)</span> å³å¯ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    std::vector&lt;int&gt; a(k + 1), p(n + 1, k + 1);\n    for (int i = 1; i &lt;= k; ++i)\n        std::cin &gt;&gt; a[i], p[a[i]] = i;\n    std::vector&lt;long long&gt; fac(n + 1), inv(n + 1);\n    &#123;\n        fac[0] = inv[0] = 1ll;\n        for (int i = 1; i &lt;= n; ++i)\n            fac[i] = fac[i - 1] * i % mod;\n        auto qkp = [](long long x, int y) &#123;\n            auto res(1ll);\n            for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n                if (y &amp; 1)\n                    (res *= x) %= mod;\n            return res;\n        &#125;;\n        inv[n] = qkp(fac[n], mod - 2);\n        for (int i = n - 1; i; --i)\n            inv[i] = inv[i + 1] * (i + 1) % mod;\n    &#125;\n    auto A = [&amp;](int n, int m) &#123;\n        if (n &lt; m || m &lt; 0)\n            return 0ll;\n        return fac[n] * inv[n - m] % mod;\n    &#125;;\n    std::vector&lt;long long&gt; f(k + 1), g(k + 1), h(k + 1);\n    std::vector&lt;long long&gt; bit(n + 1);\n    auto lowbit = [](int x) &#123;\n        return x &amp; -x;\n    &#125;;\n    auto add = [&amp;](int x, int v) &#123;\n        for (; x &lt;= n; x += lowbit(x))\n            (bit[x] += v) %= mod;\n        return;\n    &#125;;\n    auto ask = [&amp;](int x) &#123;\n        auto res(0ll);\n        for (; x; x -= lowbit(x))\n            (res += bit[x]) %= mod;\n        return res;\n    &#125;;\n    for (int i = 1; i &lt;= n; ++i)\n        if (p[i] == k + 1)\n            add(i, 1);\n    for (int i = k; i; --i)\n        f[i] = ask(a[i]), add(a[i], 1);\n    for (int i = 1; i &lt;= k; ++i) &#123;\n        g[i] = (g[i - 1] + f[i] * A(n - i, k - i)) % mod;\n        h[i] = (h[i - 1] + f[i] * (k - i) % mod * A(n - i - 1, k - i - 1)) % mod;\n        // printf(&quot;%d: f = %lld, g = %lld, h = %lld\\n&quot;, i, f[i], g[i], h[i]);\n    &#125;\n    std::vector&lt;long long&gt; res(n + 1);\n    bit.assign(n + 1, 0ll);\n    auto s(0ll);\n    for (int i = 1; i &lt;= k; ++i) &#123;\n        // printf(&quot;%d: %lld + %lld + %lld\\n&quot;, a[i], 1 + g[k] - g[i], h[i], s - ask(a[i]));\n        res[a[i]] = (1 + g[k] - g[i] + h[i] + (s - ask(a[i]))) % mod;\n        res[a[i]] = (res[a[i]] + mod) % mod;\n        (s += A(n - i, k - i) - (k - i) * A(n - i - 1, k - i - 1)) %= mod;\n        add(a[i], (A(n - i, k - i) - (k - i) * A(n - i - 1, k - i - 1)) % mod);\n    &#125;\n    for (int i = 1; i &lt;= n; ++i)\n        if (p[i] == k + 1) &#123;\n            res[i] = (h[k] + (s - ask(i))) % mod;\n            res[i] = (res[i] + mod) % mod;\n        &#125;\n    for (int x = 1; x &lt;= n; ++x)\n        std::cout &lt;&lt; res[x] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"c---1-loop-bubble-sort\">C - 1 Loop Bubble Sort</h2>\n<p><a href=\"https://atcoder.jp/contests/arc187/tasks/arc187_c\" class=\"uri\">https://atcoder.jp/contests/arc187/tasks/arc187_c</a></p>\n<p>é¦–å…ˆæ˜¯è¢«è€ƒçƒ‚äº†çš„ï¼šå¯¹åºåˆ—è¿›è¡Œä¸€æ¬¡å†’æ³¡æ’åºï¼Œç­‰ä»·äºå°†åºåˆ—åœ¨å‰ç¼€æœ€å¤§å€¼å¤„åˆ†æ®µï¼Œå¹¶å°†å…¶ä»æ®µé¦–ç§»åˆ°æ®µå°¾ï¼›ä¸”æ»¡è¶³æ’åºå‰ä¸ºå‰ç¼€æœ€å¤§å€¼çš„å…ƒç´ ï¼Œæ’åºåä»ä¸ºå‰ç¼€æœ€å¤§å€¼ã€‚</p>\n<p>è€ƒè™‘ç”¨ DP è§£å†³é—®é¢˜ã€‚æ³¨æ„çŠ¶æ€è¦ä» <span class=\"math inline\">\\(P\\)</span> çš„è§’åº¦å‡ºå‘â€”â€”å‡å¦‚ <span class=\"math inline\">\\(Q\\)</span> ä¸­ä¸å­˜åœ¨ <span class=\"math inline\">\\(-1\\)</span>ï¼Œå‘ç°ä¹Ÿéœ€è¦ DPã€‚æ­¤æ—¶å†è®¾è®¡æœ‰å…³ <span class=\"math inline\">\\(Q\\)</span> çš„çŠ¶æ€å°±å¾ˆæ‰¯æ·¡äº†ï¼Œè€ƒè™‘ä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤º <span class=\"math inline\">\\(P\\)</span> ä¸­ç›´åˆ°ç¬¬ <span class=\"math inline\">\\(i\\)</span> ä½çš„å‰ç¼€æœ€å¤§å€¼ä¸º <span class=\"math inline\">\\(j\\)</span> çš„æ–¹æ¡ˆæ•°ã€‚ä¸ºä»€ä¹ˆæŠŠå‰ç¼€æœ€å¤§å€¼ä½œä¸ºçŠ¶æ€å‘¢ï¼Ÿå› ä¸ºå®ƒå¯ä»¥è¡¨ç¤ºåˆ†æ®µï¼›åŒæ—¶é™åˆ¶æ®µé—´æ•°çš„å–å€¼ã€‚å…·ä½“åœ°ï¼Œè€ƒè™‘è½¬ç§»ï¼š</p>\n<ol type=\"1\">\n<li>è‹¥ä»¤ <span class=\"math inline\">\\(P_i=j\\)</span>ï¼Œåˆ™åœ¨ <span class=\"math inline\">\\(i\\)</span> å¤„åˆ†æ®µã€‚å¯¹åº”åˆ° <span class=\"math inline\">\\(Q\\)</span> ä¸­ï¼Œ<span class=\"math inline\">\\(i-1\\)</span> ä½æ˜¯ä¸Šä¸€ä¸ªå‰ç¼€æœ€å¤§å€¼ï¼Œé‚£ä¹ˆè¿™è¦æ±‚ <span class=\"math inline\">\\(Q_{i-1}&lt;j\\)</span>ï¼Œä¸” <span class=\"math inline\">\\(Q_{i-1}\\)</span> æ˜¯ä¸€ä¸ªå‰ç¼€æœ€å¤§å€¼ã€‚ä¹Ÿå³ï¼šå½“ <span class=\"math inline\">\\(Q_{i-1}\\ne -1\\)</span> æ—¶ï¼Œ<span class=\"math inline\">\\(f_{i,j}\\gets f_{i-1, Q_{i-1}}\\)</span>ï¼›å¦åˆ™ï¼Œ<span class=\"math inline\">\\(f_{i,j}\\gets \\sum\\limits_{k&lt;j} f_{i-1,k}\\)</span>ã€‚å…¶ä¸­ï¼ŒäºŒå¼éƒ½è¦æ±‚è½¬ç§»æ¥æºä¸ºå‰ç¼€æœ€å¤§å€¼ã€‚</li>\n<li>è‹¥ä»¤ <span class=\"math inline\">\\(P_i&lt;j\\)</span>ï¼Œåˆ™ <span class=\"math inline\">\\(i\\)</span> åœ¨ <span class=\"math inline\">\\(Q\\)</span> ä¸­æ°å¥½å‰ç§»ä¸€ä½ï¼Œå³ <span class=\"math inline\">\\(Q_{i-1}=P_i&lt;j\\)</span>ã€‚åˆ™å½“ <span class=\"math inline\">\\(Q_{i-1}\\ne -1\\)</span> æ—¶ï¼Œè¯¥ä½ç¡®å®šï¼Œ<span class=\"math inline\">\\(f_{i,j}\\gets f_{i-1,j}\\)</span>ï¼›å¦åˆ™ï¼Œ<span class=\"math inline\">\\(Q_{i-1}\\)</span> å¯é€‰çš„å€¼ä¸º <span class=\"math inline\">\\(&lt;j\\)</span> çš„æ‰€æœ‰æœªé€‰æ•°ï¼ˆå®šå€¼ï¼Œå¯é¢„å¤„ç†ï¼‰ã€‚</li>\n</ol>\n<p>å…³äºåˆå€¼ï¼Œå¯ä»¥åœ¨ <span class=\"math inline\">\\(P\\)</span> å‰åŠ ä¸€ä¸ª <span class=\"math inline\">\\(0\\)</span> ä½œä¸ºæ’åˆ—çš„ä¸€éƒ¨åˆ†ï¼ˆé‚£ä¹ˆæŒ‰ç…§å†’æ³¡æ’åºçš„è§„åˆ™ <span class=\"math inline\">\\(Q\\)</span> çš„ç¬¬ä¸€ä½ä¹Ÿä¸€å®šæ˜¯ <span class=\"math inline\">\\(0\\)</span>ï¼‰æ¥å¤„ç†å°±å¥½äº†ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; q(n + 1), t(n + 1), c(n + 1), pos(n + 1);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; q[i], c[i] = c[i - 1];\n        if (q[i] == -1)\n            ++c[i];\n        else\n            pos[q[i]] = i;\n    &#125;\n    for (int i = 1; i &lt; n; ++i) &#123;\n        // printf(&quot;t[%d] = %d\\n&quot;, i, t[i]);\n        if (!pos[i])\n            for (int j = i + 1; j &lt;= n; ++j)\n                ++t[j];\n    &#125;\n    std::vector&lt;std::vector&lt;long long&gt; &gt; f(n + 1, std::vector&lt;long long&gt; (n + 1)), s(n + 1, std::vector&lt;long long&gt; (n + 1));\n    f[0][0] = 1ll;\n    s[0].assign(n + 1, 1ll);\n    for (int i = 1; i &lt;= n; ++i)\n        for (int j = 1; j &lt;= n; ++j) &#123;\n            if (q[i - 1] == -1)\n                f[i][j] = (s[i - 1][j - 1] + f[i - 1][j] * std::max(0, 1 + t[j] - c[i - 1])) % mod;\n            else if (q[i - 1] &lt; j)\n                f[i][j] = (f[i - 1][q[i - 1]] + f[i - 1][j]) % mod;\n            s[i][j] = s[i][j - 1];\n            if (q[i] == j || !pos[j]) // æ»¡è¶³å‰ç¼€æœ€å¤§å€¼\n                (s[i][j] += f[i][j]) %= mod;\n            // printf(&quot;f[%d][%d] = %lld\\n&quot;, i, j, f[i][j]);\n        &#125;\n    std::cout &lt;&lt; f[n][n] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"f---1.-intro\">(F - 1). Intro</h2>\n<blockquote>\n<p>ç»™å®šä¸€ä¸ªå¤§å°ä¸º <span class=\"math inline\">\\(n\\)</span> çš„æ ‘ï¼Œç‚¹æœ‰ç‚¹æƒã€‚ç»™å®š <span class=\"math inline\">\\(q\\)</span> æ¬¡æ“ä½œï¼Œåˆ†ä¸ºä¸¤ç§ï¼š</p>\n<ol type=\"1\">\n<li><code>1 x</code>ï¼šæŸ¥è¯¢ <span class=\"math inline\">\\(x\\)</span> çš„ç‚¹æƒã€‚</li>\n<li><code>2 x d v</code> å¯¹äºæ‰€æœ‰è· <span class=\"math inline\">\\(x\\)</span> ä¸è¶…è¿‡ <span class=\"math inline\">\\(d\\)</span> çš„ç‚¹ï¼Œå°†å®ƒä»¬çš„æƒå€¼åŠ ä¸Š <span class=\"math inline\">\\(v\\)</span>ã€‚</li>\n</ol>\n<p><span class=\"math inline\">\\(n,q\\le 10^5,d\\le 20\\)</span>ã€‚</p>\n</blockquote>\n<p>ç”±äº <span class=\"math inline\">\\(d\\)</span> å¾ˆå°ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æšä¸¾ä¸ <span class=\"math inline\">\\(x\\)</span> è·ç¦» <span class=\"math inline\">\\(0\\sim d\\)</span> çš„ç‚¹è¿›è¡Œä¿®æ”¹ï¼›é‚£ä¹ˆå¯¹è·ç¦» <span class=\"math inline\">\\(x\\)</span> ä¸º <span class=\"math inline\">\\(i\\)</span> çš„ç‚¹çš„æ›´æ”¹å­˜å‚¨åœ¨ <span class=\"math inline\">\\(f_{x,i}\\)</span>ï¼ŒæŸ¥è¯¢ <span class=\"math inline\">\\(v\\)</span> æ—¶å°±å¯ä»¥ä» <span class=\"math inline\">\\(\\sum\\limits_i f_{fa(v,i),i}\\)</span> æ±‚å¾—ç­”æ¡ˆã€‚</p>\n<p>è€ƒè™‘ä¿®æ”¹ã€‚è®° <span class=\"math inline\">\\(S_{x,d}\\)</span> ä¸ºè· <span class=\"math inline\">\\(x\\)</span> ä¸º <span class=\"math inline\">\\(d\\)</span> çš„ç‚¹é›†ã€‚<span class=\"math inline\">\\(x\\)</span> å­æ ‘å†…æ˜¯å¥½å¤„ç†çš„ï¼Œä½†å­æ ‘å¤–çš„å‘¢ï¼Ÿå‘ç° <span class=\"math inline\">\\(S_{fa,d-1}\\)</span> ä¸­ <span class=\"math inline\">\\(x\\)</span> å­æ ‘å¤–çš„ç‚¹ï¼Œå°±æ˜¯ <span class=\"math inline\">\\(fa\\)</span> å­æ ‘ä¸‹ã€<span class=\"math inline\">\\(x\\)</span> å­æ ‘å¤–è·ç¦» <span class=\"math inline\">\\(x\\)</span> ä¸º <span class=\"math inline\">\\(d\\)</span> çš„æ‰€æœ‰ç‚¹ã€‚</p>\n<p>ç”±äºæ‰€æœ‰ <span class=\"math inline\">\\(S_{fa(x,i),d-i}\\)</span> æ— äº¤ï¼Œè¿™å¯èƒ½æ»¡è¶³æˆ‘ä»¬æ¯ä¸ªå¾…æ“ä½œç‚¹è¢«ä¸é‡ä¸æ¼åŠ ä¸€æ¬¡çš„è¦æ±‚ã€‚è€ƒè™‘å°†æ‰€æœ‰ <span class=\"math inline\">\\(S_{fa(x,i),d-i}\\)</span> æ ‡è®°å‡ºæ¥ï¼š</p>\n<figure>\n<img src=\"1.png\" alt=\"ç²‰è‰²è™šçº¿æ¡†æ˜¯å¾…æ“ä½œç‚¹é›†\" /><figcaption>ç²‰è‰²è™šçº¿æ¡†æ˜¯å¾…æ“ä½œç‚¹é›†</figcaption>\n</figure>\n<p>ç„¶åæˆ‘ä»¬å¯ä»¥ä¸€çœ¼å‘ç°è¢«å‰çš„ç‚¹å’Œæœªè¢«å‰çš„å¾…æ“ä½œç‚¹æ˜¯äº¤é”™çš„ï¼è¿™æ„å‘³ç€æˆ‘ä»¬åªéœ€è¦å†è¡¥å……ä¸Šæ‰€æœ‰ <span class=\"math inline\">\\(S_{fa(x,i),d-i-1}\\)</span> å³å¯ï¼ˆæ˜¾ç„¶å®ƒä»¬ä¹‹é—´ã€å®ƒä»¬å’Œæ‰€æœ‰ <span class=\"math inline\">\\(S_{fa(x,i),d-i}\\)</span> ä¹‹é—´éƒ½ä¸äº¤ï¼‰ã€‚</p>\n<figure>\n<img src=\"2.png\" alt=\"è™šçº¿å‰ä¸º S_{fa(x,i),d-i-1}\" /><figcaption>è™šçº¿å‰ä¸º <span class=\"math inline\">\\(S_{fa(x,i),d-i-1}\\)</span></figcaption>\n</figure>\n<p>æ­¤æ—¶å°±å¯ä»¥ä¸é‡ä¸æ¼ã€‚å½“ç„¶ï¼Œä¹Ÿä¼šå­˜åœ¨ä¸€äº›ç»†èŠ‚ï¼šæ¯”å¦‚è¯´ <span class=\"math inline\">\\(fa(x,i)\\)</span> ä¸å­˜åœ¨ä¹‹ç±»ã€‚åªéœ€è¦åœ¨æ ¹èŠ‚ç‚¹ <span class=\"math inline\">\\(1\\)</span> å¤„å°†å‰©ä½™çš„ <span class=\"math inline\">\\(S_{1,i\\to 0}\\)</span> å…¨éƒ¨æ›´æ–°å³å¯ã€‚</p>\n<p>æ•…æ¯æ¬¡ä¿®æ”¹æ“ä½œåªéœ€è¦ä¿®æ”¹ <span class=\"math inline\">\\(O(d)\\)</span> å¨ç‚¹ã€‚æ—¶é—´å¤æ‚åº¦ <span class=\"math inline\">\\(O(qd)\\)</span>ã€‚</p>\n<hr />\n<h2 id=\"f.-distance-to-the-path\">F. Distance to the Path</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1749/F\" class=\"uri\">https://codeforces.com/problemset/problem/1749/F</a></p>\n<p>æœ¬ä¾‹ä¸­å°†å•ç‚¹ä¿®æ”¹æ›¿æ¢ä¸ºè·¯å¾„ä¿®æ”¹ï¼›è€ƒè™‘æ ‘å‰–è§£å†³é—®é¢˜ã€‚</p>\n<p>å¯¹äºè·¯å¾„ä¸Šçš„æ‰€æœ‰ç‚¹ <span class=\"math inline\">\\(u\\)</span>ï¼Œå®¹æ˜“å‘ç°åªéœ€è¦ä¿®æ”¹æ‰€æœ‰çš„ <span class=\"math inline\">\\(S_{u,d}\\)</span> å°±å¯ä»¥å®Œæˆå¯¹ã€<strong>ä¸€éƒ¨åˆ†è·¯å¾„å†…ä¾§çš„ç‚¹</strong>ã€çš„ä¿®æ”¹ã€‚è¿™ã€ä¸€éƒ¨åˆ†ã€ï¼Œæ˜¯å› ä¸ºä¸åŒ…æ‹¬è·ç¦» LCA <span class=\"math inline\">\\(\\le d\\)</span> çš„ç‚¹ã€‚</p>\n<p>è€Œã€<strong>å¦ä¸€éƒ¨åˆ†è·¯å¾„å†…ä¾§çš„ç‚¹</strong>ï¼ˆè· LCA <span class=\"math inline\">\\(\\le d\\)</span>ï¼šè§ä¸Šä¸€è¡Œè¯´æ˜ï¼‰ã€åŠã€<strong>è·¯å¾„å¤–ä¾§çš„ç‚¹</strong>ï¼ˆè· LCA <span class=\"math inline\">\\(\\le d\\)</span>ï¼šå› ä¸ºè·¯å¾„åœ¨ LCA å­æ ‘å†…ï¼ŒLCA èƒ½å¤Ÿåˆ°æœ€è¿œçš„å¤–ä¾§ç‚¹ï¼‰ã€ï¼Œç­‰ä»·äºã€<strong>è· LCA <span class=\"math inline\">\\(\\le d\\)</span> çš„ç‚¹</strong>ã€ï¼Œåªéœ€è¦æŠŠ LCA ä»£å…¥ä¸Šä¾‹ä¸­æ–¹å¼ä¿®æ”¹å³å¯ã€‚</p>\n<p>ä¿®æ”¹è·¯å¾„ä¸Šæ‰€æœ‰ç‚¹ <span class=\"math inline\">\\(u\\)</span> çš„ <span class=\"math inline\">\\(S_{u,d}\\)</span> æ—¶ï¼Œå¯ä»¥å¯¹æ‰€æœ‰ <span class=\"math inline\">\\(f_{*,i}\\)</span> å»ºç«‹æ•°æ®ç»“æ„ï¼Œç”±äºåªéœ€è¦åŒºé—´ä¿®æ”¹ã€å•ç‚¹æŸ¥è¯¢ï¼Œä½¿ç”¨å·®åˆ†æ ‘çŠ¶æ•°ç»„å³å¯ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt; \nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n;\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1);\n    for (int i = 1, x, y; i &lt; n; ++i) &#123;\n        std::cin &gt;&gt; x &gt;&gt; y;\n        g[x].push_back(y), g[y].push_back(x);\n    &#125;\n    std::vector&lt;int&gt; siz(n + 1), dep(n + 1), fa(n + 1), son(n + 1);\n    std::function&lt;void(int, int)&gt; DFS = [&amp;](int x, int faa) &#123;\n        siz[x] = 1;\n        for (auto i : g[x])\n            if (i != faa) &#123;\n                fa[i] = x, dep[i] = dep[x] + 1;\n                DFS(i, x);\n                siz[x] += siz[i];\n                if (siz[i] &gt; siz[son[x]])\n                    son[x] = i;\n            &#125;\n        return;\n    &#125;;\n    DFS(1, -1);\n    std::vector&lt;int&gt; dfn(n + 1), top(n + 1);\n    DFS = [&amp;](int x, int toop) &#123;\n        static int now = 0;\n        dfn[x] = ++now, top[x] = toop;\n        if (son[x])\n            DFS(son[x], toop);\n        for (auto i : g[x])\n            if (i != fa[x] &amp;&amp; i != son[x])\n                DFS(i, i);\n        return;\n    &#125;;\n    DFS(1, 1);\n    std::vector&lt;std::vector&lt;long long&gt; &gt; bit(21, std::vector&lt;long long&gt; (n + 1));\n    auto lowbit = [&amp;](int x) &#123;\n        return x &amp; -x;\n    &#125;;\n    auto add = [&amp;](auto &amp;bit, int x, int v) &#123;\n        for (; x &lt;= n; x += lowbit(x))\n            bit[x] += v;\n        return;\n    &#125;;\n    auto ask = [&amp;](auto &amp;bit, int x) &#123;\n        auto res(0ll);\n        for (; x; x -= lowbit(x))\n            res += bit[x];\n        return res;\n    &#125;;\n    std::cin &gt;&gt; m;\n    for (int op; m--; ) &#123;\n        std::cin &gt;&gt; op;\n        if (op == 1) &#123;\n            int x;\n            std::cin &gt;&gt; x;\n            auto res(0ll);\n            for (int i = 0; i &lt;= 20 &amp;&amp; x; ++i, x = fa[x])\n                res += ask(bit[i], dfn[x]);\n            std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n        &#125;\n        else &#123;\n            int x, y, v, d;\n            std::cin &gt;&gt; x &gt;&gt; y &gt;&gt; v &gt;&gt; d;\n            for (; top[x] != top[y]; x = fa[top[x]]) &#123;\n                if (dep[top[x]] &lt; dep[top[y]])\n                    std::swap(x, y);\n                add(bit[d], dfn[top[x]], v);\n                add(bit[d], dfn[x] + 1, -v);\n            &#125;\n            if (dep[x] &gt; dep[y])\n                std::swap(x, y);\n            add(bit[d], dfn[x] + 1, v), add(bit[d], dfn[y] + 1, -v);\n            for (x = x, y = d; ~y &amp;&amp; x; x = fa[x], --y) &#123;\n                add(bit[y], dfn[x], v), add(bit[y], dfn[x] + 1, -v);\n                if (y &amp;&amp; fa[x])\n                    add(bit[y - 1], dfn[x], v), add(bit[y - 1], dfn[x] + 1, -v);\n            &#125;\n            if (x == 0)\n                for (; ~y; --y)\n                    add(bit[y], dfn[1], v), add(bit[y], dfn[1] + 1, -v);\n        &#125;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"a---ina-of-the-mountain\">A - Ina of the Mountain</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1852/C\" class=\"uri\">https://codeforces.com/problemset/problem/1852/C</a></p>\n<p>è€ƒè™‘è¿™ä¹ˆä¸€ä¸ªç®€åŒ–ç‰ˆçš„é—®é¢˜ï¼š</p>\n<blockquote>\n<p>ç»™å®š <span class=\"math inline\">\\(\\{a_n\\}\\)</span>ï¼Œæ¯æ¬¡å¯ä»¥è¿›è¡ŒåŒºé—´ <span class=\"math inline\">\\(-1\\)</span>ï¼Œé—®æ“ä½œå¤šå°‘æ¬¡æ‰èƒ½å°†æ‰€æœ‰å…ƒç´ å˜ä¸º <span class=\"math inline\">\\(0\\)</span>ã€‚</p>\n</blockquote>\n<p>ä¼šæƒ³åˆ°å·®åˆ†ï¼›å¯¹åŸæ•°ç»„è¿›è¡Œå·®åˆ†ï¼Œä¸€æ¬¡æ“ä½œç›¸å½“äºä»¤ <span class=\"math inline\">\\(d_l\\gets d_l-1\\)</span> è€Œ <span class=\"math inline\">\\(d_{r+1}\\gets d_{r+1}+1\\)</span>ï¼Œæœ€åè¦è®© <span class=\"math inline\">\\(\\forall \\,d_i=0\\)</span>ã€‚é‚£ä¹ˆç­”æ¡ˆå°±æ˜¯å·®åˆ†æ•°ç»„ä¸­æ­£æ•°ä¹‹å’Œå˜›ã€‚</p>\n<p>å›åˆ°åŸé—®é¢˜ã€‚åŸé—®é¢˜ç­‰ä»·äºæŠŠä¸Šè¿°é—®é¢˜å˜ä¸ºï¼š</p>\n<blockquote>\n<p>ç»™å®š <span class=\"math inline\">\\(\\{a_n\\}\\)</span>ï¼Œæ¯æ¬¡å¯ä»¥è¿›è¡ŒåŒºé—´ <span class=\"math inline\">\\(-1\\)</span>ï¼Œæ¯ä¸ªæ•°çš„æ€»æ“ä½œæ¬¡æ•°å¯¹ <span class=\"math inline\">\\(k\\)</span> å–æ¨¡ï¼Œé—®æ“ä½œå¤šå°‘æ¬¡æ‰èƒ½å°†æ‰€æœ‰å…ƒç´ å˜ä¸º <span class=\"math inline\">\\(0\\)</span>ã€‚</p>\n</blockquote>\n<p>æ€ä¹ˆå¥—å›åˆ°åˆšåˆšçš„é—®é¢˜ä¸Šå‘¢ï¼Ÿè¿˜åŸè¢«å–æ¨¡æ‰çš„æ“ä½œå³å¯ã€‚å…·ä½“æ¥è¯´ï¼Œæå‰åœ¨ <span class=\"math inline\">\\(d\\)</span> ä¸Šè¿›è¡Œè‹¥å¹²æ¬¡æ“ä½œï¼ˆè®°ä¸ºæ“ä½œ 1ï¼‰ï¼Œå½¢å¦‚ä»¤ <span class=\"math inline\">\\(d_i\\gets d_i+k\\)</span>ï¼ŒåŒæ—¶ <span class=\"math inline\">\\(d_{i+1}\\gets d_{i+1}-k\\)</span>ã€‚</p>\n<p>ä¼šå‘ç°ç›¸é‚»çš„æ“ä½œ <span class=\"math inline\">\\(1\\)</span> å¯¹ä¸€ä¸ªæ•°åŠ åŠ å‡å‡å½±å“åˆ¤æ–­ï¼›å‘ç°å¯ä»¥åˆå¹¶ä¸€æ®µè¿ç»­çš„æ“ä½œ 1ï¼Œè¡¨ç°åœ¨ <span class=\"math inline\">\\(a\\)</span> ä¸Šä¹Ÿå°±æ˜¯åŒºé—´ <span class=\"math inline\">\\(+k\\)</span>ã€‚æ­¤æ—¶å¯ä»¥å‘ç°ï¼Œä¸€ä¸ªä½ç½®ä¸Šåªä¼šå‰©ä¸‹è‹¥å¹²æ¬¡ <span class=\"math inline\">\\(+k\\)</span> æˆ–è‹¥å¹²æ¬¡ <span class=\"math inline\">\\(-k\\)</span> ï¼ˆå¦åˆ™å¯ä»¥æŠŠ <span class=\"math inline\">\\(+k\\)</span> å’Œ <span class=\"math inline\">\\(-k\\)</span> ä»£è¡¨çš„ä¸åŒæ“ä½œåˆå¹¶ï¼‰ï¼Œå°±ä¸ä¼šæœ‰äº’ç›¸å½±å“ä¸€è¯´äº†ã€‚è¿™ä¹Ÿæ˜¯æœ‰çš„é¢˜è§£è¯´å¯ä»¥æå‰åœ¨ <span class=\"math inline\">\\(a\\)</span> ä¸ŠåŒºé—´ <span class=\"math inline\">\\(+k\\)</span> çš„åŸå› ã€‚</p>\n<p>æ­¤æ—¶é—®é¢˜å˜ä¸ºåœ¨ <span class=\"math inline\">\\(d\\)</span> è¿›è¡Œä»»æ„æ¬¡å‰åŠ  <span class=\"math inline\">\\(k\\)</span> åå‡ <span class=\"math inline\">\\(k\\)</span> çš„æ“ä½œï¼Œä½¿å¾— <span class=\"math inline\">\\(\\sum\\limits_{d_i&gt;0}d_i\\)</span> æœ€å¤§åŒ–ã€‚é‚£ä¹ˆæ˜¾ç„¶å¦‚æœè¦ä½¿ä»£ä»·æ›´å°ï¼Œåªå¯èƒ½åœ¨åŸæœ¬ <span class=\"math inline\">\\(&lt;0\\)</span> çš„ä½ç½®åšåŠ æ³•ã€<span class=\"math inline\">\\(&gt;0\\)</span> çš„ä½ç½®åšå‡æ³•ï¼ˆå…¶ä»–æƒ…å†µä¼šå‘ç°ä¸€å®šä¸ä¼˜ï¼‰ã€‚è€ƒè™‘ä¸¤ä¸ªæ•° <span class=\"math inline\">\\(d_l,d_r\\)</span>ï¼Œå¯ä»¥æ„Ÿå—åˆ°å¯¹äºä¸€ä¸ª <span class=\"math inline\">\\(r\\)</span>ï¼Œé€‰æœ€å°çš„ <span class=\"math inline\">\\(d_l\\)</span> æ˜¯æœ€ä¼˜çš„ï¼Œä½†ä»€ä¹ˆæ—¶å€™åº”è¯¥é€‰å‘¢ï¼Ÿ</p>\n<ul>\n<li><span class=\"math inline\">\\(d_l\\le -k,d_r\\ge k\\)</span>ï¼šå½“ç„¶å¯é€‰ï¼Œ<span class=\"math inline\">\\(k\\)</span> è¢«å®Œå…¨åˆ©ç”¨ï¼Œç­”æ¡ˆå‡å°‘ <span class=\"math inline\">\\(k\\)</span>ã€‚</li>\n<li><p><span class=\"math inline\">\\(d_l&gt;-k,d_r\\ge k\\)</span>ï¼šæ­¤æ—¶ <span class=\"math inline\">\\(k\\)</span> æœªè¢«å®Œå…¨åˆ©ç”¨ï¼Œä½†å¿…é¡»é€‰ï¼šé€‰æ‹©å…¶ä»–æ›´å¤§çš„æ•°ï¼Œ<span class=\"math inline\">\\(k\\)</span> çš„åˆ©ç”¨ç‡åªä¼šæ›´ä½ï¼›å¦‚æœä¸é€‰ï¼Œç­”æ¡ˆä¹Ÿæ— æ³•å‡å°‘ã€‚</p>\n<p>Qï¼šæ­¤æ—¶æ˜¯å¦éœ€è¦å°è¯•æ‰¾åˆ°ä¸€ä¸ª <span class=\"math inline\">\\(l&#39;&lt;l\\)</span> ä¸ <span class=\"math inline\">\\(l\\)</span> åšæ“ä½œï¼Œä½¿å¾— <span class=\"math inline\">\\(l\\)</span> é‡æ–°å˜ä¸ºè´Ÿæ•°å‘¢ï¼Ÿ</p>\nAï¼šå¦ã€‚å› ä¸ºä½ å¯ä»¥å°†è¿™ä¸¤æ¬¡æ“ä½œåˆå¹¶ï¼Œå‘ç°ç›¸å½“äºæ˜¯ç›´æ¥å¯¹ <span class=\"math inline\">\\((l&#39;,r)\\)</span> åšæ“ä½œï¼Œæ˜¯æ›´åŠ£çš„ã€‚</li>\n<li><span class=\"math inline\">\\(d_l\\le -k,d_r&lt;k\\)</span>ï¼šæ­¤æ—¶ <span class=\"math inline\">\\(k\\)</span> æœªè¢«å®Œå…¨åˆ©ç”¨ï¼Œ<span class=\"math inline\">\\(d_r\\)</span> æˆä¸ºè´Ÿæ•°ã€‚è¿™æ„å‘³ç€ <span class=\"math inline\">\\(d_r\\)</span> å°†ä¼šæˆä¸ºæŸä¸ª <span class=\"math inline\">\\(r&#39;\\)</span> çš„å¯é€‰é¡¹ã€‚è€ƒå¯Ÿ <span class=\"math inline\">\\(d_{r&#39;}\\)</span> å¯ç”¨çš„æœ€å°å€¼ã€‚å¦‚æœ <span class=\"math inline\">\\(d_r\\)</span> åœ¨å½“å‰ä¸åº”è¯¥ä½œä¸ºå³ç«¯ç‚¹ï¼Œå®ƒå°±ä¸€å®šä¼šè¢« <span class=\"math inline\">\\(d_{r&#39;}\\)</span> é€‰æ‹©ã€‚å…·ä½“çš„æœ‰ç‚¹æŠ½è±¡ï¼Œä½†æ˜¯ä½ å¯ä»¥ç†è§£ä¸º <span class=\"math inline\">\\(d_r\\)</span> é€‰äº† <span class=\"math inline\">\\(d_l\\)</span> çš„è´¡çŒ®æ˜¯è¢«æ•´åˆåˆ° <span class=\"math inline\">\\(d_r\\)</span> é‡Œçš„ï¼›å¦‚æœ <span class=\"math inline\">\\(d_r\\)</span> è¢«é€‰äº†å°±è¯´æ˜ <span class=\"math inline\">\\(d_{r&#39;}\\)</span> é€‰ <span class=\"math inline\">\\(d_l\\)</span> ä¼šæ‹¥æœ‰æ›´å¤§çš„ä¼˜åŠ¿ã€‚</li>\n<li><p><span class=\"math inline\">\\(d_l&gt;-k,d_r&lt;k\\)</span>ï¼šå’Œä¸Šé¢çš„æƒ…å†µç›¸ä¼¼ï¼›ä½†è¿™ç§æƒ…å†µä¸‹ç­”æ¡ˆå¯èƒ½åè€Œå˜å¾—æ›´å¤§ï¼Œå› ä¸ºæ²¡æœ‰åæ•ˆæ€§ï¼Œæ‰€ä»¥è‡³å°‘è¦ä¿è¯å•æ­¥æœ€ä¼˜ã€‚æ­¤æ—¶ä¸èƒ½é€‰ã€‚</p>\n<p>è¯´åˆ°å•æ­¥æœ€ä¼˜ï¼Œå°±ä¼šå‘ç°è¿™é‡Œå°±æ˜¯åæ‚”è´ªå¿ƒï¼›å•æ­¥æœ€ä¼˜ä¸€å®šæ˜¯å…¨å±€æœ€ä¼˜ï¼Œä½†æ›´é å‰çš„å±€éƒ¨æœ€ä¼˜å¯èƒ½è¢«å¦å®šæ‰ã€‚è€Œã€å¦å®šã€çš„æ–¹æ³•è¡¨ç°ä¸ºä¸€æ¬¡æ“ä½œã€‚</p></li>\n</ul>\n<p>ç»¼ä¸Šï¼Œä»å‰å¾€åæ‰«ï¼Œä¼˜å…ˆé˜Ÿåˆ—å®æ—¶ç»´æŠ¤è´Ÿæ•°æœ€å°å€¼ï¼Œå¯¹äºæ¯ä¸ªæ­£æ•°ï¼Œcheck é€‰æœ€å°å€¼æ˜¯å¦ä¼˜äºå½“å‰ç­”æ¡ˆï¼Œæœ‰å°±é€‰ã€‚å¦‚æœæ­£æ•°è¢«å‡ä¸ºè´Ÿï¼ŒåŠ å…¥é˜Ÿåˆ—ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int T;\n    for (std::cin &gt;&gt; T; T--; ) &#123;\n        int n, k;\n        std::cin &gt;&gt; n &gt;&gt; k;\n        std::vector&lt;int&gt; a(n + 1), d(n + 1);\n        long long res(0ll);\n        for (int i = 1; i &lt;= n; ++i) &#123;\n            std::cin &gt;&gt; a[i], a[i] %= k;\n            d[i] = a[i] - a[i - 1];\n            if (d[i] &gt; 0)\n                (res += d[i]);\n        &#125;\n        std::priority_queue&lt;int&gt; q;\n        for (int i = 1; i &lt;= n; ++i)\n            if (d[i] &lt; 0)\n                q.push(-d[i]);\n            else &#123;\n                for (; !q.empty() &amp;&amp; d[i] &gt; 0; ) &#123;\n                    int x = -q.top(), y = d[i];\n                    auto t(res - y);\n                    x += k, y -= k;\n                    if (x &gt; 0)\n                        t += x;\n                    if (y &gt; 0)\n                        t += y;\n                    if (t &gt;= res)\n                        break;\n                    q.pop();\n                    res = t, d[i] = y;\n                    if (d[i] &lt; 0)\n                        q.push(-d[i]);\n                &#125;\n            &#125;\n        std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b---miriany-and-matchstick\">B - Miriany and Matchstick</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1852/D\" class=\"uri\">https://codeforces.com/problemset/problem/1852/D</a></p>\n<p>ä»æ„é€ çš„è§’åº¦å‡ºå‘ï¼Œçœ‹åˆ°ã€æ°å¥½ä¸º <span class=\"math inline\">\\(k\\)</span>ã€ï¼Œä¼šæƒ³åˆ°æ‰¾åˆ°ä¸Šç•Œå’Œä¸‹ç•Œå¹¶è¯æ˜ä¸­é—´æ¯ä¸€ä¸ªæ•°éƒ½èƒ½å–åˆ°ã€‚</p>\n<p>ä½†ä¼¼ä¹å¾ˆå®¹æ˜“è¯ä¼ªï¼šä¾‹å¦‚å¯¹äº <code>AAAA</code>ï¼Œä¸‹ç•Œä¸º <span class=\"math inline\">\\(0\\)</span>ï¼Œä¸Šç•Œä¸º <span class=\"math inline\">\\(4\\)</span>ï¼Œä½†æœ‰ä¸”ä»…æœ‰ <span class=\"math inline\">\\(1\\)</span> å–ä¸åˆ°ã€‚ä½†è¯¥æƒ³æ³•å¹¶æœªç ´äº§â€”â€”å¯ä»¥æ„Ÿå—åˆ°è¿™æ ·çš„ä½ç½®å¾ˆå°‘ã€‚è¿›ä¸€æ­¥åœ°ï¼Œä½  <a href=\"https://www.luogu.com.cn/article/2mmg5rjd\">å¯ä»¥è¯æ˜åªæœ‰ä¸€ä¸ªè¿™æ ·çš„ä½ç½®</a>ï¼Œä¹Ÿå¯ä»¥ <a href=\"https://www.luogu.com.cn/article/679cwjgl\">å¤§èƒ†çŒœæƒ³è¿™æ ·çš„ä½ç½®ä¸€å®šå‡ºç°åœ¨ <span class=\"math inline\">\\(l+1\\)</span>ï¼Œ<span class=\"math inline\">\\(r-1\\)</span></a>ã€‚æ€»ä¹‹ç°åœ¨æˆ‘ä»¬çš„çŠ¶æ€å°±å‡å°‘äº†ï¼ˆæˆ–è€…è¯´çŠ¶æ€å˜æˆ DP å€¼äº†ï¼‰ã€‚é¢„å¤„ç†å‡ºè¿™ä¸ªä¸œè¥¿ä¹‹åå¤§åŠ›æœç´¢æ‰¾æ–¹æ¡ˆå³å¯ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int T;\n    for (std::cin &gt;&gt; T; T--; ) &#123;\n        int n, k;\n        std::cin &gt;&gt; n &gt;&gt; k;\n        std::vector&lt;int&gt; a(n + 1);\n        for (int i = 1; i &lt;= n; ++i) &#123;\n            char t;\n            std::cin &gt;&gt; t, a[i] = (t == &#39;A&#39;);\n            if (i &gt;= 2)\n                k -= (a[i] ^ a[i - 1]);\n        &#125;\n        std::vector&lt;std::array&lt;std::tuple&lt;int, int, int&gt;, 2&gt; &gt; f(n + 1);\n        f[n][0] = &#123; a[n], a[n], 0 &#125;, f[n][1] = &#123; !a[n], !a[n], 0 &#125;;\n        auto merge = [&amp;](int i, int l0, int r0, int p0, int l1, int r1, int p1) &#123;\n            if (l0 &gt; l1)\n                std::swap(l0, l1), std::swap(r0, r1), std::swap(p0, p1);\n            int l = l0, r = std::max(r0, r1), p = 0;\n            if (!p0 &amp;&amp; !p1) &#123;\n                if (r0 &lt; l1 - 1)\n                    assert(r0 == l1 - 2), p = r0 + 1;\n                else;\n            &#125;\n            else if (p0 &amp;&amp; p1) &#123;\n                if (p0 == p1)\n                    p = p0;\n                else &#123;\n                    int tag0 = (l1 &lt;= p0 &amp;&amp; p0 &lt;= r1), tag1 = (l0 &lt;= p1 &amp;&amp; p1 &lt;= r0);\n                    if (!tag0 &amp;&amp; !tag1);\n                    else if (!tag0)\n                        p = p0;\n                    else if (!tag1)\n                        p = p1;\n                    else;\n                &#125;\n            &#125;\n            else if (p0) &#123;\n                if (l1 &lt;= p0 &amp;&amp; p0 &lt;= r1);\n                else\n                    p = p0;\n            &#125;\n            else &#123;\n                if (l0 &lt;= p1 &amp;&amp; p1 &lt;= r0);\n                else\n                    p = p1;\n            &#125;\n            assert(p != l &amp;&amp; p != r &amp;&amp; l &lt;= r);\n            return std::make_tuple(l, r, p);\n        &#125;;\n        for (int i = n - 1; i; --i) &#123;\n            &#123;\n                auto [l0, r0, p0] = f[i + 1][0];\n                auto [l1, r1, p1] = f[i + 1][1];\n                if (a[i]) &#123;\n                    ++l0, ++r0, ++l1, ++r1;\n                    if (p0) ++p0;\n                    if (p1) ++p1;\n                &#125;\n                ++l1, ++r1;\n                if (p1) ++p1;\n                f[i][0] = merge(i, l0, r0, p0, l1, r1, p1);\n            &#125;\n            &#123;\n                auto [l0, r0, p0] = f[i + 1][0];\n                auto [l1, r1, p1] = f[i + 1][1];\n                if (!a[i]) &#123;\n                    ++l0, ++r0, ++l1, ++r1;\n                    if (p0) ++p0;\n                    if (p1) ++p1;\n                &#125;\n                ++l0, ++r0;\n                if (p0) ++p0;\n                f[i][1] = merge(i, l0, r0, p0, l1, r1, p1);\n            &#125;\n        &#125;\n        std::vector&lt;int&gt; res(n + 1);\n        std::function&lt;bool(int, int, int)&gt; DFS = [&amp;](int x, int cnt, int la) &#123;\n            if (x == n + 1)\n                return cnt == k;\n            auto [l0, r0, p0] = f[x][0];\n            auto [l1, r1, p1] = f[x][1];\n            if (cnt + (la == 1) + l0 &lt;= k &amp;&amp; cnt + (la == 1) + r0 &gt;= k &amp;&amp; (!p0 || cnt + (la == 1) + p0 != k) &amp;&amp; DFS(x + 1, cnt + (la == 1) + a[x], 0))\n                res[x] = 0;\n            else if (cnt + !la + l1 &lt;= k &amp;&amp; cnt + !la + r1 &gt;= k &amp;&amp; (!p1 || cnt + !la + p1 != k) &amp;&amp; DFS(x + 1, cnt + !la + !a[x], 1))\n                res[x] = 1;\n            else\n                return false;\n            return true;\n        &#125;;\n        if (DFS(1, 0, -1)) &#123;\n            std::cout &lt;&lt; &quot;YES\\n&quot;;\n            for (int i = 1; i &lt;= n; ++i)\n                std::cout &lt;&lt; (res[i] ? &#39;A&#39; : &#39;B&#39;);\n            std::cout &lt;&lt; &#39;\\n&#39;;\n        &#125;\n        else\n            std::cout &lt;&lt; &quot;NO\\n&quot;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n",
            "tags": [
                "DP",
                "å®¹æ–¥åŸç†",
                "æ ‘é“¾å‰–åˆ†",
                "åæ‚”è´ªå¿ƒ"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250421/",
            "url": "https://xsc062.netlify.app/20250421/",
            "title": "æ‚é¢˜é€‰è°ˆ",
            "date_published": "2025-04-21T06:42:31.000Z",
            "content_html": "<figure>\n<img src=\"/20250421/neko.png\" alt=\"çŒ«\" style=\"width: 75px\">\n<figcaption>\nçŒ«\n</figcaption>\n</figure>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"a---t-shirt\">A - T-shirt</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/183/D\" class=\"uri\">https://codeforces.com/problemset/problem/183/D</a></p>\n<p>å¦‚æœçŸ¥é“ä¸€ä¸ªè¡£æœåºåˆ—ï¼Œæ€ä¹ˆç®—å‡ºæœŸæœ›å‘¢ï¼Ÿ</p>\n<hr />\n<h2 id=\"b---two-melodies\">B - Two Melodies</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/813/D\" class=\"uri\">https://codeforces.com/problemset/problem/813/D</a></p>\n<p>å¦‚æœè®¾ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºç¬¬ä¸€ä¸ªä»¥ <span class=\"math inline\">\\(i\\)</span> ç»“å°¾ï¼Œç¬¬äºŒä¸ªä»¥ <span class=\"math inline\">\\(j\\)</span> ç»“å°¾çš„æ–¹æ¡ˆæ•°ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªå¼Šç«¯â€”â€”å‡è®¾ç°åœ¨æœ‰ <span class=\"math inline\">\\(i&gt;j\\)</span>ï¼Œåˆå‡è®¾æœ‰ <span class=\"math inline\">\\(j&lt;j&#39;&lt;i\\)</span>ï¼Œé‚£ä¹ˆå°±ä¸å¯ä»¥ç›´æ¥æŠŠ <span class=\"math inline\">\\(f_{i,j}\\)</span> è½¬ç§»åˆ° <span class=\"math inline\">\\(f_{i,j&#39;}\\)</span>ï¼Œå› ä¸º <span class=\"math inline\">\\(j&#39;\\)</span> å¯èƒ½å·²ç»è¢«ç¬¬ä¸€ä¸ªé€‰è¿‡äº†ã€‚ä½†å¦‚æœä» <span class=\"math inline\">\\(i\\)</span> è½¬ç§»å°±æ²¡æœ‰è¿™æ ·çš„é—®é¢˜ï¼ˆä¸ç®¡ <span class=\"math inline\">\\(i&#39;\\)</span> æ˜¯æ¯” <span class=\"math inline\">\\(j\\)</span> å¤§è¿˜æ˜¯æ¯” <span class=\"math inline\">\\(j\\)</span> å°ï¼‰ã€‚</p>\n<p>é‚£å°±å¯ä»¥å›ºå®šä»è¾ƒå¤§çš„ä¸€ç»´è½¬ç§»ï¼Œä¹Ÿå¯ä»¥æšä¸¾æ‰€æœ‰æƒ…å†µã€‚ä½†æ˜¯è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™æ˜¯ä¸€ä¸ª <span class=\"math inline\">\\(n^3\\)</span> çš„è¿‡ç¨‹ï¼Œè€Œä¸”å¯¹äºä¸å•è°ƒçš„å†…å±‚ <span class=\"math inline\">\\(j\\)</span>ï¼Œç»´æŠ¤å®ƒçš„æ•°å€¼åªèƒ½ç”¨å¸¦ <span class=\"math inline\">\\(\\log\\)</span> çš„æ•°æ®ç»“æ„ä¼˜åŒ–ï¼Œä¼¼ä¹ä¸å¤ªè¿‡å¾—äº†ï¼›ä½† <span class=\"math inline\">\\(i\\)</span> å´å¯ä»¥å‰ç¼€ä¼˜åŒ–ã€‚</p>\n<p>å…¶å®ï¼Œä¸¤ä¸ªç»„æ˜¯æ— åºçš„ï¼Œè¿™æ„å‘³ç€å¯ä»¥å¼ºåˆ¶ <span class=\"math inline\">\\(i&gt;j\\)</span> å†ä» <span class=\"math inline\">\\(i\\)</span> è½¬ç§»ï¼›è¿™ä¸ªæ—¶å€™è½¬ç§»å°±å’Œ <span class=\"math inline\">\\(j\\)</span> æ²¡æœ‰å¤ªå¤§çš„å…³ç³»äº†ï¼Œå¯ä»¥æŠŠ <span class=\"math inline\">\\(j\\)</span> æ”¾åˆ°å¤–å±‚ï¼Œå¯¹ <span class=\"math inline\">\\(i\\)</span> å‰ç¼€ä¼˜åŒ–ã€‚å¯èƒ½éœ€è¦æ³¨æ„è¾¹ç•Œçš„å¤„ç†ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, res = 0;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; a(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    std::vector&lt;std::vector&lt;int&gt; &gt; f(n + 1, std::vector&lt;int&gt; (n + 1));\n    for (int j = 0; j &lt; n; ++j) &#123;\n        std::vector&lt;int&gt; mx(100002), mmx(7);\n        for (int i = 1; i &lt; j; ++i) &#123;\n            mx[a[i]] = std::max(mx[a[i]], f[j][i]);\n            mmx[a[i] % 7] = std::max(mmx[a[i] % 7], f[j][i]);\n        &#125;\n        for (int i = j + 1; i &lt;= n; ++i) &#123;\n            f[i][j] = std::max(&#123; !!i + !!j, mx[a[i] - 1] + 1, mx[a[i] + 1] + 1, mmx[a[i] % 7] + 1, f[j][0] + 1 &#125;);\n            mx[a[i]] = std::max(mx[a[i]], f[i][j]);\n            mmx[a[i] % 7] = std::max(mmx[a[i] % 7], f[i][j]);\n            // printf(&quot;f[%d][%d] = %d\\n&quot;, i, j, f[i][j]);\n            res = std::max(res, f[i][j]);\n        &#125;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"cf633f-the-chocolate-spree\">CF633F The Chocolate Spree</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/633/F\" class=\"uri\">https://codeforces.com/problemset/problem/633/F</a></p>\n<p>æ ‘å½¢ DP æ±‚ç›´å¾„çš„æ—¶å€™ï¼Œæœ‰ä¸€ç§æ–¹æ³•æ˜¯æ‰¾åˆ°æ¯ä¸ªç‚¹ä¸‹é¢çš„æœ€å¤§ä¸¤æ¡ä¸äº¤é“¾ã€‚</p>\n<p>è¿™é‡Œä¹Ÿå¯ä»¥æœ‰ç±»ä¼¼çš„æ±‚æ³•ã€‚å‡è®¾ç­”æ¡ˆå‡ºç°åœ¨å­æ ‘ <span class=\"math inline\">\\(u\\)</span> ä¸­ï¼ˆä¸‹é¢çš„ <span class=\"math inline\">\\(v_i\\)</span> éƒ½æ˜¯ <span class=\"math inline\">\\(u\\)</span> çš„ç›´æ¥å„¿å­ï¼‰ï¼Œå¯ä»¥è®¨è®º <span class=\"math inline\">\\(u\\)</span> å‚ä¸æ„æˆä¸¤æ¡è·¯å¾„çš„æƒ…å†µï¼š</p>\n<ol type=\"1\">\n<li>ä¸å‚ä¸æ„æˆä»»ä½•ä¸€æ¡è·¯å¾„ï¼Œç­”æ¡ˆæ˜¯ <span class=\"math inline\">\\(v_1,v_2\\)</span> å­æ ‘ä¸­çš„æœ€é•¿è·¯å¾„ä¹‹å’Œã€‚</li>\n<li><p>å‚ä¸æ„æˆå…¶ä¸­ä¸€æ¡ï¼š</p>\n<ol type=\"1\">\n<li>è¿™ä¸€æ¡ä¸å­æ ‘ <span class=\"math inline\">\\(v\\)</span> å®Œå…¨ç›¸ç¦»ï¼Œç­”æ¡ˆæ˜¯ <span class=\"math inline\">\\(v\\)</span> ä¸­æœ€é•¿è·¯å¾„ï¼Œå’Œ <span class=\"math inline\">\\(u\\)</span> ä¸‹é¢ä¸ç»è¿‡ <span class=\"math inline\">\\(v\\)</span> çš„æœ€å¤§ä¸¤æ¡ä¸äº¤é“¾ã€‚</li>\n<li>è¿™ä¸€æ¡æœ‰ä¸€æ”¯æ¥è‡ª <span class=\"math inline\">\\(v\\)</span> å­æ ‘ï¼Œä½†å’Œ <span class=\"math inline\">\\(v\\)</span> ä¸­æœ€é•¿è·¯å¾„æ²¡æœ‰é‡åˆçš„ç‚¹ã€‚ç­”æ¡ˆæ˜¯ <span class=\"math inline\">\\(u\\)</span> çš„ç‚¹æƒã€<span class=\"math inline\">\\(u\\)</span> ä¸‹é¢ä¸ç»è¿‡ <span class=\"math inline\">\\(v\\)</span> çš„æœ€å¤§é“¾ã€<span class=\"math inline\">\\(v\\)</span> ä¸­ä¸€æ¡è·¯å¾„ï¼ˆä¸ç»è¿‡ <span class=\"math inline\">\\(v\\)</span>ï¼‰å’Œ <span class=\"math inline\">\\(v\\)</span> ä¸‹é¢ä¸€æ¡é“¾ä¹‹å’Œçš„æœ€å¤§å€¼ï¼›</li>\n<li>è¿™ä¸€æ¡ä¸¤æ”¯éƒ½æ¥è‡ª <span class=\"math inline\">\\(v\\)</span> å­æ ‘ï¼šæœ‰é‡åˆï¼Œä¸å¯èƒ½å‘ç”Ÿã€‚</li>\n</ol></li>\n<li><p>å‚ä¸æ„æˆå…¶ä¸­ä¸¤æ¡ï¼Œç­”æ¡ˆæ˜¯ <span class=\"math inline\">\\(u\\)</span> ä¸‹é¢æœ€é•¿çš„å››æ¡é“¾ï¼šè·¯å¾„é‡å¤ç»è¿‡ <span class=\"math inline\">\\(u\\)</span>ï¼Œä¸å¯èƒ½å‘ç”Ÿã€‚</p></li>\n</ol>\n<p><img src=\"2.png\" /></p>\n<p>å¯ä»¥è®°å½• <span class=\"math inline\">\\(u\\)</span> ä¸‹æ–¹æœ€å¤§çš„å››æ¡ä¸äº¤é“¾ã€<span class=\"math inline\">\\(u\\)</span> ä¸­é€‰å–ä¸€æ¡ä¸ç»è¿‡ <span class=\"math inline\">\\(u\\)</span> çš„è·¯å¾„å’Œ <span class=\"math inline\">\\(u\\)</span> ä¸‹æ–¹ä¸€æ¡é“¾ä¹‹å’Œçš„æœ€å¤§å€¼ã€<span class=\"math inline\">\\(u\\)</span> ä¸­æœ€é•¿è·¯å¾„æ±‚è§£ã€‚</p>\n<details>\n<pre class=\"cpp language-cpp\" data-line=\"42-44\"><code class=\"cpp langauage-cpp\">#include &lt;bits/stdc++.h>\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(\".in\", \"r\", stdin);\n    std::freopen(\".out\", \"w\", stdout);\n#endif\n    int n;\n    std::cin >> n;\n    std::vector&lt;int> a(n + 1);\n    std::vector&lt;std::vector&lt;int> > g(n + 1);\n    for (int i = 1; i <= n; ++i)\n        std::cin >> a[i];\n    for (int i = 1, x, y; i < n; ++i) &#123;\n        std::cin >> x >> y;\n        g[x].push_back(y), g[y].push_back(x);\n    &#125;\n    auto res(0ll);\n    std::vector&lt;long long> s(n + 1), w(n + 1);\n    std::vector&lt;std::vector&lt;std::pair&lt;long long, int> > > f(n + 1, std::vector&lt;std::pair&lt;long long, int> > (4));\n    std::function&lt;void(int, int)> DFS = [&](int x, int fa) &#123;\n        f[x][0] = &#123; 0, x &#125;;\n        w[x] = s[x] = a[x];\n        for (auto i : g[x])\n            if (i != fa) &#123;\n                DFS(i, x);\n                &#123;\n                    if (f[i][0].first + a[i] > f[x][3].first)\n                        f[x][3].first = f[i][0].first + a[i], f[x][3].second = i;\n                    std::sort(f[x].begin(), f[x].end(), std::greater&lt;std::pair&lt;long long, int> > ());\n                &#125;\n                w[x] = std::max(w[x], w[i] + a[x]);\n            &#125;\n        auto mx(0ll);\n        for (auto i : g[x])\n            if (i != fa) &#123;\n                s[x] = std::max(&#123; s[x], s[i], f[x][0].first + f[x][1].first + a[x] &#125;);\n                w[x] = std::max(w[x], (f[x][0].second != i ? f[x][0] : f[x][1]).first + s[i] + a[x]);\n                res = std::max(&#123; res,\n                    mx + s[i], // æƒ…å†µ 1\n                    (f[x][0].second == i ? f[x][1].first + f[x][2].first : (f[x][1].second == i ? f[x][0].first + f[x][2].first : f[x][0].first + f[x][1].first)) + s[i] + a[x], // æƒ…å†µ 2.1\n                    (f[x][0].second == i ? f[x][1].first : f[x][0].first) + w[i] + a[x], // æƒ…å†µ 2.2\n                &#125;);\n                mx = std::max(mx, s[i]);\n            &#125;\n    //     printf(\"%d: res = %lld\\n  f: \\n\", a[x], res);\n    //     for (int i = 0; i < 4; ++i)\n    //         printf(\"    [%d] %lld\\n\", f[x][i].second, f[x][i].first);\n    //     printf(\"  s: %lld\\n  w: %lld\\n\", s[x], w[x]);\n    &#125;;\n    DFS(1, -1);\n    std::cout << res << '\\n';\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"c---å·¡é€»\">C - å·¡é€»</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P3629\" class=\"uri\">https://www.luogu.com.cn/problem/P3629</a></p>\n<p>ä½ å¯èƒ½éœ€è¦æ³¨æ„ï¼šç›®çš„æ˜¯éå†æ‰€æœ‰è¾¹è€Œéæ‰€æœ‰ç‚¹ã€‚</p>\n<p><span class=\"math inline\">\\(K=1\\)</span> çš„æ—¶å€™ï¼Œç¯ä¸Šé™¤äº†å…³é”®è¾¹çš„æ‰€æœ‰è¾¹ç»è¿‡æ¬¡æ•°ä¼šå‡ <span class=\"math inline\">\\(1\\)</span>ã€‚æ‰€ä»¥é€‰æ ‘çš„ç›´å¾„å°±å¯ä»¥æœ€ä¼˜ã€‚</p>\n<p><span class=\"math inline\">\\(K=2\\)</span> çš„æ—¶å€™ï¼Œç­”æ¡ˆæ˜¯ <span class=\"math inline\">\\(2\\times (m + 2)\\)</span> å‡å»ä¸¤ä¸ªè¾¹æ„æˆçš„ç¯çš„ <em>å¹¶é›†å‡äº¤é›†</em> å¤§å° <span class=\"math inline\">\\(L\\)</span>ã€‚ç¯å®é™…ä¸Šæ˜¯ä¸å­˜åœ¨çš„ï¼Œ<span class=\"math inline\">\\(L\\)</span> å…¶å®æ˜¯ä¸¤æ¡è·¯å¾„ <em>å¹¶é›†å‡äº¤é›†</em> å†åŠ ä¸Šä¸¤æ¡æ–°è¾¹çš„å€¼ã€‚</p>\n<p>ä¸¤æ¡è·¯å¾„æœ‰äº¤çš„æ—¶å€™ï¼Œå¯ä»¥ç­‰æ•ˆæˆæ— äº¤çš„æƒ…å†µï¼š</p>\n<p><img src=\"1.png\" /></p>\n<p>å°±åŒ–å½’æˆä¸Šä¸€ä¸ªé—®é¢˜äº†ã€‚æ³¨æ„æ­¤æ—¶æƒ…å†µ 3 å¯èƒ½å‘ç”Ÿï¼›åŒæ—¶æƒ…å†µ 2.2 å¯ä»¥é€‰å–ç»è¿‡ <span class=\"math inline\">\\(v\\)</span> çš„è·¯å¾„ã€‚</p>\n<details>\n<pre class=\"cpp language-cpp\" data-line=\"55-56,64-67\"><code class=\"cpp langauage-cpp\">#include &lt;bits/stdc++.h>\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(\".in\", \"r\", stdin);\n    std::freopen(\".out\", \"w\", stdout);\n#endif\n    int n, k;\n    std::cin >> n >> k;\n    std::vector&lt;std::vector&lt;int> > g(n + 1);\n    for (int i = 1, x, y; i < n; ++i) &#123;\n        std::cin >> x >> y;\n        g[x].push_back(y), g[y].push_back(x);\n    &#125;\n    int res = 0;\n    if (k == 1) &#123;\n        std::vector&lt;std::vector&lt;std::pair&lt;int, int> > > f(n + 1, std::vector&lt;std::pair&lt;int, int> > (2));\n        std::function&lt;void(int, int)> DFS = [&](int x, int fa) &#123;\n            f[x][0] = &#123; 0, x &#125;;\n            for (auto i : g[x])\n                if (i != fa) &#123;\n                    DFS(i, x);\n                    &#123;\n                        if (f[i][0].first + 1 > f[x][1].first)\n                            f[x][1].first = f[i][0].first + 1, f[x][1].second = i;\n                        std::sort(f[x].begin(), f[x].end(), std::greater&lt;std::pair&lt;int, int> > ());\n                    &#125;\n                &#125;\n            res = std::max(res, f[x][0].first + f[x][1].first);\n        &#125;;\n        DFS(1, -1);\n        std::cout << 2 * n - res - 1 << '\\n';\n    &#125;\n    else &#123;\n        std::vector&lt;int> s(n + 1), w(n + 1);\n        std::vector&lt;std::vector&lt;std::pair&lt;int, int> > > f(n + 1, std::vector&lt;std::pair&lt;int, int> > (4));\n        std::function&lt;void(int, int)> DFS = [&](int x, int fa) &#123;\n            f[x][0] = &#123; 0, x &#125;;\n            for (auto i : g[x])\n                if (i != fa) &#123;\n                    DFS(i, x);\n                    &#123;\n                        if (f[i][0].first + 1 > f[x][3].first)\n                            f[x][3].first = f[i][0].first + 1, f[x][3].second = i;\n                        std::sort(f[x].begin(), f[x].end(), std::greater&lt;std::pair&lt;int, int> > ());\n                    &#125;\n                    w[x] = std::max(w[x], w[i] + 1);\n                &#125;\n            &#123;\n                int t = 0;\n                for (auto [v, id] : f[x])\n                    t += v;\n                res = std::max(res, t); // æƒ…å†µ 3\n                w[x] = std::max(w[x], t - f[x][3].first); // è·¯å¾„å¯ç»è¿‡ u\n            &#125;\n            int mx = 0;\n            for (auto i : g[x])\n                if (i != fa) &#123;\n                    s[x] = std::max(&#123; s[x], s[i], f[x][0].first + f[x][1].first &#125;);\n                    w[x] = std::max(w[x], (f[x][0].second != i ? f[x][0] : f[x][1]).first + std::max(s[i], f[i][0].first + 1));\n                    res = std::max(&#123; res,\n                        mx + s[i], // æƒ…å†µ 1\n                        (f[x][0].second == i ? f[x][1].first + f[x][2].first : (f[x][1].second == i ? f[x][0].first + f[x][2].first : f[x][0].first + f[x][1].first)) + s[i], // æƒ…å†µ 2.1\n                        (f[x][0].second == i ? f[x][1].first : f[x][0].first) + w[i] + 1, // æƒ…å†µ 2.2\n                    &#125;);\n                    mx = std::max(mx, s[i]);\n                &#125;\n        &#125;;\n        DFS(1, -1);\n        std::cout << 2 * (n + 1) - res - 2 << '\\n';\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"d---ç¬é—´ä¼ é€-teleport\">D - ç¬é—´ä¼ é€ / Teleport</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P11915\" class=\"uri\">https://www.luogu.com.cn/problem/P11915</a></p>\n<p>éœ€è¦è§‚å¯Ÿåˆ°ä¸€ä¸ªå¾ˆå‰å®³çš„è´ªå¿ƒç­–ç•¥ï¼šå¦‚æœé’¦å®šæ‰€æœ‰ç‚¹çš„è·ç¦»ä¸å¤§äº <span class=\"math inline\">\\(r\\)</span>ï¼Œä¸”å­˜åœ¨ <span class=\"math inline\">\\(d(i,j)&gt;r\\)</span>ã€‚<strong>å‡è®¾</strong> ä¸€ç§æ»¡è¶³æ¡ä»¶çš„æ–°è¾¹æ˜¯ <span class=\"math inline\">\\((u,v)\\)</span>ï¼ˆç”±äºä¸¤è€…æ— åºï¼Œä¸å¦¨é’¦å®š <span class=\"math inline\">\\(d(i,u)&lt;d(i,v)\\)</span>ï¼‰ï¼Œå¯ä»¥è¿›è¡Œè®¨è®ºï¼š</p>\n<ol type=\"1\">\n<li><p><span class=\"math inline\">\\(d(j,v)&lt;d(j,u)\\)</span>ï¼š</p>\næ­¤æ—¶æœ€ä¼˜è·¯å¾„ä¸º <span class=\"math inline\">\\(i\\to u\\to v\\to j\\)</span>ï¼Œåˆ¤æ–­ä¸€ä¸‹è¿™ç§æ–¹æ¡ˆæ˜¯å¦ä¸å¤§äº <span class=\"math inline\">\\(r\\)</span> å°±å¯ä»¥äº†ã€‚</li>\n<li><p><span class=\"math inline\">\\(d(j,v)\\ge d(j, u)\\)</span>ï¼š</p>\n<p>æ­¤æ—¶ä¸ç®¡æ˜¯èµ° <span class=\"math inline\">\\(i\\to u\\to v\\to j\\)</span> è¿˜æ˜¯ <span class=\"math inline\">\\(i\\to v\\to u\\to j\\)</span> éƒ½ä¸å¦‚èµ°å·²ç»å­˜åœ¨çš„ <span class=\"math inline\">\\(i\\to u\\to j\\)</span> è¿™æ¡è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœè¦èµ°æ–°è¾¹ï¼Œä»£ä»·æ˜¯ä¸€å®šæ¯”åŸè·ç¦»å¤§ï¼Œæ›´æ˜¯æ¯” <span class=\"math inline\">\\(r\\)</span> å¤§çš„ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œ<span class=\"math inline\">\\((u,v)\\)</span> ä¸èƒ½è§£å†³ <span class=\"math inline\">\\((i,j)\\)</span> ä¹‹é—´çš„é—®é¢˜ï¼Œå‡è®¾å°±ä¸æˆç«‹äº†ã€‚</p></li>\n</ol>\n<p>ç»¼ä¸Šï¼Œåªéœ€è¦åˆ¤æ–­ <span class=\"math inline\">\\(i\\to u\\to v\\to j\\le r\\)</span> æ˜¯å¦æˆç«‹ï¼Œå°±å¯ä»¥åˆ¤æ–­ <span class=\"math inline\">\\((u,v)\\)</span> æ˜¯å¦åˆæ³•ã€‚ä»å¤§åˆ°å°æšä¸¾ <span class=\"math inline\">\\(r\\)</span>ï¼ŒåŒæ—¶ç»´æŠ¤å½“å‰ä¾ç„¶åˆæ³•çš„ <span class=\"math inline\">\\((u,v)\\)</span>ï¼ˆæ˜¾ç„¶æ˜¯æœ‰å•è°ƒæ€§çš„ï¼‰ï¼Œå¯¹äºä¸åˆæ³•çš„ <span class=\"math inline\">\\((i,j)\\)</span>ï¼Œæšä¸¾æ¯ä¸ª <span class=\"math inline\">\\(i\\)</span>ï¼Œç»´æŠ¤ <span class=\"math inline\">\\(\\max\\{d(v,j)\\}\\)</span>ï¼Œç²¾ç»†å®ç°ï¼ˆä¸»è¦æ˜¯åˆ©ç”¨å„ç§å‡æ‘Šï¼‰ä¸€ä¸‹å°±èƒ½ <span class=\"math inline\">\\(O(n^3)\\)</span>ã€‚</p>\n<p>è¿™é‡Œå…·ä½“æä¸€ä¸‹éœ€è¦æ‘Šçš„å‡ ä¸ªç‚¹ï¼š</p>\n<ol type=\"1\">\n<li>æšä¸¾åˆ° <span class=\"math inline\">\\(r\\)</span> çš„æ—¶å€™ç”¨æ‰€æœ‰ <span class=\"math inline\">\\(d(i,j)=r+1\\)</span> æŠŠ <span class=\"math inline\">\\(v\\)</span> åœ¨ <span class=\"math inline\">\\(i\\)</span> å¤„çš„æœ€å¤§ <span class=\"math inline\">\\(d(v,j)\\)</span> æ›´æ–°ï¼Œæ–¹ä¾¿åé¢ <span class=\"math inline\">\\(O(n)\\)</span> åœ° checkã€‚æ‘Šå‡ºæ¥æ˜¯ <span class=\"math inline\">\\(O(n^3)\\)</span> çš„ã€‚</li>\n<li>æšä¸¾ä»ç„¶å¤„åœ¨åˆæ³•é˜Ÿåˆ—é‡Œçš„ <span class=\"math inline\">\\((u,v)\\)</span>ï¼Œå¦‚æœ check åˆæ³•ï¼Œå°±è¯´æ˜å¯¹äºå½“å‰ <span class=\"math inline\">\\(r\\)</span> è‡³å°‘å­˜åœ¨ä¸€ä¸ªåˆæ³•è§£ï¼Œå°±å¯ä»¥ <code>break</code> äº†ï¼›å¦åˆ™ï¼ŒæŠŠ <span class=\"math inline\">\\((u,v)\\)</span> å¼¹å‡ºï¼Œç»§ç»­ check ä¸‹ä¸€æ¡è¾¹ã€‚è¿™æ ·æ¯æ¡è¾¹åªä¼šè¢«å¼¹å‡ºä¸€æ¬¡ï¼Œè€Œæœªå¼¹å‡ºè¾¹çš„ check æ¬¡æ•°æœ€å¤šæ˜¯ <span class=\"math inline\">\\(O(n)\\)</span>ï¼›åŠ ä¸Š <span class=\"math inline\">\\(O(n)\\)</span> çš„ checkï¼Œæ‘Šå‡ºæ¥æ˜¯ <span class=\"math inline\">\\(O(n^3)\\)</span> çš„ã€‚</li>\n</ol>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int inf = 0x3f3f3f3f;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int T;\n    for (std::cin &gt;&gt; T; T--; ) &#123;\n        int n;\n        std::cin &gt;&gt; n;\n        std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1, std::vector&lt;int&gt; (n + 1, inf));\n        for (int i = 1; i &lt;= n; ++i)\n            for (int j = 1; j &lt;= n; ++j) &#123;\n                char t;\n                std::cin &gt;&gt; t;\n                if (t == &#39;1&#39; || i == j)\n                    g[i][j] = t - &#39;0&#39;;\n            &#125;\n        for (int k = 1; k &lt;= n; ++k)\n            for (int i = 1; i &lt;= n; ++i)\n                if (i != k)\n                    for (int j = 1; j &lt;= n; ++j)\n                        if (j != i &amp;&amp; j != k)\n                            g[i][j] = std::min(g[i][j], g[i][k] + g[k][j]);\n        std::queue&lt;std::pair&lt;int, int&gt; &gt; q;\n        std::vector&lt;std::vector&lt;std::pair&lt;int, int&gt; &gt; &gt; p(n + 1);\n        std::vector&lt;std::vector&lt;int&gt; &gt; mx(n + 1, std::vector&lt;int&gt; (n + 1));\n        for (int i = 1; i &lt; n; ++i)\n            for (int j = i + 1; j &lt;= n; ++j) &#123;\n                q.emplace(i, j);\n                p[g[i][j] - 1].emplace_back(i, j);\n            &#125;\n        auto check = [&amp;](int u, int v, int r) &#123;\n            for (int i = 1; i &lt;= n; ++i) &#123;\n                if (g[u][i] &gt; g[v][i])\n                    std::swap(u, v);\n                if (g[u][i] + mx[v][i] &gt; r)\n                    return false;\n            &#125;\n            return true;\n        &#125;;\n        for (int r = n; r &gt;= -1; --r) &#123;\n            for (auto [i, j] : p[r])\n                for (int v = 1; v &lt;= n; ++v) &#123;\n                    mx[v][i] = std::max(mx[v][i], g[v][j]);\n                    mx[v][j] = std::max(mx[v][j], g[v][i]);\n                &#125;\n            for (; !q.empty(); ) &#123;\n                auto [u, v] = q.front();\n                if (!check(u, v, r))\n                    q.pop();\n                else\n                    break;\n            &#125;\n            if (q.empty()) &#123;\n                std::cout &lt;&lt; r + 1 &lt;&lt; &#39;\\n&#39;;\n                break;\n            &#125;\n        &#125;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"e.-two-tanks\">E. Two Tanks</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1809/E\" class=\"uri\">https://codeforces.com/problemset/problem/1809/E</a></p>\n<p>æœç„¶è¿˜æ˜¯ä¸ä¼šç®€å• DP <img src=\"/em/ll.gif\" /></p>\n<p>å¯ä»¥è§‚å¯Ÿåˆ°å¦‚æœæ€»æ°´é‡ç›¸åŒï¼Œä¸”æŸä¸ªæ—¶åˆ»ä¸¤ç§åˆå§‹çŠ¶æ€å½“å‰æ˜¯ç›¸åŒçŠ¶æ€ï¼Œé‚£ä¹ˆä»¥åå®ƒä»¬ä¹Ÿä¼šæ˜¯ç›¸åŒçŠ¶æ€ã€‚ä½†å…‰å‡­è¿™ä¸ªå¥½åƒè¿˜æ˜¯ä¸å¤ªèƒ½åšå‡ºæ¥çš„æ ·å­ <img src=\"/em/kt.gif\" /></p>\n<p>è¿™é‡Œå¤§æ¦‚ç®—ä¸€ä¸ªå®šå¼ï¼Œå¯¹äºç±»ä¼¼è¿™ç§ä¸¤ä¸ªå…ƒç´ æ€»å’Œä¸å˜çš„é—®é¢˜ï¼Œå¯ä»¥æŠŠä¸¤ä¸ªå…ƒç´ çš„å®¹é‡ç”»åˆ°æ•°è½´ä¸Šï¼ŒåŸç‚¹è¡¨ç¤ºåˆ†ç•Œï¼Œå½“å‰æ°´ä¸ºä¸€æ¡å®šé•¿çº¿æ®µï¼Œå€’æ°´å°±ç›¸å½“äºå·¦å³å¹³ç§»è¿™æ¡çº¿æ®µï¼š</p>\n<p><img src=\"3.png\" /></p>\n<p>éœ€è¦æ„è¯†åˆ°ï¼Œ<mark></mark></p>\n",
            "tags": [
                "DP",
                "è´ªå¿ƒ",
                "å‡æ‘Š"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250407/",
            "url": "https://xsc062.netlify.app/20250407/",
            "title": "æ‚é¢˜é€‰è°ˆï¼šç»„åˆè®¡æ•°",
            "date_published": "2025-04-07T06:57:14.000Z",
            "content_html": "<p>æ¯…æ¯…ï¼šç»Ÿè®¡ä¸æ˜¯æ•°å­¦ï¼ˆæ–­ç« å–ä¹‰ edï¼‰ã€‚<del>æ•…åˆ æ‰äº†æ•°å­¦æ ‡ç­¾ã€‚</del> å…¶å®å¹¶æ²¡æœ‰ã€‚</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"a.-äºŒåˆ†å›¾æŸ“è‰²\">A. äºŒåˆ†å›¾æŸ“è‰²</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6181/problem/1\" class=\"uri\">https://www.becoder.com.cn/contest/6181/problem/1</a></p>\n<p>é¦–å…ˆåªçœ‹çº¢è‰²ã€‚æ˜¾ç„¶ä¸€ä¸ªå·¦éƒ¨ç‚¹æœ€å¤šåªèƒ½ç”¨çº¢è¾¹è¿æ¥ä¸€ä¸ªå³éƒ¨ç‚¹ï¼Œåä¹‹åŒç†ã€‚æŠŠå·¦éƒ¨ç‚¹è§†ä¸ºä¸‹æ ‡ï¼Œå…¶ç”¨çº¢è¾¹ç›¸è¿çš„å³éƒ¨ç‚¹è§†ä¸ºå€¼ï¼Œåˆ™ä¸€ä¸ªåˆæ³•çš„æ–¹æ¡ˆä¸º <span class=\"math inline\">\\(n\\)</span> çš„åªä¿ç•™ä¸€éƒ¨åˆ†å…ƒç´ çš„æ’åˆ—ã€‚æ˜¾ç„¶ä¸º <span class=\"math inline\">\\(f(n)=\\sum\\limits_{i=0}^nC_n^i\\cdot A_n^i\\)</span>ã€‚</p>\n<p>å†åŠ ä¸Šè“è‰²ï¼Œ<span class=\"math inline\">\\(f^2(n)\\)</span> ä¼šç»™ä¸€æ¡è¾¹æ¶‚ä¸¤ç§é¢œè‰²ï¼Œæ•…é’¦å®šæœ‰ä¸¤ç§é¢œè‰²çš„è¾¹æ•°ï¼Œå®¹æ–¥å¾—åˆ° <span class=\"math inline\">\\(\\sum\\limits_{i=0}^n(-1)^i\\cdot C_n^i\\cdot A_n^i\\cdot f^2(n-i)\\)</span>ã€‚å‘ç° <span class=\"math inline\">\\(f\\)</span> çš„è®¡ç®—å¯èƒ½éœ€è¦ä¼˜åŒ–ä¸€ä¸‹ã€‚è€ƒè™‘å·²ç»çŸ¥é“ <span class=\"math inline\">\\(f(n-1)\\)</span>ï¼Œæ­¤æ—¶å¯¹äºæ–°å¢çš„ç¬¬ <span class=\"math inline\">\\(n\\)</span> å¯¹ç‚¹ï¼š</p>\n<ol type=\"1\">\n<li>ä»»æ„è¿è¾¹ï¼ˆæ˜¾ç„¶ä¸¤ä¸ªå½“ä¸­åªèƒ½æœ‰ä¸€ä¸ªç‚¹å‘å‡ºè¾¹ï¼‰ï¼Œå…±æœ‰ <span class=\"math inline\">\\(2n-1\\)</span> ç§æ–¹æ¡ˆï¼Œå› ä¸º <span class=\"math inline\">\\((n, n)\\)</span> ä¼šè¢«ç®—é‡ã€‚</li>\n<li>ä¸è¿ï¼Œå…± <span class=\"math inline\">\\(1\\)</span> ç§æ–¹æ¡ˆã€‚</li>\n<li>å‘ç° 1 ä¸­å¯èƒ½è¿åˆ°å·²ç»æœ‰è¿è¾¹çš„ç‚¹ä¸Šäº†ï¼Œæ–°è¾¹çš„ç›®çš„åœ°æœ‰ <span class=\"math inline\">\\(n-1\\)</span> ä¸ªé€‰é¡¹ï¼Œç›®çš„åœ°åŸæœ¬è¿æ¥çš„ç‚¹ä¹Ÿæœ‰ <span class=\"math inline\">\\(n-1\\)</span> ä¸ªé€‰é¡¹ï¼Œå»æ‰ä¸¤è¾¹å…± <span class=\"math inline\">\\(4\\)</span> ä¸ªç‚¹ï¼Œéæ³•çš„å³ä¸º <span class=\"math inline\">\\((n-1)^2\\cdot f(n-2)\\)</span>ã€‚</li>\n</ol>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 1e9 + 7;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;long long&gt; f(n + 1), fac(n + 1), inv(n + 1);\n    f[0] = 1ll, f[1] = 2ll;\n    fac[0] = 1ll, fac[1] = 1ll, inv[0] = 1ll;\n    for (int i = 2; i &lt;= n; ++i) &#123;\n        fac[i] = fac[i - 1] * i % mod;\n        f[i] = (f[i - 1] * 2 * i % mod + mod - f[i - 2] * (i - 1) % mod * (i - 1) % mod) % mod;\n    &#125;\n    auto qkp = [](long long x, int y) &#123;\n        auto res = 1ll;\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    inv[n] = qkp(fac[n], mod - 2);\n    for (int i = n - 1; i; --i)\n        inv[i] = inv[i + 1] * (i + 1) % mod;\n    auto C = [&amp;](int n, int m) &#123;\n        return fac[n] * inv[n - m] % mod * inv[m] % mod;\n    &#125;;\n    auto A = [&amp;](int n, int m) &#123;\n        return fac[n] * inv[n - m] % mod;\n    &#125;;\n    long long res = 0ll;\n    for (int i = 0, k = 1; i &lt;= n; ++i, k = mod - k)\n        (res += k * C(n, i) % mod * A(n, i) % mod * f[n - i] % mod * f[n - i]) %= mod;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b.-ä¸ƒé€‰äº”\">B. ä¸ƒé€‰äº”</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6181/problem/2\" class=\"uri\">https://www.becoder.com.cn/contest/6181/problem/2</a></p>\n<p>é¦–å…ˆ <span class=\"math inline\">\\(p\\)</span> å›ºå®šï¼Œé’¦å®šæœ‰ <span class=\"math inline\">\\(x\\)</span> ä¸ªæ•°ç›¸ç­‰ï¼Œæœ‰ <span class=\"math inline\">\\(C_k^x\\)</span> ä¸ªæ–¹æ¡ˆï¼Œå‰©ä¸‹çš„å°±æ˜¯ä» <span class=\"math inline\">\\(n-x\\)</span> ä¸ªå…ƒç´ é‡Œé€‰å‡º <span class=\"math inline\">\\(k-x\\)</span> ä¸ªæ¥é”™æ’ï¼Œè€ƒè™‘é’¦å®šç›¸åŒçš„ä¸ªæ•°æ¥å®¹æ–¥ï¼š</p>\n<p><span class=\"math display\">\\[\n\\sum_{i=0}^{k-x}(-1)^i\\cdot C_{k-x}^i\\cdot A_{n-x-i}^{k-x-i}\n\\]</span></p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 1e9 + 7;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k, x;\n    std::cin &gt;&gt; n &gt;&gt; k &gt;&gt; x;\n    std::vector&lt;long long&gt; fac(n + 1), inv(n + 1);\n    fac[0] = 1ll, fac[1] = 1ll, inv[0] = 1ll;\n    for (int i = 2; i &lt;= n; ++i)\n        fac[i] = fac[i - 1] * i % mod;\n    auto qkp = [](long long x, int y) &#123;\n        auto res = 1ll;\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    inv[n] = qkp(fac[n], mod - 2);\n    for (int i = n - 1; i; --i)\n        inv[i] = inv[i + 1] * (i + 1) % mod;\n    auto C = [&amp;](int n, int m) &#123;\n        return fac[n] * inv[n - m] % mod * inv[m] % mod;\n    &#125;;\n    auto A = [&amp;](int n, int m) &#123;\n        return fac[n] * inv[n - m] % mod;\n    &#125;;\n    long long res = C(k, x), sum = 0ll;\n    for (int i = 0, p = 1; i &lt;= k - x; ++i, p = mod - p)\n        (sum += p * C(k - x, i) % mod * A(n - x - i, k - x - i) % mod) %= mod;\n    std::cout &lt;&lt; res * sum % mod &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"d.-ç¡¬å¸è´­ç‰©\">D. ç¡¬å¸è´­ç‰©</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6181/problem/4\" class=\"uri\">https://www.becoder.com.cn/contest/6181/problem/4</a></p>\n<p>æ¯æ¬¡å¤šé‡èƒŒåŒ…ä¼šè¶…æ—¶ï¼Œè€ƒè™‘ç”¨é’¦å®šæ¯ç§ç¡¬å¸æ˜¯å¦è¶…é¢æ¥å®¹æ–¥ã€‚ä»¤ <span class=\"math inline\">\\(f_s\\)</span> è¡¨ç¤ºå‡‘å‡º <span class=\"math inline\">\\(s\\)</span> çš„æ–¹æ¡ˆæ•°ï¼ˆå®Œå…¨èƒŒåŒ…ï¼‰ï¼Œé‚£ä¹ˆ <span class=\"math inline\">\\(f_{s-c_1\\times (d_1 + 1)}\\)</span> å°±è¡¨ç¤ºé’¦å®šç¬¬ 1 ç§ç¡¬å¸è¶…é¢æ—¶å‡‘å‡º <span class=\"math inline\">\\(s\\)</span> çš„æ–¹æ¡ˆæ•°ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int c[4], T, m = 1e5;\n    std::vector&lt;long long&gt; f(m + 1);\n    f[0] = 1;\n    for (int i = 0; i &lt; 4; ++i) &#123;\n        std::cin &gt;&gt; c[i];\n        for (int j = c[i]; j &lt;= m; ++j)\n            f[j] += f[j - c[i]];\n    &#125;\n    std::cin &gt;&gt; T;\n    for (int d[4], m; T--; ) &#123;\n        for (int i = 0; i &lt; 4; ++i)\n            std::cin &gt;&gt; d[i];\n        std::cin &gt;&gt; m;\n        long long res = 0ll;\n        for (int i = 0; i &lt; (1 &lt;&lt; 4); ++i) &#123;\n            int s = m;\n            for (int j = 0; j &lt; 4; ++j)\n                if ((i &gt;&gt; j) &amp; 1)\n                    s -= (d[j] + 1) * c[j];\n            if (s &gt;= 0) &#123;\n                int k = (__builtin_popcount(i) &amp; 1) ? -1 : 1;\n                res += k * f[s];\n            &#125;\n        &#125;\n        std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"e.-distinct-multiples\">E. Distinct Multiples</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6181/problem/5\" class=\"uri\">https://www.becoder.com.cn/contest/6181/problem/5</a></p>\n<p>æ¨å¼å­é¢˜ã€‚é¢˜æ„è½¬åŒ–ä¸ºï¼Œç»™å®š <span class=\"math inline\">\\(n\\)</span> ä¸ªä½ç½®å¯é€‰çš„å€¼é›†åˆï¼Œè¦æ±‚ä»»æ„ä¸¤ä¸ªä½ç½®å€¼ä¸ç­‰ï¼Œé—®æ–¹æ¡ˆæ•°ã€‚</p>\n<p>å¦‚æœæŠŠä¸¤ä¸ªä½ç½®å–ç­‰è§†ä½œåœ¨å›¢ä¸Šé€‰ä¸­è¾¹ï¼Œé‚£ä¹ˆæœ‰æœ´ç´ åšæ³•é’¦å®šé€‰è¾¹çš„é›†åˆ <span class=\"math inline\">\\(S\\)</span> ç„¶åå®¹æ–¥ï¼Œè€ƒè™‘å®ƒä»¬æ„æˆçš„è¿é€šå— <span class=\"math inline\">\\(\\{s\\} \\subseteq S\\)</span>ï¼Œæœ‰ <span class=\"math inline\">\\(res=\\sum\\limits_{S\\subseteq V}(-1)^{|S|}\\cdot \\prod\\limits_{s_i} \\left\\lfloor \\frac m{\\operatorname{lcm} s_i} \\right\\rfloor\\)</span>ã€‚</p>\n<p>æœ‰ä¸ªå¾ˆç¥å¥‡çš„æ“ä½œæ˜¯æŠŠ <span class=\"math inline\">\\(S\\)</span> ä¸¢æ‰ï¼Œç›´æ¥æšä¸¾ <span class=\"math inline\">\\(\\{s\\}\\)</span> å°è¯•å­é›† DPã€‚æœ‰ï¼š<span class=\"math inline\">\\(res=\\sum\\limits_{\\{s\\}}\\prod\\limits_s f(s)\\cdot\\left\\lfloor \\frac m{\\operatorname{lcm} s} \\right\\rfloor\\)</span>ã€‚å…¶ä¸­ <span class=\"math inline\">\\(f(s)\\)</span> è¡¨ç¤ºé€‰å–ä¸€ä¸ª <span class=\"math inline\">\\(s\\)</span> çš„å¯¼å‡ºå­å›¾çš„å®¹æ–¥ç³»æ•°ä¹‹å’Œï¼Œå…¶ä¸­æ¬¡æ•°ä¸ºå¯¼å‡ºå­å›¾ä¸­è¾¹æ•°ã€‚</p>\n<p>æ€ä¹ˆæŠŠ <span class=\"math inline\">\\(f\\)</span> ç®—å‡ºæ¥å‘¢ï¼Ÿå®¹æ˜“å‘ç°å…¶å€¼åªä¸ <span class=\"math inline\">\\(|s|\\)</span> æœ‰å…³ï¼Œè€ƒè™‘é’¦å®šä¸ <span class=\"math inline\">\\(1\\)</span> è¿é€šçš„ç‚¹æ•°å®¹æ–¥ï¼Œåˆ™æœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\nf(n)=\\sum\\limits_{i=0}^{n - 1} (-1)^i \\times C_{n-1}^{i-1} \\times f(i) \\cdot \\sum_{j=0}^{m\\gets i\\times (i-1)\\div 2} (-1)^j\\cdot C_m^j\n\\]</span></p>\n<p>æˆ‘ä»¬çŸ¥é“ï¼ŒäºŒé¡¹å¼å®šç†å– <span class=\"math inline\">\\(a=1, b = -1\\)</span> æœ‰ <span class=\"math inline\">\\(0^m=[m=0]=\\sum_{j=0}^m(-1)^j\\cdot C_m^j\\)</span>ï¼Œä»£å…¥å¾—ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\nf(n)&amp;=\\sum\\limits_{i=0}^{n - 1} (-1)^i \\times C_{n-1}^{n-i-1} \\times f(n-i)\\cdot [m=0\\iff i=1]\\\\\n&amp;=(1 - n)\\cdot f(n-1)\n\\end{aligned}\n\\]</span></p>\n<p>ç„¶åå°±èƒ½çº¿æ€§æ±‚å‡ºã€‚å†ç”¨ä¸€ä¸ªå­é›† DPï¼Œä¸ºäº†ä¿è¯é¡ºåºæšä¸¾æœ€å°çš„æœªè¢«ç¡®å®šçš„ç‚¹æ‰€åœ¨è¿é€šå—è¿›è¡Œè½¬ç§»ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, l;\n    long long m;\n    std::cin &gt;&gt; n &gt;&gt; m, l = 1 &lt;&lt; n;\n    std::vector&lt;long long&gt; d(n), f(n + 1), dp(l), g(l);\n    f[1] = 1ll;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; d[i - 1];\n        if (i &gt;= 2)\n            f[i] = (1 + mod - i) * f[i - 1] % mod;\n        // printf(&quot;f[%d] = %lld\\n&quot;, i, f[i]);\n    &#125;\n    for (int i = 0; i &lt; l; ++i) &#123;\n        long long now = 1ll;\n        for (int j = 0; j &lt; n; ++j)\n            if ((i &gt;&gt; j) &amp; 1) &#123;\n                if (now / std::__gcd(now, d[j]) &gt; m / d[j])\n                    goto nosol;\n                now = now / std::__gcd(now, d[j]) * d[j];\n            &#125;\n        g[i] = (m / now) % mod;\n        // printf(&quot;lcm = %lld, g[%d] = %lld\\n&quot;, now, i, g[i]);\n    nosol: ;\n    &#125;\n    dp[0] = 1ll;\n    auto lowbit = [](int x) &#123;\n        return x &amp; -x;\n    &#125;;\n    for (int i = 1; i &lt; l; ++i) &#123;\n        int to = std::__lg(lowbit(i));\n        for (int j = i; j; j = (j - 1) &amp; i)\n            if ((j &gt;&gt; to) &amp; 1)\n                (dp[i] += dp[i ^ j] * f[__builtin_popcount(j)] % mod * g[j] % mod) %= mod;\n    &#125;\n    std::cout &lt;&lt; dp[l - 1] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"f.-permutation\">F. Permutation</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6181/problem/6\" class=\"uri\">https://www.becoder.com.cn/contest/6181/problem/6</a></p>\n<p>å¦‚æœå…¨æ˜¯ <code>&lt;</code>ï¼Œæ–¹æ¡ˆæ•°ä¸º <span class=\"math inline\">\\(1\\)</span>ã€‚</p>\n<p>ç°åœ¨æŠŠå…¶ä¸­ä¸€äº› <code>&lt;</code> å˜æˆ <code>?</code>ï¼Œæ¯”å¦‚ <code>&lt;&lt;??&lt;?&lt;&lt;&lt;&lt;</code> çš„æ–¹æ¡ˆæ•°ï¼Œ<del>å¤ªå¥½äº†æ˜¯å¤šé‡é›†æ’åˆ—ï¼Œæˆ‘ä»¬æ²¡æ•‘äº†</del> æ˜¾ç„¶è¢« <code>&lt;</code> è¿æ¥èµ·æ¥çš„ä¸€æ®µå…ƒç´ åªæœ‰ä¸€ç§æ’åˆ—æ–¹å¼ï¼Œæ‰€ä»¥å¯ä»¥è§†ä¸ºå¤šé‡é›†æ’åˆ—ï¼Œæ–¹æ¡ˆæ•°ä¸º <span class=\"math inline\">\\(\\dfrac {11!}{3!\\times 2!\\times 5!}\\)</span>ã€‚</p>\n<p>ä¼¼ä¹åªéœ€è¦æšä¸¾æŠŠ <code>&gt;</code> å˜æˆ <code>&lt;</code> æˆ– <code>=</code> çš„ <span class=\"math inline\">\\(2^k\\)</span> ç§æƒ…å†µå†è®¡ç®—å°±å¯ä»¥äº†ï¼Œå¯æƒœ <span class=\"math inline\">\\(k\\)</span> æœ‰ç‚¹å¤§ã€‚ä½†æˆ‘ä»¬å‘ç°å®ƒåœ¨ä¸€å®šç¨‹åº¦ä¸Šæ˜¯æ²¡æœ‰åæ•ˆæ€§çš„ï¼Œæ¯”å¦‚ <code>&lt;&lt;??&lt;</code> å’Œ <code>&lt;&lt;?&lt;&lt;</code>ï¼Œå‰é¢çš„ <code>&lt;&lt;</code> ä¸ä¼šå¯¹åé¢çš„å†…å®¹å¸¦æ¥å½±å“ã€‚</p>\n<p>æ•…ä»¤ <span class=\"math inline\">\\(f_i\\)</span> è¡¨ç¤ºå¯¹äºå‰ <span class=\"math inline\">\\(i\\)</span> ä¸ªå…ƒç´ çš„æ–¹æ¡ˆæ•°ï¼Œæšä¸¾æœ€åä¸€ä¸ªè¢«é’¦å®šä¸º <code>?</code> çš„ <code>&gt;</code> <span class=\"math inline\">\\(j\\)</span>ï¼ˆå³ <span class=\"math inline\">\\([j + 1, i-1]\\)</span> é—´çš„ <code>&gt;</code> éƒ½è¢«æ›¿æ¢ä¸º <code>&lt;</code>ï¼‰ï¼Œå¸¦ä¸Šå®¹æ–¥ç³»æ•°ï¼Œæœ‰ <span class=\"math inline\">\\(f_i=\\sum\\limits_{s_j=\\texttt{&#39;&gt;&#39;}}(-1)^{cnt_\\texttt{&#39;&gt;&#39;}[j + 1, i - 1]}\\times f_j\\times\\dfrac1{(i-j)!}\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 1e9 + 7;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;long long&gt; fac(n + 1), inv(n + 1);\n    fac[0] = 1ll, inv[0] = 1ll;\n    for (int i = 1; i &lt;= n; ++i)\n        fac[i] = fac[i - 1] * i % mod;\n    auto qkp = [](long long x, int y) &#123;\n        auto res = 1ll;\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    inv[n] = qkp(fac[n], mod - 2);\n    for (int i = n - 1; i; --i)\n        inv[i] = inv[i + 1] * (i + 1) % mod;\n    std::vector&lt;char&gt; s(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; s[i];\n    std::vector&lt;long long&gt; f(n + 1);\n    s[0] = &#39;&gt;&#39;, f[0] = 1ll;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        int cnt = 0;\n        for (int j = i - 1; ~j; --j)\n            if (s[j] == &#39;&gt;&#39;) &#123;\n                long long k = (cnt &amp; 1) ? mod - 1 : 1;\n                (k *= f[j]) %= mod, (k *= inv[i - j]) %= mod;\n                (f[i] += k) %= mod;\n                ++cnt;\n            &#125;\n        // printf(&quot;f[%d] = %lld\\n&quot;, i, f[i]);\n    &#125;\n    std::cout &lt;&lt; f[n] * fac[n] % mod &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<p><em>å¿³éƒé‚‘ä½™ä¾˜å‚ºå…®ï¼Œä½™ç‹¬ç©·å›°ä¹æ­¤æ—¶ä¹Ÿã€‚</em></p>\n<hr />\n<h2 id=\"h.-k-perm-counting\">H. ~K Perm Counting</h2>\n<p><a href=\"https://www.becoder.com.cn/contest/6181/problem/8\" class=\"uri\">https://www.becoder.com.cn/contest/6181/problem/8</a></p>\n<p>è€ƒè™‘é’¦å®šä»¤å‡ ä¸ªå…ƒç´ ä¸æ»¡è¶³æ¡ä»¶è¿›è¡Œå®¹æ–¥ï¼Œå³ç­”æ¡ˆä¸º <span class=\"math inline\">\\(\\sum\\limits_{i=0}^n (-1)^i\\cdot f(i)\\)</span>ã€‚ä½†æˆ‘ä»¬å‘ç° <span class=\"math inline\">\\([n-k,n+k]\\)</span> éƒ½æœ‰ä¸¤ä¸ªä¸èƒ½é€‰çš„å€¼ï¼Œç›´æ¥å– <span class=\"math inline\">\\(f(i)=\\prod 2\\)</span> è‚¯å®šä¼šé€‰åˆ°ç›¸åŒå€¼ï¼Œä¸€ä¸ªè‡ªç„¶ï¼ˆï¼Ÿï¼‰çš„æƒ³æ³•æ˜¯å†å®¹æ–¥ä¸€éï¼Œå¯æƒœæ‰‹ç©ä¸€ä¸‹å‘ç°ä¼¼ä¹å®¹ä¸åŠ¨ã€‚è€ƒè™‘æŠŠç©æ„å„¿æ‹åœ¨æ£‹ç›˜ä¸Šï¼š</p>\n<figure>\n<img src=\"1.png\" alt=\"ä»¥ k=2 ä¸ºä¾‹\" /><figcaption>ä»¥ <span class=\"math inline\">\\(k=2\\)</span> ä¸ºä¾‹</figcaption>\n</figure>\n<p>å…¶ä¸­ <span class=\"math inline\">\\(\\times\\)</span> æ˜¯éæ³•æ ¼å­ï¼Œè¾¹æ˜¯éæ³•æ ¼å­é—´çš„ä¸åŒé€‰å…³ç³»ï¼ŒåŒé¢œè‰²çš„è¾¹éš¶å±åŒä¸€æ¡é“¾ã€‚å®¹æ˜“å‘ç°å¦‚æœæ£‹ç›˜ç»§ç»­æ‰©å¤§ï¼Œè¿™äº›é“¾è¿˜ä¼šç»§ç»­å»¶é•¿ã€‚</p>\n<p>ä¼šå‘ç°è¿™äº›é“¾äº’ä¸å¹²æ‰°ï¼Œå°±æ˜¯è¯´æˆ‘é€‰äº†è¿™æ¡é“¾ä¸Šçš„æŸä¸ªç‚¹å’Œé“¾å¤–çš„ç‚¹æ²¡æœ‰ä»»ä½•å…³ç³»ï¼ˆæ˜¾ç„¶ï¼‰ã€‚æŠŠè¿™äº›é“¾é¦–å°¾ç›¸è¿æ‹¼èµ·æ¥ï¼Œè¦åšçš„å°±æ˜¯æ‹¼æ¥å¤„å¯ä»¥é€‰ç›¸é‚»ï¼Œå…¶ä½™ä½ç½®ä¸èƒ½é€‰ç›¸é‚»ï¼Œé€‰å‡ºæ¥ <span class=\"math inline\">\\(i\\)</span> ä¸ªçš„æ–¹æ¡ˆæ•°ã€‚æå‰é¢„å¤„ç†å‡ºæ¥æ•´ä¸ªåºåˆ—ï¼Œä»¤ <span class=\"math inline\">\\(tag_j\\)</span> è¡¨ç¤º <span class=\"math inline\">\\(j\\)</span> æ˜¯å¦èƒ½å’Œ <span class=\"math inline\">\\(j-1\\)</span> åŒé€‰ï¼Œè®¾ <span class=\"math inline\">\\(dp_{j,i,0/1}\\)</span> è¡¨ç¤º DP åˆ°äº† <span class=\"math inline\">\\(j\\)</span>ï¼Œå·²ç»é€‰äº† <span class=\"math inline\">\\(i\\)</span> ä¸ªæ•°ï¼Œç¬¬ <span class=\"math inline\">\\(j\\)</span> ä¸ªå…ƒç´ ï¼ˆä¸ï¼‰é€‰çš„æ–¹æ¡ˆæ•°ï¼Œé‚£ä¹ˆæœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\ndp_{j,i,0} = dp_{j - 1, i, 0} + dp_{j-1, i, 1}\\\\\ndp_{j,i,1} = \\begin{cases}\ndp_{j-1, i - 1, 1} + dp_{j-1,i - 1,0}&amp;tag_j=1\n\\\\\ndp_{j-1,i,0}&amp;\\text{otherwise}\n\\end{cases}\n\\]</span></p>\n<p>å¤§åŠ› DP å³å¯ã€‚<span class=\"math inline\">\\(f(i)\\)</span> å³ä¸º <span class=\"math inline\">\\((n-i)!\\times (dp_{m, i, 0} + dp_{m, i, 1})\\)</span>ï¼Œå…¶ä¸­ <span class=\"math inline\">\\(m\\)</span> ä¸ºæ€»é“¾é•¿ã€‚</p>\n<details>\n<p>æ³¨æ„ä¸æ»šåŠ¨å¯èƒ½ä¼š MLE <img src=\"/em/kt.gif\" /></p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 924844033;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    std::vector&lt;int&gt; tag(1);\n    std::vector&lt;long long&gt; fac(n + 1);\n    std::vector&lt;std::vector&lt;int&gt; &gt; vis(n + 1, std::vector&lt;int&gt; (n + 1));\n    auto calc = [&amp;](int i, int j, int s) &#123;\n        tag.push_back(1);\n        for (; ; s ^= 1) &#123;\n            // printf(&quot;(%d, %d) &quot;, i, j);\n            vis[i][j] = 1;\n            if (!s) &#123;\n                i = j + k;\n                if (i &lt;= n)\n                    tag.push_back(0);\n                else\n                    break;\n            &#125;\n            else &#123;\n                j = i + k;\n                if (j &lt;= n)\n                    tag.push_back(0);\n                else\n                    break;\n            &#125;\n        &#125;\n        // puts(&quot;&quot;);\n        return;\n    &#125;;\n    fac[0] = 1ll;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        fac[i] = fac[i - 1] * i % mod;\n        int j = i - k;\n        if (j &gt;= 1 &amp;&amp; !vis[i][j])\n            calc(i, j, 1);\n        j = i + k;\n        if (j &lt;= n &amp;&amp; !vis[i][j])\n            calc(i, j, 0);\n    &#125;\n    int m = (int)tag.size() - 1;\n    // printf(&quot;m = %d\\n&quot;, m);\n    std::vector&lt;std::vector&lt;std::vector&lt;long long&gt; &gt; &gt; dp(2, std::vector&lt;std::vector&lt;long long&gt; &gt; (n + 1, std::vector&lt;long long&gt; (2)));\n    dp[0][0][0] = 1ll;\n    for (int j = 1, now = 1; j &lt;= m; ++j, now ^= 1) &#123;\n        for (int i = 0; i &lt;= n &amp;&amp; i &lt;= j; ++i) &#123;\n            dp[now][i][0] = dp[!now][i][0];\n            dp[now][i][1] = 0ll;\n            if (i) &#123;\n                (dp[now][i][0] += dp[!now][i][1]) %= mod;\n                dp[now][i][1] = dp[!now][i - 1][0];\n                if (tag[j]) &#123;\n                    (dp[now][i][1] += dp[!now][i - 1][1]) %= mod;\n                    // assert(0);\n                &#125;\n            &#125;\n            // printf(&quot;dp[%d][%d] = %lld / %lld\\n&quot;, j, i, dp[j][i][0], dp[j][i][1]);\n        &#125;\n    &#125;\n    long long res = 0ll;\n    for (int i = 0, p = 1; i &lt;= n; ++i, p = mod - p)\n        (res += p * fac[n - i] % mod * (dp[m &amp; 1][i][0] + dp[m &amp; 1][i][1]) % mod) %= mod;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"a---positions-in-permutations\">A - Positions in Permutations</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/285/E\" class=\"uri\">https://codeforces.com/problemset/problem/285/E</a></p>\n<p><del>ï¼ˆçœ‹å‘ä¸Šä¸€é¢˜ï¼‰è¿™ç…§ç‰‡æ˜¯ä½ å—ï¼Ÿ</del></p>\n<p>åœ¨ä¸Šä¸€é¢˜çš„åŸºç¡€ä¸Šï¼Œä»¤ <span class=\"math inline\">\\(k=1\\)</span>ã€‚ä½†æ˜¯æœ‰ä¸ªå°å°çš„é—®é¢˜â€”â€”æ‰€æ±‚çš„ã€Œè‡³å°‘ã€ä¸ä¸º <span class=\"math inline\">\\(0\\)</span>ï¼Œæ— æ³•ç®€å•å®¹æ–¥ã€‚å…·ä½“åœ°ï¼Œå¦‚æœä¸€ä¸ªæ’åˆ—ä¸€å…±æœ‰ <span class=\"math inline\">\\(p\\)</span> ä¸ªéæ³•æ’åˆ—ï¼Œé‚£ä¹ˆå®ƒä¼šè¢« <span class=\"math inline\">\\(f(i)\\)</span> ç»Ÿè®¡ <span class=\"math inline\">\\(C_p^i\\)</span> æ¬¡ã€‚ä»¤ <span class=\"math inline\">\\(g(p)\\)</span> è¡¨ç¤ºéæ³•æ ¼å­æ•°æ°å¥½ä¸º <span class=\"math inline\">\\(p\\)</span> çš„æ’åˆ—çš„çœŸå®æ•°é‡ï¼Œåˆ™ <span class=\"math inline\">\\(f(i)=\\sum\\limits_{j=i}^n C_j^i\\cdot g(j)\\)</span>ï¼ŒäºŒé¡¹å¼åæ¼”å³å¯å¾—åˆ°çœŸå®å€¼ <span class=\"math inline\">\\(g(m)=\\sum\\limits_{j=m}^n (-1)^{j-m}\\cdot C_j^m\\cdot f(j)\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 1e9 + 7;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    std::vector&lt;int&gt; tag(1);\n    std::vector&lt;long long&gt; fac(n + 1), inv(n + 1);\n    std::vector&lt;std::vector&lt;int&gt; &gt; vis(n + 1, std::vector&lt;int&gt; (n + 1));\n    auto calc = [&amp;](int i, int j, int s) &#123;\n        tag.push_back(1);\n        for (; i &lt;= n &amp;&amp; j &lt;= n; s ^= 1) &#123;\n            vis[i][j] = 1;\n            if (!s) &#123;\n                i = j + 1;\n                if (i &lt;= n)\n                    tag.push_back(0);\n            &#125;\n            else &#123;\n                j = i + 1;\n                if (j &lt;= n)\n                    tag.push_back(0);\n            &#125;\n        &#125;\n        return;\n    &#125;;\n    auto qkp = [&amp;](long long x, int y) &#123;\n        auto res = 1ll;\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    fac[0] = 1ll, inv[0] = 1ll;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        fac[i] = fac[i - 1] * i % mod;\n        int j = i - 1;\n        if (j &gt;= 1 &amp;&amp; !vis[i][j])\n            calc(i, j, 1);\n        j = i + 1;\n        if (j &lt;= n &amp;&amp; !vis[i][j])\n            calc(i, j, 0);\n    &#125;\n    inv[n] = qkp(fac[n], mod - 2);\n    for (int i = n - 1; i; --i)\n        inv[i] = inv[i + 1] * (i + 1) % mod;\n    int m = (int)tag.size() - 1;\n    std::vector&lt;std::vector&lt;std::vector&lt;long long&gt; &gt; &gt; dp(2, std::vector&lt;std::vector&lt;long long&gt; &gt; (n + 1, std::vector&lt;long long&gt; (2)));\n    dp[0][0][0] = 1ll;\n    for (int j = 1, now = 1; j &lt;= m; ++j, now ^= 1) &#123;\n        for (int i = 0; i &lt;= n &amp;&amp; i &lt;= j; ++i) &#123;\n            dp[now][i][0] = dp[!now][i][0];\n            dp[now][i][1] = 0ll;\n            if (i) &#123;\n                (dp[now][i][0] += dp[!now][i][1]) %= mod;\n                dp[now][i][1] = dp[!now][i - 1][0];\n                if (tag[j])\n                    (dp[now][i][1] += dp[!now][i - 1][1]) %= mod;\n            &#125;\n        &#125;\n    &#125;\n    auto C = [&amp;](int n, int m) &#123;\n        return fac[n] * inv[n - m] % mod * inv[m] % mod;\n    &#125;;\n    long long res = 0ll;\n    for (int i = k, p = 1; i &lt;= n; ++i, p = mod - p) &#123;\n        // printf(&quot;%d: %lld\\n&quot;, i, C(i, k) * fac[n - i] % mod * (dp[m &amp; 1][i][0] + dp[m &amp; 1][i][1]) % mod);\n        (res += p * C(i, k) % mod * fac[n - i] % mod * (dp[m &amp; 1][i][0] + dp[m &amp; 1][i][1]) % mod) %= mod;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"d---all-pairs-similarity-p\">D - All Pairs Similarity P</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P11458\" class=\"uri\">https://www.luogu.com.cn/problem/P11458</a></p>\n<p>çœæµï¼šæ±‚ <span class=\"math inline\">\\(\\forall\\,i,f_i=\\sum\\limits_{j=1}^n \\dfrac{|a_i\\cap a_j|}{|a_i\\cup a_j|}\\)</span>ã€‚</p>\n<p>é¦–å…ˆåˆ†ç¦»å¸¸æ•°ï¼Œæœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\nf_i&amp;=\\sum\\limits_{j=1}^n \\dfrac{|a_i\\cap a_j|}{|a_i\\cup a_j|}\\\\\n&amp;=\\sum_{j=1}^n\\dfrac {|a_i|+|a_j|-|a_i\\cup a_j|}{|a_i\\cup a_j|}\\\\\n&amp;=\\sum_{j=1}^n \\dfrac {|a_i|+|a_j|}{|a_i\\cup a_j|}-1\n\\end{aligned}\n\\]</span></p>\n<p>å°½é‡æŠŠåˆ†å­å˜å¾—æ›´ç®€ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\nf_i&amp;=\\sum_{j=1}^n \\dfrac {|a_i|+|a_j|}{|a_i\\cup a_j|}-1\\\\\n&amp;=|a_i|\\cdot\\left(\\sum_{j=1}^n\\dfrac 1{|a_i\\cup a_j|}\\right)-n+\\sum_{j=1}^n \\dfrac {|a_j|}{|a_i\\cup a_j|}\n\\end{aligned}\n\\]</span></p>\n<p>é—®é¢˜è½¬åŒ–ä¸ºæ±‚è§£ <span class=\"math inline\">\\(\\sum\\limits_{j=1}^n\\dfrac 1{|a_i\\cup a_j|}\\)</span> å’Œ <span class=\"math inline\">\\(\\sum\\limits_{j=1}^n\\dfrac {|a_j|}{|a_i\\cup a_j|}\\)</span>ï¼Œä»¥ <span class=\"math inline\">\\(*=\\sum\\limits_{j=1}^n\\dfrac 1{|a_i\\cup a_j|}\\)</span> ä¸ºä¾‹ã€‚ä»¤ <span class=\"math inline\">\\(b_i\\)</span> ä¸º <span class=\"math inline\">\\(a_i\\)</span> è¡¥é›†ï¼Œåˆ™ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\n*&amp;=\\sum\\limits_{j=1}^n\\dfrac 1{|a_i\\cup a_j|}\\\\\n&amp;=\\sum_{j=1}^n\\dfrac 1{k-|b_i\\cap b_j|}\n\\end{aligned}\n\\]</span></p>\n<p>ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªè½¬æ¢å‘¢ï¼Ÿç›¸æ¯”èµ·å¹¶é›†è¿ç®—ï¼Œäº¤é›†è¿ç®—æœ‰ç€ä¼˜ç§€çš„æ€§è´¨ï¼š<span class=\"math inline\">\\(s\\subseteq(b_i\\cap b_j)\\iff s\\subseteq b_i\\land s\\subseteq b_j\\)</span>ï¼Œ<del>ç›´æ¥å–æˆ–å½“ç„¶ä¹Ÿæœ‰ç›¸ä¼¼çš„æ€§è´¨ï¼Œä½†æ˜¯å¤ªçƒ§è„‘äº†</del>ã€‚</p>\n<p>åŸºäºè¿™ä¸ªæ€§è´¨ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæƒ³æ³•ï¼šå¯¹äºæ‰€æœ‰ <span class=\"math inline\">\\(j\\)</span>ï¼Œåœ¨ <span class=\"math inline\">\\(\\forall \\, s\\subseteq b_j\\)</span> å¤„æ”¾ç½® <span class=\"math inline\">\\(\\dfrac 1{k-|s|}\\)</span> çš„è´¡çŒ®ï¼›å¯¹äº <span class=\"math inline\">\\(i\\)</span>ï¼Œå°† <span class=\"math inline\">\\(\\forall \\, s\\subseteq b_i\\)</span> å¤„çš„è´¡çŒ®æ±‚å’Œã€‚ä½†æ˜¯è¿™æ ·è‚¯å®šä¼šæ‹¿åˆ°å¾ˆå¤šæˆ‘ä»¬ä¸æƒ³è¦çš„è´¡çŒ®ï¼Œä¾‹å¦‚ <span class=\"math inline\">\\(\\forall \\, s\\subset (b_i\\cap b_j)\\)</span>ã€‚</p>\n<p>è€ƒè™‘ç²¾ç»†å¸ƒç½®è´¡çŒ®â€”â€”æ„é€  <span class=\"math inline\">\\(g(|s|)\\)</span> æ»¡è¶³ <span class=\"math inline\">\\(\\sum\\limits_{j=1}^n\\sum\\limits_{s\\subseteq b_j}g(|s|)=*\\)</span>ã€‚</p>\n<p>è¿™é‡Œå¯ä»¥äºŒé¡¹å¼åæ¼”å¾—åˆ° <span class=\"math inline\">\\(g\\)</span>ï¼Œå…·ä½“åœ°ï¼Œä»¤ <span class=\"math inline\">\\(F(|S|)=\\dfrac 1{k-|S|}=\\sum\\limits_{s\\subseteq S}g(|s|)=\\sum\\limits_{j=0}^{|S|} C_{|S|}^j g(j)\\)</span>ï¼Œåˆ™ <span class=\"math inline\">\\(g(i)=\\sum\\limits_{j=0}^iC_i^j\\cdot \\dfrac {(-1)^{i-j}}{k-j}\\)</span>ã€‚</p>\n<p>å†ä»¤ <span class=\"math inline\">\\(h(s)=\\sum\\limits_{b_j\\supseteq s}g(|s|)=g(|s|)\\cdot \\sum\\limits_{b_j\\supseteq s}1\\)</span>ï¼Œé‚£ä¹ˆ <span class=\"math inline\">\\(h\\)</span> å°±æ˜¯é«˜ç»´åç¼€å’Œã€‚æˆ‘ä»¬æ­£åœ¨åšçš„äº‹æƒ…å°±æ˜¯æ±‚è§£ <span class=\"math inline\">\\(*=\\sum\\limits_{s\\subseteq b_i}h(s)\\)</span>ï¼Œè¿™å°±åˆæ˜¯ä¸€ä¸ªé«˜ç»´å‰ç¼€å’Œäº†ã€‚</p>\n<p>å¯¹äº <span class=\"math inline\">\\(\\sum\\limits_{j=1}^n\\dfrac {|a_j|}{|a_i\\cup a_j|}\\)</span> å‘¢ï¼Œä»¤ <span class=\"math inline\">\\(h(s)=\\sum\\limits_{b_j\\supseteq s}g(|s|)\\cdot {\\color{red}{|a_j|}} = g(|s|) \\cdot \\sum\\limits_{b_j\\supseteq s} \\color{red}{k - |b_j|}\\)</span>ï¼Œæ”¹å˜é«˜ç»´åç¼€å’Œæ±‚å’Œå¯¹è±¡å³å¯ã€‚</p>\n<p>å¤æ‚åº¦å°±æ˜¯ <span class=\"math inline\">\\(O(n+k\\cdot 2^k)\\)</span>ï¼Œå…¶ä¸­ <span class=\"math inline\">\\(k\\cdot 2^k\\)</span> æ¥è‡ªæ•´ä½“é«˜ç»´å‰ / åç¼€å’Œï¼Œ<span class=\"math inline\">\\(n\\cdot k\\)</span> æ¥è‡ªæšä¸¾ <span class=\"math inline\">\\(i\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 1e9 + 7;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k, l;\n    std::cin &gt;&gt; n &gt;&gt; k, l = 1 &lt;&lt; k;\n    std::vector&lt;int&gt; a(n + 1), b(n + 1), cnt(l);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i], b[i] = (l - 1) ^ a[i];\n        ++cnt[b[i]];\n    &#125;\n    std::vector&lt;long long&gt; g(k + 1), fac(k + 1);\n    auto qkp = [&amp;](long long x, int y = mod - 2) &#123;\n        auto res = 1ll;\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    auto C = [&amp;](int n, int m) &#123;\n        return fac[n] * qkp(fac[n - m]) % mod * qkp(fac[m]) % mod;\n    &#125;;\n    fac[0] = 1ll;\n    for (int i = 1; i &lt;= k; ++i)\n        fac[i] = fac[i - 1] * i % mod;\n    for (int i = 0; i &lt;= k; ++i) &#123;\n        for (int j = 0, p = (i &amp; 1) ? mod - 1 : 1; j &lt;= i; ++j, p = mod - p)\n            (g[i] += C(i, j) * p % mod * qkp(k - j) % mod) %= mod;\n        // printf(&quot;g[%d] = %lld\\n&quot;, i, g[i]);\n    &#125;\n    // for (int i = 0; i &lt;= k; ++i) &#123;\n    //     long long F = 0ll;\n    //     for (int j = 0; j &lt;= i; ++j)\n    //         (F += C(i, j) * g[j] % mod) %= mod;\n    //     printf(&quot;%d: %lld / %lld\\n&quot;, i, F, qkp(k - i));\n    // &#125;\n    std::vector&lt;long long&gt; h(l);\n    std::copy(cnt.begin(), cnt.end(), h.begin());\n    for (int i = 0; i &lt; k; ++i)\n        for (int j = l - 1; ~j; --j)\n            if (!((j &gt;&gt; i) &amp; 1))\n                (h[j] += h[j ^ (1 &lt;&lt; i)]) %= mod;\n    auto f1(h);\n    for (int i = 0; i &lt; l; ++i)\n        (f1[i] *= g[__builtin_popcount(i)]) %= mod;\n    for (int i = 0; i &lt; k; ++i)\n        for (int j = 0; j &lt; l; ++j)\n            if ((j &gt;&gt; i) &amp; 1)\n                (f1[j] += f1[j ^ (1 &lt;&lt; i)]) %= mod;\n    for (int i = 0; i &lt; l; ++i)\n        h[i] = cnt[i] * (k - __builtin_popcount(i));\n    for (int i = 0; i &lt; k; ++i)\n        for (int j = l - 1; ~j; --j)\n            if (!((j &gt;&gt; i) &amp; 1))\n                (h[j] += h[j ^ (1 &lt;&lt; i)]) %= mod;\n    auto f2(h);\n    for (int i = 0; i &lt; l; ++i)\n        (f2[i] *= g[__builtin_popcount(i)]) %= mod;\n    for (int i = 0; i &lt; k; ++i)\n        for (int j = 0; j &lt; l; ++j)\n            if ((j &gt;&gt; i) &amp; 1)\n                (f2[j] += f2[j ^ (1 &lt;&lt; i)]) %= mod;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        // fprintf(stderr, &quot;%d: %d * %lld - %d + %lld\\n&quot;, i, __builtin_popcount(a[i]), f1[b[i]], n, f2[b[i]]);\n        std::cout &lt;&lt; (__builtin_popcount(a[i]) * f1[b[i]] % mod + mod - n + f2[b[i]]) % mod &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"e---prefix-xors\">E - Prefix XORs</h2>\n<p><a href=\"https://atcoder.jp/contests/arc137/tasks/arc137_d\" class=\"uri\">https://atcoder.jp/contests/arc137/tasks/arc137_d</a></p>\n<p>çœæµï¼šåš <span class=\"math inline\">\\(k\\)</span> æ¬¡å‰ç¼€å’Œï¼Œ<span class=\"math inline\">\\(k=1,2,\\cdots,m\\)</span>ï¼Œåˆ†åˆ«è¯¢é—®ï¼šä»¤ <span class=\"math inline\">\\(x_i\\gets a_i\\)</span> å¯¹ <span class=\"math inline\">\\(s_n\\)</span> çš„è´¡çŒ®æ¬¡æ•°ï¼Œåˆ™ <span class=\"math inline\">\\(\\sum a_i\\cdot (x_i\\bmod 2)\\)</span>ï¼Ÿ</p>\n<p>å¯¹äº <span class=\"math inline\">\\(a_p\\)</span>ï¼Œå®¹æ˜“å‘ç°ç¬¬ä¸€è½®å…¶å¯¹ä»»æ„ <span class=\"math inline\">\\(s_q\\)</span> æœ‰ <span class=\"math inline\">\\(1\\)</span> æ¬¡è´¡çŒ®ï¼Œæ‹‰å¼€æ¥å°±æ˜¯å¸¸æ•°åˆ—ï¼›ç¬¬äºŒè½®æœ‰ <span class=\"math inline\">\\((q-p+1)\\)</span> æ¬¡è´¡çŒ®ï¼Œæ˜¯å…¬å·®ä¸º <span class=\"math inline\">\\(1\\)</span> çš„ç­‰å·®æ•°åˆ—ï¼›ç¬¬ä¸‰è½®æ˜¯ç±»ä¸‰è§’å½¢æ•°â€”â€”è‡³æ­¤ï¼Œè‚¯å®šå’Œç»„åˆæ•°æœ‰å…³äº†ã€‚æ‰‹ç©å¯ä»¥å‘ç°ç¬¬ <span class=\"math inline\">\\(k\\)</span> è½® <span class=\"math inline\">\\(a_p\\)</span> å¯¹ <span class=\"math inline\">\\(s_n\\)</span> çš„è´¡çŒ®ä¸º <span class=\"math inline\">\\(C_{n-p+(k-2)}^{n-p}\\)</span>ï¼Œå°½é‡ä»¤å…¶ä¸­ä¸€ä¸ªä¸åŠ¨ï¼Œå¾—åˆ° <span class=\"math inline\">\\(C_{n-p+(k-2)}^{k-1}\\)</span>ã€‚</p>\n<p>ä½†æ˜¯æˆ‘ä»¬å‘ç°ç›´æ¥æšä¸¾æ¯è½®æ¯ä¸ªæ•°ä¼šèµ·é£ï¼Œè€Œä¸”æ¨¡æ•°ä¸º <span class=\"math inline\">\\(2\\)</span> ä¼¼ä¹åªèƒ½ Lucasï¼ˆå†å¸¦ä¸ª <span class=\"math inline\">\\(\\log\\)</span>ï¼‰ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p>\n<p>é‚£å°± Lucas å‘—ã€‚ç”±å…¶è§‚å¯Ÿå®¹æ˜“å‘ç° <span class=\"math inline\">\\(C_{n-p+(k-2)}^{k-2}\\bmod2=1\\)</span> å½“ä¸”ä»…å½“ <span class=\"math inline\">\\((k-2)\\subseteq (n-p+k-2)\\iff (k-2)\\subseteq \\complement_U(n-p)\\)</span>ï¼Œæ•…é—®é¢˜è½¬åŒ–ä¸ºé«˜ç»´åç¼€å’Œï¼Œ<del>å½“ç„¶ä½ ä¹Ÿå¯ä»¥åšä¸€æ¬¡ and-FWT</del>ï¼Œé‚£ä¹ˆ <span class=\"math inline\">\\(res_k=\\sum (C_{n-p+(k-2)}^{k-2}\\bmod 2)\\cdot a_p=S_{k-2}\\)</span>ï¼Œå…¶ä¸­ <span class=\"math inline\">\\(S\\)</span> ä¸ºé«˜ç»´åç¼€å’Œï¼Œåˆå€¼ä¸º <span class=\"math inline\">\\(S_{\\complement_u(n-i)}\\gets a_i\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m, l, k;\n    std::cin &gt;&gt; n &gt;&gt; m, k = std::__lg(n + m) + 1, l = 1 &lt;&lt; k;\n    std::vector&lt;int&gt; s(l);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; s[l - 1 - (n - i)];\n    for (int i = 0; i &lt; k; ++i)\n        for (int j = l - 1; ~j; --j)\n            if (!((j &gt;&gt; i) &amp; 1))\n                s[j] ^= s[j ^ (1 &lt;&lt; i)];\n    for (int i = 1; i &lt;= m; ++i)\n        std::cout &lt;&lt; s[i - 1] &lt;&lt; &#39; &#39;;\n    std::cout &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b---the-top-scorer\">B - The Top Scorer</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1096/E\" class=\"uri\">https://codeforces.com/problemset/problem/1096/E</a></p>\n<p>é‰´äºæ¯ç§æ–¹æ¡ˆç­‰æ¦‚ç‡ï¼ˆç¿»è¯‘æ²¡è¯´ï¼Œä½†åŸé¢˜é¢æœ‰æåˆ°ï¼‰ï¼Œè€ƒè™‘è®¡ç®—å°æ˜èƒ½å¤Ÿå–èƒœçš„æ–¹æ¡ˆæ•°ï¼Œå†å¯¹æ€»æ–¹æ¡ˆæ•°åšé™¤æ³•ã€‚å…ˆæšä¸¾æœ€é«˜åˆ† <span class=\"math inline\">\\(k\\ge r\\)</span>ï¼Œå†æšä¸¾åŒ…æ‹¬å°æ˜åœ¨å†…æ°æœ‰ <span class=\"math inline\">\\(c\\ge 1\\)</span> ä¸ªäºº æ‹¿åˆ° <span class=\"math inline\">\\(k\\)</span> åˆ†ã€‚ä½†å‰©ä¸‹çš„äººå‘¢ï¼Ÿæ˜¾ç„¶æ˜¯ä¸èƒ½æ’æ¿éšæœºåˆ†é…çš„ï¼Œå› ä¸ºå­˜åœ¨ <span class=\"math inline\">\\(&lt;k\\)</span> çš„é™åˆ¶ã€‚</p>\n<p>è€ƒè™‘å®¹æ–¥ï¼Œé’¦å®šå‰©ä¸‹çš„ <span class=\"math inline\">\\(p-c\\)</span> ä¸ªäººä¸­æ‹¿åˆ° <span class=\"math inline\">\\(\\ge k\\)</span> åˆ†çš„äººæ•°åå†å¯ç©ºåœ°æ’æ¿å³å¯ï¼Œåˆ™æ€»æ–¹æ¡ˆæ•°ä¸ºï¼š</p>\n<p><span class=\"math display\">\\[\n\\sum_{k=r}^s\\sum_{c=1}^p\\dfrac {C_{p - 1}^{c-1}}c\\cdot \\sum_{i=0}^{p-c}C_{p-c}^i\\cdot C_{s-k\\cdot (c+i)+(p-c-1)}^{p-c-1}\n\\]</span></p>\n<p>å…¶ä¸­åˆ†æ¯ä¸Šçš„ <span class=\"math inline\">\\(c\\)</span> æ¥æºäºç­‰æ¦‚ç‡åˆ†é…ç»™æœ€é«˜åˆ†ï¼Œè™½ç„¶ä¸æ˜¯æ•´æ•°ï¼Œä½†ä¹Ÿä»£è¡¨ç€ã€Œå°æ˜è·èƒœå¯è¡Œæ–¹æ¡ˆæ•°ã€ã€‚æœ€åå°†ç­”æ¡ˆé™¤ä¸Šæ€»æ–¹æ¡ˆæ•° <span class=\"math inline\">\\(C_{s-r+p-1}^{p-1}\\)</span> å³å¯ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int p, s, r;\n    std::cin &gt;&gt; p &gt;&gt; s &gt;&gt; r;\n    std::vector&lt;long long&gt; fac(s + p), inv(s + p);\n    fac[0] = inv[0] = 1ll;\n    for (int i = 1; i &lt; s + p; ++i) &#123;\n        fac[i] = fac[i - 1] * i % mod;\n    &#125;\n    auto qkp = [&amp;](long long x, int y) &#123;\n        auto res = 1ll;\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    inv.back() = qkp(fac.back(), mod - 2);\n    for (int i = s + p - 2; i &gt; 0; --i)\n        inv[i] = inv[i + 1] * (i + 1) % mod;\n    auto C = [&amp;](int n, int m) &#123;\n        if (n == -1 &amp;&amp; m == -1)\n            return 1ll;\n        return fac[n] * inv[n - m] % mod * inv[m] % mod;\n    &#125;;\n    auto res(0ll);\n    for (int k = r; k &lt;= s; ++k)\n        for (int c = 1; c &lt;= p; ++c)\n            if ((p - c) * (k - 1) + c * k &gt;= s) &#123;\n                auto t(0ll);\n                for (int i = 0, now = 1; i &lt;= p - c &amp;&amp; k * (c + i) &lt;= s; ++i, now = mod - now)\n                    (t += now * C(p - c, i) % mod * C(s - k * (c + i) + (p - c - 1), p - c - 1) % mod) %= mod;\n                (res += C(p - 1, c - 1) * qkp(c, mod - 2) % mod * t % mod) %= mod;\n            &#125;\n    std::cout &lt;&lt; res * qkp(C(s - r + p - 1, p - 1), mod - 2) % mod &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"c---sky-full-of-stars\">C - Sky Full of Stars</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/997/C\" class=\"uri\">https://codeforces.com/problemset/problem/997/C</a></p>\n<p>å‘ç°ç”¨ <span class=\"math inline\">\\(3^{n\\times n}\\)</span> å‡å»ä»»æ„ä¸€è¡Œä¸€åˆ—ä¸åŒè‰²çš„æ–¹æ¡ˆå°±æ˜¯ç­”æ¡ˆã€‚</p>\n<p>è€ƒè™‘ä¸€å…ƒå®¹æ–¥ï¼Œå¦‚ä»¤ <span class=\"math inline\">\\(f_i\\)</span> è¡¨ç¤ºè‡³å°‘ <span class=\"math inline\">\\(i\\)</span> è¡Œ <span class=\"math inline\">\\(i\\)</span> åˆ—åŒè‰²çš„æ–¹æ¡ˆï¼Œä½†ä¼šå‘ç° <span class=\"math inline\">\\(f_0\\)</span> ä¸­åŒ…å« <span class=\"math inline\">\\(0\\)</span> è¡Œ <span class=\"math inline\">\\(1\\)</span> åˆ—åŒè‰²ç­‰ä¸é¢„æœŸä¸ç¬¦çš„æƒ…å†µã€‚å—æ­¤å¯å‘è€ƒè™‘ä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºè‡³å°‘ <span class=\"math inline\">\\(i\\)</span> è¡Œ <span class=\"math inline\">\\(j\\)</span> åˆ—åŒè‰²è¿›è¡ŒäºŒå…ƒå®¹æ–¥ã€‚å®¹æ˜“å‘ç°å½“ <span class=\"math inline\">\\(i\\times j\\ne 0\\)</span> æ—¶ï¼Œè¢«é€‰ä¸­çš„ <span class=\"math inline\">\\(i\\)</span> è¡Œ <span class=\"math inline\">\\(j\\)</span> åˆ—å…¨éƒ¨è¿é€šï¼Œåº”ä¸ºåŒä¸€ç§é¢œè‰²ï¼›å°†å®ƒä»¬æŒªåˆ°è§’è½ï¼Œå¯ä»¥å‘ç°æœªè¢«é€‰ä¸­çš„æ ¼å­å…±æœ‰ <span class=\"math inline\">\\((n-i)\\times (n-j)\\)</span> ä¸ªã€‚æ•…æœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\nf_{i,j}=\\begin{cases}\nC_n^j\\times 3^j\\times 3^{n\\times(n - j)}&amp;i=0\\\\\nC_n^i\\times 3^i\\times 3^{n\\times(n-i)}&amp;j=0\\\\\nC_n^i\\times C_n^j\\times 3\\times 3^{(n-i)\\times (n-j)}&amp;\\text{otherwise}\n\\end{cases}\n\\]</span></p>\n<p>ä»¤ <span class=\"math inline\">\\(g_{i,j}\\)</span> è¡¨ç¤ºæ°å¥½ <span class=\"math inline\">\\(i\\)</span> è¡Œ <span class=\"math inline\">\\(j\\)</span> åˆ—åŒè‰²çš„æ–¹æ¡ˆæ•°ï¼Œé‚£ä¹ˆç­”æ¡ˆä¸º <span class=\"math inline\">\\(3^{n\\times n}-g_{0,0}\\)</span>ã€‚äºŒé¡¹å¼åæ¼” / å®¹æ–¥åŸç†å¾— <span class=\"math inline\">\\(g_{0,0}=\\sum\\limits_{i=0}^n\\sum\\limits_{j=0}^n (-1)^{i+j}\\cdot f_{i,j}\\)</span>ã€‚å¾ˆæƒŠè®¶åœ°å‘ç°è¿™æ˜¯ <span class=\"math inline\">\\(O(n^2)\\)</span> çš„ï¼è€ƒè™‘ä¼˜åŒ–ã€‚æŠŠ <span class=\"math inline\">\\(f_{1\\to n,1\\to n}\\)</span> åˆå¹¶åŒç±»é¡¹ï¼Œå¾—åˆ°ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\ng_{0, 0}\n&amp;=\\left[\\sum_{j=0}^n (-1)^j\\cdot f_{0,j}\\right]+\\sum_{i=1}^n (-1)^i\\cdot f_{i,0}+\\sum_{j=1}^n (-1)^{i+j}\\cdot C_n^i\\times C_n^j\\times 3^{(n-i)\\times (n-j)+1}\\\\\n&amp;=\\left[\\sum_{j=0}^n (-1)^j\\cdot f_{0,j}\\right]+\\sum_{i=1}^n (-1)^i\\cdot f_{i,0}+(-1)^i\\cdot C_n^i\\times 3^{n^2-n\\times i+1}\\times\\sum_{j=1}^n (-1)^j\\cdot C_n^j\\times 3^{j\\times(-n+i)}\\\\\n&amp;=\\left[\\sum_{j=0}^n (-1)^j\\cdot f_{0,j}\\right]+\\sum_{i=1}^n (-1)^i\\cdot f_{i,0}+(-1)^i\\cdot C_n^i\\times 3^{n^2-n\\times i+1}\\times\\left[\\left(\\sum_{j=0}^n (-1)^j\\cdot C_n^j\\times (3^{-n+i})^j\\right)-1\\right]\\\\\n&amp;=\\left[\\sum_{j=0}^n (-1)^j\\cdot f_{0,j}\\right]+\\sum_{i=1}^n (-1)^i\\cdot f_{i,0}+(-1)^i\\cdot C_n^i\\times 3^{n^2-n\\times i+1}\\times\\left[(-3^{-n+i}+1)^n-1\\right]\n\\end{aligned}\n\\]</span></p>\n<p>ç”±æ­¤ä¾¿å¯ <span class=\"math inline\">\\(O(n\\log n)\\)</span> è®¡ç®—ã€‚æ‹…å¿ƒè¶…æ—¶å¯ä»¥æŠŠæ‰€æœ‰ <span class=\"math inline\">\\(3^{-n+i}\\)</span> å’Œ <span class=\"math inline\">\\(3^{n\\times i}\\)</span> çº¿æ€§é¢„å¤„ç†å‡ºæ¥ï¼Œå¤æ‚åº¦ä¸ä¼šå˜å°±æ˜¯äº†ã€‚</p>\n<p>è¿™é‡Œè§£é‡Šä¸€ä¸‹æœ€åä¸€æ­¥çš„äºŒé¡¹å¼å®šç†ï¼Œéå¸¸é—æ†¾åœ°å‘ç° <span class=\"math inline\">\\(-1\\)</span> å’Œ <span class=\"math inline\">\\(3^{-n+i}\\)</span> éƒ½æ˜¯ <span class=\"math inline\">\\(j\\)</span> æ¬¡çš„ï¼Œæ²¡åŠæ³•æŠŠäºŒè€…ç›¸åŠ å‡åšäºŒé¡¹å¼å®šç†ï¼›ä½†ç”±äºæ¬¡æ•°ç›¸åŒï¼Œè¿™æç¤ºæˆ‘ä»¬å¯ä»¥æŠŠ <span class=\"math inline\">\\(-1\\)</span> ä¹˜åˆ° <span class=\"math inline\">\\(3^{-n+i}\\)</span> é‡Œå»ï¼Œç»™æ¯ä¸€é¡¹é…ä¸Š <span class=\"math inline\">\\(1^{n-k}\\)</span> å°±å¯ä»¥åš <span class=\"math inline\">\\(-3^{n-i}\\)</span>ï¼ˆæ³¨æ„ä¸æ˜¯ <span class=\"math inline\">\\((-3)^{n-i}\\)</span>ï¼‰ å’Œ <span class=\"math inline\">\\(1\\)</span> çš„äºŒé¡¹å¼å®šç†ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    long long n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;long long&gt; fac(n + 1), inv(n + 1), invn(n + 1), invi(n + 1), powi(n + 1), pown(n + 1);\n    auto qkp = [&amp;](long long x, long long y) &#123;\n        auto res(1ll);\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    const long long pnn = qkp(3ll, n * n), pn = qkp(3ll, n);\n    fac[0] = inv[0] = invn[0] = invi[0] = powi[0] = pown[0] = 1ll;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        fac[i] = fac[i - 1] * i % mod;\n        powi[i] = powi[i - 1] * 3 % mod;\n        pown[i] = pown[i - 1] * pn % mod;\n    &#125;\n    inv[n] = qkp(fac[n], mod - 2);\n    invi[n] = qkp(powi[n], mod - 2);\n    invn[n] = qkp(pown[n], mod - 2);\n    for (int i = n - 1; i; --i) &#123;\n        inv[i] = inv[i + 1] * (i + 1) % mod;\n        invi[i] = invi[i + 1] * 3 % mod;\n        invn[i] = invn[i + 1] * pn % mod;\n    &#125;\n    auto C = [&amp;](int n, int m) &#123;\n        return fac[n] * inv[n - m] % mod * inv[m] % mod;\n    &#125;;\n    long long g = 0ll;\n    auto f = [&amp;](int i, int j) &#123; // make sure (!i || !j)\n        if (i == 0 &amp;&amp; j == 0)\n            return pnn;\n        else if (i == 0)\n            return C(n, j) * powi[j] % mod * pown[n - j] % mod;\n        return C(n, i) * powi[i] % mod * pown[n - i] % mod;\n    &#125;;\n    for (int j = 0, p = 1; j &lt;= n; ++j, p = mod - p)\n        (g += p * f(0, j)) %= mod;\n    for (int i = 1, p = mod - 1; i &lt;= n; ++i, p = mod - p)\n        (g += p * f(i, 0) % mod + p * C(n, i) % mod * pnn % mod * invn[i] % mod * 3 % mod * (qkp(mod - invi[n - i] + 1, n) + mod - 1) % mod) %= mod;\n    std::cout &lt;&lt; (pnn + mod - g) % mod &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"d---å»-m-nom\">D - å» M / NoM</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P11316\" class=\"uri\">https://www.luogu.com.cn/problem/P11316</a></p>\n<p>å‡è®¾ <span class=\"math inline\">\\(f(i)\\)</span> ä¸ºè‡³å°‘æœ‰ <span class=\"math inline\">\\(i\\)</span> å¯¹ä¸åˆæ³•å…ƒç´ çš„æ–¹æ¡ˆæ•°ï¼Œåˆ™å®¹æ–¥å¾—åˆ°ç­”æ¡ˆ <span class=\"math inline\">\\(\\sum\\limits_{i=0}^n (-1)^i\\cdot f(i)\\)</span>ã€‚è€ƒè™‘æ€ä¹ˆè®¡ç®— <span class=\"math inline\">\\(f(i)\\)</span>ã€‚</p>\n<p><mark><span class=\"math inline\">\\(M\\)</span> æ•´é™¤ <span class=\"math inline\">\\(dis(x, y) \\iff (pos_x - pos_y)\\bmod M=0\\iff pos_x\\equiv pos_y\\pmod M\\)</span>ã€‚</mark></p>\n<p>è€ƒè™‘æŠŠå…³äº <span class=\"math inline\">\\(M\\)</span> åŒä½™çš„ä½ç½®æ”¾åœ¨ä¸€ä¸ªç»„ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦è®©ä¸€å¯¹å…ƒç´ ä¸èƒ½é€‰åŒä¸€ç»„çš„ä½ç½®ã€‚</p>\n<p>è€ƒè™‘å®¹æ–¥ï¼Œä»¤ <span class=\"math inline\">\\(f(i)\\)</span> è¡¨ç¤ºè‡³å°‘æœ‰ <span class=\"math inline\">\\(i\\)</span> å¯¹ç‚¹é€‰åˆ°ä¸€ç»„çš„æ–¹æ¡ˆæ•°ï¼Œè€ƒè™‘æ€ä¹ˆè®¡ç®—ã€‚å‡è®¾æˆ‘ä»¬è¦åœ¨ç¬¬ <span class=\"math inline\">\\(k\\)</span> ç»„ï¼ˆsize ä¸º <span class=\"math inline\">\\(s_k\\)</span>ï¼‰ä¸­é€‰å‡º <span class=\"math inline\">\\(x\\)</span> å¯¹ä½ç½®ï¼Œå®é™…ä¸Šåªéœ€è¦é€‰æ‹© <span class=\"math inline\">\\(2x\\)</span> ä¸ªä½ç½®ç„¶åä»»æ„åˆ†é…ç»™è¿™ <span class=\"math inline\">\\(x\\)</span> å¯¹æ•°ï¼Œå³ <span class=\"math inline\">\\(A_{s_k}^{2x}\\)</span>ã€‚è®¾ <span class=\"math inline\">\\(dp_{i, j}\\)</span> è¡¨ç¤º DP åˆ°ç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªç»„ï¼Œå·²ç»é€‰äº† <span class=\"math inline\">\\(j\\)</span> å¯¹ï¼Œé‚£ä¹ˆæœ‰ <span class=\"math inline\">\\(dp_{i,j}=\\sum\\limits_{k=0}^jC_{n-(j - k)}^{j-k}\\times dp_{i-1,j-k}\\times A_{s_i}^{2k}\\)</span>ã€‚ä¹ä¸€çœ‹å¥½åƒæ˜¯ <span class=\"math inline\">\\(O(n^3)\\)</span> çš„ï¼Œä½†æ˜¯åˆ«å¿˜äº† <span class=\"math inline\">\\(\\sum s_i=2n\\)</span>ï¼Œæ‰€ä»¥åªæœ‰ <span class=\"math inline\">\\(O(n^2)\\)</span>ã€‚<span class=\"math inline\">\\(f(i)\\)</span> å³ä¸º <span class=\"math inline\">\\(dp_{m,i}\\times (2n-2i)!\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 1e9 + 7;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;int&gt; s(m + 1);\n    std::vector&lt;long long&gt; fac(2 * n + 1), inv(2 * n + 1);\n    fac[0] = inv[0] = 1ll;\n    for (int i = 1; i &lt;= 2 * n; ++i)\n        ++s[i % m + 1], fac[i] = fac[i - 1] * i % mod;\n    auto qkp = [](long long x, int y) &#123;\n        auto res = 1ll;\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    inv[2 * n] = qkp(fac[2 * n], mod - 2);\n    for (int i = 2 * n - 1; i; --i)\n        inv[i] = inv[i + 1] * (i + 1) % mod;\n    auto A = [&amp;](int n, int m) &#123;\n        return fac[n] * inv[n - m] % mod;\n    &#125;;\n    auto C = [&amp;](int n, int m) &#123;\n        return fac[n] * inv[n - m] % mod * inv[m] % mod;\n    &#125;;\n    std::vector&lt;std::vector&lt;long long&gt; &gt; dp(m + 1, std::vector&lt;long long&gt; (n + 1));\n    dp[0][0] = 1ll;\n    for (int i = 1; i &lt;= m; ++i)\n        for (int j = 0; j &lt;= n; ++j) &#123;\n            for (int k = 0; k &lt;= j &amp;&amp; 2 * k &lt;= s[i]; ++k)\n                (dp[i][j] += C(n - (j - k), k) * dp[i - 1][j - k] % mod * A(s[i], 2 * k) % mod) %= mod;\n            // printf(&quot;s = %d, dp[%d][%d] = %lld\\n&quot;, s[i], i, j, dp[i][j]);\n        &#125;\n    long long res = 0ll;\n    for (int i = 0, p = 1; i &lt;= n; ++i, p = mod - p)\n        (res += p * dp[m][i] % mod * fac[2 * n - 2 * i] % mod) %= mod;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"e---kdoi-11å½©ç¯æ™šä¼š\">E - ã€ŒKDOI-11ã€å½©ç¯æ™šä¼š</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P11292\" class=\"uri\">https://www.luogu.com.cn/problem/P11292</a></p>\n<p>è€ƒè™‘ <span class=\"math inline\">\\({cnt_i}^2\\)</span> çš„å«ä¹‰ï¼Œå³åœ¨æ‰€æœ‰é¢œè‰²ä¸º <span class=\"math inline\">\\(i\\)</span>ã€é•¿åº¦ä¸º <span class=\"math inline\">\\(l\\)</span> çš„é“¾ä¸­æœ‰æ”¾å›åœ°é€‰ä¸¤æ¬¡çš„æ–¹æ¡ˆæ•°ã€‚</p>\n<p>æ˜¾ç„¶å¤æ‚åº¦é‡Œæ˜¯ä¸èƒ½åŒ…å« <span class=\"math inline\">\\(k\\)</span> çš„ï¼Œæ‰€ä»¥æ”¾å¼ƒç›´æ¥ç»Ÿè®¡ <span class=\"math inline\">\\(cnt_i\\)</span> çš„æƒ³æ³•ã€‚æ˜¾ç„¶æ¯ç§é¢œè‰²æ˜¯ç­‰ä»·çš„ï¼Œè€ƒè™‘è®¡ç®—é€‰æ‹©ä¸¤æ¡é“¾å¯ä»¥ç»™ç­”æ¡ˆå¸¦æ¥çš„è´¡çŒ®ï¼šç­”æ¡ˆçš„å½¢å¼æ˜¯ä¸ªå’Œå¼ï¼›å¯¹äºä¸¤æ¡åŒè‰²é“¾ <span class=\"math inline\">\\(p,q\\)</span>ï¼Œå‡è®¾é¢œè‰²ä¸º <span class=\"math inline\">\\(i\\)</span>ï¼Œé‚£ä¹ˆä¼šå¯¹ <span class=\"math inline\">\\({cnt_i}^2\\)</span> å¸¦æ¥ <span class=\"math inline\">\\(k^{n-2l-|p\\cap q|}\\)</span> çš„è´¡çŒ®ï¼Œå¯¹æ€»ç­”æ¡ˆå¸¦æ¥ <span class=\"math inline\">\\(k^{n-2l-|p\\cap q| + 1}\\)</span> çš„è´¡çŒ®ã€‚</p>\n<p>ç„¶è€Œå¦‚æœè¦æšä¸¾è®¡ç®— <span class=\"math inline\">\\(|p\\cap q|\\)</span> å°±æ— æ³•é¿å… <span class=\"math inline\">\\(O(n^5)\\)</span>ï¼Œè€ƒè™‘æ›´æœ‰æ½œåŠ›çš„æ–¹æ³•ï¼šå°†é—®é¢˜è½¬åŒ–ä¸ºå¯¹äºæ¯ä¸ª <span class=\"math inline\">\\(x\\)</span>ï¼Œæ±‚äº¤é›†å¤§å°æ°å¥½ä¸º <span class=\"math inline\">\\(x\\)</span> çš„é“¾å¯¹ä¸ªæ•°ã€‚ç„¶è€Œã€Œæ°å¥½ã€æ˜¯ä¸æ–¹ä¾¿è®¡ç®—çš„â€”â€”å‡å¦‚å½“å‰ä¸¤é“¾åœ¨ <span class=\"math inline\">\\(u\\)</span> æ¬¡é‡åˆï¼Œå¦‚æœå‡è®¾ä¸‹ä¸€æ¬¡åœ¨ <span class=\"math inline\">\\(v\\)</span> æ¬¡é‡åˆï¼Œå°±éœ€è¦ä¿è¯åœ¨ <span class=\"math inline\">\\(u,v\\)</span> ä¹‹é—´ä¸èƒ½é‡åˆâ€”â€”è¿™å¹¶ä¸å¥½æ“ä½œã€‚äºŒé¡¹å¼åæ¼”å°†æ°å¥½è½¬åŒ–ä¸ºè‡³å°‘ï¼Œåˆ™é™åˆ¶å‡å¼±ã€‚</p>\n<p>ä»¤ <span class=\"math inline\">\\(f_{u,c,l_1,l_2}\\)</span> è¡¨ç¤º <span class=\"math inline\">\\(p,q\\)</span> å½“å‰åœ¨ <span class=\"math inline\">\\(u\\)</span> å¤„é‡åˆï¼Œè§†é‡å†…çš„ <span class=\"math inline\">\\(p,q\\)</span> é•¿åº¦ä¸º <span class=\"math inline\">\\(l_1,l_2\\)</span>ï¼Œè‡³å°‘å·²ç»é‡åˆäº† <span class=\"math inline\">\\(c\\)</span> æ¬¡çš„æ–¹æ¡ˆæ•°ã€‚é¢„å¤„ç†å‡ºèµ°åˆ° <span class=\"math inline\">\\(u\\)</span> æ­¥æ•°ä¸º <span class=\"math inline\">\\(l_1,l_2\\)</span> çš„æ–¹æ¡ˆæ•°ä¸ºåˆå§‹å€¼ã€‚æšä¸¾å¯èƒ½çš„åç»­é‡åˆç‚¹ <span class=\"math inline\">\\(v\\)</span>ï¼ˆæ»¡è¶³ <span class=\"math inline\">\\(v\\)</span> çš„æ‹“æ‰‘åº <span class=\"math inline\">\\(&gt;u\\)</span>ï¼‰æœ‰ <span class=\"math inline\">\\(f_{v,c+1,l_1&#39;,l_2&#39;}\\gets f_{v,c+1,l_1&#39;,l_2&#39;} + f_{u,c,l_1,l_2}\\)</span>ã€‚é¢„å¤„ç†å‡º <span class=\"math inline\">\\(u\\to v\\)</span> é•¿åº¦ä¸º <span class=\"math inline\">\\(\\Delta\\)</span> çš„æ–¹æ¡ˆæ•°ï¼ˆè¿™æ˜¯ <span class=\"math inline\">\\(O(n^3l)\\)</span> çš„ï¼‰ä¼˜åŒ–è½¬ç§»ï¼Œåœ¨ç®—å‡º <span class=\"math inline\">\\(nex_{u,l}\\)</span> è¡¨ç¤ºä» <span class=\"math inline\">\\(u\\)</span> å‡ºå‘èµ° <span class=\"math inline\">\\(l\\)</span> æ­¥çš„æ–¹æ¡ˆæ•°å¤„ç†ç­”æ¡ˆï¼Œåˆ™ <span class=\"math inline\">\\(F(i)=\\sum_{u,l_1,l_2}f_{u,l_1,l_2}\\cdot nex_{u,l-l_1}\\cdot nex_{u,l-l_2}\\)</span>ï¼Œæšä¸¾ <span class=\"math inline\">\\(u,c,l_1,l_2,v,l_1&#39;,l_2&#39;\\)</span>ï¼Œå°±å¯ä»¥è¾¾åˆ°ä¼˜ç§€çš„ <span class=\"math inline\">\\(O(n^2l^5+n^3l)\\)</span>ï¼ç®€ç›´æ˜¯ä»¤äººéœ‡æ’¼ <img src=\"/em/kt.gif\" /></p>\n<p>ç»™å‡ºç¬¬ä¸€ä¸ªä¼˜åŒ–ï¼šå‘ç° <span class=\"math inline\">\\(l_1\\)</span> å’Œ <span class=\"math inline\">\\(l_2\\)</span> çš„è½¬ç§»å½¼æ­¤ä¸å¹²æ‰°ï¼Œè€ƒè™‘å»ºç«‹ä¸€ä¸ªä¸´æ—¶æ•°ç»„ <span class=\"math inline\">\\(g\\)</span>ï¼Œå…ˆä» <span class=\"math inline\">\\(f_u,c\\)</span> è½¬ç§» <span class=\"math inline\">\\(l_1\\)</span> åˆ° <span class=\"math inline\">\\(g\\)</span>ï¼Œå†ä» <span class=\"math inline\">\\(g\\)</span> è½¬ç§» <span class=\"math inline\">\\(l_2\\)</span> åˆ° <span class=\"math inline\">\\(f_{v,c+1}\\)</span>ï¼Œåˆ™å¤æ‚åº¦é™ä¸º <span class=\"math inline\">\\(O(n^2l^4+n^3l)\\)</span>ï¼Œä»ä¸è¶³ä»¥é€šè¿‡ã€‚</p>\n<p>DP è¿‡ç¨‹ä¸Šçš„ä¼˜åŒ–å·²ç»ä¸‡ç­–å°½ï¼Œè€ƒè™‘ä»å¼å­æœ¬èº«æ¶ˆå…ƒå‡å°‘ DP ç»´åº¦å…¥æ‰‹ã€‚ä»¤ <span class=\"math inline\">\\(h(i)\\)</span> è¡¨ç¤ºäº¤é›†å¤§å°æ°å¥½æ°å¥½ä¸º <span class=\"math inline\">\\(i\\)</span> çš„æ–¹æ¡ˆæ•°ï¼Œåˆ™æ­¤æ—¶ç­”æ¡ˆå¼ä¸º <span class=\"math inline\">\\(\\sum\\limits_{i=0}^l k^{n-2l+i+1}\\times h(i)\\)</span>ã€‚åˆ <span class=\"math inline\">\\(F(i)=\\sum\\limits_{j=i}^lC_j^i\\cdot h(j)\\)</span>ï¼ŒäºŒé¡¹å¼åæ¼”å¾—ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\nres&amp;=\\sum\\limits_{i=0}^lk^{n-2l+i+1}\\cdot \\sum_{j=i}^l(-1)^{j-i}\\cdot C_j^i\\cdot F(j)\\\\\n&amp;=k^{n-2l+1}\\cdot\\sum_{j=0}^l \\sum_{i=0}^j k^i\\cdot (-1)^{j-i}\\cdot C_j^i\\cdot F(j)\\\\\n&amp;=k^{n-2l+1}\\cdot \\sum_{j=0}^l (k-1)^j\\cdot F(j)\n\\end{aligned}\n\\]</span></p>\n<p><mark>æ³¨æ„è¿™é‡Œåˆ©ç”¨äº†äºŒé¡¹å¼åæ¼”çš„ç³»æ•°å¯ä»¥å’Œäº¤æ¢æ±‚å’Œé¡ºåºåçš„ <span class=\"math inline\">\\(i\\)</span> æ¬¡é¡¹ï¼ˆæˆ– <span class=\"math inline\">\\(j-i\\)</span> æ¬¡é¡¹ï¼Œå‚è§ <a href=\"#c---sky-full-of-stars\">Sky Full of Stars ä¸­æœ€åä¸€æ­¥çš„å¤„ç†</a>ï¼‰ç»„æˆäºŒé¡¹å¼å®šç†çš„ç‰¹ç‚¹</mark>ï¼Œä»¥ä¾¿åŸºäºå¼å­ç»“æ„å°½å¯èƒ½æ¶ˆå…ƒã€‚</p>\n<p>é‚£ä¹ˆæ­¤æ—¶ç­”æ¡ˆå¼å·²ç»å’Œ <span class=\"math inline\">\\(c\\)</span> æ— å…³ï¼Œå¯ä»¥ä¸¢æ‰ <span class=\"math inline\">\\(c\\)</span> è¿™ä¸€ç»´ï¼Œå’Œ <span class=\"math inline\">\\(c\\)</span> æœ‰å…³çš„è®¡ç®—å·²ç»åœ¨è½¬ç§»æ—¶å¤„ç†äº†ã€‚åˆ™ <span class=\"math inline\">\\(f_{v,l_1&#39;,l_2&#39;}=\\sum f_{u,l_1,l_2}\\times (k-1)\\)</span>ï¼Œå¤æ‚åº¦é™ä¸º <span class=\"math inline\">\\(O(n^2l^3+n^3l)\\)</span>ã€‚</p>\n<details>\n<p>è®°å¾—è¿˜è¦ç®—ä¸Š <span class=\"math inline\">\\(F(0)\\)</span>ï¼Œå³ä»»é€‰ä¸€æ¡åˆæ³•é“¾çš„æ–¹æ¡ˆæ•°å¹³æ–¹ã€‚</p>\n<pre class=\"cpp\"><code>// å…„å¼Ÿä½ å¥½é¦™\n// å…„å¼Ÿä½ æ˜¯ä¾æ‰˜æ‰“åˆ†ï¼Œæˆ‘è¸é©¬åƒåƒåƒåƒåƒ\n#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;party3.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    using arr = std::vector&lt;long long&gt;;\n    using arrr = std::vector&lt;arr&gt;;\n    using arrrr = std::vector&lt;arrr&gt;;\n    int n, k, l, m;\n    std::cin &gt;&gt; n, std::cin &gt;&gt; n &gt;&gt; k &gt;&gt; l &gt;&gt; m;\n    std::vector&lt;int&gt; deg(n + 1), id;\n    std::vector&lt;std::vector&lt;std::pair&lt;int, int&gt; &gt; &gt; g(n + 1);\n    for (int x, y, c; m--; ) &#123;\n        std::cin &gt;&gt; x &gt;&gt; y &gt;&gt; c;\n        ++deg[y], g[x].emplace_back(y, c);\n    &#125;\n    arrrr to(n + 1, arrr(n + 1, arr(l + 1)));\n    arrr pre(n + 1, arr(l + 1)), nex(n + 1, arr(l + 1));\n    &#123;\n        std::queue&lt;int&gt; q;\n        for (int i = 1; i &lt;= n; ++i)\n            if (!deg[i])\n                q.push(i);\n        for (int u; !q.empty(); ) &#123;\n            u = q.front(), q.pop();\n            to[u][u][0] = 1ll, id.push_back(u);\n            for (auto i : id)\n                for (int j = 0; j &lt;= l; ++j) &#123;\n                    (pre[u][j] += to[i][u][j]) %= mod;\n                    // printf(&quot;to[%d][%d][%d] = %lld\\n&quot;, i, u, j, to[i][u][j]);\n                &#125;\n            // for (int j = 0; j &lt;= l; ++j)\n            //     printf(&quot;pre[%d][%d] = %lld\\n&quot;, u, j, pre[u][j]);\n            for (auto [v, c] : g[u]) &#123;\n                for (auto i : id)\n                    for (int j = 1; j &lt;= l; ++j)\n                        (to[i][v][j] += to[i][u][j - 1] * c) %= mod;\n                if (!--deg[v])\n                    q.push(v);\n            &#125;\n        &#125;\n        for (int u = 1; u &lt;= n; ++u)\n            for (int v = 1; v &lt;= n; ++v)\n                for (int i = 0; i &lt;= l; ++i)\n                    (nex[u][i] += to[u][v][i]) %= mod;\n    &#125;\n    arrrr f(n + 1, arrr(l + 1, arr(l + 1)));\n    &#123;\n        for (int i = 1; i &lt;= n; ++i)\n            for (int l1 = 1; l1 &lt;= l; ++l1)\n                for (int l2 = 1; l2 &lt;= l; ++l2)\n                    f[i][l1][l2] = pre[i][l1 - 1] * pre[i][l2 - 1] % mod * (k - 1) % mod;\n        for (auto i = 0; i &lt; n; ++i) &#123;\n            int u = id[i];\n            // for (int l1 = 1; l1 &lt;= l; ++l1)\n            //     for (int l2 = 1; l2 &lt;= l; ++l2)\n            //         printf(&quot;f[%d][%d][%d] = %lld\\n&quot;, u, l1, l2, f[u][l1][l2]);\n            for (auto j = i + 1; j &lt; n; ++j) &#123;\n                arrr g(l + 1, arr(l + 1));\n                int v = id[j];\n                for (int l1 = 1; l1 &lt; l; ++l1)\n                    for (int _l1 = l1 + 1; _l1 &lt;= l; ++_l1) &#123;\n                        auto K = to[u][v][_l1 - l1];\n                        if (K)\n                            for (int l2 = 1; l2 &lt; l; ++l2)\n                                (g[_l1][l2] += f[u][l1][l2] * K) %= mod;\n                    &#125;\n                for (int _l1 = 2; _l1 &lt;= l; ++_l1)\n                    for (int l2 = 1; l2 &lt; l; ++l2)\n                        if (g[_l1][l2])\n                            for (int _l2 = l2 + 1; _l2 &lt;= l; ++_l2)\n                                (f[v][_l1][_l2] += g[_l1][l2] * to[u][v][_l2 - l2] % mod * (k - 1)) %= mod; \n            &#125;\n        &#125;\n    &#125;\n    auto qkp = [](long long x, int y) &#123;\n        auto res(1ll);\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    auto res(0ll);\n    for (int u = 1; u &lt;= n; ++u)\n        for (int v = 1; v &lt;= n; ++v)\n            (res += to[u][v][l - 1]) %= mod;\n    (res *= res) %= mod;\n    for (int u = 1; u &lt;= n; ++u)\n        for (int l1 = 1; l1 &lt;= l; ++l1)\n            for (int l2 = 1; l2 &lt;= l; ++l2)\n                (res += f[u][l1][l2] * nex[u][l - l1] % mod * nex[u][l - l2] % mod) %= mod;\n    res = res % mod * (qkp(k, n + 1) * qkp(qkp(k, 2 * l), mod - 2) % mod) % mod;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"g---å°æ˜Ÿæ˜Ÿ\">G - å°æ˜Ÿæ˜Ÿ</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P3349\" class=\"uri\">https://www.luogu.com.cn/problem/P3349</a></p>\n<p>é¦–å…ˆè€ƒè™‘æ¯”è¾ƒæš´åŠ›çš„åšæ³•ï¼Œé‚£ä¹ˆæœ‰ <span class=\"math inline\">\\(f_{i,j,S}\\)</span> è¡¨ç¤ºåœ¨ <span class=\"math inline\">\\(i\\)</span> è¿™ä¸ªå­æ ‘é‡Œé¢é€‰äº†é›†åˆ <span class=\"math inline\">\\(S\\)</span>ï¼Œä¸” <span class=\"math inline\">\\(i\\)</span> çš„é¢œè‰²ä¸º <span class=\"math inline\">\\(j\\)</span> çš„æ–¹æ¡ˆæ•°ï¼Œç»´æ•°é‡Œä¹‹æ‰€ä»¥æœ‰ <span class=\"math inline\">\\(j\\)</span> æ˜¯ä¸ºäº†æ»¡è¶³è¿è¾¹é™åˆ¶ã€‚</p>\n<p>ç„¶åæ ‘ä¸Šå­é›† DPï¼Œå‘ç°æ˜¯ <span class=\"math inline\">\\(O(n^4\\cdot 2^n)\\)</span> çš„ï¼Œ</p>\n<hr />\n<h2 id=\"cf785d-anton-and-school---2\">CF785D Anton and School - 2</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/785/D\" class=\"uri\">https://codeforces.com/problemset/problem/785/D</a></p>\n<p>å®¹æ˜“æƒ³åˆ°æšä¸¾æ¯ä¸ª <code>(</code> ä½œä¸ºåˆ†ç•Œç‚¹çš„æƒ…å†µï¼Œé‚£ä¹ˆé’¦å®šå½“å‰æšä¸¾çš„ <code>(</code> æ˜¯è¦é€‰çš„ã€‚å¯¹äºå½“å‰ <code>(</code>ï¼Œè‹¥å…¶å·¦è¾¹ï¼ˆä¸å«ï¼‰çš„ <code>(</code> æœ‰ <span class=\"math inline\">\\(n\\)</span> ä¸ªè€Œå³è¾¹çš„ <code>)</code> æœ‰ <span class=\"math inline\">\\(m\\)</span> ä¸ªï¼Œæšä¸¾é™¤äº†å½“å‰ <code>(</code> è¿˜è¦é€‰ <span class=\"math inline\">\\(i\\)</span> ä¸ª <code>(</code>ï¼Œé‚£ä¹ˆç­”æ¡ˆä¸º <span class=\"math inline\">\\(\\sum_{i=0}C_n^{i-1}\\cdot C_m^i\\)</span>ã€‚</p>\n<p>å‘ç°è¿™ä¸ªå½¢å¼å¯ä»¥èŒƒå¾·è’™å¾·å·ç§¯ï¼š<span class=\"math inline\">\\(\\sum_{i=0}C_n^{i-1}\\cdot C_m^i=\\sum_{i=0}C_n^{n-i+1}\\cdot C_m^i=C_{n+m}^{n+1}\\)</span>ã€‚</p>\n<p>å…³äºæ€ä¹ˆè®°å¿†èŒƒå¾·è’™å¾·å·ç§¯ï¼Œå‘ç°ä¸Šä¸‹ç›¸åŠ ï¼Œä¹Ÿå¯ä»¥ä»ç»„åˆæ„ä¹‰è®°å¿†ï¼šåœ¨ <span class=\"math inline\">\\(n\\)</span> ä¸ªçƒä¸­é€‰å‡º <span class=\"math inline\">\\(k-i\\)</span> ä¸ªçƒï¼Œå†ä» <span class=\"math inline\">\\(m\\)</span> ä¸ªçƒä¸­é€‰å‡º <span class=\"math inline\">\\(i\\)</span> ä¸ªçƒçš„æ€»æ–¹æ¡ˆå°±æ˜¯ä» <span class=\"math inline\">\\(n+m\\)</span> ä¸ªçƒä¸­ç›´æ¥é€‰å‡º <span class=\"math inline\">\\(k\\)</span> ä¸ªçƒçš„æ–¹æ¡ˆã€‚</p>\n<p>æ³¨æ„åˆ¤æ–­å³ä¾§æ²¡æœ‰ <code>)</code> çš„æ—¶å€™è´¡çŒ®ä¸º <span class=\"math inline\">\\(0\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 1e9 + 7;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    std::string s;\n    std::cin &gt;&gt; s;\n    int n = s.length();\n    s = &quot; &quot; + s;\n    std::vector&lt;int&gt; cnt1(n + 1), cnt2(n + 1);\n    std::vector&lt;long long&gt; fac(n + 1), inv(n + 1);\n    fac[0] = inv[0] = 1ll;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        fac[i] = fac[i - 1] * i % mod;\n        cnt1[i] = cnt1[i - 1] + (s[i] == &#39;(&#39;);\n    &#125;\n    auto qkp = [](long long x, int y) &#123;\n        auto res(1ll);\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    inv[n] = qkp(fac[n], mod - 2);\n    cnt2[n] = (s[n] == &#39;)&#39;);\n    for (int i = n - 1; i; --i) &#123;\n        cnt2[i] = cnt2[i + 1] + (s[i] == &#39;)&#39;);\n        inv[i] = inv[i + 1] * (i + 1) % mod;\n    &#125;\n    long long res = 0ll;\n    auto C = [&amp;](int n, int m) &#123;\n        if (n &lt; m)\n            return 0ll;\n        return fac[n] * inv[n - m] % mod * inv[m] % mod;\n    &#125;;\n    for (int i = 1; i &lt;= n; ++i)\n        if (s[i] == &#39;(&#39;)\n            (res += C(cnt1[i] + cnt2[i] - 1, cnt1[i])) %= mod;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"cf1332e-height-all-the-same\">CF1332E Height All the Same</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1332/E\" class=\"uri\">https://codeforces.com/problemset/problem/1332/E</a></p>\n<p>å®¹æ˜“å‘ç°ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ç”¨æ¥æ”¹å˜ä¸¤ä¸ªæ•°å¥‡å¶æ€§çš„ï¼›è€Œç¬¬äºŒä¸ªæ“ä½œèƒ½åœ¨å…¨å›¾å¥‡å¶æ€§ç›¸åŒçš„ä»»ä½•æƒ…å†µä¸‹è¾¾æˆè¦æ±‚ã€‚</p>\n<p>æ³¨æ„åˆ°å¦‚æœæˆ‘ä»¬æƒ³åŒæ—¶ä»…æ”¹å˜ä»»æ„ä¸¤ä¸ªæ•°çš„å¥‡å¶æ€§ï¼Œå¯ä»¥åœ¨æ£‹ç›˜ä¸Šä»»æ‰¾ä¸€æ¡è·¯å¾„ä¸€è·¯ä½¿ç”¨æ“ä½œä¸€ã€‚åªè¦æŸç§å¥‡å¶æ€§çš„å…ƒç´ ä¸ªæ•°å…±æœ‰å¶æ•°ä¸ªï¼Œå°±èƒ½é€šè¿‡è‹¥å¹²æ¬¡æ“ä½œä¸€æŠŠå®ƒä»¬å…¨éƒ¨å˜æˆå¦ä¸€ç§å¥‡å¶æ€§ã€‚</p>\n<p>ä»¤ <span class=\"math inline\">\\(K_1\\)</span> ä¸º <span class=\"math inline\">\\(L\\sim R\\)</span> ä¸­å¥‡æ•°çš„ä¸ªæ•°ï¼Œ<span class=\"math inline\">\\(K_2\\)</span> ä¸ºå¶æ•°ï¼Œé‚£ä¹ˆæœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\nres=\\sum_{i=0}^{nm} C_{nm}^i\\times {K_1}^i\\cdot {K_2}^{nm-i}\\cdot [i\\bmod 2=0]\n\\]</span></p>\n<p>æˆ‘ä»¬å‘ç°è¿™ä¸ªä¸œè¥¿å’ŒäºŒé¡¹å¼å®šç†ç®€ç›´åƒå¾—ä¸èƒ½å†åƒäº†ï¼ä½†å¤šäº†ä¸€ä¸ªç³»æ•°å¯¼è‡´æ²¡åŠæ³•çœç•¥æšä¸¾è¿‡ç¨‹ã€‚å¦‚æœè¿›è¡Œå˜å½¢å‘¢ï¼Ÿ</p>\n<p><span class=\"math display\">\\[\nres=(K_1+K_2)^{nm}-\\sum_{i=0}^{nm} C_{nm}^i\\times {K_1}^i\\cdot {K_2}^{nm-i}\\cdot [i\\bmod 2=1]\n\\]</span></p>\n<p>ä¼¼ä¹ä¾ç„¶æ²¡æœ‰å‡ºè·¯ï¼ä½†è¿™é‡Œæœ‰ä¸ªç¥å¥‡çš„æ“ä½œï¼š</p>\n<p><span class=\"math display\">\\[\nres=(-K_1+K_2)^{nm}+\\sum_{i=0}^{nm} C_{nm}^i\\times {K_1}^i\\cdot {K_2}^i\\cdot [i\\bmod 2=1]\n\\]</span></p>\n<p>äºŒå¼ç›¸åŠ å°±å¯ä»¥<mark>æ¶ˆå…ƒ</mark>ï¼Œå¾—åˆ° <span class=\"math inline\">\\(2\\cdot res=(K_1+K_2)^{nm}+(K_1-K_2)^{nm}\\)</span>ã€‚<mark>è¿™å¯ç¤ºæˆ‘ä»¬äºŒé¡¹å¼å®šç†ä¸­çš„ç¬¦å·å’Œå¥‡å¶æ€§çš„æ·±åˆ‡è”ç³»ã€‚</mark></p>\n<details>\n<p>å¦‚æœä½ ä½¿ç”¨è´¹é©¬å°å®šç†å¯¹æ¬¡æ•°è¿›è¡Œäº†å¤„ç†ï¼Œä½ å¯èƒ½éœ€è¦æ³¨æ„æ¬¡æ•°å¯èƒ½ä¸º <span class=\"math inline\">\\(\\text{mod} -1\\)</span> çš„å€æ•°ã€‚</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nconst int inv2 = 499122177;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    long long n, m, l, r, k1, k2;\n    std::cin &gt;&gt; n &gt;&gt; m &gt;&gt; l &gt;&gt; r, k1 = (r - l + 1) / 2, k2 = (r - l + 1) - k1;\n    auto qkp = [](long long x, long long y) &#123;\n        auto res(1ll);\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    if (n * m % 2)\n        std::cout &lt;&lt; qkp(r - l + 1, n * m) &lt;&lt; &#39;\\n&#39;;\n    else\n        std::cout &lt;&lt; (qkp(r - l + 1, n * m) + qkp((k1 + mod - k2) % mod, n * m)) % mod * inv2 % mod &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"a---äº¤é”™åºåˆ—\">A - äº¤é”™åºåˆ—</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P4456\" class=\"uri\">https://www.luogu.com.cn/problem/P4456</a></p>\n<figure>\n<img src=\"2.png\" alt=\"å‡ºé¢˜äººç–‘ä¼¼éœ€è¦åŠ å¼ºæ•°å­¦åŠŸåº•ï¼ˆï¼Ÿï¼‰\" /><figcaption>å‡ºé¢˜äººç–‘ä¼¼éœ€è¦åŠ å¼ºæ•°å­¦åŠŸåº•ï¼ˆï¼Ÿï¼‰</figcaption>\n</figure>\n<p>å®¹æ˜“æƒ³åˆ°æŠŠç­”æ¡ˆç”¨äºŒé¡¹å¼å®šç†æ‹†å¼€ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\nres&amp;=\\sum_y f_y\\cdot y^b\\cdot (n-y)^a\\\\\n&amp;=\\sum_y f_y\\cdot y^b\\cdot \\sum_{i=0}^a C_a^i\\cdot n^i\\cdot(-y)^{a-i}\\\\\n&amp;=\\sum_y\\sum_{i=0}^a f_y\\cdot C_a^i\\cdot n^i\\cdot(-1)^{a-i}\\cdot y^{a+b-i}\\\\\n&amp;=\\sum_{i=0}^a C_a^i\\cdot n^i\\cdot(-1)^{a-i}\\cdot \\sum_y f_y\\cdot y^{a+b-i}\\\\\n\\end{aligned}\n\\]</span></p>\n<p>ç„¶åå‘ç°åé¢é‚£ä¸ª sigma ä¸å¤ªæœ‰åŠæ³•æ±‚ã€‚ä¸€ä¸ªæ¯”è¾ƒä¼˜é›…çš„æ–¹æ³•æ˜¯æŠŠ <span class=\"math inline\">\\(y^{a+b-i}\\)</span> ç›´æ¥ä½œä¸ºç³»æ•°è€Œéä¸‹æ ‡å¡åˆ° <span class=\"math inline\">\\(f\\)</span> é‡Œå»ï¼Œå³ä»¤ <span class=\"math inline\">\\(f_{i}\\)</span> è¡¨ç¤º <span class=\"math inline\">\\(\\forall \\,y\\)</span>ï¼Œ<span class=\"math inline\">\\(\\sum y^i\\)</span> ä¹‹å’Œã€‚</p>\n<p>å…·ä½“åœ°ï¼Œä»¤ <span class=\"math inline\">\\(dp_{n,i,0/1}\\)</span> è¡¨ç¤ºå½“å‰ DP åˆ°ç¬¬ <span class=\"math inline\">\\(n\\)</span> ä½ï¼Œè¦æ±‚å¹‚æ¬¡ä¸º <span class=\"math inline\">\\(i\\)</span>ï¼Œæœ€åä¸€ä½ä¸º <span class=\"math inline\">\\(0/1\\)</span> çš„ç­”æ¡ˆã€‚åˆ™æ˜¾ç„¶æœ‰ <span class=\"math inline\">\\(dp_{n,i,0}=dp_{n-1,i,0}+dp_{n-1,i,1}\\)</span>ã€‚å¯¹äº <span class=\"math inline\">\\(dp_{n,i,1}\\)</span>ï¼Œå› ä¸ºæ­¤æ—¶ <span class=\"math inline\">\\(\\forall\\, k,k\\gets k+1\\)</span>ï¼Œåˆ™ <span class=\"math inline\">\\((k+1)^i=\\sum\\limits_{j=0}^i C_i^j \\cdot k^j\\)</span> å³ <span class=\"math inline\">\\(dp_{n,i,1}=\\sum\\limits_{j=0}^i C_i^j\\cdot dp_{n-1,j,0}\\)</span>ã€‚å‘ç° <span class=\"math inline\">\\(i,j\\)</span> çš„èŒƒå›´æ˜¯ <span class=\"math inline\">\\(90\\)</span>ï¼Œå¾ˆææ€–çš„äº‹æƒ…æ˜¯è¿™æ˜¯å¯ä»¥çŸ©é˜µçš„ã€‚</p>\n<details>\n<p>å°±åƒæˆ‘ä»¬éƒ½çŸ¥é“çš„é‚£æ ·ï¼ŒçŸ©é˜µåœ¨åŠ å®Œä¹‹åå†å–æ¨¡å°±ä¼šå¿«å¾ˆå¤šâ€¦â€¦</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint mod;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, a, b;\n    std::cin &gt;&gt; n &gt;&gt; a &gt;&gt; b &gt;&gt; mod;\n    std::vector&lt;std::vector&lt;long long&gt; &gt; C(a + b + 1, std::vector&lt;long long&gt;(a + b + 1));\n    for (int i = 0; i &lt;= a + b; ++i) &#123;\n        C[i][0] = 1ll;\n        for (int j = 1; j &lt;= i; ++j)\n            C[i][j] = (C[i - 1][j - 1] + C[i - 1][j]) % mod;\n    &#125;\n    struct mat &#123;\n        int n, m;\n        std::vector&lt;std::vector&lt;long long&gt; &gt; a;\n        mat(int n, int m, bool flag = 0): n(n), m(m), a(n, std::vector&lt;long long&gt; (m)) &#123;\n            if (flag)\n                for (int i = 0; i &lt; n; ++i)\n                    a[i][i] = 1ll;\n            return;\n        &#125;\n        mat operator* (const mat &amp;q) const &#123;\n            mat res(n, q.m);\n            for (int i = 0; i &lt; n; ++i)\n                for (int k = 0; k &lt; q.m; ++k) &#123;\n                    for (int j = 0; j &lt; m; ++j)\n                        res.a[i][k] += a[i][j] * q.a[j][k];\n                    res.a[i][k] %= mod;\n                &#125;\n            return res;\n        &#125;\n        mat operator^ (int q) const &#123;\n            mat res(n, n, 1), x(*this);\n            for (; q; x = x * x, q &gt;&gt;= 1)\n                if (q &amp; 1)\n                    res = res * x;\n            return res;\n        &#125;\n    &#125; f(1, 2 * (a + b + 1)), op(2 * (a + b + 1), 2 * (a + b + 1));\n    auto fun = [&amp;](int i, int j) &#123;\n        return i + j * (a + b + 1);\n    &#125;;\n    f.a[0][fun(0, 0)] = 1ll;\n    for (int i = 0; i &lt;= a + b; ++i)\n        op.a[fun(i, 0)][fun(i, 0)] = op.a[fun(i, 1)][fun(i, 0)] = 1ll;\n    for (int i = 0; i &lt;= a + b; ++i)\n        for (int j = 0; j &lt;= i; ++j)\n            op.a[fun(j, 0)][fun(i, 1)] = C[i][j];\n    f = f * (op ^ n);\n    // for (int i = 0; i &lt;= n; ++i) &#123;\n    //     if (i)\n    //         f = f * op;\n    //     for (int j = 0; j &lt;= a + b; ++j)\n    //         printf(&quot;f[%d][%d] = %lld / %lld\\n&quot;, i, j, f.a[0][fun(j, 0)], f.a[0][fun(j, 1)]);\n    // &#125;\n    auto res = 0ll;\n    for (int i = 0; i &lt;= a; ++i) &#123;\n        static auto p(1ll), k((a % 2) ? mod - 1ll : 1ll);\n        (res += C[a][i] * p % mod * k % mod * (f.a[0][fun(a + b - i, 0)] + f.a[0][fun(a + b - i, 1)]) % mod) %= mod;\n        (p *= n) %= mod, k = mod - k;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b---different-subsets-for-all-tuples\">B - Different Subsets For All Tuples</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/CF660E\" class=\"uri\">https://www.luogu.com.cn/problem/CF660E</a></p>\n<p>é¦–å…ˆä½ å¯èƒ½éœ€è¦çŸ¥é“ï¼Œå¦‚æœå·²çŸ¥ä¸€ä¸ªåºåˆ—ï¼Œå¦‚ä½•å¾—åˆ°ç­”æ¡ˆï¼Ÿ</p>\n<p>ä»¤ <span class=\"math inline\">\\(f_i\\)</span> è¡¨ç¤ºåœ¨ <span class=\"math inline\">\\(i\\)</span> å¤„å–ä¸€ä¸ªå­åºåˆ—çš„æœ«å°¾ï¼Œæšä¸¾ä¸Šä¸€ä¸ªå…ƒç´  <span class=\"math inline\">\\(x\\)</span>ï¼Œæ‰¾åˆ° <span class=\"math inline\">\\(i\\)</span> ä¹‹å‰æœ€é åçš„ä¸€ä¸ª <span class=\"math inline\">\\(a_j=x\\)</span>ï¼Œé‚£ä¹ˆæœ‰ <span class=\"math inline\">\\(f_i=\\sum f_j\\)</span>ï¼Œæ¢è¨€ä¹‹éœ€è¦ä¿è¯ <span class=\"math inline\">\\((j,i)\\)</span> èŒƒå›´å†…æ²¡æœ‰ <span class=\"math inline\">\\(x\\)</span> å‡ºç°ã€‚</p>\n<p>æ­¤æ—¶åºåˆ—æœªçŸ¥ï¼Œä»¤ <span class=\"math inline\">\\(f_{i, x}\\)</span> è¡¨ç¤ºåœ¨ <span class=\"math inline\">\\(i\\)</span> å¤„å–ä¸€ä¸ªå­åºåˆ—æœ«å°¾ï¼Œä¸” <span class=\"math inline\">\\(i\\)</span> çš„å€¼ä¸º <span class=\"math inline\">\\(x\\)</span>ï¼›æŒ‰ç…§è´¡çŒ®çš„è§†è§’æ¥çœ‹å¾…ï¼Œæ¯ä¸ªå¯ä»¥å’Œ <span class=\"math inline\">\\(i\\)</span> ç»„æˆæ–°å­åºåˆ—çš„æ–¹æ¡ˆå¯ä»¥å¸¦æ¥ <span class=\"math inline\">\\(m^{i-1}\\)</span> çš„è´¡çŒ®ï¼ˆå› ä¸º <span class=\"math inline\">\\(a_i\\)</span> å·²ç»å›ºå®šä¸º <span class=\"math inline\">\\(x\\)</span>ï¼Œå…¶ä»–ä½ç½®å¯ä»¥ä»»é€‰ï¼‰ï¼Œé‚£ä¹ˆæœ‰ <span class=\"math inline\">\\(f_{i,x}=m^i\\times \\sum_{j&lt;i,y}f_{j,y}\\times (m-1)^{i-j-1}\\)</span>ã€‚</p>\n<p>ç„¶åå°±æƒŠè®¶åœ°å‘ç°å¼å­å’Œ <span class=\"math inline\">\\(x\\)</span> è¿™ä¸€ç»´æ²¡æœ‰å…³ç³»äº†ã€‚æ‰€ä»¥ç›´æ¥å¸¦ä¸Šç³»æ•°å¾—åˆ°ï¼š</p>\n<p><span class=\"math display\">\\[\n\\begin{aligned}\nf_i&amp;=m^i\\times \\sum_{j&lt;i} f_j\\times (m-1)^{i-j-1}\\times m\\\\\n&amp;=m^i\\times (m-1)^{i-1}\\times m\\cdot \\sum_{j&lt;i} f_j\\times (m-1)^{-j}\n\\end{aligned}\n\\]</span></p>\n<p>å‰ç¼€å’Œä¼˜åŒ–ä¸€ä¸‹å°±å¯ä»¥å¿«é€Ÿæ±‚äº†ã€‚æœ€ç»ˆçš„ç­”æ¡ˆå°±æ˜¯ <span class=\"math inline\">\\(res=m^n+\\sum f_i\\times (m-1)^{n-i}\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 1e9 + 7;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    if (m == 1)\n        std::cout &lt;&lt; (n + 1) &lt;&lt; &#39;\\n&#39;;\n    else &#123;\n        std::vector&lt;long long&gt; f(n + 1), s(n + 1), pm1(n + 1);\n        pm1[0] = 1ll;\n        for (int i = 1; i &lt;= n; ++i)\n            pm1[i] = pm1[i - 1] * (m - 1) % mod;\n        auto qkp = [](long long x, int y) &#123;\n            auto res(1ll);\n            for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n                if (y &amp; 1)\n                    (res *= x) %= mod;\n            return res;\n        &#125;;\n        auto res(qkp(m, n));\n        const auto invm = qkp(m - 1, mod - 2);\n        for (int i = 1; i &lt;= n; ++i) &#123;\n            static long long p(m), inv(invm);\n            f[i] = (p + pm1[i - 1] * m % mod * s[i - 1] % mod) % mod;\n            s[i] = (s[i - 1] + f[i] * inv % mod) % mod;\n            (res += f[i] * pm1[n - i] % mod) %= mod;\n            (p *= m) %= mod, (inv *= invm) %= mod;\n        &#125;\n        std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;; \n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"g---gardens\">G - Gardens</h2>\n<p><a href=\"https://atcoder.jp/contests/abc235/tasks/abc235_g\" class=\"uri\">https://atcoder.jp/contests/abc235/tasks/abc235_g</a></p>\n<p>å¦‚æœæ²¡æœ‰ã€æ¯ä¸ªäººå¿…é¡»æœ‰ä¸€ä¸ªå…ƒç´ ã€è¿™ä¸ªé™åˆ¶ï¼Œå°±å¯ä»¥éšä¾¿åšäº†ã€‚ç°åœ¨åŠ ä¸Šäº†è¿™ä¸ªé™åˆ¶ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°ç”¨æ²¡å¾—åˆ°çš„äººæ¥å®¹æ–¥ã€‚é’¦å®šè‡³å°‘æœ‰ <span class=\"math inline\">\\(i\\)</span> ä¸ªäººæ²¡æ‹¿åˆ°ï¼Œå¾—åˆ°ç­”æ¡ˆä¸º <span class=\"math inline\">\\(\\sum\\limits_{i=0}^n (-1)^i\\cdot C_n^i\\cdot \\left(\\sum\\limits_{j=0}^a C_i^j\\right)\\cdot \\left(\\sum\\limits_{j=0}^b C_i^j\\right)\\cdot \\left(\\sum\\limits_{j=0}^c C_i^j\\right)\\)</span>ã€‚</p>\n<p>æ€ä¹ˆç®— <span class=\"math inline\">\\(\\sum\\limits_{j=0}^a C_i^j\\)</span> å‘¢ï¼Ÿå½“ <span class=\"math inline\">\\(a&gt; i\\)</span> æ—¶ï¼ŒäºŒé¡¹å¼æ˜¯å¥½æ±‚çš„ï¼›å½“ <span class=\"math inline\">\\(a\\le i\\)</span> æ—¶å‘¢ï¼Ÿçœ‹åˆ°è¿™ä¸ªå¼å­å¾ˆå®¹æ˜“å¸¦åˆ°æ¨è¾‰ä¸‰è§’é‡Œå»ï¼Œä¹Ÿå°±æ˜¯æ±‚ä¸€è¡Œçš„å‰ <span class=\"math inline\">\\(a\\)</span> ä¸ªæ•°ã€‚æ³¨æ„åˆ°å¯ä»¥ç”¨ä¸Šä¸€è¡Œçš„å‰ <span class=\"math inline\">\\(a\\)</span> ä¸ªæ•° <span class=\"math inline\">\\(O(1)\\)</span> å¾—åˆ°ï¼ˆå‡è®¾ç¬¬ <span class=\"math inline\">\\(j-1\\)</span> è¡Œå‰ <span class=\"math inline\">\\(a\\)</span> ä¸ªæ•°ä¹‹å’Œä¸º <span class=\"math inline\">\\(f_a(j-1)\\)</span>ï¼‰ï¼š<span class=\"math inline\">\\(f_a(j)=f_a(j-1)\\times 2-C_{j-1,a}\\)</span>ã€‚<mark>ä½ éœ€è¦æ„è¯†åˆ°ï¼Œç”±äºä¸Šä¸€è¡Œä¹Ÿæ˜¯ç­”æ¡ˆä¸­è¦æ±‚çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨é€’æ¨è§£å†³é—®é¢˜ã€‚<strong>åœ¨ç»„åˆè®¡æ•°ä¸­ï¼Œé€’æ¨ / DP æ— è®ºæ˜¯åœ¨åŒ–ç®€å¼å­è¿˜æ˜¯æ±‚å®¹æ–¥ / äºŒé¡¹å¼åæ¼”é‡Œå…·ä½“æŸä¸€é™åˆ¶ä¸‹çš„æ–¹æ¡ˆæ•°éƒ½æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œåœ¨éœ€è¦ä¼˜åŒ–å¤æ‚åº¦æ—¶ï¼Œå¯ä»¥ä»é€’æ¨ / DPã€æ’ç­‰å¼ã€å‰ç¼€å’Œã€é¢„å¤„ç†ç­‰æ–¹æ³•å…¥æ‰‹è€ƒè™‘</strong></mark>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 998244353;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, a, b, c;\n    std::cin &gt;&gt; n &gt;&gt; a &gt;&gt; b &gt;&gt; c;\n    std::vector&lt;long long&gt; fac(n + 1), inv(n + 1), fa(n + 1), fb(n + 1), fc(n + 1), pow2(n + 1);\n    fac[0] = inv[0] = pow2[0] = 1ll;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        fac[i] = fac[i - 1] * i % mod;\n        pow2[i] = pow2[i - 1] * 2 % mod;\n    &#125;\n    auto qkp = [&amp;](long long x, int y) &#123;\n        auto res(1ll);\n        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)\n            if (y &amp; 1)\n                (res *= x) %= mod;\n        return res;\n    &#125;;\n    inv[n] = qkp(fac[n], mod - 2);\n    for (int i = n - 1; i; --i)\n        inv[i] = inv[i + 1] * (i + 1) % mod;\n    auto C = [&amp;](int n, int m) &#123;\n        return fac[n] * inv[n - m] % mod * inv[m] % mod;\n    &#125;;\n    for (int i = 0; i &lt;= a; ++i)\n        (fa[a] += C(a, i)) %= mod;\n    for (int i = a + 1; i &lt;= n; ++i)\n        fa[i] = (2 * fa[i - 1] % mod + mod - C(i - 1, a)) % mod;\n    for (int i = 0; i &lt;= b; ++i)\n        (fb[b] += C(b, i)) %= mod;\n    for (int i = b + 1; i &lt;= n; ++i)\n        fb[i] = (2 * fb[i - 1] % mod + mod - C(i - 1, b)) % mod;\n    for (int i = 0; i &lt;= c; ++i)\n        (fc[c] += C(c, i)) %= mod;\n    for (int i = c + 1; i &lt;= n; ++i)\n        fc[i] = (2 * fc[i - 1] % mod + mod - C(i - 1, c)) % mod;\n    auto res(0ll);\n    for (int i = n, p = 1; ~i; --i, p = mod - p)\n        (res += p * C(n, i) % mod * (i &gt;= a ? fa[i] : pow2[i]) % mod * (i &gt;= b ? fb[i] : pow2[i]) % mod * (i &gt;= c ? fc[i] : pow2[i]) % mod) %= mod;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n",
            "tags": [
                "DP",
                "è®¡æ•°"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20250120/",
            "url": "https://xsc062.netlify.app/20250120/",
            "title": "å­¦ä¹ ç¬”è®°ï¼šAC è‡ªåŠ¨æœº",
            "date_published": "2025-01-20T03:21:15.000Z",
            "content_html": "<p>è€³æœºå£°éŸ³ç–‘ä¼¼æœ‰ç‚¹å°äº†ï¼Œç”¨å¿ƒæ—·ç¥æ€¡çš„è¯æ¥è¯´å¤§è‡´ä¼šæ˜¯ã€Œæ¯”æœè‡â†‘å—¡å—¡å£°è¿˜å°ã€ã€‚</p>\n<span id=\"more\"></span>\n<p>ï¼Ÿå§æ§½è€³æœºä¸Šå±…ç„¶å¯ä»¥è°ƒéŸ³é‡ <img src=\"/em/oh.gif\" /></p>\n<hr />\n<h2 id=\"å‰ç½®çŸ¥è¯†\">å‰ç½®çŸ¥è¯†</h2>\n<p>é¦–å…ˆå¯èƒ½éœ€è¦çŸ¥é“ä¸“æœ‰åè¯ã€Œè‡ªåŠ¨æœºã€çš„å«ä¹‰ã€‚</p>\n<p>å¤§è‡´å¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œä¸€ä¸ª DAGï¼Œå…¶ä¸­ç‚¹è¡¨ç¤ºçŠ¶æ€ï¼Œè¾¹è¡¨ç¤ºè½¬ç§»ã€‚ç»™è¿›å»ä¸€ä¸ªå­—ç¬¦ä¸²ä¹‹ç±»ï¼Œå°±å¯ä»¥åœ¨ DAG ä¸Šæ¸¸èµ°ï¼Œæ ¹æ®æœ€åæ‰€å¤„ç»“ç‚¹ï¼Œå¯ä»¥å¾—åˆ°å­—ç¬¦ä¸²ç›¸å…³ç‰¹å¾ã€‚</p>\n<p>è¿™ä¸ªå®šä¹‰è®©æˆ‘ä»¬æƒ³åˆ°äº† Trieã€‚äº‹å®ä¸Šï¼ŒTrie å°±æ˜¯ä¸€ç§ç›¸å½“åŸºç¡€çš„è‡ªåŠ¨æœºã€‚</p>\n<hr />\n<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å¤ä¹  KMP ç›¸å…³æ¦‚å¿µã€‚</p>\n<p>å‡æƒ³ä¸€ä¸ªåœºæ™¯ï¼šä½ éœ€è¦æ±‚å¾— <span class=\"math inline\">\\(T\\)</span> åœ¨ <span class=\"math inline\">\\(S\\)</span> ä¸­çš„å‡ºç°æ¬¡æ•°ã€‚</p>\n<p>æ‹¥æœ‰ä¸€å®šé¢˜ç›®ç»éªŒçš„ä½ ï¼Œä¼šä½¿ç”¨ KMP æ±‚å‡º <span class=\"math inline\">\\(T\\)</span> çš„ <code>next</code> æ•°ç»„ï¼Œä»¤ <span class=\"math inline\">\\(T\\)</span> åœ¨ <span class=\"math inline\">\\(S\\)</span> ä¸Šè¿›è¡ŒåŒ¹é…ï¼Œå¤±é…æˆ–å®Œå…¨åŒ¹é…æ—¶å›åˆ° <span class=\"math inline\">\\(T\\)</span> åœ¨è¯¥å¤„çš„ <code>next</code>ï¼Œ<span class=\"math inline\">\\(S\\)</span> ä¸Šçš„æŒ‡é’ˆå§‹ç»ˆå‘å³ï¼Œ<span class=\"math inline\">\\(T\\)</span> ä¸Šçš„æŒ‡é’ˆå¦‚æœå‘å³ï¼Œæ¯æ¬¡åªèƒ½ç§»åŠ¨ä¸€ä½ï¼›å¦‚æœå‘å·¦ï¼Œæœ€å·¦ç§»åˆ°å¼€å¤´ï¼Œå‡æ‘Šä¸‹æ¥å¤æ‚åº¦å³ä¸º <span class=\"math inline\">\\(O(|S| + |T|)\\)</span>ã€‚</p>\n<p>å‡å¦‚åœºæ™¯å˜å¾—æ›´å¤æ‚ï¼šç»™å®š <span class=\"math inline\">\\(\\{T_m\\}\\)</span>ï¼Œä½ éœ€è¦æ±‚å‡ºæ¯ä¸ª <span class=\"math inline\">\\(T_j\\)</span> åœ¨ <span class=\"math inline\">\\(S\\)</span> ä¸­çš„å‡ºç°æ¬¡æ•°ã€‚</p>\n<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¯¹æ¯ä¸ª <span class=\"math inline\">\\(T_j\\)</span> è¿›è¡Œä¸€æ¬¡ KMPï¼Œå¤æ‚åº¦å°†ä¼šä¸Šå‡åˆ° <span class=\"math inline\">\\(O(m|S|)\\)</span>ï¼Œéš¾ä»¥æ‰¿å—ã€‚æœ‰æ²¡æœ‰ä¼˜åŒ–çš„æ–¹æ³•å‘¢ï¼Ÿ</p>\n<hr />\n<h2 id=\"ac-è‡ªåŠ¨æœºçš„å»ºç«‹\">AC è‡ªåŠ¨æœºçš„å»ºç«‹</h2>\n<p>ç»“åˆä¸Šé¢çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬ä¸‹æ„è¯†æƒ³åˆ°ï¼Œèƒ½ä¸èƒ½å°† <span class=\"math inline\">\\(\\{T_m\\}\\)</span> å»ºæˆä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œä»¤ <span class=\"math inline\">\\(S\\)</span> åœ¨å…¶ä¸Šè¿›è¡Œ KMP å‘¢ï¼Ÿ</p>\n<p>å°† <span class=\"math inline\">\\(\\{T_m\\}\\)</span> å…¨éƒ¨åŠ å…¥ Trieï¼Œç”±äº <code>next</code> åªä¼šç”±æ›´æ·±çš„ç‚¹æŒ‡å‘æ›´æµ…çš„ç‚¹ï¼Œä¼¼ä¹ä»ç›´è§‰ä¸Šæ˜¯æœ‰è§„åˆ™çš„ã€‚ä½†éšä¹‹è€Œæ¥çš„æ˜¯ä¸€ä¸ªé—®é¢˜ï¼šç‚¹ <span class=\"math inline\">\\(u\\)</span> çš„ <code>next</code> ä¸ä¸€å®šåœ¨ <span class=\"math inline\">\\(\\text{root}\\to u\\)</span> çš„é“¾ä¸Šï¼ˆç”±äº Trie çš„æ€§è´¨ï¼Œå¯çŸ¥æŒ‡å‘çš„ç‚¹æ˜¯å”¯ä¸€çš„ï¼‰ã€‚é‰´äºè¿™ä¸€ç‚¹ä¸åŒï¼Œæˆ‘ä»¬ç»“åˆå…¶ã€Œå¤±é…æŒ‡é’ˆã€çš„å®šä¹‰ï¼Œå°† <code>next</code> åœ¨ Trie ä¸Šçš„åŒåˆ†å¼‚æ„ä½“å”¤ä¸º <code>fail</code>ã€‚</p>\n<p>è€ƒå¯Ÿ Trie ä¸Šè¯¥ <code>fail</code> è¾¹çš„æ€§è´¨ã€‚ç°æ¬²æ±‚è§£ <span class=\"math inline\">\\(u\\)</span> çš„ <code>fail</code> æŒ‡å‘çš„ <span class=\"math inline\">\\(c\\)</span>ï¼Œç»“åˆ KMP ä¸­ <code>next</code> çš„æ€§è´¨ï¼Œå‡è®¾ <span class=\"math inline\">\\(u\\)</span> çš„çˆ¶èŠ‚ç‚¹çš„ <code>fail</code> è¾¹æŒ‡å‘ <span class=\"math inline\">\\(v&#39;\\)</span>ï¼Œé‚£ä¹ˆ <span class=\"math inline\">\\(v\\)</span> çš„å€¼ä¸ºï¼š</p>\n<ul>\n<li><span class=\"math inline\">\\(v&#39;\\)</span> ä¸Šæœ‰è¾¹æƒç›¸åŒçš„è¾¹ï¼Œé‚£ä¹ˆ <span class=\"math inline\">\\(v\\)</span> å°±æ˜¯è¯¥è¾¹æŒ‡å‘çš„ç‚¹ã€‚</li>\n<li>å¦åˆ™ï¼Œå‰å¾€ <span class=\"math inline\">\\(v&#39;\\)</span> çš„ <code>fail</code>ï¼Œé‡å¤ä»¥ä¸Šåˆ¤å®šã€‚</li>\n</ul>\n<p>é‚£ä¹ˆå°±å®Œæˆäº†å¤±é…çš„å¤„ç†ã€‚ç›¸åº”åœ°ï¼Œå®Œå…¨åŒ¹é…æ—¶çš„è·³è½¬åº”å¦‚ä½•å¤„ç†ï¼Ÿç›´æ¥å°† <code>fail</code> çš„å„¿å­å…¨éƒ¨æ¥åˆ° <span class=\"math inline\">\\(u\\)</span> ä¸‹é¢å³å¯ã€‚å¦‚æœ <span class=\"math inline\">\\(u\\)</span> å’Œ <code>fail</code> å…·æœ‰åŒä¸€ä¸ªè¾¹æƒçš„è¾¹æ—¶ï¼Œä¿ç•™ <span class=\"math inline\">\\(u\\)</span> çš„è¿™æ¡è¾¹ <span class=\"math inline\">\\(u\\to v\\)</span>ï¼Œå› ä¸º <span class=\"math inline\">\\(v\\)</span> çš„ <code>fail</code> å¿…å®šæŒ‡å‘ <span class=\"math inline\">\\(u\\)</span> çš„ <code>fail</code> çš„å¯¹åº”å„¿å­ã€‚</p>\n<p>ä¸¤ç‚¹ç»“åˆï¼Œæˆ‘ä»¬å‘ç°ä»å®ç°ä¸Šï¼Œå¯ä»¥ç›´æ¥ä»¤ <span class=\"math inline\">\\(v\\)</span> çš„ <code>fail</code> æŒ‡å‘ <span class=\"math inline\">\\(u\\)</span> çš„ <code>fail</code> çš„å¯¹åº”å„¿å­ï¼ˆé‚£ä¹ˆæ—¶é—´å¤æ‚åº¦æ˜¾è€Œæ˜“è§æ˜¯ <span class=\"math inline\">\\(O(26\\sum |T|)\\)</span> çš„ï¼‰ã€‚</p>\n<p>åŒ¹é…æ—¶ï¼Œå¯¹äºæ¯ä¸ªç‚¹å’Œå…¶è¿”å›åˆ°æ ¹çš„ <code>fail</code> é“¾ï¼Œå…¨éƒ¨æ ‡è®°ã€‚åˆ™ä¸€ä¸ªæ¨¡å¼ä¸²åŒ¹é…çš„æ¬¡æ•°å³ä¸ºè¢«æ‰“æ ‡è®°çš„æ¬¡æ•°ã€‚</p>\n<p>é‚£ä¹ˆå¯ä»¥å‘ç° AC è‡ªåŠ¨æœºçš„æœ¬è´¨å°±æ˜¯æ·»åŠ äº† <code>fail</code> è¾¹çš„ Trieã€‚</p>\n<hr />\n<p>é‚£ä¹ˆæ ¹æ®ä¸Šè¿°è¦æ±‚ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§æ·±åº¦é¡ºåºæ±‚å¾— <code>fail</code>ï¼Œè€ƒè™‘ BFSã€‚</p>\n<details>\n<p>å“¦å“¦å¥½ç¥å¥‡å¤æ´»ä¹‹åè®°å¾—å•¥æ˜¯ KMP ä½†å¿˜äº†å•¥æ˜¯ C++ äº†ã€‚ç”šè‡³èŠ±äº†ä¸€ç‚¹æ—¶é—´å­¦ä¹ æ€ä¹ˆåˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Ÿï¼Ÿï¼Ÿ</p>\n<p>å¤§å®¶å†™ AC è‡ªåŠ¨æœº Trie æ ¹èŠ‚ç‚¹ä¸‹æ ‡ä¸€å®šè¦è®¾æˆ 0 å•Š <img src=\"/em/ll.gif\" /> è®¾æˆ 1 è¢«å„ç§ç»†èŠ‚å‘æƒ¨äº† <img src=\"/em/ll.gif\" /></p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxn = 2e5 + 5;\nint T[maxn][26], tot, cnt[maxn], fail[maxn];\nint ins(std::string &amp;t) &#123;\n    int p = 0;\n    for (auto i : t) &#123;\n        if (!T[p][i - &#39;a&#39;])\n            T[p][i - &#39;a&#39;] = ++tot;\n        p = T[p][i - &#39;a&#39;];\n    &#125;\n    return p;\n&#125;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; tail(n + 1);\n    std::vector&lt;std::string&gt; t(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; t[i], tail[i] = ins(t[i]);\n    &#123;\n        std::queue&lt;int&gt; q;\n        for (int i = 0; i &lt; 26; ++i)\n            if (T[0][i])\n                q.push(T[0][i]);\n        for (; !q.empty(); ) &#123;\n            int u = q.front();\n            q.pop();\n            for (int i = 0; i &lt; 26; ++i)\n                if (T[u][i]) &#123;\n                    int v = T[u][i];\n                    fail[v] = T[fail[u]][i];\n                    q.push(v);\n                &#125;\n                else\n                    T[u][i] = T[fail[u]][i];\n        &#125;\n    &#125;\n    std::string s;\n    std::cin &gt;&gt; s;\n    &#123;\n        int p = 0;\n        for (auto i : s) &#123;\n            p = T[p][i - &#39;a&#39;];\n            for (int fa = p; fa; fa = fail[fa])\n                ++cnt[fa];\n        &#125;\n    &#125;\n    for (int i = 1; i &lt;= n; ++i)\n        std::cout &lt;&lt; cnt[tail[i]] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<p>è‚‰çœ¼å¯è§è¯¥æŸ¥è¯¢æ–¹å¼æ˜¯æå…¶ä½æ•ˆçš„ï¼Œæ•…è€ƒè™‘ä¼˜åŒ–è·³ <code>fail</code> æ‰“æ ‡è®°çš„è¿‡ç¨‹ã€‚</p>\n<p>æ—¢ç„¶è‡ªåŠ¨æœºç»“æ„ä¸å˜ï¼Œä¸å¦‚å°†è·³ <code>fail</code> çš„æ­¥éª¤æ”¾åœ¨æœ€åç»Ÿä¸€è¿›è¡Œã€‚å®¹æ˜“åœ¨å‘ç° <code>fail</code> æ ‘ä¸Šè¿›è¡Œæ‹“æ‰‘æ’åºè½¬ç§»å³å¯ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxn = 2e5 + 5;\nint T[maxn][26], tot, cnt[maxn], fail[maxn], deg[maxn];\nint ins(std::string &amp;t) &#123;\n    int p = 0;\n    for (auto i : t) &#123;\n        if (!T[p][i - &#39;a&#39;])\n            T[p][i - &#39;a&#39;] = ++tot;\n        p = T[p][i - &#39;a&#39;];\n    &#125;\n    return p;\n&#125;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; tail(n + 1);\n    std::vector&lt;std::string&gt; t(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; t[i], tail[i] = ins(t[i]);\n    &#123;\n        std::queue&lt;int&gt; q;\n        for (int i = 0; i &lt; 26; ++i)\n            if (T[0][i])\n                q.push(T[0][i]);\n        for (; !q.empty(); ) &#123;\n            int u = q.front();\n            q.pop();\n            for (int i = 0; i &lt; 26; ++i)\n                if (T[u][i]) &#123;\n                    int v = T[u][i];\n                    fail[v] = T[fail[u]][i], ++deg[T[fail[u]][i]];\n                    q.push(v);\n                &#125;\n                else\n                    T[u][i] = T[fail[u]][i];\n        &#125;\n    &#125;\n    std::string s;\n    std::cin &gt;&gt; s;\n    &#123;\n        int p = 0;\n        for (auto i : s)\n            p = T[p][i - &#39;a&#39;], ++cnt[p];\n    &#125;\n    &#123;\n        std::queue&lt;int&gt; q;\n        for (int i = 1; i &lt;= tot; ++i)\n            if (!deg[i])\n                q.push(i);\n        for (; !q.empty(); ) &#123;\n            int u = q.front();\n            q.pop();\n            cnt[fail[u]] += cnt[u];\n            if (!--deg[fail[u]])\n                q.push(fail[u]);\n        &#125;\n    &#125;\n    for (int i = 1; i &lt;= n; ++i)\n        std::cout &lt;&lt; cnt[tail[i]] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"ac-è‡ªåŠ¨æœºçš„åº”ç”¨ä¸è¯†åˆ«\">AC è‡ªåŠ¨æœºçš„åº”ç”¨ä¸è¯†åˆ«</h2>\n<p>æˆ‘ä»¬çŸ¥é“å…¶æœ€å…¸å‹çš„ç‰¹å¾æ˜¯ <strong>å¤šæ¨¡å¼ä¸²</strong>ã€<strong>é™æ€ / ç¦»çº¿</strong>ã€‚å½“ç¢°åˆ°ç±»ä¼¼ç‰¹ç‚¹æ—¶ï¼Œå¤§æ¦‚ç‡å°±æ˜¯ AC è‡ªåŠ¨æœºã€‚</p>\n<p>å…¶ä¸­ï¼Œå¯ä»¥è®¾ç½®çš„éš¾ç‚¹æœ‰ï¼š</p>\n<ol type=\"1\">\n<li>å­—ç¬¦ä¸²éš¾ç‚¹ï¼Œå’Œå…¶ä»–å­—ç¬¦ä¸²é¢˜å¯è®¾ç½®çš„éš¾ç‚¹ç›¸åŒã€‚</li>\n<li>fail æ ‘ç»´æŠ¤ï¼Œå¯èƒ½ç»“åˆæ•°æ®ç»“æ„ã€æ‹“æ‰‘æ’åºã€æ ‘å½¢ DP ç­‰è€ƒå¯Ÿã€‚</li>\n<li>DP çš„è®¾è®¡ã€‚</li>\n</ol>\n<hr />\n<h2 id=\"å­—ç¬¦ä¸²éš¾ç‚¹è®¾è®¡\">å­—ç¬¦ä¸²éš¾ç‚¹è®¾è®¡</h2>\n<h3 id=\"eg.-indie-album\">eg. Indie Album</h3>\n<p><a href=\"https://codeforces.com/problemset/problem/1207/G\" class=\"uri\">https://codeforces.com/problemset/problem/1207/G</a></p>\n<p>é¢˜ç›®çš„ã€Œå¯æŒä¹…åŒ–ã€è¯•å›¾è¯¯å¯¼æˆ‘ä»¬ç”¨æ“ä½œä¸²å»ºç«‹è‡ªåŠ¨æœºï¼Œä½†è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ²¡åŠæ³•æ±‚ <span class=\"math inline\">\\(t\\)</span> çš„å‡ºç°æ¬¡æ•°ã€‚</p>\n<p>ä¸ºäº†ä¿è¯ç­”æ¡ˆå¯æ±‚æˆ‘ä»¬ä»ç„¶åœ¨ <span class=\"math inline\">\\(t\\)</span> ä¸Šå»ºç«‹ ACAMã€‚å®¹æ˜“å‘ç°æ“ä½œä¸²ä»¥ Trie å½¢å¼ç»™å‡ºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨éå† Trie æ—¶åŒæ—¶å®Œæˆæ¸¸èµ°ï¼Œé€šè¿‡å›æº¯å®Œæˆè¯¢é—®ã€‚</p>\n<p>å‡è®¾å½“å‰ DFS ä¸­ï¼Œéå†åˆ° Trie æ ‘ä¸­çš„ <span class=\"math inline\">\\(x\\)</span> ç‚¹å’Œè‡ªåŠ¨æœºä¸­çš„ <span class=\"math inline\">\\(u\\)</span> çŠ¶æ€ï¼Œé‚£ä¹ˆå¯¹äº <span class=\"math inline\">\\(x\\)</span> ç‚¹æ‰€å¯¹åº”çš„ä¸€ä¸ªè¯¢é—®ä¸² <span class=\"math inline\">\\(t\\)</span>ï¼Œç›¸å½“äºè¯¢é—®ç»è¿‡çš„æ‰€æœ‰çŠ¶æ€æœ‰å¤šå°‘ä¸ªåœ¨ <span class=\"math inline\">\\(t\\)</span> å¼•å¯¼çš„ fail æ ‘å­æ ‘ä¸­ã€‚æˆ‘ä»¬æ±‚å‡º fail æ ‘çš„ dfnï¼Œç”¨æ ‘çŠ¶æ•°ç»„ç®€å•ç»Ÿè®¡å³å¯ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxn = 4e5 + 5;\nstd::vector&lt;int&gt; g[maxn], q[maxn];\nint fail[maxn], T[maxn][26], tot, bit[maxn], to[maxn][26], cnt[maxn];\nint ins(std::string s) &#123;\n    int p = 0;\n    for (auto i : s) &#123;\n        if (!T[p][i - &#39;a&#39;])\n            T[p][i - &#39;a&#39;] = ++tot;\n        p = T[p][i - &#39;a&#39;];\n    &#125;\n    return p;\n&#125;\nint lowbit(int x) &#123;\n    return x &amp; -x;\n&#125;\nvoid add(int x, int v) &#123;\n    for (; x &lt;= tot + 1; x += lowbit(x))\n        bit[x] += v;\n    return;\n&#125;\nint ask(int x) &#123;\n    int res = 0;\n    for (; x; x -= lowbit(x))\n        res += bit[x];\n    return res;\n&#125;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, now = 0;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; id(n + 1);\n    for (int i = 1, op; i &lt;= n; ++i) &#123;\n        char t;\n        std::cin &gt;&gt; op;\n        if (op == 1) &#123;\n            std::cin &gt;&gt; t;\n            if (!to[0][t - &#39;a&#39;])\n                to[0][t - &#39;a&#39;] = ++now;\n            ++cnt[to[0][t - &#39;a&#39;]], id[i] = to[0][t - &#39;a&#39;];\n        &#125;\n        else &#123;\n            int j; \n            std::cin &gt;&gt; j &gt;&gt; t;\n            if (!to[id[j]][t - &#39;a&#39;])\n                to[id[j]][t - &#39;a&#39;] = ++now;\n            ++cnt[to[id[j]][t - &#39;a&#39;]], id[i] = to[id[j]][t - &#39;a&#39;];\n        &#125;\n    &#125;\n    int m;\n    std::cin &gt;&gt; m;\n    std::vector&lt;int&gt; tail(m + 1), res(m + 1);\n    for (int i = 1, x; i &lt;= m; ++i) &#123;\n        std::string t;\n        std::cin &gt;&gt; x &gt;&gt; t, tail[i] = ins(t);\n        q[id[x]].push_back(i);\n    &#125;\n    &#123;\n        std::queue&lt;int&gt; q;\n        for (int i = 0; i &lt; 26; ++i)\n            if (T[0][i])\n                q.push(T[0][i]), g[0].push_back(T[0][i]);\n        for (; !q.empty(); ) &#123;\n            int u = q.front();\n            q.pop();\n            for (int i = 0; i &lt; 26; ++i)\n                if (T[u][i]) &#123;\n                    int v = T[u][i];\n                    fail[v] = T[fail[u]][i];\n                    q.push(v), g[fail[v]].push_back(v);\n                &#125;\n                else\n                    T[u][i] = T[fail[u]][i];\n        &#125;\n    &#125;\n    std::vector&lt;int&gt; dfn(tot + 1), rfn(tot + 1);\n    std::function&lt;void(int)&gt; DFS = [&amp;](int x) &#123;\n        static int now = 0;\n        dfn[x] = ++now;\n        // printf(&quot;%d &quot;, x);\n        for (auto i : g[x])\n            DFS(i);\n        rfn[x] = now;\n        return;\n    &#125;;\n    DFS(0);\n    std::function&lt;void(int, int)&gt; DFS1 = [&amp;](int x, int u) &#123;\n        add(dfn[u], 1);\n        for (auto i : q[x])\n            res[i] += ask(rfn[tail[i]]) - ask(dfn[tail[i]] - 1);\n        for (int i = 0; i &lt; 26; ++i)\n            if (to[x][i])\n                DFS1(to[x][i], T[u][i]);\n        add(dfn[u], -1);\n        return;\n    &#125;;\n    DFS1(0, 0);\n    for (int i = 1; i &lt;= m; ++i)\n        std::cout &lt;&lt; res[i] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"fail-æ ‘çš„ç»´æŠ¤\">fail æ ‘çš„ç»´æŠ¤</h2>\n<h3 id=\"eg.-divljak\">eg. Divljak</h3>\n<p><a href=\"https://www.luogu.com.cn/problem/P5840\" class=\"uri\">https://www.luogu.com.cn/problem/P5840</a></p>\n<h4 id=\"æ³•ä¸€æŠŠåŠ¨æ€é—®é¢˜ç¦»çº¿\">æ³•ä¸€ï¼šæŠŠåŠ¨æ€é—®é¢˜ç¦»çº¿</h4>\n<p>é—®é¢˜ç›¸å½“äºå°†æ¨¡å¼ä¸² <span class=\"math inline\">\\(T:\\{P\\}\\)</span> åŠ¨æ€åŒ–ï¼Œä½†æˆ‘ä»¬ä»å¯ä»¥æ— è„‘ç¦»çº¿ä¸‹æ¥è§£å†³é—®é¢˜ã€‚</p>\n<p>è€ƒè™‘åŸæœ¬çš„ç­”æ¡ˆè®¡ç®—è¿‡ç¨‹ï¼Œå³åœ¨ç»è¿‡çš„æ‰€æœ‰çŠ¶æ€åŠå…¶ fail é“¾ä¸Šæ‰“æ ‡è®°ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦ç¦»çº¿å¹¶åŒºåˆ†æ ‡è®°çš„æ¥æºï¼ˆå¹¶ä¸”æ ‡è®°ç±»å‹ä¸ºå¸ƒå°”å€¼ï¼‰ï¼Œä¸‹æ„è¯†æƒ³åˆ°ä½¿ç”¨çº¿æ®µæ ‘ç»´æŠ¤ã€‚</p>\n<p>æˆ‘ä»¬å¯¹æ¯ä¸ªçŠ¶æ€å»ºç«‹åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘ï¼Œæœ€åæ‹“æ‰‘æ’åºæ—¶ä½¿ç”¨çº¿æ®µæ ‘åˆå¹¶å¤„ç†ä¿¡æ¯ã€‚å®¹æ˜“è¯æ˜æ—¶é—´å¤æ‚åº¦ç›¸è¾ƒåŸæ¥å¤šäº†ä¸€ä¸ª <span class=\"math inline\">\\(\\log\\)</span>ã€‚</p>\n<p><del>ç†è®ºå¯è¡Œï¼Œå¼€å§‹å®è·µ</del> å‡ºé¢˜äººä¼¼ä¹ä¸æ˜¯å¾ˆå–œæ¬¢çº¿æ®µæ ‘é€‰æ‰‹æ‰€ä»¥å†³å®šå‰¥å¤ºä½ çš„ Memory Limitã€‚æƒ³è¦ç”¨è¿™ç§åšæ³•é€šè¿‡æœ¬é¢˜å¯è§ <a href=\"https://www.luogu.com.cn/article/jaxk3sno\" class=\"uri\">https://www.luogu.com.cn/article/jaxk3sno</a>ã€‚</p>\n<h4 id=\"æ³•äºŒè½¬è€Œå¤„ç†é™æ€é—®é¢˜\">æ³•äºŒï¼šè½¬è€Œå¤„ç†é™æ€é—®é¢˜</h4>\n<p>æ³¨æ„åˆ°é¢˜ç›®ä¸­çš„é™æ€çš„ <span class=\"math inline\">\\(S_x\\)</span> æ¯”èµ· <span class=\"math inline\">\\(T:\\{P\\}\\)</span> æ›´é€‚åˆç”¨æ¥åšæ¨¡å¼ä¸²ï¼Œæˆ‘ä»¬åœ¨ <span class=\"math inline\">\\(S_x\\)</span> ä¸Šæ„å»º AC è‡ªåŠ¨æœºï¼Œè€ƒè™‘åœ¨çº¿è§£å†³é—®é¢˜ã€‚</p>\n<p>åœ¨æ¯æ¬¡ <code>1</code> æ“ä½œæ—¶ï¼Œæ›´æ–°æ¨¡å¼ä¸²ä¿¡æ¯ã€‚å¯¹äºé€”å¾„çš„æ‰€æœ‰çŠ¶æ€ <span class=\"math inline\">\\(\\{u\\}\\)</span>ï¼Œè€ƒè™‘æ›´æ–°å…¶æ‰€åœ¨ fail é“¾ä¸Šçš„ä¿¡æ¯ã€‚</p>\n<p>æ³¨æ„åˆ°æˆ‘ä»¬éœ€è¦ä¿®æ”¹æ•´æ¡ fail é“¾ä¸Šçš„ä¿¡æ¯ï¼Œè¯¢é—®åˆ™æ˜¯è¯¢é—®å•ç‚¹ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥è€ƒè™‘ä½¿ç”¨æ ‘ä¸Šå·®åˆ†ã€‚</p>\n<p>ä½†æ˜¯ here comes a problemï¼Œæˆ‘ä»¬å¯¹äºè¿™ä¸€æ•´ä¸ªä¸²åªèƒ½åœ¨æ•´ä¸ªæ ‘ä¸Šæ¯ä¸ªç‚¹ä¸Šæ›´æ–°ä¸€æ¬¡ã€‚æ€ä¹ˆæ¶ˆå»ç›¸åŒçš„å½±å“å‘¢ï¼Ÿ</p>\n<p>è¿™é‡Œå®ç°ä¸Šæˆ‘ä»¬å°†ç»è¿‡çš„ç‚¹æŒ‰ fail æ ‘ä¸Š dfn æ’åºï¼Œå¹¶ä¸”å¯¹äºåºåˆ—ä¸­ç›¸é‚»çš„ä¸¤ç‚¹åœ¨å…¶ LCA ä¸Šå‡å»ä¸€æ¬¡æ ‡è®°ã€‚ä¸ºä»€ä¹ˆè¿™æ˜¯æ­£ç¡®çš„å‘¢ï¼Ÿå‚è€ƒè™šæ ‘ï¼Œæˆ‘ä»¬åªéœ€è¦è®©åºåˆ—ä¸­ç›¸é‚»çš„ä¸¤ä¸ªç‚¹å°½é‡è¿‘å°±å¯ä»¥ä¿è¯é‡å¤çš„è¢«åˆ é™¤å®Œæ¯•ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxn = 2e6 + 5;\nint tot, bit[maxn], T[maxn][26], fail[maxn];\nint ins(std::string &amp;t) &#123;\n    int p = 0;\n    for (auto i : t) &#123;\n        if (!T[p][i - &#39;a&#39;])\n            T[p][i - &#39;a&#39;] = ++tot;\n        p = T[p][i - &#39;a&#39;];\n    &#125;\n    return p;\n&#125;\nint lowbit(int x) &#123;\n    return x &amp; -x;\n&#125;\nvoid add(int x, int v) &#123;\n    // printf(&quot;add (%d, %d)\\n&quot;, x, v);\n    for (; x &lt;= tot + 1; x += lowbit(x))\n        bit[x] += v;\n    return;\n&#125;\nint ask(int x) &#123;\n    int res = 0, to = x;\n    for (; x; x -= lowbit(x))\n        res += bit[x];\n    // printf(&quot;ask(%d) = %d\\n&quot;, to, res);\n    return res;\n&#125;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, q;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; tail(n + 1);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::string t;\n        std::cin &gt;&gt; t, tail[i] = ins(t);\n    &#125;\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(tot + 2);\n    &#123;\n        std::queue&lt;int&gt; q;\n        for (int i = 0; i &lt; 26; ++i)\n            if (T[0][i])\n                q.push(T[0][i]);\n        for (; !q.empty(); ) &#123;\n            int u = q.front();\n            q.pop();\n            for (int i = 0; i &lt; 26; ++i)\n                if (T[u][i]) &#123;\n                    int v = T[u][i];\n                    fail[v] = T[fail[u]][i];\n                    q.push(v);\n                &#125;\n                else\n                    T[u][i] = T[fail[u]][i];\n        &#125;\n        for (int i = 1; i &lt;= tot; ++i)\n            g[fail[i] + 1].push_back(i + 1);\n    &#125;\n    std::vector&lt;std::array&lt;int, 22&gt; &gt; f(tot + 2);\n    std::vector&lt;int&gt; dep(tot + 2), dfn(tot + 2), siz(tot + 2);\n    std::function&lt;void(int)&gt; DFS = [&amp;](int x) &#123;\n        static int now = 0;\n        siz[x] = 1, dfn[x] = ++now;\n        // printf(&quot;%d\\n&quot;, x);\n        for (auto i : g[x]) &#123;\n            dep[i] = dep[x] + 1;\n            f[i][0] = x;\n            for (int j = 1; j &lt;= 21; ++j)\n                f[i][j] = f[f[i][j - 1]][j - 1];\n            DFS(i), siz[x] += siz[i];\n        &#125;\n        return;\n    &#125;;\n    dep[1] = 1, DFS(1);\n    auto askLCA = [&amp;](int x, int y) &#123;\n        if (x == y)\n            return x;\n        if (dep[x] &lt; dep[y])\n            std::swap(x, y);\n        for (int i = 21; ~i; --i)\n            if (dep[f[x][i]] &gt;= dep[y])\n                x = f[x][i];\n        if (x == y)\n            return x;\n        for (int i = 21; ~i; --i)\n            if (f[x][i] != f[y][i])\n                x = f[x][i], y = f[y][i];\n        return f[x][0];\n    &#125;;\n    std::cin &gt;&gt; q;\n    for (; q--; ) &#123;\n        int op;\n        std::cin &gt;&gt; op;\n        if (op == 1) &#123;\n            std::string s;\n            std::cin &gt;&gt; s;\n            int p = 0, len = (int)s.length();\n            std::vector&lt;int&gt; id(len + 1);\n            for (int i = 1; i &lt;= len; ++i)\n                p = T[p][s[i - 1] - &#39;a&#39;], id[i] = p + 1;\n            std::sort(id.begin() + 1, id.end(), [&amp;](int x, int y) &#123; return dfn[x] &lt; dfn[y]; &#125;);\n            // for (int i = 1; i &lt;= len; ++i)\n            //     printf(&quot;%d &quot;, id[i]);\n            // puts(&quot;&quot;);\n            for (int i = 1; i &lt;= len; ++i) &#123;\n                // printf(&quot;%d %d %d\\n&quot;, i, id[i], dfn[id[i]]);\n                // assert(0);\n                add(dfn[id[i]], 1);\n                if (i != 1)\n                    add(dfn[askLCA(id[i], id[i - 1])], -1);\n            &#125;\n        &#125;\n        else &#123;\n            int x;\n            std::cin &gt;&gt; x;\n            x = tail[x] + 1;\n            std::cout &lt;&lt; ask(dfn[x] + siz[x] - 1) - ask(dfn[x] - 1) &lt;&lt; &#39;\\n&#39;;\n        &#125;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"ac-è‡ªåŠ¨æœºä¸Šçš„-dp\">AC è‡ªåŠ¨æœºä¸Šçš„ DP</h2>\n<p>é‰´äº AC è‡ªåŠ¨æœºçš„ä¼˜ç§€ç»“æ„ä¸æ€§è´¨ï¼Œå¹¶ä¸ç»å¸¸ä½œä¸ºå­—ç¬¦ä¸²åŒ¹é…å·¥å…·å‡ºç°ï¼Œå…¶ä¸€ä¸ªåº”ç”¨æ˜¯ä½œä¸º DP çš„è½½ä½“ã€‚</p>\n<h3 id=\"eg1.-l-è¯­è¨€\">eg1. L è¯­è¨€</h3>\n<p><a href=\"https://www.luogu.com.cn/problem/P2292\" class=\"uri\">https://www.luogu.com.cn/problem/P2292</a></p>\n<p>æˆ‘ä»¬æƒ³åˆ°è¦åœ¨è‡ªåŠ¨æœºä¸ŠåŒ¹é…ï¼Œä½†æ­¤æ—¶ <code>fail</code> ä½œä¸ºã€Œæ–­å¥ã€çš„å”¯ä¸€æ‰‹æ®µï¼ˆæ–­å¥çš„ä½ç½®åœ¨é“¾ä¸Šå½“å‰ç‚¹æ·±åº¦ - <code>fail</code> æ·±åº¦å¤„ï¼‰ï¼Œä¸å†ä»…å½“å¤±é…æ—¶æ‰èƒ½ç»è¿‡ã€‚æˆ‘ä»¬è€ƒè™‘æœ´ç´ çš„ DPï¼šåœ¨ç»è¿‡çš„æ¯ä¸ªçŠ¶æ€è€ƒè™‘æ–­å¥ï¼Œé‚£ä¹ˆè¿™è¦æ±‚æ–­å¥å¤„æ˜¯ä¸€ä¸ªå•è¯çš„ç»“å°¾ï¼Œé‚£ä¹ˆæ­¤æ—¶ <code>fail</code> æœ€é•¿åŒ¹é…é•¿åº¦å³å¯è¢«æ›´æ–°ã€‚æœ€åéå†æ‰€æœ‰å•è¯çš„æœ«ç»“ç‚¹ï¼Œå–æœ€å¤§ç­”æ¡ˆã€‚è¿™é‡Œçš„ <code>fail</code> å…¶å®æ˜¯ <code>fail</code> é“¾ä¸Šä»»æ„ä¸€ç‚¹ã€‚</p>\n<p>è€ƒè™‘å¤æ‚åº¦ã€‚å®¹æ˜“å‘ç°å¯¹äºæ¯ä¸€ä¸ªç‚¹æˆ‘ä»¬è·³äº†å…¶æ•´æ¡ fail é“¾ï¼Œé‚£ä¹ˆå¤æ‚åº¦å°±æ˜¯æœ€åŠ£ <span class=\"math inline\">\\(n^2\\)</span> çš„ã€‚è€ƒè™‘ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹è‡³ <span class=\"math inline\">\\(O(1)\\)</span>ã€‚</p>\n<p>é¢˜ç›®é‡Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ¡ä»¶è¿˜æ²¡æœ‰ç”¨åˆ°ï¼šå•ä¸ªå•è¯é•¿åº¦ <span class=\"math inline\">\\(\\le 20\\)</span>ï¼Œè¿™è®©æˆ‘ä»¬æƒ³åˆ°çŠ¶æ€å‹ç¼©ã€‚å¯¹äºæ¯ä¸€ä¸ªçŠ¶æ€ï¼Œè®°å½•å…¶æ–­å‡ºæ¥å•è¯çš„å¯èƒ½é•¿åº¦ã€‚</p>\n<p>æˆ‘ä»¬åœ¨ DAG ä¸Šæ¸¸èµ°çš„æ—¶å€™è®°å½•ç›®å‰å¯ä»¥æ–­çš„æ‰€æœ‰ä½ç½®ï¼Œå¦‚æœå…¶å’Œå½“å‰å¯æ–­å‡ºæ¥çš„é•¿åº¦ä¹‹äº¤ä¸ä¸ºç©ºï¼Œå°±å¯ä»¥å°†æ­¤å¤„åŠ å…¥ã€Œå¯ä»¥æ–­çš„æ‰€æœ‰ä½ç½®ã€å¹¶æ›´æ–°ç­”æ¡ˆã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxn = 2e5 + 5;\nint T[maxn][26], tot, fail[maxn], len[maxn], dep[maxn], tag[maxn];\nint ins(std::string &amp;t) &#123;\n    int p = 0;\n    for (auto i : t) &#123;\n        if (!T[p][i - &#39;a&#39;])\n            T[p][i - &#39;a&#39;] = ++tot, dep[tot] = dep[p] + 1;\n        p = T[p][i - &#39;a&#39;];\n    &#125;\n    ++tag[p];\n    return p;\n&#125;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;int&gt; tail(n + 1);\n    std::vector&lt;std::string&gt; t(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; t[i], tail[i] = ins(t[i]);\n    &#123;\n        std::queue&lt;int&gt; q;\n        for (int i = 0; i &lt; 26; ++i)\n            if (T[0][i])\n                q.push(T[0][i]);\n        for (; !q.empty(); ) &#123;\n            int u = q.front();\n            q.pop();\n            len[u] = len[fail[u]];\n            if (tag[u])\n                len[u] |= (1 &lt;&lt; dep[u]);\n            for (int i = 0; i &lt; 26; ++i)\n                if (T[u][i]) &#123;\n                    int v = T[u][i];\n                    fail[v] = T[fail[u]][i];\n                    q.push(v);\n                &#125;\n                else\n                    T[u][i] = T[fail[u]][i];\n        &#125;\n    &#125;\n    for (; m--; ) &#123;\n        std::string s;\n        std::cin &gt;&gt; s;\n        int p = 0, q = 1, res = 0;\n        for (int i = 0; i &lt; (int)s.length(); ++i) &#123;\n            p = T[p][s[i] - &#39;a&#39;], q &lt;&lt;= 1;\n            if (len[p] &amp; q)\n                q |= 1, res = i + 1;\n        &#125;\n        std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"eg2.-popcount-words\">eg2. Popcount Words</h3>\n<p><a href=\"https://codeforces.com/gym/103409/problem/H\" class=\"uri\">https://codeforces.com/gym/103409/problem/H</a></p>\n<p><del>å’‹ä¸Šå¼ºåº¦äº†å•Šã€‚</del></p>\n<p>å…ˆæŠŠæ•´ä¸ªåºåˆ—å†™å‡ºæ¥ï¼Œå³ <span class=\"math inline\">\\(w=\\texttt{01101001100101}\\cdots\\)</span>ï¼Œå°è¯•è¿›ä¸€æ­¥æ¢ç©¶å½¢å¼åŒ–çš„è§„å¾‹ï¼Œå¯ä»¥å¾—åˆ°ï¼š</p>\n<ol type=\"1\">\n<li><span class=\"math inline\">\\(w_{[0, 2^n), 0}=w_{[0, 2^{n-1}),0}+w_{[0, 2^n), 1}\\)</span>ï¼Œå…¶ä¸­ <span class=\"math inline\">\\(w_{[l, r], 0/1}\\)</span> è¡¨ç¤º <span class=\"math inline\">\\([l, r]\\)</span> å†…ï¼ŒåŸä¸² / å–åçš„å€¼ã€‚</li>\n<li>å¯¹äºä¸ä»¥ <span class=\"math inline\">\\(0\\)</span> å¼€å¤´çš„æ•´æ®µï¼Œå¯ä»¥ä»ä¸Šè¿°è§„åˆ™è½¬åŒ–ä¸º <span class=\"math inline\">\\(0\\)</span> å¼€å¤´çš„æ•´æ®µã€‚</li>\n</ol>\n<p>æ¥ç€ä¸éš¾æƒ³åˆ°ä¸€ç§ç±»ä¼¼çº¿æ®µæ ‘çš„æ–¹å¼ï¼Œå°†å¾…æ±‚çš„ <span class=\"math inline\">\\(w_{[l, r], 0}\\)</span> åˆ†åˆ° <span class=\"math inline\">\\(O(\\log V)\\)</span> ä¸ªæ•´æ®µä¸Šï¼Œé‚£ä¹ˆ <span class=\"math inline\">\\(S\\)</span> å°±å¯ä»¥è¢« <span class=\"math inline\">\\(O(n\\log V)\\)</span> ä¸ªæ•´æ®µï¼ˆä¹Ÿæ˜¯ <span class=\"math inline\">\\(\\log V\\)</span> ä¸ªæœ¬è´¨ä¸åŒæ•´æ®µï¼‰æè¿°ã€‚</p>\n<p>æˆ‘ä»¬å¯¹ <span class=\"math inline\">\\({p_m}\\)</span> å»ºç«‹ AC è‡ªåŠ¨æœºï¼Œéœ€è¦çŸ¥é“è¿™ <span class=\"math inline\">\\(\\log V\\)</span> ä¸ªæ•´æ®µåœ¨æ¯ä¸ªç‚¹ä¸Šçš„å‡ºç°æ¬¡æ•°ã€‚å¯¹äºè‡ªåŠ¨æœºä¸Šä»»æ„çŠ¶æ€ <span class=\"math inline\">\\(u\\)</span>ï¼Œè®¾ <span class=\"math inline\">\\(to_{u, n, 0/1}\\)</span> è¡¨ç¤º <span class=\"math inline\">\\(u\\)</span> ç»è¿‡ <span class=\"math inline\">\\(w_{[0, 2^n), 0/1}\\)</span> ååˆ°è¾¾çš„ç‚¹ï¼Œåˆ™å¯å€å¢ï¼ˆå˜¶ï¼Œè¿™é‡Œæ˜¯ä¸æ˜¯åº”è¯¥åè¿‡æ¥å«åˆ†æ²»å•Šï¼‰ç®€å•è§£å†³ã€‚</p>\n<p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ç”¨ <span class=\"math inline\">\\(to\\)</span> æ¥è¿›è¡Œå¿«é€Ÿæ¸¸èµ°äº†ã€‚é¡ºä¾¿æ‰“ä¸ª <span class=\"math inline\">\\(cnt\\)</span> è®°å½•ä¸€ä¸‹æ¯ä¸ª <span class=\"math inline\">\\(u\\)</span> ä½œä¸ºä¸åŒæ•´æ®µçš„å¼€å¤´è¢«ç»è¿‡çš„æ¬¡æ•°ã€‚ç„¶ååšä¸€ä¸ª DPï¼Œç±»ä¼¼äºçº¿æ®µæ ‘ä¸Š <code>pushdown</code> çš„æ“ä½œæŠŠæ‰€æœ‰æ•´æ®µä¸‹æ”¾åˆ°å•ç‚¹ä¸Šçš„å•ä¸ªå­—ç¬¦ã€‚</p>\n<p>æœ‰ä¸€è¯´ä¸€ç”¨ DP æ¥å¤„ç†è¿™ä¸ªä¸œè¥¿è¿˜æŒºéš¾æƒ³çš„ã€‚å¯èƒ½ä¹Ÿæ˜¯åŸºäºå‰é¢çš„å€å¢å§ã€‚æœ€åæ‹“æ‰‘æ’åºå°±è¡Œäº†ã€‚</p>\n<details>\n<p>å¤§å®¶æ•°ç»„ä¸€å®šè¦ç”¨ C-style array å•Šï¼Œ<code>std::vector&lt;&gt;</code> è®¡ç®—çš„æ˜¯ç”³è¯·ç©ºé—´åŒ… MLE çš„ <img src=\"/em/ll.gif\" /></p>\n<p>å¤§å®¶å¤§æ•°ç»„ä¸€å®šè¦å†…å­˜è¿ç»­è®¿é—®ä¼˜åŒ–å•Šï¼ŒTLE <span class=\"math inline\">\\(\\to\\)</span> 100ms æ³ªç›®äº† <img src=\"/em/ll.gif\" /></p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxn = 5e5 + 5;\nlong long sum[maxn], f[2][30][maxn];\nint cnt[2][30][maxn], to[2][30][maxn];\nint T[maxn][2], tot, fail[maxn], deg[maxn];\nint ins(std::string &amp;t) &#123;\n    int p = 0;\n    for (auto i : t) &#123;\n        if (!T[p][i - &#39;0&#39;])\n            T[p][i - &#39;0&#39;] = ++tot;\n        p = T[p][i - &#39;0&#39;];\n    &#125;\n    return p;\n&#125;\nvoid ask(std::vector&lt;std::pair&lt;int, int&gt; &gt; &amp;s, int ql, int qr, int l = 0, int r = (1 &lt;&lt; 30) - 1, int len = 30, int v = 0) &#123;\n    if (ql &lt;= l &amp;&amp; r &lt;= qr) &#123;\n        s.emplace_back(len, v);\n        return;\n    &#125;\n    int mid = l + (r - l) / 2;\n    if (ql &lt;= mid)\n        ask(s, ql, qr, l, mid, len - 1, v);\n    if (qr &gt; mid)\n        ask(s, ql, qr, mid + 1, r, len - 1, v ^ 1);\n    return;\n&#125;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;std::pair&lt;int, int&gt; &gt; s;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        int l, r;\n        std::cin &gt;&gt; l &gt;&gt; r;\n        ask(s, l, r);\n    &#125;\n    std::vector&lt;int&gt; tail(m + 1);\n    for (int i = 1; i &lt;= m; ++i) &#123;\n        std::string t;\n        std::cin &gt;&gt; t;\n        tail[i] = ins(t);\n    &#125;\n    &#123;\n        std::queue&lt;int&gt; q;\n        for (int i = 0; i &lt; 2; ++i)\n            if (T[0][i])\n                q.push(T[0][i]);\n        for (; !q.empty(); ) &#123;\n            int u = q.front();\n            q.pop();\n            for (int i = 0; i &lt; 2; ++i)\n                if (T[u][i]) &#123;\n                    int v = T[u][i];\n                    fail[v] = T[fail[u]][i], ++deg[T[fail[u]][i]];\n                    q.push(v);\n                &#125;\n                else\n                    T[u][i] = T[fail[u]][i];\n        &#125;\n    &#125;\n    for (int i = 0; i &lt;= tot; ++i)\n        to[0][0][i] = T[i][0], to[1][0][i] = T[i][1];\n    for (int j = 1; j &lt; 30; ++j)\n        for (int i = 0; i &lt;= tot; ++i) &#123;\n            to[0][j][i] = to[1][j - 1][to[0][j - 1][i]];\n            to[1][j][i] = to[0][j - 1][to[1][j - 1][i]];\n        &#125;\n    &#123;\n        int p = 0;\n        for (auto [n, i] : s) &#123;\n            // printf(&quot;# %d %d\\n&quot;, n, i);\n            ++cnt[i][n][p], p = to[i][n][p];\n        &#125;\n    &#125;\n    for (int j = 29; ~j; --j)\n        for (int i = 0; i &lt;= tot; ++i) &#123;\n            if (j != 29) &#123;\n                f[0][j][i] += f[0][j + 1][i];\n                f[1][j][i] += f[1][j + 1][i];\n                f[0][j][to[1][j][i]] += f[1][j + 1][i];\n                f[1][j][to[0][j][i]] += f[0][j + 1][i];\n            &#125;\n            f[1][j][i] += cnt[1][j][i];\n            f[0][j][i] += cnt[0][j][i];\n        &#125;\n    for (int i = 0; i &lt;= tot; ++i) &#123;\n        sum[T[i][0]] += f[0][0][i], sum[T[i][1]] += f[1][0][i];\n        // printf(&quot;%d %d\\n&quot;, f[i][0][0], f[i][0][1]);\n    &#125;\n    &#123;\n        std::queue&lt;int&gt; q;\n        for (int i = 0; i &lt;= tot; ++i)\n            if (!deg[i])\n                q.push(i);\n        for (; !q.empty(); ) &#123;\n            int u = q.front();\n            q.pop();\n            sum[fail[u]] += sum[u];\n            if (!--deg[fail[u]])\n                q.push(fail[u]);\n        &#125;\n    &#125;\n    for (int i = 1; i &lt;= m; ++i)\n        std::cout &lt;&lt; sum[tail[i]] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"eg3.-legen\">eg3. Legenâ€¦</h3>\n<p><a href=\"https://codeforces.com/problemset/problem/696/D\" class=\"uri\">https://codeforces.com/problemset/problem/696/D</a></p>\n<p>å…ˆåœ¨ fail æ ‘ä¸ŠæŠŠæ¯ä¸ªçŠ¶æ€çš„å®é™…ä»·å€¼è®¡ç®—å‡ºæ¥ã€‚æˆ‘ä»¬å‘ç°åŒ¹é…ä¸²æ˜¯æœªçŸ¥çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦ä¸»åŠ¨å†³å®šæ¸¸èµ°è·¯å¾„ã€‚æ³¨æ„åˆ° <span class=\"math inline\">\\(l=10^{14}\\)</span>ï¼Œè€ƒè™‘çŸ©é˜µã€‚</p>\n<p>ä»¤ <span class=\"math inline\">\\(f_{u, i}\\)</span> è¡¨ç¤ºåœ¨ <span class=\"math inline\">\\(u\\)</span> çŠ¶æ€æ—¶å·²ç»èµ°äº† <span class=\"math inline\">\\(i\\)</span> æ­¥ï¼Œå¯ä»¥å¾—åˆ°çš„æœ€å¤§ä»·å€¼ã€‚é‚£ä¹ˆæ˜¾ç„¶æœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\nf_{v,i+1}=f_{u,i}+s_v.\n\\]</span></p>\n<p>å…¶ä¸­ <span class=\"math inline\">\\(v\\)</span> æ˜¯è‡ªåŠ¨æœºä¸Š <span class=\"math inline\">\\(u\\)</span> çš„ä»»æ„å‡ºè¾¹ã€‚å›¾çš„å¤§å°ä¸º <span class=\"math inline\">\\(200\\)</span>ï¼Œå¯ä»¥æ”¾åˆ° <span class=\"math inline\">\\(+\\max\\)</span> çŸ©é˜µé‡ŒåŠ é€Ÿè½¬ç§»ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxn = 2e5 + 5;\nconst long long inf = 1e18;\nint fail[maxn], T[maxn][26], tot;\nint ins(std::string s) &#123;\n    int p = 0;\n    for (auto i : s) &#123;\n        if (!T[p][i - &#39;a&#39;])\n            T[p][i - &#39;a&#39;] = ++tot;\n        p = T[p][i - &#39;a&#39;];\n    &#125;\n    return p;\n&#125;\nstruct matrix &#123;\n    int n, m;\n    std::vector&lt;std::vector&lt;long long&gt; &gt; a;\n    matrix(int n1, int m1, long long v = -inf, bool op = 0): n(n1), m(m1), a(n + 1, std::vector&lt;long long&gt; (m + 1, v)) &#123;\n        if (op)\n            for (int i = 0; i &lt;= n; ++i)\n                a[i][i] = 0;\n        return;\n    &#125;\n    std::vector&lt;long long&gt; &amp;operator[] (int i) &#123;\n        return a[i];\n    &#125;\n    matrix operator* (matrix &amp;q) const &#123;\n        matrix res(n, q.m);\n        for (int k = 0; k &lt;= m; ++k)\n            for (int i = 0; i &lt;= n; ++i)\n                for (int j = 0; j &lt;= q.m; ++j)\n                    res[i][j] = std::max(res[i][j], a[i][k] + q[k][j]);\n        return res;\n    &#125;\n    matrix&amp; operator*= (matrix q) &#123;\n        return *this = *this * q;\n    &#125;\n    matrix operator^ (long long q) &#123;\n        matrix res(n, n, -inf, 1), x(*this);\n        for (; q; q &gt;&gt;= 1, x *= x)\n            if (q &amp; 1)\n                res *= x;\n        return res;\n    &#125;\n&#125;;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    long long m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;long long&gt; a(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    std::vector&lt;int&gt; tail(n + 1);\n    std::vector&lt;std::string&gt; t(n + 1);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; t[i];\n        tail[i] = ins(t[i]);\n    &#125;\n    std::vector&lt;long long&gt; s(tot + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        s[tail[i]] += a[i];\n    &#123;\n        std::queue&lt;int&gt; q;\n        for (int i = 0; i &lt; 26; ++i)\n            if (T[0][i])\n                q.push(T[0][i]); \n        for (; !q.empty(); ) &#123;\n            int u = q.front();\n            q.pop();\n            for (int i = 0; i &lt; 26; ++i)\n                if (T[u][i]) &#123;\n                    int v = T[u][i];\n                    fail[v] = T[fail[u]][i], s[v] += s[fail[v]];\n                    q.push(v);\n                &#125;\n                else\n                    T[u][i] = T[fail[u]][i];\n        &#125;\n    &#125;\n    matrix f(0, tot), op(tot, tot);\n    f[0][0] = 0;\n    for (int i = 0; i &lt;= tot; ++i)\n        for (int j = 0; j &lt; 26; ++j)\n            op[i][T[i][j]] = s[T[i][j]];\n    f *= (op * m);\n    std::cout &lt;&lt; *std::max_element(f[0].begin(), f[0].end()) &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;\n</code></pre>\n</details>\n<hr />\n<h3 id=\"eg4.-you-are-given-some-strings\">eg4. You Are Given Some Stringsâ€¦</h3>\n<p>goto <a href=\"/20250121/#%E4%B8%80%E4%B8%AA%E6%A8%A1%E6%9D%BFcf1202e-you-are-given-some-strings...\">link</a>.</p>\n",
            "tags": [
                "DP",
                "å­—ç¬¦ä¸²",
                "AC è‡ªåŠ¨æœº"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20241104/",
            "url": "https://xsc062.netlify.app/20241104/",
            "title": "æ‚é¢˜é€‰è°ˆ",
            "date_published": "2024-11-04T01:05:07.000Z",
            "content_html": "<p>å“­ã„ãŸé–ƒå…‰ãŒç›®ã«åˆºã•ã‚‹ / ãŠåˆ¥ã‹ã‚Œã®é˜ãŒé³´ã‚‹ / ç¥ãŒæˆã—ãŸæ­´å²ã® / çµã¶ç­”ãˆã¯ç ‚ã®å‘³ãŒã™ã‚‹</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"a.-ç¾å‘³ã—ã„ç¾å‘³ã—ã„ãƒãƒ³ãƒãƒ¼ã‚°\">A. ç¾å‘³ã—ã„ç¾å‘³ã—ã„ãƒãƒ³ãƒãƒ¼ã‚°</h2>\n<p><a href=\"https://vjudge.net/contest/669299#problem/A\" class=\"uri\">https://vjudge.net/contest/669299#problem/A</a></p>\n<p>æœ‰ä¸€ä¸ªå¾ˆç¥å¥‡çš„éšæœºåŒ–åšæ³•ï¼šæˆ‘ä»¬ä»å‰å¾€åä¸²ç­¾å­ï¼Œæœ€å¼€å§‹ç­¾å­æ•°ä¸º <span class=\"math inline\">\\(0\\)</span>ï¼Œå¦‚æœå½“å‰ä»»ä½•ä¸€ä¸ªç­¾å­éƒ½æ²¡åŠæ³•å†ä¸²è¿™ä¸€ä¸ªå°±æ–°å¢ç­¾å­ã€‚å¦‚æœæ²¡æœ‰ç­¾å­å¯ä»¥ç”¨äº†ï¼Œå°±è¯´æ˜è¿™å—è‚‰ä¸åˆæ³•ï¼ŒæŒªåˆ°å‰ <span class=\"math inline\">\\(k\\)</span> å—ä¸­çš„éšæœºä½ç½®ä½¿å…¶ä¼˜å…ˆè¢«é€‰æ‹©ã€‚</p>\n<p>ä½ ä¼šå‘ç°è¿™ä¸ªåšæ³•è·‘å¾—å¾ˆå¿«ï¼Œspdarkle è¯´å› ä¸º <span class=\"math inline\">\\(K\\)</span> å¾ˆå°è¿˜ä¿è¯æœ‰è§£ï¼Œæ‰€ä»¥æœŸæœ›æ¬¡æ•°æ˜¯éå¸¸å¯¹çš„ã€‚æˆ‘å¤ªèœäº†ä»–ä¹Ÿæ²¡ç»†è¯´æ‰€ä»¥å¼€æ‘†ã€‚</p>\n<p>ç”±äºç¥ç§˜åŸå› ï¼Œæˆ‘çš„ <code>std::mt19937::operator()</code> å¦‚æœå¤–è¾¹ä¸å¥—ä¸€å±‚ abs å°±ä¼šèµ·é£ <img src=\"/em/yun.gif\" alt=\"æ™•\" /></p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    struct _ &#123; int l, r, u, d; &#125;;\n    std::vector&lt;_&gt; a(n + 1), b(k + 1);\n    std::mt19937 rand(time(nullptr));\n    auto random = [&amp;](int l, int r) &#123;\n        return l + std::abs((int)rand()) % (r - l + 1);\n    &#125;;\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i].l &gt;&gt; a[i].u &gt;&gt; a[i].r &gt;&gt; a[i].d;\n    for (;;) &#123;\n        std::copy(a.begin() + 1, a.begin() + k + 1, b.begin() + 1);\n        for (int i = k + 1; i &lt;= n; ++i) &#123;\n            for (int j = 1; j &lt;= k; ++j) &#123;\n                if (std::min(b[j].r, a[i].r) &gt;= std::max(b[j].l, a[i].l) &amp;&amp; std::min(b[j].d, a[i].d) &gt;= std::max(b[j].u, a[i].u)) &#123;\n                    b[j].l = std::max(b[j].l, a[i].l);\n                    b[j].r = std::min(b[j].r, a[i].r);\n                    b[j].u = std::max(b[j].u, a[i].u);\n                    b[j].d = std::min(b[j].d, a[i].d);\n                    goto issol;\n                &#125;\n            &#125;\n            std::swap(a[i], a[random(1, i)]);\n            goto nosol;\n        issol: ;\n        &#125;\n        for (int i = 1; i &lt;= k; ++i)\n            std::cout &lt;&lt; b[i].l &lt;&lt; &#39; &#39; &lt;&lt; b[i].u &lt;&lt; &#39;\\n&#39;;\n        break;\n    nosol: ;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"b.-shik-and-travel\">B. Shik and Travel</h2>\n<p><a href=\"https://vjudge.net/contest/669299#problem/B\" class=\"uri\">https://vjudge.net/contest/669299#problem/B</a></p>\n<p>æœ€å°åŒ–æœ€å¤§ï¼Œæ˜¾ç„¶éœ€è¦äºŒåˆ†ç­”æ¡ˆï¼Œcheck æ‰“ä¸ª DPã€‚å…·ä½“æ€ä¹ˆ DP å‘¢ï¼Ÿé¦–å…ˆè€ƒè™‘æš´åŠ›ï¼Œè®¾ <span class=\"math inline\">\\(f_{u, a, b}\\)</span> è¡¨ç¤ºåœ¨å½“å‰ <span class=\"math inline\">\\(mid\\)</span> çš„é™åˆ¶ä¸‹ï¼Œä» <span class=\"math inline\">\\(u\\)</span> å‡ºå‘åˆ°ç¬¬ä¸€ä¸ªå¶å­è·ç¦»ä¸º <span class=\"math inline\">\\(a\\)</span>ï¼Œæœ€åä¸€ä¸ªè·ç¦»ä¸º <span class=\"math inline\">\\(b\\)</span> çš„å¯è¡Œæ€§ã€‚é‚£ä¹ˆæœ‰ <span class=\"math inline\">\\(f_{u,a,b} = (f_{l,a,i}\\land f_{r,j,b})\\lor (f_{r,a,i}\\land f_{l,j,b})\\)</span>ã€‚</p>\n<p>å…ˆä¸è¯´è½¬ç§»ï¼ŒçŠ¶æ€æ•°å·²ç»éš¾ä»¥æ¥å—ã€‚æ‰€ä»¥æˆ‘ä»¬ä»çŠ¶æ€æ•°å…¥æ‰‹ï¼Œæ˜¾ç„¶å¦‚æœå­˜åœ¨ä¸€ä¸ª <span class=\"math inline\">\\(a&#39;\\le a\\)</span> å’Œ <span class=\"math inline\">\\(b&#39;\\le b\\)</span>ï¼Œé‚£ä¹ˆ <span class=\"math inline\">\\((a&#39;,b&#39;)\\)</span> å°±æ˜¯æ— ç”¨çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰æœ‰ç”¨çš„ <span class=\"math inline\">\\((a, b)\\)</span> æŒ‰ <span class=\"math inline\">\\(a\\)</span> ä»å°åˆ°å¤§æ’åºï¼Œ<span class=\"math inline\">\\(b\\)</span> åº”è¯¥æ˜¯å•è°ƒé€’å‡çš„ï¼›è€ƒè™‘è¿™ä¸ªæŠ½è±¡çš„è¿‡ç¨‹ï¼Œç›¸å½“äºä»å¤´åˆ°å°¾éå†ä¸€ä¸²çŠ¶æ€ï¼Œåœ¨è·¯ä¸Šç¢°åˆ°çš„æ‰€æœ‰è¾ƒå¤§çš„ <span class=\"math inline\">\\(b\\)</span> éƒ½ä¼šè¢«å½“åœºä¸¢å¼ƒã€‚</p>\n<p>æ„Ÿæ€§æ€è€ƒå¯ä»¥å‘ç°<mark>å½“æˆ‘ä»¬è¯•å›¾è®© <span class=\"math inline\">\\(b\\)</span> æœ€å°çš„æ—¶å€™ï¼Œè¿™ä¸ªçŠ¶æ€æœ€æœ‰ç”¨ï¼ˆå³æœ€ä¸å¯èƒ½è¢«ä¸¢å¼ƒï¼‰</mark>ã€‚å¯¹äºä¸€ä¸ª <span class=\"math inline\">\\(f_{l,a,i}\\)</span>ï¼Œæˆ‘ä»¬æ‰¾åˆ°èƒ½å¤Ÿè½¬ç§»çš„ <span class=\"math inline\">\\(f_{r,j,b_{\\min}}\\)</span> æ¥è½¬ç§»ã€‚æ­£ç¡®æ€§å¾ˆå¥½è¯æ˜ï¼Œæˆ‘ä»¬çš„ check åªè¦æ±‚åœ¨æ ¹èŠ‚ç‚¹ä¸Šå­˜åœ¨ä»»æ„åˆæ³•çŠ¶æ€ï¼Œé‚£åªéœ€è¦è®©æœ€ä¸å¯èƒ½è¢«ä¸¢å¼ƒçš„ä¸è¢«ä¸¢å¼ƒå³å¯ï¼Œæ›´å¯èƒ½è¢«ä¸¢å¼ƒçš„çŠ¶æ€æ˜¯å¦è¢«ä¸¢å¼ƒå°±ä¸ä¼šäº§ç”Ÿå½±å“äº†ã€‚</p>\n<p>ä¼˜åŒ–åçš„çŠ¶æ€æ•°åœ¨ <span class=\"math inline\">\\(u\\)</span> ä¸Šåªä¼šå¢åŠ  <span class=\"math inline\">\\(\\min(|a_l|,|b_r|)+\\min(|a_r|,|b_l|)\\)</span>ï¼Œå³ä¸¤ä¸ªå„¿å­ä¸Šçš„çŠ¶æ€æ•°è¾ƒå°è€…ï¼Œå‚è€ƒ DSU on treeï¼Œæ˜¯ <span class=\"math inline\">\\(O(n\\log)\\)</span> çš„ã€‚åŠ ä¸Šå¯¹çŠ¶æ€æ’åºçš„æ•°æ®ç»“æ„ï¼Œå¤æ‚åº¦ <span class=\"math inline\">\\(O(n\\log^2 n\\log V)\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long long inf = 1e18;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;std::vector&lt;std::pair&lt;int, int&gt; &gt; &gt; g(n + 1);\n    for (int i = 2, x, w; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; x &gt;&gt; w;\n        g[x].emplace_back(i, w);\n    &#125;\n    long long res = -1;\n    for (long long l = 0, r = inf, mid; l &lt;= r; ) &#123;\n        mid = (l + r) &gt;&gt; 1;\n        if ([&amp;](void) -&gt; bool &#123;\n            std::vector&lt;std::vector&lt;std::pair&lt;long long, long&gt; &gt; &gt; f(n + 1);\n            std::function&lt;void(int)&gt; DFS = [&amp;](int x) &#123;\n                if (g[x].empty()) &#123;\n                    f[x].emplace_back(0, 0);\n                    return;\n                &#125;\n                long long lim = mid;\n                for (auto [i, w] : g[x])\n                    DFS(i), lim -= w;\n                std::vector&lt;std::pair&lt;long long, long long&gt; &gt; t;\n                for (int i = 0; i &lt; 2; ++i) &#123;\n                    int j = 0;\n                    auto l = g[x][0], r = g[x][1];\n                    for (auto [a, b] : f[l.first]) &#123;\n                        for (; j + 1 &lt; (int)f[r.first].size() &amp;&amp; f[r.first][j + 1].first + b &lt;= lim; ++j);\n                        if (j &lt; (int)f[r.first].size() &amp;&amp; f[r.first][j].first + b &lt;= lim)\n                            t.emplace_back(a + l.second, f[r.first][j].second + r.second);\n                    &#125;\n                    std::swap(g[x][0], g[x][1]);\n                &#125;\n                std::sort(t.begin(), t.end());\n                for (auto [a, b] : t)\n                    if (f[x].empty() || f[x].back().second &gt; b)\n                        f[x].emplace_back(a, b);\n                return;\n            &#125;;\n            DFS(1);\n            return !f[1].empty();\n        &#125; ())\n            res = mid, r = mid - 1;\n        else \n            l = mid + 1;\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"d.-candy-piles\">D. Candy Piles</h2>\n<p><a href=\"https://vjudge.net/contest/669299#problem/D\" class=\"uri\">https://vjudge.net/contest/669299#problem/D</a></p>\n<p>ä¸éš¾å‘ç°æˆ‘ä»¬å¯ä»¥æŠŠé¢˜æ„è½¬åŒ–ä¸ºï¼ŒæŠŠæ‰€æœ‰åˆ—ä»å¤§åˆ°å°æ’åˆ—ï¼Œæ¯æ¬¡å¯ä»¥é€‰æ‹©åˆ æ‰æœ€å·¦è¾¹ä¸€åˆ—æˆ–æœ€ä¸‹è¾¹ä¸€è¡Œï¼Œåˆ ç©ºè€…èƒœã€‚</p>\n<p>æŠŠè¯¥æŸ±çŠ¶å›¾è½¬åŒ–ä¸ºç½‘æ ¼å›¾ï¼Œå®šä¹‰è¾¹ç•Œä¸ºèƒœåˆ©ç‚¹ï¼Œå¯¹äºéè¾¹ç•Œä¸Šçš„ç‚¹ï¼Œå…¶ä¸€å®šå¯ä»¥å¾€å³èµ°ã€å¾€ä¸Šèµ°ã€‚è‹¥ä¸€ä¸ªç‚¹ä¸Šæ–¹ã€å³ä¾§ç‚¹å‡ä¸ºèƒœåˆ©ç‚¹ï¼Œæ­¤ç‚¹ä¸ºå¤±è´¥ç‚¹ï¼›å¦åˆ™ï¼Œæ­¤ç‚¹ä¸ºèƒœåˆ©ç‚¹ã€‚</p>\n",
            "tags": [
                "DP",
                "éšæœºåŒ–"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20240906/",
            "url": "https://xsc062.netlify.app/20240906/",
            "title": "æ‚é¢˜é€‰è°ˆï¼šDP æ‚é¢˜",
            "date_published": "2024-09-06T07:30:38.000Z",
            "content_html": "<p>ç°åœ¨æ˜¯ 10 é¢˜ã€‚è™½ç„¶çœ‹ç€å¾ˆæ‰ä»·ï¼Œä½†æ˜¯å†™å¤Ÿäº† 10 å°±æ”¹æˆ 20 é¢˜ã€‚ä»¥æ­¤ç±»æ¨ï¼Œå…å¾—æˆ‘æ‘†çƒ‚ï¼ˆï¼‰</p>\n<p>è‡ªç”¨å‘ï¼Œä¸å†™å¤ªè¯¦ç»†ï¼ŒæŠŠç ´é¢˜ç‚¹å†™å‡ºæ¥å°±å·®ä¸å¤šäº†ã€‚å“¦å“¦è¿™é‡Œçš„ç ´é¢˜æ˜¯åŠ¨è¯ä¸æ˜¯åè¯ã€‚</p>\n<span id=\"more\"></span>\n<hr />\n<h2 id=\"å­—ç¬¦åˆå¹¶\">1. å­—ç¬¦åˆå¹¶</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/P3736\" class=\"uri\">https://www.luogu.com.cn/problem/P3736</a></p>\n<blockquote>\n<p>ç»™å®šé•¿åº¦ä¸º <span class=\"math inline\">\\(n\\)</span> çš„ <span class=\"math inline\">\\(01\\)</span> ä¸²å’Œ <span class=\"math inline\">\\(2^k\\)</span> æ¡è§„åˆ™ï¼Œç¬¬ <span class=\"math inline\">\\(i\\)</span> æ¡è§„åˆ™å½¢å¦‚ï¼š</p>\n<ul>\n<li>å¯¹äºåºåˆ—ä¸­çš„ <span class=\"math inline\">\\(k\\)</span> ä½äºŒè¿›åˆ¶æ•° <span class=\"math inline\">\\(i\\)</span>ï¼Œå¯ä»¥å°†å®ƒåˆå¹¶ä¸º <span class=\"math inline\">\\(c(c\\in\\{0,1\\})\\)</span>ï¼Œå¹¶äº§ç”Ÿ <span class=\"math inline\">\\(v\\)</span> çš„ä»·å€¼ã€‚</li>\n</ul>\n<p>è¿›è¡Œä»»æ„æ¬¡åˆå¹¶ï¼Œæ±‚å‡ºèƒ½å–å¾—çš„æœ€å¤§æ€»ä»·å€¼ã€‚<span class=\"math inline\">\\(n\\le 300,k\\le 8\\)</span>ã€‚</p>\n</blockquote>\n<p><strong>çŠ¶å‹</strong>ï¼Œ<strong>åŒºé—´ DP</strong>ã€‚</p>\n<p>æ³¨æ„åˆ° <span class=\"math inline\">\\(k\\)</span> åªæœ‰ <span class=\"math inline\">\\(8\\)</span>ï¼Œç‹¬ç‰¹çš„è¾“å…¥æ–¹å¼ä¹Ÿå¼•å¯¼æˆ‘ä»¬æ³¨æ„åˆ°çŠ¶æ€æ•°ä¸º <span class=\"math inline\">\\(10^2\\)</span> çº§åˆ«ã€‚åˆå¹¶çš„èƒŒæ™¯åˆè®©æˆ‘ä»¬æœ¬èƒ½æƒ³åˆ°åŒºé—´ DPï¼Œæ‰€ä»¥åˆšå¥½ç›²çŒœè¿™é¢˜æ˜¯ä¸ª <span class=\"math inline\">\\(O(2^k\\times n^2)\\)</span> çš„åŒºé—´çŠ¶å‹ DPã€‚</p>\n<ul>\n<li><p>ç„¶åæˆ‘è§‰å¾—æœ€ç¥çš„ä¸€ä¸ªåœ°æ–¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæœ€åçš„ç­”æ¡ˆä¸€å®šæ˜¯ä¸€ä¸ªé•¿åº¦å°äº <span class=\"math inline\">\\(k\\)</span> çš„ä¸²ï¼Œ<mark>æ¯ä½å±•å¼€è¿˜åŸï¼Œå¯ä»¥çŸ¥é“ï¼Œæ¯ä¸ªåˆå¹¶æ“ä½œé€‰å–çš„åŒºé—´å¯èƒ½åŒ…å«ä½†ä¸ç›¸äº¤ã€‚</mark></p>\n<p>çœ‹èµ·æ¥å¾ˆè ¢å¾ˆæ˜¾ç„¶ï¼Œä½†è¿™æ˜¯æˆ‘ä»¬ <span class=\"math inline\">\\(n^2\\)</span> åŒºé—´ DP çš„åŸºç¡€å•Šï¼ˆï¼ˆï¼ˆ</p></li>\n</ul>\n<p>ç„¶åæˆ‘ä»¬åŒºé—´ DP å¥—è·¯ï¼Œæšä¸¾å¯¹äº <span class=\"math inline\">\\([l,r]\\)</span> æœ€å·¦è¾¹ä¸€ä½ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹å¤§åŠ›è½¬ç§»äº†ã€‚</p>\n<p>ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œè¿™ä¸€ä½åŸæœ¬çš„æ ·å­æœ‰ç‚¹å¤šï¼Œå¯ä»¥æ˜¯ä»»ä½•ä¸€ä¸ªé•¿åº¦ä¸º <span class=\"math inline\">\\(1 + d\\times (k-1)\\)</span> çš„æ•°ï¼Œæ‰€ä»¥åªèƒ½å†æ¥ä¸€å±‚ <span class=\"math inline\">\\(\\dfrac nk\\)</span> çš„æšä¸¾ï¼Œæé™æƒ…å†µæ˜¯ä¸ªæœ‰ç‚¹éš¾ç»·çš„ 3e9ï¼Œä½œä¸ºæ­£è§£åªèƒ½è¯´è¿™ä¸ªæ•°æ®èŒƒå›´çš„æç¤ºæ€§æœ‰ç‚¹ä»¤äººéš¾è¯„äº†ã€‚</p>\n<p>å®ç°ç€å®ç°ç€æŠŠè‡ªå·±æ•´æ‡µäº†ï¼š<code>00000</code> å’Œ <code>0</code> å‹å‡ºæ¥éƒ½æ˜¯ <code>0</code>ï¼Œä½†äºŒè€…ä»£è¡¨çš„å«ä¹‰æ˜¾ç„¶ä¸åŒï¼Œåˆæ— æ³•ç®€å•åŒºåˆ«ã€‚ä½†å…¶å®<mark>é•¿åº¦ä¸º <span class=\"math inline\">\\(1+d\\times (k-1)\\)</span> çš„åŒºé—´å’Œé•¿åº¦ä¸º <span class=\"math inline\">\\(d\\)</span> çš„æœ€ç»ˆç»“æœæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬è®¾è®¡çš„åŒ…å«äº†åŒºé—´ä½œå³ç«¯ç‚¹çš„çŠ¶æ€ä¸­ï¼Œå‹å‡ºæ¥çš„å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„é‚£ä¸ªã€‚</mark></p>\n<details>\n<p>è¿™é‡Œçš„å®ç°æ¯”<strong>æ‰€æœ‰</strong>æˆ‘æ‰¾åˆ°çš„é¢˜è§£éƒ½æ›´åƒäººæ‰“å‡ºæ¥çš„ã€‚å¯¼è‡´æˆ‘æƒ³å¯¹æ¯”ç–—æ³•éƒ½æ‰¾ä¸åˆ°åˆé€‚çš„ä»£ç  <img src=\"/em/lh.gif\" /></p>\n<p>æ¢è¨€ä¹‹ï¼Œè¿™æœ€åƒæ˜¯ä¸€ä»½é€šå¸¸çš„åŒºé—´ DP ä»£ç ï¼Œä¸å­˜åœ¨å…¶ä»–é¢˜è§£ä¸­ä¹±ä¸ƒå…«ç³Ÿçš„å¡«è¡¨å•Šç›¸äº’å½±å“å•Šä¹‹ç±»çš„æ¶å¿ƒ featureã€‚</p>\n<p>sto rybp orz</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxn = 305;\nconst int maxm = (1 &lt;&lt; 8) + 5;\nchar a[maxn];\nint c[maxm], w[maxm];\nlong long f[maxn][maxn][maxm];\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n    std::cout.tie(nullptr);\n#else\n    freopen(&quot;in.in&quot;, &quot;r&quot;, stdin);\n    freopen(&quot;out.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    int siz = (1 &lt;&lt; k), si = (1 &lt;&lt; (k - 1));\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    for (int i = 0; i &lt; siz; ++i)\n        std::cin &gt;&gt; c[i] &gt;&gt; w[i];\n    memset(f, -0x3f, sizeof(f));\n    for (int l = 1; l &lt; k; ++l)\n        for (int i = 1; i &lt;= n - l + 1; ++i) &#123;\n            int j = i + l - 1, now = 0;\n            for (int p = i; p &lt;= j; ++p)\n                now = now * 2 + a[p] - &#39;0&#39;;\n            f[i][j][now] = 0;\n        &#125;\n    for (int i = 1; i &lt;= n - k + 1; ++i) &#123;\n        int now = 0;\n        for (int j = i; j &lt;= i + k - 1; ++j)\n            now = now * 2 + a[j] - &#39;0&#39;;\n        f[i][i + k - 1][c[now]] = w[now];\n    &#125;\n    for (int l = k + 1; l &lt;= n; ++l)\n        for (int i = 1; i &lt;= n - l + 1; ++i) &#123;\n            int j = i + l - 1;\n            for (int p = i; p &lt; j; p += k - 1) &#123;\n                for (int q = 0; q &lt; si; ++q)\n                    if (!(q &gt;&gt; ((l - 1) % (k - 1) + 1)))\n                        f[i][j][q] = std::max(f[i][j][q], f[i][p][q &gt;&gt; ((l - 1) % (k - 1))] + f[p + 1][j][q &amp; ((1 &lt;&lt; ((l - 1) % (k - 1))) - 1)]);\n                if (l % (k - 1) == 1 || k == 2)\n                    for (int q = 0; q &lt; siz; ++q)\n                        f[i][j][c[q]] = std::max(f[i][j][c[q]], f[i][p][q &gt;&gt; (k - 1)] + f[p + 1][j][q &amp; ((1 &lt;&lt; (k - 1)) - 1)] + w[q]);\n            &#125;\n        &#125;\n    std::cout &lt;&lt; *std::max_element(f[1][n], f[1][n] + si) &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<p>å…¶å®ä¸€å¼€å§‹æŒºæ‹…å¿ƒä¼šä¸ä¼šå› ä¸ºå†™åšå®¢å½±å“åšé¢˜æ—¶é—´ä¹‹ç±»çš„ã€‚</p>\n<p>ç›´åˆ°å‘ç°æˆ‘å¯ä»¥çœ‹çŸ¥ä¹çœ‹ä¸€ä¸ªä¸Šåˆç„¶åä»£ç åŠ¨éƒ½ä¸åŠ¨ä¸€ä¸‹ <img src=\"/em/lh.gif\" /></p>\n<hr />\n<h2 id=\"mod-mod-mod\">2. Mod Mod Mod</h2>\n<p><a href=\"https://codeforces.com/contest/889/problem/E\" class=\"uri\">https://codeforces.com/contest/889/problem/E</a></p>\n<blockquote>\n<p>ç»™å®š <span class=\"math inline\">\\(a_{1\\sim n}\\)</span>ï¼Œå¯¹äºæ‰€æœ‰éè´Ÿæ•´æ•° <span class=\"math inline\">\\(x\\)</span> å®šä¹‰ <span class=\"math inline\">\\(f(x,n)=x\\bmod a_n\\)</span>ï¼Œ<span class=\"math inline\">\\(f(x,i)=x\\bmod a_i+f(x\\bmod a_i,i+1)\\)</span>ã€‚</p>\n<p>æ±‚ <span class=\"math inline\">\\(f(x,1)\\)</span> æœ€å¤§å€¼ã€‚<span class=\"math inline\">\\(n\\le 2\\times 10^5\\)</span>ã€‚</p>\n</blockquote>\n<p><strong>æŠ€å·§ / ç‰¹æ®Šæ€§è´¨ç±» DP</strong>ã€‚</p>\n<p>å°ç¥é¢˜ã€‚æ³¨æ„åˆ°é¢˜æ„å¯ä»¥è½¬åŒ–ä¸ºï¼Œæ‰¾åˆ°ä¸€ä¸ª <span class=\"math inline\">\\(x\\)</span>ï¼Œæœ€å¤§åŒ–ï¼š</p>\n<p><span class=\"math display\">\\[\nx\\bmod a_1 + x\\bmod a_1\\bmod a_2 + \\cdots + x\\bmod a_1\\bmod a_2\\bmod\\cdots\\bmod a_n.\n\\]</span></p>\n<p>ç®€ç§° <span class=\"math inline\">\\(x\\bmod a_1\\bmod a_2\\bmod \\cdots\\bmod a_i\\)</span> çš„å€¼ä¸º <span class=\"math inline\">\\(f_i\\)</span>ã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¸éš¾æ³¨æ„åˆ°ï¼Œ<span class=\"math inline\">\\(f_i\\)</span> è‚¯å®šæ˜¯<mark>å•è°ƒä¸å‡</mark>çš„ã€‚å½¢è±¡åŒ–åœ°ï¼Œæ•´ä¸ª <span class=\"math inline\">\\(f\\)</span> åºåˆ—è‚¯å®šæ˜¯ç”±è‹¥å¹²ä¸ªå•è°ƒä¸‹é™çš„æ®µç»„æˆçš„ã€‚å¹¶ä¸”ï¼Œ<mark>å¿…å®šå­˜åœ¨è‡³å°‘ä¸€ä¸ª <span class=\"math inline\">\\(i\\)</span>ï¼Œä½¿å¾— <span class=\"math inline\">\\(f_i = a_i-1\\)</span>ï¼Œå¦åˆ™å¯ä»¥å°†æ‰€æœ‰ <span class=\"math inline\">\\(f_i\\gets f_i+1\\)</span>ï¼ŒåŒæ—¶ <span class=\"math inline\">\\(\\sum f\\gets (\\sum f) + n\\)</span></mark>ã€‚</p>\n<p>è¿™å¯ç¤ºæˆ‘ä»¬å…³æ³¨ <span class=\"math inline\">\\(f_i\\)</span> çš„å€¼åŸŸã€‚å‡è®¾å·²ç»ç¡®å®šäº† <span class=\"math inline\">\\(f\\)</span> åºåˆ—çš„ä¸€ä¸ªå‰ç¼€ <span class=\"math inline\">\\(f_1\\sim i\\)</span>ï¼Œå¯¹äºä»»æ„ <span class=\"math inline\">\\(0\\le k\\le f_{\\min}\\)</span>ï¼ˆæ³¨æ„ç”±äºå•è°ƒä¸é™ï¼Œ<span class=\"math inline\">\\(f_{\\min} = f_i\\)</span>ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰ <span class=\"math inline\">\\(f_j\\gets f_j-k\\)</span>ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„åˆæ³•çš„ <span class=\"math inline\">\\(f&#39;_{1\\sim i}\\)</span>ã€‚</p>\n<p>å½¢è±¡åŒ–åœ°ï¼Œå°† <span class=\"math inline\">\\(f_{1\\sim i}\\)</span> æƒ³è±¡ä¸ºä¸€ä¸ªé€æ¸é™ä½çš„æŸ±çŠ¶å›¾ï¼Œä»»æ„åˆ‡å»äº†ä¸€ä¸ªé«˜åº¦çš„åº•éƒ¨ï¼Œå¹¶ä¸”è¿™ä¸ªé«˜åº¦ä¸é«˜äºæœ€çŸ®çš„å…ƒç´ ï¼ˆå³ç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªå…ƒç´ ï¼‰ã€‚</p>\n<p>è¿™æ—¶å€™æœ‰ä¸€ä¸ªå¾ˆç¾å¦™çš„æ€§è´¨ï¼Œå°±æ˜¯æˆ‘ä»¬<mark>å¯¹äºåˆ‡ä¹‹å‰å’Œåˆ‡ä¹‹åçš„æŸ±çŠ¶å›¾ï¼Œå…¶ <strong>æœ€çŸ®å…ƒç´ ä»¥ä¸Šçš„éƒ¨åˆ†</strong> é•¿å¾—å®Œå…¨ç›¸åŒ</mark>ã€‚ç„¶åå°±æ˜¯ç¥ä¸­ç¥ä¹‹ DP çŠ¶æ€è®¾è®¡ã€‚å¾ˆéš¾æƒ³è±¡æ˜¯åœ¨ä»€ä¹ˆæ ·çš„ç²¾ç¥çŠ¶æ€ä¸‹å‡‘å‡ºæ¥è¿™ç§ç¥å¥‡çŠ¶æ€çš„ï¼Œå¯èƒ½æ˜¯æŸç§æˆ‘ä¸äº†è§£çš„ trickï¼Ÿ</p>\n<p>ä»¤ <span class=\"math inline\">\\(dp_{i, j}\\)</span> è¡¨ç¤ºå¯¹äºå‰ç¼€ <span class=\"math inline\">\\(f_{1, i}\\)</span>ï¼Œå½“åˆ‡å»çš„é«˜åº¦ä¸º <span class=\"math inline\">\\(0\\sim j\\)</span> æ—¶ï¼Œ<strong>æœ€çŸ®å…ƒç´ ä»¥ä¸Šçš„éƒ¨åˆ†</strong> çš„å’Œéƒ½ä¸º <span class=\"math inline\">\\(dp_{i, j}\\)</span>ã€‚é‚£ä¹ˆæ˜“å¾— <span class=\"math inline\">\\(\\sum f_{1\\sim i}=j\\times i + dp_{i, j}\\)</span>ã€‚</p>\n<p>è€ƒè™‘è½¬ç§»ã€‚å‡è®¾å·²çŸ¥æ‰€æœ‰ <span class=\"math inline\">\\(dp_{i - 1, j}\\)</span>ï¼Œéœ€è½¬ç§»åˆ° <span class=\"math inline\">\\(i\\)</span>ï¼Œæˆ‘ä»¬æœ‰ä¸‰ç§è½¬ç§»è·¯å¾„ï¼š</p>\n<ol type=\"1\">\n<li><p><span class=\"math inline\">\\(j &lt; a_i\\)</span>ï¼š</p>\nå¯¹ <span class=\"math inline\">\\(a_i\\)</span> å–æ¨¡å–ä¸åŠ¨ï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ã€‚<span class=\"math inline\">\\(dp_{i, j}\\gets dp_{i - 1, j}\\)</span>ã€‚</li>\n<li><p><span class=\"math inline\">\\(j\\ge a_i\\)</span>ï¼š</p>\n<ul>\n<li><p>è®© <span class=\"math inline\">\\(i\\)</span> æ‰¿æ‹… <span class=\"math inline\">\\(f_i=a_i-1\\)</span> çš„è´£ä»»ã€‚æˆ‘ä»¬ä» <span class=\"math inline\">\\(0\\sim j\\)</span> ä¸­æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³ <span class=\"math inline\">\\(j&#39;\\bmod a_i=a_i-1\\)</span> çš„ <span class=\"math inline\">\\(j&#39;\\)</span>ï¼Œ<span class=\"math inline\">\\(j&#39;\\)</span> è‚¯å®šæ˜¯è¶Šå¤§è¶Šå¥½ï¼Œæ•… <span class=\"math inline\">\\(j&#39;=(\\left\\lfloor \\dfrac {j}{a_i}\\right\\rfloor-1)\\times a_i+(a_i-1)\\)</span>ã€‚</p>\næ­¤æ—¶ä¾¿æœ‰ <span class=\"math inline\">\\(dp_{i, a_i-1}\\gets dp_{i - 1, j&#39;} + [j&#39; - (a_i-1)]\\times (i-1)\\)</span>ã€‚</li>\n<li><p>ç›²çŒœ <span class=\"math inline\">\\(0\\sim i - 1\\)</span> æˆ– <span class=\"math inline\">\\(i+1\\sim n\\)</span> ä¸­ä¼šå‡ºç°æ‰¿æ‹… <span class=\"math inline\">\\(f_{i&#39;}=a_{i&#39;-1}\\)</span> çš„ <span class=\"math inline\">\\(i&#39;\\)</span>ï¼Œæ•…æŒ‰ç…§ <span class=\"math inline\">\\(j\\)</span> å–æœ€å¤§æ¥è½¬ç§»ã€‚</p>\n<p>æ­¤æ—¶æœ‰ <span class=\"math inline\">\\(dp_{i, j\\bmod a_i}=dp_{i-1,j}+(j-j\\bmod a_i)\\times (i-1)\\)</span>ã€‚</p></li>\n</ul></li>\n</ol>\n<p>ç­”æ¡ˆå³ä¸º <span class=\"math inline\">\\(\\max\\{j\\times n+dp_{n, j}\\}\\)</span>ã€‚ç”±äºä¸å­˜åœ¨ <span class=\"math inline\">\\(f_i=a_i-1\\)</span> çš„ <span class=\"math inline\">\\(f\\)</span> è‚¯å®šæ¯”å­˜åœ¨çš„è¦åŠ£ï¼Œæ‰€ä»¥æˆ‘ä»¬è‚¯å®šé€‰åˆ°çš„æ˜¯æ­£ç¡®çš„ç­”æ¡ˆã€‚</p>\n<p>æ³¨æ„åˆ°æ¯ä¸ª <span class=\"math inline\">\\(i\\)</span> åªä¼šæ–°å¢ <span class=\"math inline\">\\(a_i-1\\)</span> ä¸€ä¸ªçŠ¶æ€ï¼Œæ•…çŠ¶æ€æ€»æ•°ä¸º <span class=\"math inline\">\\(O(n)\\)</span>ã€‚æŠŠ <span class=\"math inline\">\\(dp\\)</span> å¼€æˆ map å°±å¯ä»¥ <span class=\"math inline\">\\(O(n\\log n)\\)</span> åœ°è§£å†³é—®é¢˜ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n    std::cout.tie(nullptr);\n#else\n    freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n;\n    std::cin &gt;&gt; n;\n    std::vector&lt;long long&gt; a(n + 1);\n    std::map&lt;long long, long long&gt; t;\n    std::cin &gt;&gt; a[1];\n    t[a[1] - 1] = 0;\n    for (int i = 2; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i];\n        for (;;) &#123;\n            auto p = t.lower_bound(a[i]);\n            if (p == t.end())\n                break;\n            long long j = p-&gt;first, f = p-&gt;second;\n            t[j % a[i]] = std::max(t[j % a[i]], f + (j - j % a[i]) * (i - 1));\n            if (j &gt;= a[i]) &#123;\n                j = (j / a[i] - 1) * a[i] + a[i] - 1;\n                t[a[i] - 1] = std::max(t[a[i] - 1], f + (j - (a[i] - 1)) * (i - 1));\n            &#125;\n            t.erase(p);\n        &#125;\n    &#125;\n    long long res = 0;\n    for (auto i : t)\n        res = std::max(res, i.first * n + i.second);\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"stalinsort-algorithm\">3. StalinSort Algorithm</h2>\n<p><a href=\"https://qoj.ac/problem/1456\" class=\"uri\">https://qoj.ac/problem/1456</a></p>\n<blockquote>\n<p>ç»™å®šæ’åˆ— <span class=\"math inline\">\\(A_{1\\sim n}\\)</span>ã€‚ä» <span class=\"math inline\">\\(i=2\\)</span> å¼€å§‹å¾€å³æ‰«ï¼Œæ¯ä¸€æ­¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>\n<ul>\n<li>è‹¥ <span class=\"math inline\">\\(A_i&gt; A_{i-1}\\)</span>ï¼Œä»€ä¹ˆä¹Ÿä¸åšã€‚</li>\n<li>å¦åˆ™ï¼Œä½ å¯ä»¥åˆ é™¤ <span class=\"math inline\">\\(A_{i-1}\\)</span> æˆ– <span class=\"math inline\">\\(A_i\\)</span>ï¼Œä½†è¦æ±‚åˆ é™¤åï¼Œè¯¥å‰ç¼€å¿…é¡»å•è°ƒé€’å¢ã€‚</li>\n</ul>\n<p>é—®æœ€å°‘å¯ä»¥åˆ é™¤å¤šå°‘ä¸ªæ•°ã€‚<span class=\"math inline\">\\(n\\le 10^5\\)</span>ã€‚</p>\n</blockquote>\n<p>ä½ ä¼šå‘ç°<mark>åˆ æœ€å°‘ = ç•™æœ€å¤š</mark>ã€‚</p>\n<p>è€ƒè™‘ <span class=\"math inline\">\\(i\\)</span> èƒ½å¤Ÿè½¬ç§»åˆ°çš„ <span class=\"math inline\">\\(j(j&gt;i)\\)</span> éœ€æ»¡è¶³çš„æ¡ä»¶ã€‚è‹¥ä»¤ <span class=\"math inline\">\\(nex_p\\)</span> è¡¨ç¤º <span class=\"math inline\">\\(p\\)</span> ä¹‹åç¬¬ä¸€ä¸ªå€¼æ¯” <span class=\"math inline\">\\(a_p\\)</span> å¤§çš„å…ƒç´ ï¼Œåˆ™ <span class=\"math inline\">\\(j\\in [nex_i, nex_{nex_i})\\)</span> ä¸” <span class=\"math inline\">\\(a_j&gt;a_i\\)</span>ã€‚</p>\n<p><mark>èµ›æ—¶è¯¯è®¤ä¸ºå³ç«¯ç‚¹ä¸º <span class=\"math inline\">\\(i\\)</span> ä¹‹åç¬¬äºŒä¸ªå€¼æ¯” <span class=\"math inline\">\\(a_i\\)</span> å¤§çš„å…ƒç´ ï¼Œå¯¼è‡´å®Œå…¨å¯„æ‰ã€‚</mark></p>\n<p>æ—¶é—´å¤æ‚åº¦ <span class=\"math inline\">\\(O(n^2)\\)</span>ï¼Œè€ƒè™‘ä¼˜åŒ–ã€‚<mark>æ³¨æ„åˆ°å¦‚æœåªæœ‰ <span class=\"math inline\">\\(j\\in [nex_i, nex_{nex_i})\\)</span> è¿™ä¸ªæ¡ä»¶å¾ˆå®¹æ˜“ç”¨çº¿æ®µæ ‘ç»´æŠ¤ï¼Œè€ƒè™‘æ¶ˆå» <span class=\"math inline\">\\(a_j&gt;a_i\\)</span> çš„å½±å“ã€‚æ•…è€ƒè™‘æŒ‰ <span class=\"math inline\">\\(a\\)</span> <strong>ä»å°åˆ°å¤§</strong> çš„é¡ºåºé€‰å– <span class=\"math inline\">\\(i\\)</span>ï¼Œå› ä¸ºå½“å‰æœ€å°çš„ <span class=\"math inline\">\\(i\\)</span> ä¸€å®šå·²ç»è¢«åˆ·å®Œè¡¨äº†</mark>ã€‚</p>\n<p>æ—¶é—´å¤æ‚åº¦ <span class=\"math inline\">\\(O(n\\log n)\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxn = 5e5 + 5;\nconst int inf = 0x3f3f3f3f;\nstruct _ &#123; int u, d; &#125; t1[maxn &lt;&lt; 2];\nint n, t[maxn &lt;&lt; 2];\n#define lt (p &lt;&lt; 1)\n#define rt (lt | 1)\nvoid upd(int p, int l, int r, int x, int v) &#123;\n    t[p] = std::min(t[p], v);\n    if (l == r)\n        return;\n    int mid = (l + r) &gt;&gt; 1;\n    if (x &lt;= mid)\n        upd(lt, l, mid, x, v);\n    else\n        upd(rt, mid + 1, r, x, v);\n    return;\n&#125;\nint ask(int p, int l, int r, int ql, int qr) &#123;\n    if (ql &lt;= l &amp;&amp; r &lt;= qr)\n        return t[p];\n    int mid = (l + r) &gt;&gt; 1, res = n + 1;\n    if (ql &lt;= mid)\n        res = ask(lt, l, mid, ql, qr);\n    if (qr &gt; mid)\n        res = std::min(res, ask(rt, mid + 1, r, ql, qr));\n    return res;\n&#125;\nvoid pushdown(int p) &#123;\n    if (t1[p].d) &#123;\n        t1[lt].u = std::max(t1[lt].u, t1[p].d);\n        t1[lt].d = std::max(t1[lt].d, t1[p].d);       \n        t1[rt].u = std::max(t1[rt].u, t1[p].d);\n        t1[rt].d = std::max(t1[rt].d, t1[p].d);       \n        t1[p].d = 0;\n    &#125;\n    return;\n&#125;\nvoid upd(int p, int l, int r, int ql, int qr, int v) &#123;\n    t1[p].u = std::max(t1[p].u, v);\n    if (ql &lt;= l &amp;&amp; r &lt;= qr) &#123;\n        t1[p].d = std::max(t1[p].d, v);\n        return;\n    &#125;\n    pushdown(p);\n    int mid = (l + r) &gt;&gt; 1;\n    if (ql &lt;= mid)\n        upd(lt, l, mid, ql, qr, v);\n    if (qr &gt; mid)\n        upd(rt, mid + 1, r, ql, qr, v);\n    return;\n&#125;\nint ask(int p, int l, int r, int x) &#123;\n    if (l == r)\n        return t1[p].u;\n    pushdown(p);\n    int mid = (l + r) &gt;&gt; 1;\n    if (x &lt;= mid)\n        return ask(lt, l, mid, x);\n    return ask(rt, mid + 1, r, x);\n&#125;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n    std::cout.tie(nullptr);\n#else\n    freopen(&quot;sort3.in&quot;, &quot;r&quot;, stdin);\n    // freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int res = 0;\n    std::cin &gt;&gt; n;\n    std::vector&lt;int&gt; a(n + 1), ne(n + 1), f(n + 1);\n    std::fill(t + 1, t + 4 * n + 1, n + 1);\n    std::fill(t1 + 1, t1 + 4 * n + 1, (_)&#123; -inf, 0 &#125;);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    for (int i = n; ~i; --i) &#123;\n        ne[i] = ask(1, 0, n, a[i] + 1, n);\n        upd(1, 0, n, a[i], i);   \n    &#125;\n    std::vector&lt;int&gt; id(n + 1);\n    std::iota(id.begin(), id.end(), 0);\n    std::sort(id.begin(), id.end(), [&amp;](int x, int y) &#123; return a[x] &lt; a[y]; &#125;);\n    f[0] = 0;\n    for (int i = 0; i &lt;= n; ++i) &#123;\n        if (i) &#123;\n            f[id[i]] = ask(1, 0, n, id[i]);\n            res = std::max(res, f[id[i]]);\n        &#125;\n        if (ne[id[i]] &lt;= n)\n            upd(1, 0, n, ne[id[i]], ne[ne[id[i]]] - 1, f[id[i]] + 1);\n    &#125;\n    std::cout &lt;&lt; n - res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"merge-triplets\">4. Merge Triplets</h2>\n<p><a href=\"https://atcoder.jp/contests/agc043/tasks/agc043_d\" class=\"uri\">https://atcoder.jp/contests/agc043/tasks/agc043_d</a></p>\n<blockquote>\n<p>ç»™å®š <span class=\"math inline\">\\(A_{1\\sim 3N}=\\{1, 2, \\dots, 3N\\}\\)</span>ï¼Œä» <span class=\"math inline\">\\(1\\)</span> å¼€å§‹æ¯ <span class=\"math inline\">\\(3\\)</span> ä¸ªæ•°åˆ†ä¸ºä¸€ç»„ï¼Œæ¯ä¸€ç»„åˆå§‹æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æ‰§è¡Œè‹¥å¹²æ¬¡ä»¥ä¸‹æ“ä½œï¼š</p>\n<ul>\n<li>åœ¨æ‰€æœ‰æŒ‡é’ˆæŒ‡å‘çš„æ•°ä¸­é€‰æ‹©ä¸€ä¸ªæœ€å°çš„ï¼ŒæŠŠå®ƒæ”¾åˆ°åºåˆ—æœ«ï¼ˆä¸ä¼šåŠ å…¥æœ«ç«¯çš„ç»„ï¼‰ï¼›å°†åŸæœ¬æŒ‡å‘å®ƒçš„æŒ‡é’ˆåç§»ä¸€ä½ï¼Œå¦‚æœç§»å‡ºåŸæœ¬çš„ç»„å°±åˆ é™¤è¿™ä¸ªæŒ‡é’ˆã€‚</li>\n</ul>\n<p>é—®ä»»æ„æ¬¡æ“ä½œåï¼Œå¯èƒ½å¾—åˆ°å¤šå°‘ç§åºåˆ—ã€‚<span class=\"math inline\">\\(n\\le 2\\times 10^3\\)</span>ã€‚</p>\n</blockquote>\n<p>ç”±äºè¦å¯¹åˆæ³•çš„æœ€ç»ˆåºåˆ—è¿›è¡Œè®¡æ•°ï¼Œè€ƒè™‘æœ€ç»ˆåºåˆ—çš„æ€§è´¨ã€‚</p>\n<p>è‹¥åºåˆ—ä¸­ <span class=\"math inline\">\\(a_{i+1}&lt;a_i\\)</span>ï¼Œåˆ™è¯´æ˜åœ¨æŸä¸€ç»„ä¸­ï¼Œå€¼ä¸º <span class=\"math inline\">\\(a_i\\)</span> çš„å…ƒç´ ä¸‹ä¸€ä¸ªå°±æ˜¯ <span class=\"math inline\">\\(a_{i+1}\\)</span>ã€‚å¦åˆ™ï¼Œå›  <span class=\"math inline\">\\(a_{i+1}\\)</span> å¯é€‰ä¸”æ¯” <span class=\"math inline\">\\(a_i\\)</span> å°ï¼Œ<span class=\"math inline\">\\(a_{i+1}\\)</span> åº”æ’åœ¨ <span class=\"math inline\">\\(a_i\\)</span> å‰é¢ã€‚</p>\n<p>å¦åˆ™ï¼Œ<span class=\"math inline\">\\(a_{i+1}\\)</span> æ—¢å¯ä»¥ä¸ <span class=\"math inline\">\\(a_i\\)</span> ä¸åœ¨åŒä¸€ç»„ï¼Œä¹Ÿå¯ä»¥æ˜¯ <span class=\"math inline\">\\(a_i\\)</span> çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</p>\n<p>ä¸€ç»„æœ€å¤šä¸‰ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸èƒ½å‡ºç° <span class=\"math inline\">\\(a_i&gt;a_{i+1},a_{i+2},a_{i+3}\\)</span> çš„æƒ…å†µã€‚è€Œ <span class=\"math inline\">\\(N=1\\)</span> æ—¶åºåˆ—é•¿åº¦åªæœ‰ <span class=\"math inline\">\\(3\\)</span>ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ ·ä¾‹ä¸€çš„ç­”æ¡ˆä¸º <span class=\"math inline\">\\(3!\\)</span>ã€‚</p>\n<p>ä½†è¿™ä¸ªé™åˆ¶å¹¶ä¸èƒ½æ’é™¤æ‰€æœ‰éæ³•æƒ…å†µã€‚<span class=\"math inline\">\\(N=2\\)</span> æ—¶æš´æœæˆ‘ä»¬ç›®å‰é™åˆ¶ä¸‹çš„è§£ï¼Œå…±æœ‰ 276 ä¸ªï¼Œæ¯”ç­”æ¡ˆä¸­çš„ 261 ä¸ªè¦å¤šï¼Œè¯´æ˜åŒ…å«äº†å…¶ä»–éæ³•è§£ã€‚</p>\n<p>æš´æœè¾“å‡ºå¹¶è§‚å¯Ÿï¼Œæ˜“å¾—è¿™ 15 ä¸ªéæ³•åºåˆ—å³ä¸ºæ»¡è¶³ç›®å‰é™åˆ¶ä¸”å­˜åœ¨ <span class=\"math inline\">\\(3\\)</span> ä¸ª <span class=\"math inline\">\\(i\\)</span>ï¼Œæ»¡è¶³ <span class=\"math inline\">\\(a_i&gt;a_{i+1}\\)</span> ä¸” <span class=\"math inline\">\\(a_i&lt;a_{i+2}\\)</span> çš„æ‰€æœ‰åºåˆ—ï¼Œ<mark>ç”±å‰é¢çš„æ¨å¯¼ï¼Œå¿…é¡»åˆ†ä¸ºä¸‰ä¸ªé•¿åº¦ä¸º 2 çš„ç»„ï¼Œè€Œæˆ‘ä»¬è¦æ±‚çš„æ˜¯é•¿åº¦ä¸º 3 çš„ç»„ã€‚æ˜¾ç„¶æ— æ³•ç”¨å‰è€…ç»„åˆå¾—åˆ°åè€…</mark>ã€‚</p>\n<p>åœ¨æˆ‘ä»¬ç¬¬ä¸€ä¸ªæ¡ä»¶çš„é™åˆ¶ä¸‹ï¼Œå¿…é¡»è¢«åˆ†åˆ°åŒä¸€ç»„çš„æ•°çš„è¿ç»­é•¿åº¦ï¼Œåªæœ‰ <span class=\"math inline\">\\(1,2,3\\)</span> ä¸‰ç§ã€‚è€Œï¼š</p>\n<ul>\n<li>é•¿åº¦ä¸º 3 çš„å¯¹ç­”æ¡ˆåˆæ³•æ€§æ— å½±å“ï¼›</li>\n<li>è€Œé•¿åº¦ä¸º 1 çš„æ—¢å¯ä»¥å’Œ 2 ç»„ä¸ºä¸€ç»„ï¼Œä¹Ÿå¯ä»¥å’Œå…¶ä»–ä¸¤ä¸ª 1 ç»„ä¸ºä¸€ç»„ï¼›</li>\n<li>é•¿åº¦ä¸º 2 çš„åªèƒ½å’Œ 1 ç»„æˆä¸€ç»„ã€‚</li>\n</ul>\n<p><mark>è¿™æ—¶ï¼Œæˆ‘ä»¬å‘ç°æ‰€æœ‰é™åˆ¶éƒ½æŒ‡å‘é•¿åº¦ä¸º 2 çš„æ®µï¼Œå…¶æ€»ä¸ªæ•°ä¸èƒ½æ¯”é•¿åº¦ä¸º 1 çš„æ®µå¤šã€‚</mark></p>\n<p>äºæ˜¯ä¹ï¼Œä¸Šè¿°é™åˆ¶å¯æ€»ç»“ä¸ºä¸¤ç‚¹ï¼š</p>\n<ol type=\"1\">\n<li>è‹¥ä»¤æ‰€æœ‰æ»¡è¶³ <span class=\"math inline\">\\(a_l&gt;\\max\\{a_{l\\sim r}\\}\\)</span> çš„æå¤§åŒºé—´ä¸ºä¸€æ®µï¼ˆæ˜“è¯æ¯æ®µäº’ä¸é‡åˆä¸”è¦†ç›–å…¨åºåˆ—ï¼‰ï¼Œé‚£ä¹ˆå…¶é•¿åº¦ä¸èƒ½è¶…è¿‡ 3ã€‚</li>\n<li>å…¶ä¸­ï¼Œé•¿åº¦ä¸º 2 çš„ä¸ªæ•°ä¸èƒ½æ¯”é•¿åº¦ä¸º 1 çš„ä¸ªæ•°å¤šã€‚</li>\n</ol>\n<p><mark>ä»¤ <span class=\"math inline\">\\(f_{i, j}\\)</span> è¡¨ç¤ºè‹¥å½“å‰æšä¸¾çš„æœ€åä¸€æ®µå³ç«¯ç‚¹ä¸º <span class=\"math inline\">\\(i\\)</span>ï¼Œé•¿åº¦ä¸º 1 çš„æ®µæ¯”é•¿åº¦ä¸º 2 çš„æ®µå¤š <span class=\"math inline\">\\(j\\)</span> çš„æ–¹æ¡ˆæ•°ã€‚</mark></p>\n<p>æœ€åç­”æ¡ˆå³ä¸º <span class=\"math inline\">\\(\\sum\\limits_{j=0}^n f_{i, j}\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n    std::cout.tie(nullptr);\n#else\n    freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, mod;\n    std::cin &gt;&gt; n &gt;&gt; mod;\n    n *= 3;\n    std::vector&lt;std::unordered_map&lt;int, long long&gt; &gt; f(n + 1);\n    f[0][0] = 1;\n    for (int i = 0; i &lt; n; ++i)\n        for (auto [j, k] : f[i]) &#123;\n            (f[i + 1][j + 1] += k) %= mod;\n            if (i + 2 &lt;= n)\n                (f[i + 2][j - 1] += k * (i + 1) % mod) %= mod;\n            if (i + 3 &lt;= n)\n                (f[i + 3][j] += k * (i + 1) % mod * (i + 2) % mod) %= mod;\n        &#125;\n    long long res = 0;\n    for (int i = 0; i &lt;= n; ++i)\n        (res += f[n][i]) %= mod;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"runaway-quail\">5. Runaway Quail</h2>\n<p><a href=\"https://qoj.ac/problem/5978\" class=\"uri\">https://qoj.ac/problem/5978</a></p>\n<blockquote>\n<p>æ•°è½´ä¸Šæœ‰ <span class=\"math inline\">\\(n\\)</span> åªé¸¡ï¼Œåˆå§‹ä½ç½®ä¸ºé <span class=\"math inline\">\\(0\\)</span> æ•´æ•° <span class=\"math inline\">\\(p_i\\)</span>ï¼Œå¥”è·‘é€Ÿåº¦ä¸º <span class=\"math inline\">\\(s_i\\)</span>ã€‚ä½ åˆå§‹åœ¨ <span class=\"math inline\">\\(0\\)</span> ä½ç½®ï¼Œå¥”è·‘é€Ÿåº¦ä¸º <span class=\"math inline\">\\(Y(Y&gt;s_i)\\)</span>ã€‚ä½ è¦æŠ“åˆ°æ‰€æœ‰é¸¡ã€‚</p>\n<p>ä½ å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»è°ƒè½¬æ–¹å‘ï¼›é¸¡æ€»ä¼šæœç€è¿œç¦»ä½ çš„æ–¹å‘å¥”è·‘ï¼›å½“ä½ çš„åæ ‡å’Œé¸¡é‡åˆæ—¶ï¼Œä½ æŠ“åˆ°é¸¡ã€‚</p>\n<p>é—®æŠ“åˆ°æ‰€æœ‰é¸¡çš„æœ€çŸ­æ—¶é—´ï¼ˆæ˜¾ç„¶æ˜¯ä¸ªå®æ•°ï¼‰ã€‚<span class=\"math inline\">\\(n\\le 500\\)</span>ã€‚</p>\n</blockquote>\n<p>å®¹æ˜“å‘ç°é¸¡çš„å¥”è·‘æ–¹å‘ä»å§‹è‡³ç»ˆä¸ä¼šå˜ï¼Œå¦‚æœæˆ‘ä»¬è¦ä»å¾€å·¦è¿½å˜æˆå¾€å³è¿½ï¼Œæ˜¾è€Œæ˜“è§åœ°æˆ‘ä»¬ä¼š<mark>åœ¨è¿½ä¸Šå³è¾¹ç¬¬ä¸€åªé¸¡å‰ç»è¿‡åŸç‚¹</mark>ï¼Œåä¹‹åŒç†ã€‚</p>\n<p>é‚£ä¹ˆæœ‰ä¸€ä¸ªå¾ˆç¥å¥‡çš„çŠ¶æ€è®¾è®¡ï¼Œè®¾ <span class=\"math inline\">\\(f_{i,j}\\)</span> ä¸ºè¿½ä¸Šäº†å·¦è¾¹é€Ÿåº¦ç¬¬ <span class=\"math inline\">\\(1\\sim i - 1\\)</span> å¤§çš„æ‰€æœ‰é¸¡å’Œå³è¾¹é€Ÿåº¦ç¬¬ <span class=\"math inline\">\\(1\\sim j - 1\\)</span> å¤§çš„æ‰€æœ‰é¸¡ï¼Œç„¶åè·‘å›åŸç‚¹çš„æœ€å°æ—¶é—´ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨è®°å½•è¿™ä¸ªéå¸¸éš¾è®°å½•çš„å½“å‰ä½ç½®ä¿¡æ¯ï¼Œå¯¹äºé€Ÿåº¦æ’å <span class=\"math inline\">\\(\\ge i,j\\)</span> çš„æ‰€æœ‰é¸¡ï¼Œå½“å‰æ˜¯å¦è¿½ä¸Šæˆ‘ä»¬å¹¶ä¸å…³å¿ƒâ€”â€”<mark>å¦‚æœå…¶ä½ç½®æ¯”è¾ƒè¿œï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šåœ¨åç»­è½¬ç§»ä¸­å†è€ƒè™‘ï¼›å¦‚æœå…¶ä½ç½®æ¯”è¾ƒè¿‘ï¼Œåœ¨è§£å†³é€Ÿåº¦æ’å <span class=\"math inline\">\\(&lt;i,j\\)</span> çš„é¸¡æ—¶å°±å·²ç»æŠ“ä½</mark>ã€‚</p>\n<p><mark>æˆ‘ä»¬ <span class=\"math inline\">\\(O(n)\\)</span> æšä¸¾ä¸Šä¸€æ¬¡åå‘æ˜¯åœ¨æŠ“ä½å“ªä¸€åªé¸¡æ—¶ï¼Œç„¶åè®©ä¸­é—´å…¨éƒ¨åŒå‘è·‘å³å¯</mark>ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾æˆ‘ä»¬è¦ç”¨ <span class=\"math inline\">\\(f_{i,j}\\)</span> æ›´æ–° <span class=\"math inline\">\\(f_{k,j}\\)</span>ï¼ˆ<span class=\"math inline\">\\(k&lt;i\\)</span>ï¼‰ï¼Œé‚£ä¹ˆåªéœ€è¦æ›´æ–°æŠ“ä½é€Ÿåº¦æ’å <span class=\"math inline\">\\(i\\sim k+1\\)</span> ä¸­è·‘å¾—æœ€è¿œçš„ä¸€åªé¸¡æ‰€éœ€é¢å¤–æ—¶é—´ã€‚æŒ‰é€Ÿåº¦æ’åºåå¯ä»¥çº¿æ€§ç®—ä»£ä»·ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst long double eps = 1e-12;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int T;\n    for (std::cin &gt;&gt; T; T--; ) &#123;\n        int v, n;\n        std::cin &gt;&gt; v &gt;&gt; n;\n        std::vector&lt;std::pair&lt;int, int&gt; &gt; a(n + 1);\n        for (int i = 1; i &lt;= n; ++i)\n            std::cin &gt;&gt; a[i].first;\n        for (int i = 1; i &lt;= n; ++i)\n            std::cin &gt;&gt; a[i].second;\n        a.emplace_back(0, 0), ++n;\n        std::sort(a.begin() + 1, a.end());\n        int p = std::lower_bound(a.begin() + 1, a.end(), std::make_pair(0, 0)) - a.begin();\n        std::sort(a.begin() + 1, a.begin() + p, [](std::pair&lt;int, int&gt; x, std::pair&lt;int, int&gt; y) &#123; return x.second == y.second ? x.first &lt; y.first : x.second &gt; y.second; &#125;);\n        std::sort(a.begin() + p + 1, a.end(), [](std::pair&lt;int, int&gt; x, std::pair&lt;int, int&gt; y) &#123; return x.second == y.second ? x.first &lt; y.first : x.second &lt; y.second; &#125;);\n        std::vector&lt;std::vector&lt;long double&gt; &gt; f(n + 1, std::vector&lt;long double&gt; (n + 1, 1e18));\n        f[1][n] = 0.;\n        auto at = [&amp;](int i, long double t) &#123;\n            return std::fabs(a[i].first + t * a[i].second * (i &lt; p ? -1 : 1));\n        &#125;;\n        auto calc = [&amp;](int i, long double t) &#123;\n            return at(i, t) / (v - a[i].second);\n        &#125;;\n        // for (int i = 1; i &lt;= n; ++i)\n        //     printf(&quot;%d: (%d, %d)\\n&quot;, i, a[i].first, a[i].second);\n        for (int i = 1; i &lt;= p; ++i)\n            for (int j = n; j &gt;= p; --j) &#123;\n                if (i == p &amp;&amp; j == p)\n                    break;\n                long double d = 0.;\n                // printf(&quot;[%d, %d]: %lf\\n&quot;, i, j, f[i][j]);\n                for (int k = i; k &lt; p; ++k) &#123;\n                    if (at(k, f[i][j]) &gt;= at(i, f[i][j]) - eps)\n                        d = std::max(d, calc(k, f[i][j]));\n                    // printf(&quot;  k1 = %d, d = %lf\\n&quot;, k, d);\n                    f[k + 1][j] = std::min(f[k + 1][j], f[i][j] + d + (k != j - 1) * d);\n                &#125;\n                d = 0.;\n                for (int k = j; k &gt; p; --k) &#123;\n                    if (at(k, f[i][j]) &gt;= at(j, f[i][j]) - eps)\n                        d = std::max(d, calc(k, f[i][j]));\n                    // printf(&quot;  k2 = %d, d = %lf\\n&quot;, k, d);\n                    f[i][k - 1] = std::min(f[i][k - 1], f[i][j] + d + (k != i + 1) * d);\n                &#125;\n            &#125;\n        &#123;\n            static int casetot = 0;\n            std::cout &lt;&lt; &quot;Case #&quot; &lt;&lt; ++casetot &lt;&lt; &quot;: &quot;;\n        &#125;\n        std::cout &lt;&lt; std::fixed &lt;&lt; std::setprecision(9) &lt;&lt; f[p][p] &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"the-great-marathon\">6. The Great Marathon</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/38/H\" class=\"uri\">https://codeforces.com/problemset/problem/38/H</a></p>\n<blockquote>\n<p>ç»™å®šä¸€ä¸ª <span class=\"math inline\">\\(n\\)</span> ä¸ªç‚¹ <span class=\"math inline\">\\(m\\)</span> æ¡è¾¹çš„æ— å‘è¿é€šå›¾ï¼Œç‚¹ <span class=\"math inline\">\\(i\\)</span> ä¸Šåˆå§‹æœ‰é€‰æ‰‹ <span class=\"math inline\">\\(i\\)</span>ã€‚ä¸ºæ¯ä¸ªé€‰æ‰‹ä»»æ„æŒ‡å®šç»ˆç‚¹ï¼ˆå¯é‡å¤ï¼‰ï¼Œé‚£ä¹ˆæœ€åçš„æ’åæŒ‰ç…§æœ€çŸ­è·¯ä¸ºç¬¬ä¸€å…³é”®å­—ã€ç¼–å·ä¸ºç¬¬äºŒå…³é”®å­—æ’åºã€‚</p>\n<p>ç°æŒ‰ç…§æ’ååºåˆ—åˆ†æˆå‰ä¸­åä¸‰æ®µï¼Œè®°ä¸ºé‡‘é“¶é“œç‰Œï¼›æ»¡è¶³é‡‘ç‰Œæ•°åœ¨ <span class=\"math inline\">\\([g_1,g_2]\\)</span> ä¹‹é—´ï¼Œé“¶ç‰Œæ•°åœ¨ <span class=\"math inline\">\\([s_1,s_2]\\)</span> ä¹‹é—´ã€‚ä»»æ„æŒ‡å®šå‘ç‰Œæ•°é‡å’Œæ¯ä¸ªäººçš„ç»ˆç‚¹ï¼Œé—®æœ€åæœ‰å¤šå°‘ç§æ–¹æ¡ˆæ•°ï¼›ä¸¤ä¸ªæ–¹æ¡ˆä¸åŒå½“ä¸”ä»…å½“æœ‰è‡³å°‘ä¸€ä¸ªäººæ‹¿çš„ç‰Œä¸ä¸€æ ·ã€‚</p>\n<p><span class=\"math inline\">\\(n\\le 50,m\\le 1000\\)</span>ã€‚</p>\n</blockquote>\n<p><mark><span class=\"math inline\">\\(n=50\\)</span>ï¼šå¯èƒ½éœ€è¦è€ƒè™‘ <span class=\"math inline\">\\(n^5\\)</span> åšæ³•ã€‚</mark></p>\n<p>å‘ç°æ˜¯ <mark>éœ€è¦ç¡®å®šé¡ºåºçš„ DP</mark>ã€‚å…³é”®ä½ç½®è‡ªç„¶åœ¨äºã€é‡‘é“¶ã€é“¶é“œç•Œå¤„ã€ã€‚è€ƒè™‘é’¦å®šé‡‘ç‰Œæœ€åä¸€åã€é“œç‰Œç¬¬ä¸€åçš„äººé€‰ï¼ˆä¸è€ƒè™‘ä¸­é—´çš„é“¶ç‰Œæ˜¯å› ä¸ºä¼šå‡ºç°è¿™æ ·é‚£æ ·çš„é—®é¢˜ï¼‰ï¼Œè¿˜éœ€è¦æšä¸¾ä»–ä»¬çš„è·¯ç¨‹å—ï¼Ÿå¹¶ä¸ã€‚ç”šè€Œè‡³äºï¼Œè¿™æ ·åšä¼šç®—é‡ã€‚</p>\n<p>è€ƒè™‘<mark>ã€æœ€å°åŒ–ã€å·¦å³ä¸¤ä¾§çš„é‡‘ç‰Œã€é“œç‰Œå¯é€‰é›†åˆ</mark>ã€‚å¼ºè¡Œè®©é‡‘ç‰Œæœ€åä¸€å <span class=\"math inline\">\\(u\\)</span> çš„è·¯ç¨‹ä¸º <span class=\"math inline\">\\(\\min\\{dis_{u,i}\\}\\)</span>ï¼Œæœ€å°è·¯ç¨‹å°äºè¿™ä¸ªå€¼çš„æ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥æˆä¸ºé‡‘ç‰Œï¼›åŒæ—¶è®©é“œç‰Œç¬¬ä¸€å <span class=\"math inline\">\\(v\\)</span> çš„è·¯ç¨‹ä¸º <span class=\"math inline\">\\(\\max\\{dis_{v,i}\\}\\)</span>ï¼Œæœ€å¤§è·¯ç¨‹å¤§äºè¿™ä¸ªå€¼çš„æ‰€æœ‰æ•°éƒ½å¯ä»¥æˆä¸ºé“œç‰Œã€‚</p>\n<p>Q1: å¦‚æœå­˜åœ¨ä¸€ä¸ª <span class=\"math inline\">\\(i\\)</span>ï¼Œå®ƒæœ€å°çš„è·ç¦»ä¹Ÿæ¯” <span class=\"math inline\">\\(u\\)</span> çš„æœ€å°è·ç¦»å¤§ï¼Œä½†å®é™…ä¸Šå½“ <span class=\"math inline\">\\(u\\)</span> æ›´å¤§ä¸€ç‚¹å„¿çš„æ—¶å€™ï¼Œ<span class=\"math inline\">\\(i\\)</span> å¯ä»¥æˆä¸ºé‡‘ç‰Œå‘¢ï¼Ÿ</p>\n<p>A1ï¼šè¿™ç§æƒ…å†µåœ¨é’¦å®š <span class=\"math inline\">\\(i\\)</span> ä¸ºæœ€åä¸€åçš„æ—¶å€™è®¨è®ºè¿‡äº†ã€‚</p>\n<p>Q2ï¼šæ˜¯å¦ä¼šç®—é‡ï¼Ÿ</p>\n<p>A2ï¼šå¦‚ä¸Šæ‰€è¿°ï¼Œå‡å¦‚åœ¨é’¦å®š <span class=\"math inline\">\\(i\\)</span> çš„æ—¶å€™ç»Ÿè®¡äº† <span class=\"math inline\">\\(u\\)</span>ï¼Œé‚£ä¹ˆåœ¨é’¦å®š <span class=\"math inline\">\\(u\\)</span> çš„æ—¶å€™å°±ä¸ä¼šç»Ÿè®¡ <span class=\"math inline\">\\(i\\)</span>ã€‚</p>\n<p>è€ƒè™‘è½¬ç§»ã€‚ä»¤ <span class=\"math inline\">\\(f_{i,u,v,j,k}\\)</span> ä¸ºè€ƒè™‘åˆ° <span class=\"math inline\">\\(i\\)</span>ï¼Œé‡‘ç‰Œå€’ä¸€ä¸º <span class=\"math inline\">\\(u\\)</span>ï¼Œé“œç‰Œç¬¬ä¸€ä¸º <span class=\"math inline\">\\(v\\)</span>ï¼Œé€‰äº† <span class=\"math inline\">\\(j\\)</span> ä¸ªé‡‘ã€<span class=\"math inline\">\\(k\\)</span> ä¸ªé“œçš„æ–¹æ¡ˆæ•°ã€‚è½¬ç§»æ˜¯ <span class=\"math inline\">\\(O(1)\\)</span> çš„ã€‚</p>\n<details>\n<p>æ³¨æ„ <code>vector</code> è¦å¼€åœ¨å¾ªç¯å¤–é¢ï¼Œä¸ç„¶ç”³è¯·ç©ºé—´å¾ˆè€—æ—¶é—´ /ll</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int inf = 0x3f3f3f3f;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;std::vector&lt;int&gt; &gt; g(n + 1, std::vector&lt;int&gt; (n + 1, inf));\n    for (int x, y; m--; ) &#123;\n        std::cin &gt;&gt; x &gt;&gt; y;\n        std::cin &gt;&gt; g[x][y], g[y][x] = g[x][y];\n    &#125;\n    for (int i = 1; i &lt;= n; ++i)\n        g[i][i] = 0;\n    for (int k = 1; k &lt;= n; ++k)\n        for (int i = 1; i &lt;= n; ++i)\n            if (k != i)\n                for (int j = 1; j &lt;= n; ++j)\n                    if (i != k &amp;&amp; j != k)\n                        g[i][j] = std::min(g[i][j], g[i][k] + g[k][j]);\n    int g1, g2, s1, s2;\n    std::cin &gt;&gt; g1 &gt;&gt; g2 &gt;&gt; s1 &gt;&gt; s2;\n    for (int i = 1; i &lt;= n; ++i)\n        for (int j = 1; j &lt;= n; ++j)\n            if (g[i][j] != inf)\n                g[i][j] = g[i][j] * n + i;\n    std::vector&lt;int&gt; mx(n + 1), mn(n + 1, inf);\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        for (int j = 1; j &lt;= n; ++j)\n            if (j != i)\n                mn[i] = std::min(mn[i], g[i][j]);\n        mx[i] = *std::max_element(g[i].begin() + 1, g[i].end());\n    &#125;\n    auto res(0ll);\n    std::vector&lt;std::vector&lt;std::vector&lt;long long&gt; &gt; &gt; f(n + 1, std::vector&lt;std::vector&lt;long long&gt; &gt; (n + 1, std::vector&lt;long long&gt; (n + 1)));\n    for (int u = 1; u &lt;= n; ++u)\n        for (int v = 1; v &lt;= n; ++v)\n            if (v != u) &#123;\n                f[0][1][1] = 1ll;\n                for (int i = 1; i &lt;= n; ++i)\n                    if (i == u || i == v)\n                        f[i] = f[i - 1];\n                    else &#123;\n                        bool flag = 0;\n                        for (int j = 1; j &lt;= n; ++j)\n                            if (mn[u] &lt; g[i][j] &amp;&amp; g[i][j] &lt; mx[v]) &#123;\n                                flag = 1;\n                                break;\n                            &#125;\n                        for (int j = 1; j &lt;= g2; ++j)\n                            for (int k = 1; k &lt;= n - g1 - s1; ++k) &#123;\n                                f[i][j][k] = 0ll;\n                                if (mx[i] &lt; mn[u])\n                                    f[i][j][k] = f[i - 1][j - 1][k];\n                                else if (mn[i] &gt; mx[v])\n                                    f[i][j][k] = f[i - 1][j][k - 1];\n                                else &#123;\n                                    if (flag)\n                                        f[i][j][k] = f[i - 1][j][k];\n                                    if (mn[i] &lt; mn[u])\n                                        f[i][j][k] += f[i - 1][j - 1][k];\n                                    if (mx[i] &gt; mx[v])\n                                        f[i][j][k] += f[i - 1][j][k - 1];\n                                &#125;\n                            &#125;\n                    &#125;\n                for (int g = g1; g &lt;= g2; ++g)\n                    for (int s = s1; s &lt;= s2; ++s)\n                        res += f[n][g][n - g - s];\n            &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"sorting-pancakes\">7. Sorting Pancakes</h2>\n<p><a href=\"https://codeforces.com/contest/1675/problem/G\" class=\"uri\">https://codeforces.com/contest/1675/problem/G</a></p>\n<blockquote>\n<p>ç»™å®šç›’å­ <span class=\"math inline\">\\(1\\sim n\\)</span> å’Œæ¯ä¸ªç›’å­ <span class=\"math inline\">\\(i\\)</span> é‡Œçš„åˆå§‹çƒæ•° <span class=\"math inline\">\\(a_i\\)</span>ï¼Œæ¯æ¬¡å¯ä»¥é€‰æ‹©ä¸€ä¸ªçƒç§»åŠ¨åˆ°ç›¸é‚»ç›’å­ï¼Œæœ€åæ¬²ä½¿ç›’å­å†…çƒæ•°å•è°ƒä¸å‡,æ±‚æœ€å°ç§»çƒæ¬¡æ•°ã€‚</p>\n<p><span class=\"math inline\">\\(n,\\sum a_i\\le 250\\)</span>ã€‚</p>\n</blockquote>\n<p>ç®€å•é¢˜ï¼è¿™ç§ã€ç§»åŠ¨å…ƒç´ çš„é¢˜ã€ï¼Œä¼šè€ƒè™‘<mark>é’¦å®šæ¯ä¸ªå…ƒç´ æœ€ç»ˆçš„å€¼ï¼ŒæŠŠå‰é¢çš„å…ƒç´ å¯Œä½™çš„ / æ¬ ä¸‹æ¥çš„å­˜å‚¨èµ·æ¥</mark>ã€‚<em>å½“ç„¶ä¹Ÿæœ‰ä¾‹å¤–ï¼Œæ¯”å¦‚æ·»åŠ äº†ã€æ—¶é—´ã€è¿™ä¸€ç»´çš„é™åˆ¶ï¼Œgoto <a href=\"http://localhost:4000/20250510/#a---pass-to-next\">solu to Pass to Next</a></em></p>\n<p>åœ¨å¦‚æœåœ¨ <span class=\"math inline\">\\(i\\)</span> å¤„å¯Œä½™äº† <span class=\"math inline\">\\(x\\)</span>ï¼Œé‚£ä¹ˆåœ¨ç§»åŠ¨åˆ° <span class=\"math inline\">\\(i+1\\)</span> çš„è¿‡ç¨‹ä¸­å°±ä¼šäº§ç”Ÿ <span class=\"math inline\">\\(|x|\\)</span> çš„ä»£ä»·ã€‚</p>\n<p>ä»¤ <span class=\"math inline\">\\(f_{i,k,j}\\)</span> è¡¨ç¤ºç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªå…ƒç´ å¤„ï¼Œé’¦å®šå®ƒæœ€ç»ˆä¸º <span class=\"math inline\">\\(j\\)</span>ï¼Œå¯Œä½™ <span class=\"math inline\">\\(k\\)</span>ï¼Œåˆ™ <span class=\"math inline\">\\(f_{i,k,j}\\gets \\min\\limits_{j&#39;\\ge j}\\{f_{i-1, k-(j-a_i),j&#39;}\\}\\)</span>ã€‚æ˜¾è€Œæ˜“è§åç¼€ min ä¼˜åŒ–å°±èƒ½ <span class=\"math inline\">\\(O(n\\cdot m^2)\\)</span> åœ°åšäº†ã€‚</p>\n<details>\n<p>DP æ•°ç»„å’Œåç¼€ min æ•°ç»„è¦åˆèµ·æ¥ï¼Œä¸ç„¶ä¼š MLE /ll</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int inf = 0x3f3f3f3f;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;int&gt; a(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    using arr = std::vector&lt;int&gt;;\n    using brr = std::vector&lt;arr&gt;;\n    using crr = std::vector&lt;brr&gt;;\n    crr f(n + 1, brr(2 * m + 1, arr(m + 1, inf)));\n    std::fill(f[0][m].begin(), f[0][m].begin() + m + 1, 0);\n    for (int i = 1; i &lt;= n; ++i)\n        for (int k = 0; k &lt;= 2 * m; ++k)\n            for (int j = std::min(m, k + a[i]); j &gt;= std::max(0, k + a[i] - 2 * m); --j) &#123;\n                f[i][k][j] = f[i - 1][k - (j - a[i])][j] + std::abs(k - m);\n                if (j != m)\n                    f[i][k][j] = std::min(f[i][k][j], f[i][k][j + 1]);\n            &#125;\n    std::cout &lt;&lt; f[n][m][0] &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"complexity\">8. Complexity</h2>\n<p><a href=\"https://atcoder.jp/contests/agc033/tasks/agc033_d\" class=\"uri\">https://atcoder.jp/contests/agc033/tasks/agc033_d</a></p>\n<blockquote>\n<p>ç»™å®š <span class=\"math inline\">\\(n\\times m\\)</span> çš„ <span class=\"math inline\">\\(01\\)</span> çŸ©é˜µã€‚å®šä¹‰å…¶å­çŸ©é˜µçš„å‡Œä¹±åº¦ï¼š</p>\n<ul>\n<li>è‹¥è¯¥çŸ©é˜µä¸­åªæœ‰ä¸€ç§å€¼ï¼Œå‡Œä¹±åº¦ä¸º <span class=\"math inline\">\\(0\\)</span>ã€‚</li>\n<li>å¦åˆ™ï¼Œä»»æ„ç«–ç›´ / æ°´å¹³åˆ‡ä¸€åˆ€ï¼Œå¾—åˆ°ä¸¤ä¸ªå°çŸ©é˜µï¼›è‹¥å®ƒä»¬çš„å‡Œä¹±åº¦åˆ†åˆ«ä¸º <span class=\"math inline\">\\(a,b\\)</span>ï¼Œåˆ™å¤§çŸ©é˜µçš„å‡Œä¹±åº¦ä¸º <span class=\"math inline\">\\(\\max(a,b)+1\\)</span> çš„æœ€å°å€¼ã€‚</li>\n</ul>\n<p>æ±‚ç»™å®šçŸ©é˜µçš„å‡Œä¹±åº¦ã€‚<span class=\"math inline\">\\(n,m\\le 185\\)</span>ã€‚</p>\n</blockquote>\n<p>å¦‚æœæš´åŠ›æšä¸¾ DPï¼Œå¾ˆä¸å¹¸æ˜¯ <span class=\"math inline\">\\(n^5\\)</span> çš„ã€‚è€ƒè™‘ä¼˜åŒ–ã€‚å‘ç°çŸ©é˜µçš„å‡Œä¹±åº¦å¤§è‡´åœ¨ <span class=\"math inline\">\\(O(\\log n)\\)</span> çº§åˆ«ï¼Œè€ƒè™‘ç”¨<mark>çŠ¶æ€äº¤æ¢ç­”æ¡ˆ</mark>å‡å°å¤æ‚åº¦ã€‚å…·ä½“åœ°ï¼Œè®¾ <span class=\"math inline\">\\(f_{k,u,d,l}\\)</span> è¡¨ç¤ºå‡Œä¹±åº¦ <span class=\"math inline\">\\(\\le k\\)</span> æ—¶ï¼Œ<span class=\"math inline\">\\(r\\)</span> å¯å–åˆ°çš„æœ€å¤§å€¼ï¼Œé‚£ä¹ˆæœ‰è½¬ç§»ï¼š</p>\n<ul>\n<li>ç«–ç€åˆ‡ä¸€åˆ€ï¼Œæšä¸¾åˆ‡ç‚¹ <span class=\"math inline\">\\(i\\le f_{k-1,u,d,l}\\)</span>ï¼Œæœ‰ <span class=\"math inline\">\\(f_{k,u,d,l}\\gets f_{k-1,u,d,i+1}\\)</span>ã€‚å‘ç°æ˜¾ç„¶ <span class=\"math inline\">\\(i\\)</span> å– <span class=\"math inline\">\\(f_{k-1,u,d,l}\\)</span> çš„æ—¶å€™æœ€ä¼˜ï¼Œè¿™ä¸ªæ˜¯ <span class=\"math inline\">\\(O(1)\\)</span> çš„ã€‚</li>\n<li>æ¨ªç€åˆ‡ä¸€åˆ€ï¼Œæšä¸¾åˆ‡ç‚¹ <span class=\"math inline\">\\(i\\in[u,d)\\)</span>ï¼Œæœ‰ <span class=\"math inline\">\\(f_{k,u,d,l}\\gets \\min(f_{k-1,u,i,l},f_{k-1,i+1,d,l})\\)</span>ã€‚å‘ç°éš <span class=\"math inline\">\\(i\\)</span> å¢å¤§å·¦è¾¹å•è°ƒä¸å¢ï¼Œå³è¾¹å•è°ƒä¸é™ã€‚éšç€ <span class=\"math inline\">\\(d\\)</span> çš„å¢å¤§ï¼Œå·¦è¾¹ä¸å˜ï¼Œå³è¾¹ä¸‹ç§»ï¼Œäº¤å‡ºæ¥çš„äº¤ç‚¹ä¸€ç›´å³ç§»ã€‚ç„¶åå°±å¯ä»¥ä¼˜åŒ–åˆ°å‡æ‘Š <span class=\"math inline\">\\(O(1)\\)</span>ã€‚</li>\n</ul>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int inf = 0x3f3f3f3f;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;std::vector&lt;char&gt; &gt; a(n + 1, std::vector&lt;char&gt; (m + 1));\n    for (int i = 1; i &lt;= n; ++i)\n        for (int j = 1; j &lt;= m; ++j)\n            std::cin &gt;&gt; a[i][j];\n    using arr = std::vector&lt;int&gt;;\n    using brr = std::vector&lt;arr&gt;;\n    using crr = std::vector&lt;brr&gt;;\n    std::vector&lt;std::string&gt; res;\n    std::vector&lt;crr&gt; _f(2, crr(n + 1, brr(m + 1, arr(n + 1))));\n    for (int k = 0; ; ++k) &#123;\n        auto &amp;f = _f[k &amp; 1], &amp;f1 = _f[(k &amp; 1) ^ 1];\n        if (k == 0) &#123;\n            crr tag(m + 1, brr(n + 1, arr(n + 1, -1)));\n            for (int l = 1; l &lt;= m; ++l)\n                for (int u = 1; u &lt;= n; ++u)\n                    for (int d = u; d &lt;= n &amp;&amp; a[d][l] == a[u][l]; ++d)\n                        tag[l][u][d] = a[u][l];\n            for (int u = 1; u &lt;= n; ++u)\n                for (int d = u; d &lt;= n; ++d)\n                    for (int l = m; l; --l) &#123;\n                        f[u][l][d] = l - 1;\n                        if (~tag[l][u][d]) &#123;\n                            if (l != m &amp;&amp; tag[l][u][d] == tag[l + 1][u][d])\n                                f[u][l][d] = f[u][l + 1][d];\n                            else\n                                f[u][l][d] = l;\n                        &#125;\n                    &#125;\n        &#125;\n        else\n            for (int u = 1; u &lt;= n; ++u)\n                for (int l = 1; l &lt;= m; ++l)\n                    for (int d = u, pos = 1; d &lt;= n; ++d) &#123;\n                        f[u][l][d] = f1[u][l][d];\n                        if (f[u][l][d] != m) &#123;\n                            f[u][l][d] = std::max(f[u][l][d], f1[u][f1[u][l][d] + 1][d]);\n                            int mx = 0;\n                            for (int i = pos; i &lt; d; ++i) &#123;\n                                if (std::min(f1[u][l][i], f1[i + 1][l][d]) &gt;= mx)\n                                    mx = std::min(f1[u][l][i], f1[i + 1][l][d]), pos = i;\n                                else\n                                    break;\n                            &#125;\n                            f[u][l][d] = std::max(f[u][l][d], mx);\n                        &#125;\n                    &#125;\n        if (f[1][1][n] == m) &#123;\n            std::cout &lt;&lt; k &lt;&lt; &#39;\\n&#39;;\n            return 0;\n        &#125;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"boxes-and-balls\">9. Boxes and Balls</h2>\n<p><a href=\"https://www.luogu.com.cn/problem/CF1845E\" class=\"uri\">https://www.luogu.com.cn/problem/CF1845E</a></p>\n<blockquote>\n<p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º <span class=\"math inline\">\\(n\\)</span> çš„ <span class=\"math inline\">\\(01\\)</span> åºåˆ— <span class=\"math inline\">\\(a_{1\\sim n}\\)</span>ã€‚ä½ å¯ä»¥è¿›è¡Œæ°å¥½ <span class=\"math inline\">\\(k\\)</span> æ¬¡å¦‚ä¸‹æ“ä½œï¼š</p>\n<ul>\n<li>é€‰æ‹©åºåˆ—ä¸­ä¸€å¯¹ç›¸é‚»ä¸”å€¼ä¸åŒçš„å…ƒç´ ï¼Œå°†å®ƒä»¬äº¤æ¢ã€‚</li>\n</ul>\n<p>é—®æœ‰å¤šå°‘ç§æœ€ç»ˆåºåˆ—ã€‚<span class=\"math inline\">\\(n,k\\le 1500\\)</span>ã€‚</p>\n</blockquote>\n<p>æ²¿ç”¨ <a href=\"#sorting-pancakes\">7. Sorting Pancakes</a> çš„æ€è·¯ï¼Œè€ƒè™‘ä»¤ <span class=\"math inline\">\\(f_{i,j,l}\\)</span> è¡¨ç¤ºæœ€ç»ˆåºåˆ—çš„å‰ <span class=\"math inline\">\\(i\\)</span> ä¸ªé‡Œæœ‰ <span class=\"math inline\">\\(j\\)</span> ä¸ª <span class=\"math inline\">\\(1\\)</span>ï¼Œä»£ä»·å·²ç»æœ‰ <span class=\"math inline\">\\(l\\)</span> çš„æ–¹æ¡ˆæ•°ï¼›é‚£ä¹ˆä»¤ <span class=\"math inline\">\\(s_i\\)</span> ä¸º <span class=\"math inline\">\\(a\\)</span> çš„å‰ç¼€å’Œï¼Œæ˜¾ç„¶æœ‰ï¼š</p>\n<p><span class=\"math display\">\\[\nf_{i+1,j+1,k+|j-s_i|}\\gets f_{i,j,k}\\\\\nf_{i+1,j,k+|j-s_i|}\\gets f_{i,j,k}\n\\]</span></p>\n<p>æœ€ååœ¨æ¯” <span class=\"math inline\">\\(k\\)</span> å°ä¸”å¥‡å¶æ€§å’Œ <span class=\"math inline\">\\(k\\)</span> ç›¸åŒçš„ <span class=\"math inline\">\\(l\\)</span> é‡Œæ‰¾ç­”æ¡ˆã€‚ç„¶åæƒ³æ€ä¹ˆä¼˜åŒ–ã€‚</p>\n<p>ç­”æ¡ˆæ˜¯ä¸ç”¨ä¼˜åŒ–ã€‚è€ƒè™‘<mark>æœ‰æ•ˆçŠ¶æ€æ•°</mark>ï¼Œ<del>æ‰“ä¸ªè¡¨å‘ç°æ¯ä¸ª <span class=\"math inline\">\\(i\\)</span> åœ¨ <span class=\"math inline\">\\(O(n\\sqrt n)\\)</span> å·¦å³</del>ï¼Œä½†æœ‰å¦ä¸€ç§æ–¹æ³•æ˜¯å‘ç°æœ‰æ•ˆçš„ <span class=\"math inline\">\\(|j-s_i|\\)</span> ä¸ä¼šè¶…è¿‡ <span class=\"math inline\">\\(O(\\sqrt n)\\)</span>ï¼ˆåŸå› ï¼šä¸ºäº†æ¶ˆé™¤ <span class=\"math inline\">\\(|j-s_i|\\)</span> çš„æ¬ è´¦ï¼Œéœ€è¦ <span class=\"math inline\">\\(|j-s_i|\\)</span> ä¸ªä½ç½®ï¼›æ¯ä¸ªä½ç½®éƒ½ä¼šæœ‰å·®ä¸å¤š <span class=\"math inline\">\\(|j-s_i|\\)</span> çš„ä»£ä»·ï¼‰ï¼Œæ‰€ä»¥æšä¸¾æ—¶åªç”¨æšä¸¾ <span class=\"math inline\">\\(O(\\sqrt n)\\)</span> ä¸ª <span class=\"math inline\">\\(j\\)</span>ã€‚</p>\n<p>æ€»ä¹‹åªç”¨å­˜æœ‰æ•ˆçŠ¶æ€ä¼šå‘ç°è·‘ä¸æ»¡ <img src=\"/em/bb.gif\" /></p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 1e9 + 7;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int n, k;\n    std::cin &gt;&gt; n &gt;&gt; k;\n    std::vector&lt;int&gt; a(n + 1), s(n + 1);\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; a[i];\n    std::partial_sum(a.begin() + 1, a.end(), s.begin() + 1);\n    using arr = std::vector&lt;long long&gt;;\n    using brr = std::vector&lt;arr&gt;;\n    using crr = std::vector&lt;brr&gt;;\n    brr tag(n + 1, arr(n + 1));\n    std::vector&lt;std::vector&lt;std::pair&lt;int, int&gt; &gt; &gt; stt(2);\n    stt[0].emplace_back(0, 0);\n    crr _f(2, brr(n + 1, arr(k + 1)));\n    _f[0][0][0] = 1;\n    for (int i = 0; i &lt; n; ++i) &#123;\n        auto &amp;f = _f[i &amp; 1], &amp;f1 = _f[(i &amp; 1) ^ 1];\n        std::vector&lt;std::pair&lt;int, int&gt; &gt;().swap(stt[(i &amp; 1) ^ 1]);\n        for (auto [j, l] : stt[i &amp; 1]) &#123;\n                if (j + 1 &lt;= s[n] &amp;&amp; l + std::abs(j - s[i]) &lt;= k) &#123;\n                    if (tag[j + 1][l + std::abs(j - s[i])] != i + 1)\n                        tag[j + 1][l + std::abs(j - s[i])] = i + 1, stt[(i &amp; 1) ^ 1].emplace_back(j + 1, l + std::abs(j - s[i])), f1[j + 1][l + std::abs(j - s[i])] = 0ll;\n                    (f1[j + 1][l + std::abs(j - s[i])] += f[j][l]) %= mod;\n                &#125;\n                if (l + std::abs(j - s[i]) &lt;= k) &#123;\n                    if (tag[j][l + std::abs(j - s[i])] != i + 1)\n                        tag[j][l + std::abs(j - s[i])] = i + 1, stt[(i &amp; 1) ^ 1].emplace_back(j, l + std::abs(j - s[i])), f1[j][l + std::abs(j - s[i])] = 0ll;\n                    (f1[j][l + std::abs(j - s[i])] += f[j][l]) %= mod;\n                &#125;\n            &#125;\n        std::cout &lt;&lt; (int)stt[i &amp; 1].size() &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    auto res(0ll);\n    for (int i = k &amp; 1; i &lt;= k; i += 2)\n        if (tag[s[n]][i] == n)\n            (res += _f[n &amp; 1][s[n]][i]) %= mod;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h2 id=\"legondary-grandmaster\">10. LEGOndary Grandmaster</h2>\n<p><a href=\"https://codeforces.com/problemset/problem/1615/F\" class=\"uri\">https://codeforces.com/problemset/problem/1615/F</a></p>\n<blockquote>\n<p>ç»™å®šä¸¤ä¸ªé•¿åº¦ä¸º <span class=\"math inline\">\\(n\\)</span> çš„ <span class=\"math inline\">\\(0/1/?\\)</span> ä¸² <span class=\"math inline\">\\(s,t\\)</span>ï¼Œä½ å¯ä»¥å¯¹ <span class=\"math inline\">\\(s\\)</span> è¿›è¡Œè‹¥å¹²æ¬¡å¦‚ä¸‹æ“ä½œï¼š</p>\n<ul>\n<li>é€‰æ‹©åºåˆ—ä¸­ä¸€å¯¹ç›¸é‚»ä¸”å€¼ç›¸åŒçš„å…ƒç´ ï¼Œå°†å®ƒä»¬å–åã€‚</li>\n</ul>\n<p>ç°ä»»æ„å°† <span class=\"math inline\">\\(s\\)</span> å’Œ <span class=\"math inline\">\\(t\\)</span> ä¸­çš„ <code>?</code> å¡«ä¸º <span class=\"math inline\">\\(0/1\\)</span>ï¼Œé—®æ‰€æœ‰æƒ…å†µä¸­ <span class=\"math inline\">\\(s\\)</span> è½¬åŒ–ä¸º <span class=\"math inline\">\\(t\\)</span> æ‰€éœ€æœ€å°æ“ä½œæ¬¡æ•°å’Œï¼ˆè§„å®šæ— è§£çš„æ“ä½œæ¬¡æ•°ä¸º <span class=\"math inline\">\\(0\\)</span>ï¼‰ã€‚<span class=\"math inline\">\\(n\\le 2000\\)</span>ã€‚</p>\n</blockquote>\n<p>å¦‚æœæˆ‘ä»¬ä¹‹å‰åšè¿‡æŸäº›ä»¤äººå¿ƒï¼ˆå’¬ï¼‰æ—·ï¼ˆç‰™ï¼‰ç¥ï¼ˆåˆ‡ï¼‰æ€¡ï¼ˆé½¿ï¼‰çš„é¢˜ç›®ï¼Œä¼šå‘ç°è¿™ä¸ªæ“ä½œç­‰ä»·äºäº¤æ¢ä»»æ„ä¸¤ä¸ªç›¸é‚»æ•°ï¼Œå†è®©ä»–ä»¬å–åã€‚</p>\n<p>è¿›ä¸€æ­¥åœ°ï¼Œå¯ä»¥äº¤æ¢è¿ç®—é¡ºåºï¼Œå…ˆå–åæŸä¸ªä½ç½®ï¼Œå†äº¤æ¢ï¼Œå†å–åè¿™ä¸ªä½ç½®â€”â€”æŠŠè¿™ä¸ªæ“ä½œå¹³å‡åˆ†é…åˆ° <span class=\"math inline\">\\(s\\)</span> å’Œ <span class=\"math inline\">\\(t\\)</span> ä¸Šï¼Œ<mark>ç»“åˆã€ç›¸é‚»ä¸¤æ•°ä½ç½®å¿…ä¸€å¥‡ä¸€å¶ã€è¿™ä¸ªç¾å¦™çš„æ€§è´¨ï¼Œæƒ³åˆ°æŠŠ <span class=\"math inline\">\\(s\\)</span> å’Œ <span class=\"math inline\">\\(t\\)</span> çš„å¥‡æ•°ä½éƒ½æå‰å–åï¼Œè¿™æ ·å°±å¯ä»¥è½¬åŒ–æˆç›´æ¥äº¤æ¢äº†</mark>ï¼Œ</p>\n<p>æ¥ä¸‹æ¥å°±å’Œä¸Šä¸€é¢˜æœ‰ç‚¹ä¸ä¸€æ ·äº†ã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥ç®—ä¸€ä¸ªä½ç½®çš„è´¡çŒ®â€”â€”è¿™æ„å‘³ç€ä¸éœ€è¦ç»Ÿè®¡ä¸€ä¸ªåºåˆ—çš„ä»£ä»·ï¼ˆæ­¤æ—¶å¤±å»äº† <span class=\"math inline\">\\(k\\)</span> çš„é™åˆ¶ï¼Œä»£ä»·æ¥åˆ° <span class=\"math inline\">\\(n^2\\)</span> çº§åˆ«ï¼‰ã€‚ä»¤ <span class=\"math inline\">\\(f_{i,j}\\)</span> è¡¨ç¤ºä»å‰å¾€ååˆ°äº†ç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªä½ç½®ï¼Œæ¬ å€ºä¸º <span class=\"math inline\">\\(j\\)</span> çš„æ–¹æ¡ˆæ•°ï¼›åŒæ ·åœ°ï¼Œä»¤ <span class=\"math inline\">\\(g_{i,j}\\)</span> è¡¨ç¤ºä»ååˆ°å‰åˆ°äº†ç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªä½ç½®ï¼Œæ¬ å€ºä¸º <span class=\"math inline\">\\(j\\)</span> çš„æ–¹æ¡ˆæ•°ã€‚åˆ™è´¡çŒ®ä¸º <span class=\"math inline\">\\(\\sum_i \\sum_j f_{i, j}\\times g_{i + 1, -j}\\times j\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int mod = 1e9 + 7;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr), std::cout.tie(nullptr);\n#else\n    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);\n    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);\n#endif\n    int T;\n    for (std::cin &gt;&gt; T; T--; ) &#123;\n        int n;\n        std::string s, t;\n        std::cin &gt;&gt; n &gt;&gt; s &gt;&gt; t, s = &#39;#&#39; + s, t = &#39;#&#39; + t;\n        for (int i = 1; i &lt;= n; ++i)\n            if (i &amp; 1) &#123;\n                if (s[i] != &#39;?&#39;)\n                    s[i] = &#39;0&#39; + &#39;1&#39; - s[i];\n                if (t[i] != &#39;?&#39;)\n                    t[i] = &#39;0&#39; + &#39;1&#39; - t[i];\n            &#125;\n        using arr = std::vector&lt;long long&gt;;\n        using brr = std::vector&lt;arr&gt;;\n        brr f(n + 1, arr(2 * n + 1)), g(n + 2, arr(2 * n + 1));\n        f[0][n] = 1ll;\n        for (int i = 1; i &lt;= n; ++i) &#123;\n            for (int S = 0; S &lt;= 1; ++S)\n                if ((S == 0 &amp;&amp; s[i] == &#39;1&#39;) || (S == 1 &amp;&amp; s[i] == &#39;0&#39;));\n                else\n                    for (int T = 0; T &lt;= 1; ++T) &#123;\n                        if ((T == 0 &amp;&amp; t[i] == &#39;1&#39;) || (T == 1 &amp;&amp; t[i] == &#39;0&#39;));\n                        else\n                            for (int j = 0; j &lt;= 2 * n; ++j)\n                                if (j - (T - S) &gt;= 0 &amp;&amp; j - (T - S) &lt;= 2 * n)\n                                    (f[i][j] += f[i - 1][j - (T - S)]) %= mod;\n                    &#125;\n        &#125;\n        g[n + 1][n] = 1ll;\n        for (int i = n; i; --i) &#123;\n            for (int S = 0; S &lt;= 1; ++S)\n                if ((S == 0 &amp;&amp; s[i] == &#39;1&#39;) || (S == 1 &amp;&amp; s[i] == &#39;0&#39;));\n                else\n                    for (int T = 0; T &lt;= 1; ++T) &#123;\n                        if ((T == 0 &amp;&amp; t[i] == &#39;1&#39;) || (T == 1 &amp;&amp; t[i] == &#39;0&#39;));\n                        else\n                            for (int j = 0; j &lt;= 2 * n; ++j)\n                                if (j - (T - S) &gt;= 0 &amp;&amp; j - (T - S) &lt;= 2 * n)\n                                    (g[i][j] += g[i + 1][j - (T - S)]) %= mod;\n                    &#125;\n        &#125;\n        auto res(0ll);\n        for (int i = 1; i &lt; n; ++i)\n            for (int j = 1; j &lt;= n; ++j) &#123;\n                (res += j * f[i][n + j] % mod * g[i + 1][n - j] % mod) %= mod;\n                (res += j * f[i][n - j] % mod * g[i + 1][n + j] % mod) %= mod;\n            &#125;\n        std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n",
            "tags": [
                "DP"
            ]
        },
        {
            "id": "https://xsc062.netlify.app/20240501/",
            "url": "https://xsc062.netlify.app/20240501/",
            "title": "æ‚é¢˜é€‰è°ˆ",
            "date_published": "2024-05-01T07:44:48.000Z",
            "content_html": "<p><a href=\"https://www.becoder.com.cn/contest/5169\">SAM æ‚é¢˜</a> + <a href=\"https://www.becoder.com.cn/contest/5170\">NOIPS8</a> + <a href=\"https://www.becoder.com.cn/contest/5175\">å‘¨è€ƒ</a> é€‰è®²ã€‚</p>\n<p>çœ‹çœ‹è¿™ä¸ªæ ‡ç­¾åˆ—è¡¨é•¿åº¦å°±çŸ¥é“è¿™ä¸‰å¤©åšçš„é¢˜æœ‰å¤šæ‚ã€‚</p>\n<span id=\"more\"></span>\n<hr />\n<h3 id=\"d.-å­—ç¬¦ä¸²\">D. å­—ç¬¦ä¸²</h3>\n<p><a href=\"https://www.becoder.com.cn/contest/5169/problem/4\" class=\"uri\">https://www.becoder.com.cn/contest/5169/problem/4</a></p>\n<p>å’Œ SA çš„åšæ³•ä¸€æ ·ï¼Œå…ˆäºŒåˆ† <span class=\"math inline\">\\(s_{c\\sim d}\\)</span> çš„å‰ç¼€é•¿åº¦ <span class=\"math inline\">\\(mid\\)</span>ï¼Œåªéœ€ check <span class=\"math inline\">\\(s_{c \\sim c + mid - 1}\\)</span> æ˜¯å¦åœ¨ <span class=\"math inline\">\\(s_{a\\sim b}\\)</span> ä¸­å‡ºç°è¿‡ã€‚</p>\n<p>è€ƒè™‘æ€ä¹ˆå¿«é€Ÿ checkã€‚ä» <span class=\"math inline\">\\(c\\)</span> ä¸€æ­¥ä¸€æ­¥è·³åˆ° <span class=\"math inline\">\\(c+mid-1\\)</span> æ˜¾ç„¶ä¼šèµ·é£ï¼Œè€ƒè™‘åˆ°æŸ¥è¯¢æ˜¯é™æ€çš„ï¼Œæˆ‘ä»¬äº‹å…ˆé¢„å¤„ç†ä¸€ä¸‹ç„¶åå€å¢åœ°è·³å³å¯ã€‚</p>\n<p>æ­¤æ—¶åªéœ€çœ‹å½“å‰çŠ¶æ€çš„ <span class=\"math inline\">\\(\\text {endpos}\\)</span> æ˜¯å¦åœ¨ <span class=\"math inline\">\\([a + mid - 1, b]\\)</span> å‡ºç°è¿‡ã€‚</p>\n<p>å› ä¸ºè¿™ä¸ªä¸èƒ½ç”¨æœ€å¤§æœ€å°ç®€å•ä»£æ›¿ï¼Œæ‰€ä»¥å°±åˆ°äº†æˆ‘ä»¬å–œé—»ä¹è§çš„çº¿æ®µæ ‘åˆå¹¶ç¯èŠ‚ã€‚å°†æ’å…¥åçš„æ¯ä¸ªå•ç‚¹ <span class=\"math inline\">\\(\\text {endpos}\\)</span> åœ¨æƒå€¼çº¿æ®µæ ‘ä¸Šæ›´æ–°ï¼Œåœ¨ parent tree ä¸Šæš´åŠ›çº¿æ®µæ ‘åˆå¹¶å³å¯ã€‚</p>\n<p>ä¹‹å‰ä¸€ç›´æœ‰ä¸€ä¸ªè¯¯åŒºï¼Œå°±æ˜¯è§‰å¾—çº¿æ®µæ ‘åˆå¹¶æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œæ¯”å¦‚ç”¨ A æ ‘å’Œ B æ ‘å¹¶å‡ºæ¥äº† C æ ‘ä¹‹åï¼ŒA æ ‘å’Œ B æ ‘çš„æ•°æ®å°±æ— æ•ˆäº†ã€‚</p>\n<p>ä½†è¿™æ˜¾ç„¶æ˜¯å¾ˆè’è°¬çš„ï¼ŒåŒæ ·å› ä¸ºæˆ‘ä»¬çš„æŸ¥è¯¢æ˜¯é™æ€çš„ï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥ç”¨ä¸€ç§ç±»ä¼¼äºå¯æŒä¹…åŒ–çš„æ–¹å¼ï¼Œå»ºç«‹ä¸€äº›æ–°çš„ç‚¹è¡¨ç¤ºåˆå¹¶åçš„ä¿¡æ¯çŠ¶æ€ç‚¹ï¼Œä¸€äº›å¯ä»¥ä¿ç•™çš„ç‚¹å°±ä¿ç•™ä½œå„¿å­ã€‚</p>\n<p>åœ¨å¯¹åº”çš„çŠ¶æ€ä¸ŠæŸ¥è¯¢å³å¯ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxm = 35;\nconst int maxn = 6e5 + 5;\nconst int maxk = 8e7 + 5;\nstruct _ &#123;\n    int l, f;\n    int ne[maxm]; \n    _() &#123;&#125;\n    _(int l1, int f1): l(l1), f(f1) &#123;&#125;\n&#125;;\n_ t[maxn &lt;&lt; 1];\nint vis[maxn &lt;&lt; 1];\nint fa[maxn][maxm];\nint n, la, tot, siz;\nstruct &#123; int l, r, u; &#125; t1[maxk];\nint tab[maxn &lt;&lt; 1], cnt[maxn &lt;&lt; 1];\nvoid Init(void) &#123;\n    la = tot = 1;\n    t[1] = _(0, 0);\n    return;\n&#125;\nvoid ext(int c) &#123;\n    int p = la, np = ++tot;\n    la = tot;\n    t[np] = _(t[p].l + 1, 0);\n    while (p &amp;&amp; !t[p].ne[c])\n        t[p].ne[c] = np, p = t[p].f;\n    if (!p)\n        t[np].f = 1;\n    else &#123;\n        int q = t[p].ne[c];\n        if (t[q].l == t[p].l + 1)\n            t[np].f = q;\n        else &#123;\n            int nq = ++tot;\n            t[nq] = _(t[p].l + 1, t[q].f);\n            std::copy(t[q].ne, t[q].ne + 26, t[nq].ne);\n            while (p &amp;&amp; t[p].ne[c] == q)\n                t[p].ne[c] = nq, p = t[p].f;\n            t[q].f = nq;\n            t[np].f = nq;\n        &#125;\n    &#125;\n    return;\n&#125;\nint now = 0;\nvoid ins(int &amp;p, int l, int r, int v) &#123;\n    if (!p)\n        p = ++now;\n    ++t1[p].u;\n    if (l == r)\n        return;\n    int mid = (l + r) &gt;&gt; 1;\n    if (v &lt;= mid)\n        ins(t1[p].l, l, mid, v);\n    else\n        ins(t1[p].r, mid + 1, r, v);\n    return;\n&#125;\nint ask(int p, int l, int r, int ql, int qr) &#123;\n    if (ql &lt;= l &amp;&amp; r &lt;= qr)\n        return t1[p].u;\n    int mid = (l + r) &gt;&gt; 1, res = 0;\n    if (ql &lt;= mid)\n        res = ask(t1[p].l, l, mid, ql, qr);\n    if (qr &gt; mid)\n        res += ask(t1[p].r, mid + 1, r, ql, qr);\n    return res;\n&#125;\nint merge(int p, int q, int l, int r) &#123;\n    if (!p || !q)\n        return p + q;\n    int np = ++now, mid = (l + r) &gt;&gt; 1;\n    t1[np].u = t1[p].u + t1[q].u;\n    if (l == r) return np;\n    t1[np].l = merge(t1[p].l, t1[q].l, l, mid);\n    t1[np].r = merge(t1[p].r, t1[q].r, mid + 1, r);\n    return np;\n&#125;\nint pos[maxn], rt[maxn &lt;&lt; 1];\nbool check(int x, int a, int b, int c, int d) &#123;\n    assert(c + x - 1 &gt;= 0);\n    int p = pos[c + x - 1];\n    for (int i = siz; ~i; --i)\n        if (fa[p][i] &amp;&amp; t[fa[p][i]].l &gt;= x)\n            p = fa[p][i];\n    return ask(rt[p], 0, n - 1, a + x - 1, b) &gt; 0;\n&#125;\nint solve(int a, int b, int c, int d) &#123;\n    int l = 1, r = std::min(d - c + 1, b - a + 1), res = 0;\n    while (l &lt;= r) &#123;\n        int mid = (l + r) &gt;&gt; 1;\n        if (check(mid, a, b, c, d))\n            l = mid + 1, res = mid;\n        else\n            r = mid - 1;\n    &#125;\n    return res;\n&#125;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n    std::cout.tie(nullptr);\n#endif\n    int m;\n    std::string s;\n    std::cin &gt;&gt; n &gt;&gt; m &gt;&gt; s;\n    Init();\n    for (int i = 0; i &lt; n; ++i) &#123;\n        ext(s[i] - &#39;a&#39;);\n        pos[i] = la;\n        ins(rt[la], 0, n - 1, i);\n    &#125;\n    siz = log(tot) / log(2.0);\n    for (int i = 1; i &lt;= tot; ++i)\n        ++cnt[t[i].l];\n    std::partial_sum(cnt + 1, cnt + tot + 1, cnt + 1);\n    for (int i = 1; i &lt;= tot; ++i)\n        tab[cnt[t[i].l]--] = i;\n    for (int i = 1; i &lt;= tot; ++i) &#123;\n        int u = tab[i];\n        fa[u][0] = t[u].f;\n        for (int j = 1; j &lt;= siz; ++j)\n            fa[u][j] = fa[fa[u][j - 1]][j - 1];\n    &#125;\n    for (int i = tot; i; --i) &#123;\n        int u = tab[i];\n        if (t[u].f)\n            rt[t[u].f] = merge(rt[t[u].f], rt[u], 0, n - 1);\n    &#125;\n    while (m--) &#123;\n        int a, b, c, d;\n        std::cin &gt;&gt; a &gt;&gt; b &gt;&gt; c &gt;&gt; d;\n        std::cout &lt;&lt; solve(a - 1, b - 1, c - 1, d - 1) &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"f.-security\">F. Security</h3>\n<p><a href=\"https://www.becoder.com.cn/contest/5169/problem/6\" class=\"uri\">https://www.becoder.com.cn/contest/5169/problem/6</a></p>\n<p>å¯¹æˆ‘ä»¬æ¥è¯´åº”è¯¥æ˜¯ä¼š D å°±ä¼š F çš„ã€‚æ‰€ä»¥åªæ‰“äº† 10minã€‚</p>\n<p>é¦–å…ˆè€ƒè™‘ä¸€ä¸ªå¤§å®¶å–œé—»ä¹è§çš„ DFS æ±‚æœ€å°å­—å…¸åºã€‚æ˜¾ç„¶åœ°ï¼Œå¦‚æœå­˜åœ¨å’Œå½“å‰ä½ç›¸ç­‰çš„å­—ç¬¦ï¼Œé‚£ä¹ˆä¼˜å…ˆè·³ç›¸ç­‰å­—ç¬¦ï¼Œè¿›å…¥ä¸‹ä¸€å±‚æ·±æœï¼›å¦åˆ™æ‰¾åˆ°æœ€å°çš„æ›´å¤§å­—ç¬¦ï¼Œç„¶åç›´æ¥ outã€‚</p>\n<p>æ­¤æ—¶ SAM å°±æ˜¯æˆ‘ä»¬ç”¨æ¥åˆ¤æ–­ <span class=\"math inline\">\\(S_{l, r}\\)</span> ä¸­æ˜¯å¦å­˜åœ¨æŸçŠ¶æ€çš„å·¥å…·äº†ã€‚ç”šè‡³æ¯”ä¸Šä¸€é¢˜ç®€å•ï¼Œå› ä¸ºä¸ç”¨å†™äºŒåˆ†å’Œå€å¢ã€‚</p>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯å¦‚æœ <span class=\"math inline\">\\(S_{l, r}\\)</span> åŒ…å« <span class=\"math inline\">\\(T\\)</span> é‚£ä¹ˆè¿˜è¦åœ¨åé¢éšä¾¿åŠ ä¸€ä¸ªå­—ç¬¦ä»¥å­—å…¸åºä¿è¯ä¸¥æ ¼å¤§äº <span class=\"math inline\">\\(T\\)</span>ã€‚</p>\n<details>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯å› ä¸ºæˆ‘å†™çš„å¤ªä¸‘äº†ä»¥è‡³äºåœ¨ CF ä¸Šä¼šå…‰è£ MLE #46ã€‚ç„¶ååˆ†å±å·¦åŠè¾¹çœ‹æˆ‘ä»£ç å³åŠè¾¹å†™çš„ zwb å´æ²¡æœ‰ã€‚å•§ã€‚ä¸ºä»€ä¹ˆå‘¢ã€‚</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxm = 35;\nconst int maxn = 6e5 + 5;\nconst int maxk = 8e7 + 5;\nstruct _ &#123;\n    int l, f;\n    int ne[maxm]; \n    _() &#123;&#125;\n    _(int l1, int f1): l(l1), f(f1) &#123;&#125;\n&#125;;\n_ t[maxn &lt;&lt; 1];\nint vis[maxn &lt;&lt; 1];\nint fa[maxn][maxm];\nint n, la, tot, siz;\nstruct &#123; int l, r, u; &#125; t1[maxk];\nint tab[maxn &lt;&lt; 1], cnt[maxn &lt;&lt; 1];\nvoid Init(void) &#123;\n    la = tot = 1;\n    t[1] = _(0, 0);\n    return;\n&#125;\nvoid ext(int c) &#123;\n    int p = la, np = ++tot;\n    la = tot;\n    t[np] = _(t[p].l + 1, 0);\n    while (p &amp;&amp; !t[p].ne[c])\n        t[p].ne[c] = np, p = t[p].f;\n    if (!p)\n        t[np].f = 1;\n    else &#123;\n        int q = t[p].ne[c];\n        if (t[q].l == t[p].l + 1)\n            t[np].f = q;\n        else &#123;\n            int nq = ++tot;\n            t[nq] = _(t[p].l + 1, t[q].f);\n            std::copy(t[q].ne, t[q].ne + 26, t[nq].ne);\n            while (p &amp;&amp; t[p].ne[c] == q)\n                t[p].ne[c] = nq, p = t[p].f;\n            t[q].f = nq;\n            t[np].f = nq;\n        &#125;\n    &#125;\n    return;\n&#125;\nint now = 0;\nvoid ins(int &amp;p, int l, int r, int v) &#123;\n    if (!p)\n        p = ++now;\n    ++t1[p].u;\n    if (l == r)\n        return;\n    int mid = (l + r) &gt;&gt; 1;\n    if (v &lt;= mid)\n        ins(t1[p].l, l, mid, v);\n    else\n        ins(t1[p].r, mid + 1, r, v);\n    return;\n&#125;\nint ask(int p, int l, int r, int ql, int qr) &#123;\n    if (ql &lt;= l &amp;&amp; r &lt;= qr)\n        return t1[p].u;\n    int mid = (l + r) &gt;&gt; 1, res = 0;\n    if (ql &lt;= mid)\n        res = ask(t1[p].l, l, mid, ql, qr);\n    if (qr &gt; mid)\n        res += ask(t1[p].r, mid + 1, r, ql, qr);\n    return res;\n&#125;\nint merge(int p, int q, int l, int r) &#123;\n    if (!p || !q)\n        return p + q;\n    int np = ++now, mid = (l + r) &gt;&gt; 1;\n    t1[np].u = t1[p].u + t1[q].u;\n    if (l == r) return np;\n    t1[np].l = merge(t1[p].l, t1[q].l, l, mid);\n    t1[np].r = merge(t1[p].r, t1[q].r, mid + 1, r);\n    return np;\n&#125;\nint pos[maxn], rt[maxn &lt;&lt; 1];\nbool check(int p, int ch, int l, int r) &#123;\n    return ask(rt[t[p].ne[ch]], 0, n - 1, l, r) &gt; 0;\n&#125;\nbool fun(std::string &amp;res, std::string now, std::string &amp;t, int x, int p, int l, int r) &#123;\n    // std::cout &lt;&lt; &quot;x = &quot; &lt;&lt; x &lt;&lt; &quot;, now = \\&quot;&quot; &lt;&lt; now &lt;&lt; &quot;\\&quot;;\\n&quot;;\n    if (x != (int)t.length() &amp;&amp; check(p, t[x] - &#39;a&#39;, l + x, r) &amp;&amp; fun(res, now + t[x], t, x + 1, ::t[p].ne[t[x] - &#39;a&#39;], l, r))\n        return 1;\n    for (int i = (x == (int)t.length()) ? 0 : t[x] - &#39;a&#39; + 1; i &lt; 26; ++i) &#123;\n        if (check(p, i, l + x, r)) &#123;\n            now += i + &#39;a&#39;;\n            res = now;\n            return 1;\n        &#125;\n    &#125;\n    return 0;\n&#125;\nstd::string solve(std::string &amp;t, int l, int r) &#123;\n    std::string res;\n    return fun(res, &quot;&quot;, t, 0, 1, l, r) ? res : &quot;-1&quot;;\n&#125;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n    std::cout.tie(nullptr);\n#endif\n    int q;\n    std::string s;\n    std::cin &gt;&gt; s &gt;&gt; q;\n    n = (int)s.length();\n    Init();\n    for (int i = 0; i &lt; n; ++i) &#123;\n        ext(s[i] - &#39;a&#39;);\n        pos[i] = la;\n        ins(rt[la], 0, n - 1, i);\n    &#125;\n    siz = log(tot) / log(2.0);\n    for (int i = 1; i &lt;= tot; ++i)\n        ++cnt[t[i].l];\n    std::partial_sum(cnt + 1, cnt + tot + 1, cnt + 1);\n    for (int i = 1; i &lt;= tot; ++i)\n        tab[cnt[t[i].l]--] = i;\n    for (int i = 1; i &lt;= tot; ++i) &#123;\n        int u = tab[i];\n        fa[u][0] = t[u].f;\n        for (int j = 1; j &lt;= siz; ++j)\n            fa[u][j] = fa[fa[u][j - 1]][j - 1];\n    &#125;\n    for (int i = tot; i; --i) &#123;\n        int u = tab[i];\n        if (t[u].f)\n            rt[t[u].f] = merge(rt[t[u].f], rt[u], 0, n - 1);\n    &#125;\n    while (q--) &#123;\n        int l, r;\n        std::string t;\n        std::cin &gt;&gt; l &gt;&gt; r &gt;&gt; t;\n        std::cout &lt;&lt; solve(t, l - 1, r - 1) &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"a.-å…­å‡ºç¥å±±\">A. å…­å‡ºç¥å±±</h3>\n<p><a href=\"https://www.becoder.com.cn/contest/5170/problem/1\" class=\"uri\">https://www.becoder.com.cn/contest/5170/problem/1</a></p>\n<p>æ˜¯èƒ½ç”¨è´ªå¿ƒæ‹¿ 60pts çš„ DP é¢˜ /tuu</p>\n<p>éœ€è¦å…ˆæŠŠæš´åŠ›çš„å¼å­å†™å‡ºæ¥ã€‚è®¾ <span class=\"math inline\">\\(f_{i, j}\\)</span> ä¸ºå°† <span class=\"math inline\">\\(i\\)</span> å±±ä¿®æ”¹é«˜åº¦ä¸º <span class=\"math inline\">\\(j\\)</span> çš„ä»£ä»·ï¼Œåˆ™ï¼š</p>\n<p><span class=\"math display\">\\[\nf_{i, j} = \\min\\limits_{k\\in [j-d, j+d]}\\left\\{f_{i-1, k}\\right\\} + |h_i - j|\n\\]</span></p>\n<p>æ³¨æ„åˆ°å¯ä»¥å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–ã€‚ä½†æ˜¯è¿™æ ·åšå¤æ‚åº¦è¿˜æ˜¯ <span class=\"math inline\">\\(O(nV)\\)</span> çš„ï¼Œæ ¹æœ¬åŸå› åœ¨äºç¬¬äºŒç»´è¿™ä¸ª <span class=\"math inline\">\\(V\\)</span> çš„çŠ¶æ€æ•°å¤ªå¤šäº†ã€‚</p>\n<p>æ ¹æ®ç›´è§‰ï¼Œæœ€å <span class=\"math inline\">\\(j\\)</span> çš„å€¼åº”ä¸º <span class=\"math inline\">\\(k+d\\)</span> æˆ– <span class=\"math inline\">\\(k-d\\)</span> æˆ– <span class=\"math inline\">\\(a_i\\)</span>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œåˆæ³•çš„çŠ¶æ€æ•°ä¸ºæ‰€æœ‰çš„ <span class=\"math inline\">\\(a_i+x\\times d, x\\in[-n, n]\\)</span>ã€‚</p>\n<details>\n<p><summary>æ­£ç¡®æ€§è¯æ˜â€¦â€¦</summary></p>\n<p>è€ƒè™‘å…¨éƒ¨æ›´æ”¹å®Œåçš„ç»“æŸçŠ¶æ€ï¼Œå³æœ€åçš„æœ€ä¼˜çŠ¶æ€ã€‚</p>\n<p>è€ƒè™‘æ‰€æœ‰å±±ä¸­æœ€çŸ®çš„å±± <span class=\"math inline\">\\(i\\)</span>ï¼Œæ­¤å±±çš„é«˜åº¦è¦ä¹ˆä¸º <span class=\"math inline\">\\(h_i\\)</span>ï¼Œè¦ä¹ˆä¸ºå‰ä¸€åº§å±±çš„é«˜åº¦ <span class=\"math inline\">\\(-d\\)</span>ï¼Œè¦ä¹ˆä¸ºåä¸€åº§å±±çš„é«˜åº¦ <span class=\"math inline\">\\(-d\\)</span>ã€‚</p>\n<p>è€ƒè™‘ç¬¬äºŒçŸ®çš„å±±ï¼Œä»¥æ­¤ç±»æ¨å³å¯ã€‚</p>\n</details>\n<p>å°†ç¬¬äºŒç»´çš„çŠ¶æ€é›†å¤§å°å‡å°‘ä¸º <span class=\"math inline\">\\(O(n^2)\\)</span>ï¼Œæ€»æ—¶é—´å¤æ‚åº¦ä¸º <span class=\"math inline\">\\(O(n^3)\\)</span>ã€‚</p>\n<details>\n<p>éœ€æ³¨æ„åˆ°å› ä¸º <span class=\"math inline\">\\(a_i+x\\times d\\)</span> ä¸­çš„ <span class=\"math inline\">\\(x\\)</span> èŒƒå›´ä¸º <span class=\"math inline\">\\([-n, n]\\)</span> å…± <span class=\"math inline\">\\(2\\times n\\)</span>ï¼Œæ‰€ä»¥ DP æ•°ç»„ç¬¬äºŒç»´å¤§å°ä¸€å®šè¦å¼€ <span class=\"math inline\">\\(2\\times n^2\\)</span> å‘€ï¼ï¼ï¼</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nusing ll = long long;\nconst int maxn = 305;\nconst int maxm = 18e4 + 5;\nconst ll inf = 0x3f3f3f3f3f3f3f3f;\nll d;\nint n;\nll h[maxn];\nll f[maxn][maxm];\nint main() &#123;\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n    std::cout.tie(nullptr);\n    memset(f, 0x3f, sizeof (f));\n    std::cin &gt;&gt; n &gt;&gt; d;\n    std::vector&lt;ll&gt; st;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; h[i];\n        for (ll j = -n; j &lt;= n; ++j)\n            st.push_back(h[i] + j * d);\n    &#125;\n    std::sort(st.begin(), st.end());\n    st.erase(std::unique(st.begin(), st.end()), st.end());\n    auto abs = [&amp;](ll x) -&gt; ll &#123; return x &gt;= 0 ? x : -x; &#125;;\n    f[1][lower_bound(st.begin(), st.end(), h[1]) - st.begin()] = 0;\n    for (int i = 2; i &lt;= n; ++i) &#123;\n        int h(1), t(0), p(-1);\n        static int q[maxm];\n        for (int j = 0; j &lt; (int)st.size(); ++j) &#123;\n            while (p &lt; (int)st.size() &amp;&amp; st[p + 1] &lt;= st[j] + d) &#123;\n                ++p;\n                while (h &lt;= t &amp;&amp; f[i - 1][p] &lt;= f[i - 1][q[t]])\n                    --t;\n                q[++t] = p;\n            &#125;\n            while (h &lt;= t &amp;&amp; st[q[h]] &lt; st[j] - d)\n                ++h;\n            if (h &lt;= t)\n                f[i][j] = std::min(inf, f[i - 1][q[h]] + abs(st[j] - ::h[i]));\n        &#125;\n    &#125;\n    ll res = f[n][std::lower_bound(st.begin(), st.end(), h[n]) - st.begin()];\n    std::cout &lt;&lt; (res == inf ? -1 : res) &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"b.-æ°´æ·¹ä¸ƒå†›\">B. æ°´æ·¹ä¸ƒå†›</h3>\n<p><a href=\"https://www.becoder.com.cn/contest/5170/problem/2\" class=\"uri\">https://www.becoder.com.cn/contest/5170/problem/2</a></p>\n<p>å®¹æ˜“å‘ç°æœ€åè¿å‡ºæ¥ä¸€å®šæ˜¯æ²¡æœ‰ç¯çš„ã€‚æ‰€ä»¥ä¸€å®šæ˜¯ä¸€ä¸ª DAGã€‚</p>\n<p>æˆ‘ä»¬çŸ¥é“çŠ¶æ€å‹ç¼©æ˜¯ä¼šéå†åˆ°æ¯ä¸€ç§æƒ…å†µçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‡è®¾å½“å‰çš„ DAG å°±æ˜¯è¯¥çŠ¶æ€ä¸‹çš„æœ€ä¼˜ã€‚</p>\n<p>è‡³äºè¿™ä¸ªã€Œæœ€ä¼˜ã€å¦‚ä½•å®šä¹‰å°±è¦äº¤ç»™æˆ‘ä»¬äº†ã€‚æˆ‘ä»¬ä¸å¦¨å¼ºåˆ¶è®¤ä¸ºè¿™ä¸ª DAG æ˜¯æŒ‰å±‚åºéå†å¾—åˆ°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿ç»­éå†åˆ°çš„ç‚¹å±äºåŒä¸€å±‚ï¼ˆè¿™é‡Œçš„å±‚æ˜¯æŒ‡æŸç‚¹åˆ°ä»»æ„æºç‚¹çš„æœ€é•¿è·¯é•¿åº¦ï¼‰ã€‚</p>\n<p>æ˜¾ç„¶åªæœ‰ä¸€ç»„ç›¸äº’ä¹‹é—´æ²¡æœ‰ä»»ä½•è¿è¾¹çš„ç‚¹æ‰èƒ½ç»„æˆåŒä¸€å±‚ã€‚ä¸å¦¨æšä¸¾ç‚¹é›†ç„¶åæš´åŠ›è½¬ç§»ï¼Œè½¬ç§»æ—¶è®°å½•è·¯å¾„å³å¯ã€‚</p>\n<details>\n<p>æ³¨æ„åˆ°åœ¨å†™è¿™ç©æ„å„¿çš„æ—¶å€™æˆ‘è¿˜ä¸ä¼š <a href=\"/2024/05/17/20240517/\">çŠ¶å‹æšä¸¾å­é›†</a>ï¼Œæ‰€ä»¥æšä¸¾å­é›†çš„éƒ¨åˆ†å¯èƒ½æ‰“å¾—æ¯”è¾ƒæŠ½è±¡ã€‚</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxn = 25;\nconst int inf = 0x3f3f3f3f;\nconst int maxm = (1 &lt;&lt; 16) + 5;\nint n, res;\nint tag[maxn][maxn];\nint f[maxn], g[maxn];\nint solve(std::vector&lt;int&gt;&amp; a) &#123;\n    static int g[maxn];\n    static int f[maxm], p[maxm];\n    int n(a.size()), siz(1 &lt;&lt; n);\n    std::fill(g, g + n, 0);\n    std::fill(p, p + siz + 1, 0);\n    std::fill(f, f + siz + 1, inf);\n    std::vector&lt;int&gt; st;\n    for (int i = 0; i &lt; n; ++i) &#123;\n        for (int j = 0; j &lt; n; ++j) &#123;\n            if (::g[a[i]] &amp; (1 &lt;&lt; a[j]))\n                g[i] |= 1 &lt;&lt; j;\n        &#125;\n    &#125;\n    for (int i = 1; i &lt; siz; ++i) &#123;\n        int now = 0;\n        for (int j = 0; j &lt; n; ++j) &#123;\n            if (i &amp; (1 &lt;&lt; j))\n                now |= g[j];\n        &#125;\n        if (!(now &amp; i))\n            st.push_back(i), f[i] = 0, p[i] = i;\n        for (auto j : st) &#123;\n            if (!(i &amp; j)) &#123;\n                if (f[i | j] &gt; f[i] + 1)\n                    f[i | j] = f[i] + 1, p[i | j] = j;\n            &#125;\n        &#125;\n    &#125;\n    int now = siz - 1;\n    while (now) &#123;\n        int fa = now ^ p[now];\n        for (int i = 0; i &lt; n; ++i)\n            if (p[now] &amp; (1 &lt;&lt; i))\n                for (int j = 0; j &lt; n; ++j)\n                    if ((fa &amp; (1 &lt;&lt; j)) &amp;&amp; tag[a[j]][a[i]] == 2)\n                        tag[a[j]][a[i]] = 1, tag[a[i]][a[j]] = -1;\n        now = fa;\n    &#125;\n    return f[siz - 1];\n&#125;\nint find(int x) &#123;\n    return x == f[x] ? x : f[x] = find(f[x]);\n&#125;\nint main() &#123;\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n    std::cout.tie(nullptr);\n    int m;\n    std::cin &gt;&gt; n &gt;&gt; m;\n    std::vector&lt;std::pair&lt;int, int&gt; &gt; edge;\n    for (int i = 0; i &lt; n; ++i)\n        f[i] = i;\n    while (m--) &#123;\n        int x, y;\n        std::cin &gt;&gt; x &gt;&gt; y;\n        edge.emplace_back(--x, --y);\n        f[find(x)] = find(y);\n        g[x] |= 1 &lt;&lt; y;\n        g[y] |= 1 &lt;&lt; x;\n        tag[x][y] = tag[y][x] = 2;\n    &#125;\n    std::vector&lt;int&gt; ver[maxn];\n    for (int i = 0; i &lt; n; ++i) &#123;\n        ver[find(i)].push_back(i);\n    &#125;\n    for (int i = 0; i &lt; n; ++i) &#123;\n        if (f[i] == i)\n            res = std::max(res, solve(ver[i]));\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    for (auto i : edge) &#123;\n        if (tag[i.first][i.second] == 1)\n            std::cout &lt;&lt; i.first + 1 &lt;&lt; &#39; &#39; &lt;&lt; i.second + 1 &lt;&lt; &#39;\\n&#39;;\n        else std::cout &lt;&lt; i.second + 1 &lt;&lt; &#39; &#39; &lt;&lt; i.first + 1 &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"c.-ç…®é…’è®ºè‹±é›„\">C. ç…®é…’è®ºè‹±é›„</h3>\n<p><a href=\"https://www.becoder.com.cn/contest/5170/problem/3\" class=\"uri\">https://www.becoder.com.cn/contest/5170/problem/3</a></p>\n<p>æ³¨æ„åˆ°å¦‚æœå­˜åœ¨ä¸²è¢«å…¶ä»–ä¸²åŒ…å«é‚£ä¹ˆç›´æ¥å°†å…¶æ¯™æ‰å°±å¯ä»¥äº†ã€‚</p>\n<p>å¯¹äºç›¸äº’ä¸å®Œå…¨åŒ…å«çš„ä¸²ï¼Œæˆ‘ä»¬ä»¤ <span class=\"math inline\">\\(mx_{i, j, 0/1, 0/1}\\)</span> è¡¨ç¤ºå°†æ­£åº / é€†åºçš„ <span class=\"math inline\">\\(i\\)</span> ä¸²æ‹¼åˆ°æ­£åº / é€†åºçš„ <span class=\"math inline\">\\(j\\)</span> ä¸²ä¹‹å‰ï¼Œä¸¤è€…å…±ç”¨ç›¸æ¥å…¬å…±éƒ¨åˆ†çš„ä¸²é•¿ã€‚è¿™ä¸ªå¯ä»¥ç”¨å­—ç¬¦ä¸²å“ˆå¸Œæš´åŠ›æ±‚ã€‚</p>\n<p>ç”¨çŠ¶å‹æšä¸¾æ‹¼æ¥é¡ºåºï¼Œæ±‚å¾—æœ€å°æ€»ä¸²é•¿å³å¯ã€‚</p>\n<p>æ³¨æ„å¦‚æœå»æ‰è¢«åŒ…å«ä¸²å <span class=\"math inline\">\\(n=1\\)</span> æ—¶éœ€ç›´æ¥è¾“å‡ºä¸²çš„ borderï¼›ä»¥åŠç­”æ¡ˆéœ€å’Œ <span class=\"math inline\">\\(2\\)</span> å– <span class=\"math inline\">\\(\\max\\)</span>ã€‚</p>\n<p>å®ç°èµ·æ¥åˆè‡­åˆé•¿ï¼Œä½†å®é™…ä¸Šæ€è·¯ç¡®å®éå¸¸ç®€å•ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nusing ll = long long;\nconst int p = 131;\nconst int maxn = 25;\nconst int lim = 2e4;\nconst int maxl = 2e4 + 5;\nconst int mod = 998244353;\nconst int inf = 0x3f3f3f3f;\nconst int maxm = (1 &lt;&lt; 16) + 5;\nint n;\nstd::vector&lt;std::string&gt; s;\nstd::vector&lt;std::vector&lt;ll&gt; &gt; h[2];\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n    std::cout.tie(nullptr);\n#endif\n    std::cin &gt;&gt; n;\n    s.resize(n);\n    h[0].resize(n);\n    h[1].resize(n);\n    static ll base[maxl];\n    static bool del[maxn];\n    base[0] = 1;\n    for (int i = 1; i &lt;= lim; ++i)\n        base[i] = base[i - 1] * p % mod;\n\n    for (int i = 0; i &lt; n; ++i) &#123;\n        std::cin &gt;&gt; s[i];\n        h[0][i].resize((int)s[i].length());\n        h[1][i].resize((int)s[i].length());\n        ll x = 0;\n        for (int j = 0; j &lt; (int)s[i].length(); ++j, (x *= p) %= mod)\n            h[0][i][j] = ((x += s[i][j]) %= mod);\n        std::reverse(s[i].begin(), s[i].end());\n        x = 0;\n        for (int j = 0; j &lt; (int)s[i].length(); ++j, (x *= p) %= mod)\n            h[1][i][j] = ((x += s[i][j]) %= mod);\n        std::reverse(s[i].begin(), s[i].end());\n    &#125;\n\n    std::vector&lt;int&gt; tab;\n    auto gethash = [&amp;](int i, int l, int r, bool t) -&gt; ll &#123;\n        if (l &gt; r) return 0;\n        ll res = (h[t][i][r] - (l ? h[t][i][l - 1] : 0) * base[r - l + 1] % mod);\n        return (res % mod + mod) % mod;\n    &#125;;\n    // ll now = 0;\n    // for (int i = 0; i &lt;= 4; ++i)\n    //     now = (now * p + s[1][i]) % mod;\n    // printf(&quot;now = %lld\\n&quot;, now);\n    // now = 0;\n    // for (int i = 3; i &lt;= 7; ++i)\n    //     now = (now * p + s[0][i]) % mod;\n    // printf(&quot;now = %lld\\n&quot;, now);\n    // printf(&quot;# %lld\\n&quot;, h[0][0].back());\n    for (int i = 0; i &lt; n; ++i) &#123;\n        tab.push_back(i);\n        for (int j = 0; j &lt; n; ++j)\n            if (!del[j] &amp;&amp; i != j)\n                for (int k = 0; k &lt;= ((int)s[j].length()) - ((int)s[i].length()); ++k) &#123;\n                    // printf(&quot;i = %d, j = %d, k = %d, %lld / %lld\\n&quot;, i, j, k,\n                    //         gethash(i, 0, ((int)s[i].length()) - 1, 0), gethash(j, k, k + ((int)s[i].length()) - 1, 0));\n                    if (h[0][i].back() == gethash(j, k, k + ((int)s[i].length()) - 1, 0)) &#123;\n                        tab.pop_back();\n                        del[i] = 1;\n                        goto outo;\n                    &#125;\n                &#125;\n        outo: ;\n    &#125;\n    n = (int)tab.size();\n    if (n == 1) &#123;\n        int border;\n        for (border = ((int)s[tab[0]].length()) - 1; ~border; --border) &#123;\n            if (gethash(tab[0], 0, border - 1, 0) == gethash(tab[0], ((int)s[tab[0]].length()) - border, ((int)s[tab[0]].length()) - 1, 0))\n                break;\n        &#125;\n        std::cout &lt;&lt; std::max(2, ((int)s[tab[0]].length()) - border) &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    else &#123;\n        static int mx[maxn][maxn][2][2];\n        for (int i = 0; i &lt; n; ++i)\n            for (int j = 0; j &lt; n; ++j)\n                for (int a = 0; a &lt; 2; ++a)\n                    for (int b = 0; b &lt; 2; ++b)\n                        for (int k = std::min((int)s[tab[i]].length(), (int)s[tab[j]].length()); ~k; --k) &#123;\n                            if (gethash(tab[i], ((int)s[tab[i]].length()) - k, ((int)s[tab[i]].length()) - 1, a) ==\n                                                                                            gethash(tab[j], 0, k - 1, b)) &#123;\n                                mx[i][j][a][b] = (int)s[tab[j]].length() - k;\n                                // printf(&quot;%d(%d) + %d(%d) = %d, k = %d\\n&quot;, i, a, j, b, mx[i][j][a][b], k);\n                                break;\n                            &#125;\n                        &#125;\n        static int f[maxm][maxn][2];\n        memset(f, 0x3f, sizeof (f));\n\n        int siz = 1 &lt;&lt; n, res = inf;\n        f[1][0][0] = (int)s[tab[0]].length();\n        for (int i = 1; i &lt; siz; ++i)\n            for (int j = 0; j &lt; n; ++j)\n                if (i &amp; (1 &lt;&lt; j))\n                    for (int a = 0; a &lt; 2; ++a) &#123;\n                        // printf(&quot;f[%d][%d][%d] = %d\\n&quot;, i, j, a, f[i][j][a]);\n                        for (int k = 0; k &lt; n; ++k)\n                            if (!(i &amp; (1 &lt;&lt; k)))\n                                for (int b = 0; b &lt; 2; ++b)\n                                    f[i | (1 &lt;&lt; k)][k][b] = std::min(f[i | (1 &lt;&lt; k)][k][b], f[i][j][a] + mx[j][k][a][b]);\n                        if (i == siz - 1)\n                            res = std::min(res, f[i][j][a] - (int)s[tab[0]].length() + mx[j][0][a][0]);\n                    &#125;\n        \n        std::cout &lt;&lt; std::max(2, res) &lt;&lt; &#39;\\n&#39;;\n    &#125;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"a.-ææ–‘é©¬\">A. ææ–‘é©¬</h3>\n<p><a href=\"https://www.becoder.com.cn/contest/5175/problem/1\" class=\"uri\">https://www.becoder.com.cn/contest/5175/problem/1</a></p>\n<p>æˆ‘ç”šè‡³ä¸ä¼šï¼ˆï¼‰</p>\n<p>ç¿»è½¬ + æ‹¼æ¥æœ¬è´¨ä¸Šå°±æ˜¯é¦–å°¾ç›¸æ¥ã€‚æˆ‘ä»¬æŠŠå­—ç¬¦ä¸²æ•´ä¸ªæ‹¼åˆ°è‡ªå·±åè¾¹å„¿ï¼Œç„¶åä»»å–ä¸€æ®µé•¿åº¦ä¸º <span class=\"math inline\">\\(n\\)</span> çš„ä¸²å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå€’è¿‡æ¥çš„æ“ä½œåçš„å­—ç¬¦ä¸²ã€‚</p>\n<p>æ³¨æ„åˆ°å¯ä»¥æ“ä½œå¾ˆå¤šæ¬¡ã€‚ä½†æ˜¯æ—¢ç„¶æˆ‘ä»¬æ“ä½œåçš„ä¸²ä¹Ÿå¯ä»¥åœ¨è¿™ä¸ªæ‹¼æ¥åçš„ä¸²ä¸­æ‰¾åˆ°äº†ï¼Œé‚£ä¹ˆå…¶å®å¤šæ¬¡æ“ä½œåçš„ä¹Ÿè¡Œã€‚</p>\n<p>æ‰€ä»¥å‘¢æˆ‘ä»¬åœ¨æ‹¼æ¥åçš„ä¸²ç§æšä¸¾æ¯ä¸€ä¸ªé•¿åº¦ä¸º <span class=\"math inline\">\\(n\\)</span> çš„ä¸²è®¡ç®—ç­”æ¡ˆå³å¯ã€‚</p>\n<p>å…·ä½“æ€ä¹ˆç®—å‘¢ï¼Ÿæ³¨æ„åˆ°åªçœ‹å¼€å¤´ï¼Œä¹Ÿå°±æ˜¯åœ¨æ–°ä¸²ä¸­åªçœ‹ç¦»æˆ‘ä»¬å½“å‰æšä¸¾çš„å³ç«¯ç‚¹æœ€è¿‘çš„é‚£ä¸€æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰“ä¸€ä¸ªåŒæŒ‡é’ˆï¼Œçœ‹è¿™ä¸€æ®µæ˜¯å¦åœ¨å³ç§»åä»ç„¶åˆæ³•ï¼Œå¦‚æœéæ³•å°±æŠŠç­”æ¡ˆåŒºé—´å·¦ç«¯ç‚¹æ›´æ–°ä¸ºå³ç«¯ç‚¹è‡ªå·±ã€‚ä»¥åŠæ³¨æ„åˆ°å·¦å³ç«¯ç‚¹çš„è·ç¦»ä¸èƒ½è¶…è¿‡ <span class=\"math inline\">\\(n\\)</span>ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nint res;\nstd::string s;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n    std::cout.tie(nullptr);\n#endif\n    std::cin &gt;&gt; s;\n    int l = 0, r = -1, n = (int)s.length();\n    char la = 0;\n    s += s;\n    while (++r &lt; (int)s.length()) &#123;\n        if (s[r] == la)\n            l = r;\n        while (r - l + 1 &gt; n) ++l;\n        la = s[r];\n        res = std::max(res, r - l + 1);\n    &#125;\n    std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"d.-é“¾çŠ¶é—ªç”µ\">D. é“¾çŠ¶é—ªç”µ</h3>\n<p><a href=\"https://www.becoder.com.cn/contest/5175/problem/4\" class=\"uri\">https://www.becoder.com.cn/contest/5175/problem/4</a></p>\n<p>è«åå…¶å¦™ä¸”åˆè‡­åˆé•¿çš„æ ¹å·åšæ³•ã€‚</p>\n<p>å®¹æ˜“å‘ç°ä¸€ä¸ªæ€ªè¢«æ€æ‰äº†åºåˆ—å°±ä¼šè£‚å¼€æˆä¸¤æ®µè¿ç»­å­åºåˆ—ï¼Œä»¥åŠæœ€å…ˆè¢«æ€æ‰çš„æ€ªç‰©ä¸€å®šè¡€é‡æœ€å°‘ã€‚åœ¨è£‚å¼€æ¥çš„ä¸¤æ®µè¿ç»­å­åºåˆ—ä¸­ä¹Ÿæ»¡è¶³æ­¤è§„å¾‹ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>\n<p>è€ƒè™‘å¯¹åºåˆ—å»ºç«‹ç¬›å¡å°”æ ‘ã€‚ä»¤æ ‘æ ¹ä¸º <span class=\"math inline\">\\(rt\\)</span>ï¼Œå½“å‰æ”»å‡»åŠ›ä¸º <span class=\"math inline\">\\(k\\)</span>ï¼Œè®° <span class=\"math inline\">\\(t_{x, k}=\\left\\lceil \\dfrac {h_x}k \\right\\rceil\\)</span>ï¼Œå³ä¸è€ƒè™‘å…¶ä»–æ¡ä»¶æ—¶å‡»å€’ <span class=\"math inline\">\\(x\\)</span> æ‰€éœ€æ¬¡æ•°ã€‚</p>\n<p>é‚£ä¹ˆå¯¹äº <span class=\"math inline\">\\(rt\\)</span> çš„å·¦ã€å³å„¿å­ <span class=\"math inline\">\\(l,r\\)</span>ï¼Œå•è€ƒè™‘è¿™ä¸‰ä¸ªæ€ªç‰©æ‰€éœ€çš„æ€»å‡»å€’æ¬¡æ•°ï¼Œå®¹æ˜“å‘ç°ä¸º <span class=\"math inline\">\\(t_{rt,k}+(t_{l,k}-t_{rt,k})+(t_{r,k}-t_{rt,k})\\)</span>ã€‚</p>\n<p>å¯¹äº <span class=\"math inline\">\\(l\\)</span> å¼•å¯¼çš„å­æ ‘ï¼Œæ­¤æ—¶çš„å®é™…å·²æ”»å‡»æ¬¡æ•°ä¸º <span class=\"math inline\">\\(t_{l,k}\\)</span>ï¼›æ‰€ä»¥å¯¹äº <span class=\"math inline\">\\(l\\)</span> çš„å·¦å³å„¿å­ <span class=\"math inline\">\\(l&#39;,r&#39;\\)</span>ï¼Œå‡»å€’è¿™ä¸¤ä¸ªæ€ªç‰©çš„æ‰€éœ€æ¬¡æ•°ä¸º <span class=\"math inline\">\\((t_{l&#39;,k} - t_{l,k})+(t_{r&#39;,k}-t_{l,k})\\)</span>ã€‚<span class=\"math inline\">\\(r\\)</span> å¼•å¯¼çš„å­æ ‘åŒç†ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ï¼Œå¦‚æœå­˜åœ¨æ ‘è¾¹ <span class=\"math inline\">\\(u\\to v\\)</span>ï¼Œé‚£ä¹ˆå‡»å€’ <span class=\"math inline\">\\(v\\)</span> çš„æ‰€éœ€æ¬¡æ•°ä¸º <span class=\"math inline\">\\(t_{v,k}-t_{u,k}\\)</span>ï¼›ç‰¹åˆ«åœ°ï¼Œå‡»å€’ <span class=\"math inline\">\\(rt\\)</span> çš„æ‰€éœ€æ¬¡æ•°ä¸º <span class=\"math inline\">\\(t_{rt,k}\\)</span>ã€‚</p>\n<p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸€æ¬¡ <span class=\"math inline\">\\(O(n)\\)</span> çš„æ ‘ä¸Š DFS å¯¹äºä¸€ä¸ª <span class=\"math inline\">\\(k\\)</span> æ‰¾åˆ°ç­”æ¡ˆäº†ã€‚</p>\n<p>é‚£ä¹ˆå¯¹äº <span class=\"math inline\">\\(2\\times 10^4\\)</span> èŒƒå›´å†…çš„æ‰€æœ‰ <span class=\"math inline\">\\(k\\)</span>ï¼Œåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å°±è¦åˆ©ç”¨ <span class=\"math inline\">\\(t\\)</span> çš„æ€§è´¨è¿›è¡Œæ ¹å·åˆ†æ²»äº†ã€‚</p>\n<ul>\n<li><p>å¯¹äº <span class=\"math inline\">\\(k\\le \\sqrt {2\\times 10^4}\\)</span>ï¼Œæˆ‘ä»¬å¤§å¯ä»¥ç›´æ¥åšè¿™ä¹ˆå¤šæ¬¡ DFS å¾—åˆ°ç­”æ¡ˆï¼›</p></li>\n<li><p>å¯¹äº <span class=\"math inline\">\\(k&gt;\\sqrt {2\\times 10^4}\\)</span>ï¼š</p>\n<p>æˆ‘ä»¬å®¹æ˜“å‘ç°æœ€ç»ˆçš„ç»“æœæ˜¯è‹¥å¹²ä¸ª <span class=\"math inline\">\\(t\\)</span> çš„å€¼ç›¸åŠ å‡å¾—åˆ°çš„ï¼Œè€Œæ¯ä¸ª <span class=\"math inline\">\\(t\\)</span> çš„æƒå€¼ <span class=\"math inline\">\\(cnt\\)</span> å–å†³äºå…¶åœ¨ç¬›å¡å°”æ ‘ä¸Šçš„å„¿å­ä¸ªæ•°ï¼Œæœ‰å¤šå°‘å°±åœ¨ <span class=\"math inline\">\\(1\\)</span> çš„åŸºç¡€ä¸Šå‡å»å¤šå°‘ã€‚</p>\n<p>ç”±äº <span class=\"math inline\">\\(t\\)</span> å®åœ¨è¿‡äºç‰¹æ®Šï¼Œè€ƒè™‘æ•´é™¤åˆ†å— / æ•°è®ºåˆ†å—ã€‚å¯¹äºæ¯ä¸ª <span class=\"math inline\">\\(x\\)</span>ï¼Œå¯¹äºä»»æ„ <span class=\"math inline\">\\(k&#39;\\in (\\sqrt {2\\times 10^4}, 2\\times 10^4]\\)</span>ï¼Œå¯èƒ½çš„ <span class=\"math inline\">\\(t\\)</span> å€¼åªæœ‰ <span class=\"math inline\">\\(\\sqrt {2\\times 10^4 }\\)</span> ç§ã€‚è®¡ç®—å‡ºå¯¹äºæ¯ä¸ª <span class=\"math inline\">\\(t&#39;\\)</span>ï¼Œæ»¡è¶³ <span class=\"math inline\">\\(\\left\\lceil \\dfrac {h_x}{k&#39;} \\right\\rceil=t&#39;\\)</span> çš„ <span class=\"math inline\">\\(k&#39;\\)</span> èŒƒå›´ï¼Œå¯¹è¯¥èŒƒå›´ <span class=\"math inline\">\\(k&#39;\\)</span> çš„ç­”æ¡ˆåŒºé—´åŠ ä¸Š <span class=\"math inline\">\\(t&#39;\\times cnt\\)</span> å³å¯ï¼Œå¯ä»¥ä½¿ç”¨å·®åˆ†ã€‚</p>\n<p>è‡³æ­¤ï¼Œå°±å¯ä»¥åœ¨ä¸€æ¬¡ DFS å†…è§£å†³è¿™ç§æƒ…å†µä¸‹çš„é—®é¢˜ã€‚</p></li>\n</ul>\n<p>æ€»æ—¶é—´å¤æ‚åº¦ä¸º <span class=\"math inline\">\\(O(n\\sqrt {2\\times 10^4})\\)</span>ã€‚</p>\n<details>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘åœ¨åšè¿™é“é¢˜çš„æ—¶å€™å¹¶æ²¡æœ‰æ„è¯†åˆ°è‡ªå·±ç”¨åˆ°äº†ç¬›å¡å°”æ ‘ï¼Œ</p>\n<p>æ‰€ä»¥ä»£ç ä¸­ç¬›å¡å°”æ ‘çš„å»ºæ ‘éƒ¨åˆ†å¯èƒ½é•¿å¾—ç‰¹åˆ«æŠ½è±¡ï¼ˆ</p>\n<p>è¿™é‡Œæ˜¯ä½¿ç”¨äº†ä¸‹æ ‡ä¸Šçš„ ST è¡¨å¸¦ log åœ°æ±‚è§£äº†å·¦å³å„¿å­ã€‚</p>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxm = 35;\nconst int maxn = 1e5 + 5;\nusing ll = long long;\nll res;\nint n, k, l;\nint g[maxn][2];\nint f[maxn][maxm];\nint a[maxn], t[maxn];\nll dif[maxn], cnt[maxn];\nint ask(int l, int r) &#123;\n    if (l &gt; r) return 0;\n    int k = log(r - l + 1) / log(2.0);\n    return (a[f[l][k]] &lt; a[f[r - (1 &lt;&lt; k) + 1][k]]) ? f[l][k] : f[r - (1 &lt;&lt; k) + 1][k];\n&#125;\nvoid bld(int rt, int l, int r) &#123;\n    if (rt != l) &#123;\n        g[rt][0] = ask(l, rt - 1);\n        bld(g[rt][0], l, rt - 1);\n    &#125;\n    if (rt != r) &#123;\n        g[rt][1] = ask(rt + 1, r);\n        bld(g[rt][1], rt + 1, r);\n    &#125;\n    return;\n&#125;\n// k &lt;= sqrt(lim)\nvoid DFS(int x, int k, int fa) &#123;\n    t[x] = (a[x] + k - 1) / k;\n    res += t[x] - t[fa];\n    for (int i = 0; i &lt; 2; ++i) &#123;\n        if (g[x][i])\n            DFS(g[x][i], k, x);\n    &#125;\n    return;\n&#125;\n// k &gt; sqrt(lim)\nvoid DFS(int x, int fa) &#123;\n    ++cnt[x];\n    --cnt[fa];\n    for (int i = 0; i &lt; 2; ++i) &#123;\n        if (g[x][i])\n            DFS(g[x][i], x);\n    &#125;\n    int l = k + 1, r;\n    // æ³¨æ„è¿™é‡Œ i çš„èŒƒå›´åˆ¤å®šï¼Œå¦‚æœç›´æ¥å†™æˆ i * i &lt;= k ä¼šå°‘è®¡ç®—ä¸€äº›æƒ…å†µ\n    for (int i = 1; (i - 1) * (i - 1) &lt; k; ++i) &#123;\n        r = l - 1;\n        l = (a[x] + i - 1) / i;\n        // fprintf(stderr, &quot;%d: [%d, %d] += %d * %d\\n&quot;, a[x], l, r, cnt[x], i);\n        dif[l] += i * cnt[x], dif[r + 1] -= i * cnt[x];\n    &#125;\n    return;\n&#125;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n    std::cout.tie(nullptr);\n#endif\n    std::cin &gt;&gt; n;\n    for (int i = 1; i &lt;= n; ++i) &#123;\n        std::cin &gt;&gt; a[i];\n        f[i][0] = i;\n        k = std::max(k, a[i]);\n    &#125;\n    for (int j = 1; (1 &lt;&lt; j) &lt;= n; ++j)\n        for (int i = 1; i + (1 &lt;&lt; j) - 1 &lt;= n; ++i)\n            f[i][j] = (a[f[i][j - 1]] &lt; a[f[i + (1 &lt;&lt; (j - 1))][j - 1]]) ? f[i][j - 1] : f[i + (1 &lt;&lt; (j - 1))][j - 1];\n    int rt = ask(1, n);\n    bld(rt, 1, n);\n    for (int i = 1; i * i &lt;= k; ++i) &#123;\n        res = 0;\n        DFS(rt, i, 0);\n        std::cout &lt;&lt; res &lt;&lt; &#39; &#39;;\n        l = i + 1;\n    &#125;\n    // fputs(&quot;\\n&quot;, stderr);\n    DFS(rt, 0);\n    std::partial_sum(dif + 1, dif + k + 1, dif + 1);\n    for (int i = l; i &lt;= k; ++i)\n        std::cout &lt;&lt; dif[i] &lt;&lt; &#39; &#39;;\n    std::cout &lt;&lt; &#39;\\n&#39;;\n    return 0;\n&#125;</code></pre>\n</details>\n<hr />\n<h3 id=\"f.-å¼¹é£ç»µç¾Š\">F. å¼¹é£ç»µç¾Š</h3>\n<p><a href=\"https://www.becoder.com.cn/contest/5175/problem/6\" class=\"uri\">https://www.becoder.com.cn/contest/5175/problem/6</a></p>\n<p>å¾ˆæ£’å¯æŒä¹…åŒ–åˆ†å—ï¼Œä½¿æˆ‘ lxl æ—‹è½¬ã€‚</p>\n<p>ç¬‘è¯ï¼šèµ›å 5s æ‰äº¤ä¸Šå»ã€‚ç„¶å A äº†ã€‚</p>\n<p>æˆ‘ä»¬çŒœå¤§å®¶éƒ½ä¼šæ™®é€šçš„å¼¹é£ç»µç¾Šè¿™é“é¢˜ã€‚å°±æ˜¯å—é—´æš´åŠ›è·³å˜›ã€‚</p>\n<p>è¿™é‡Œç»™ä¸€ä¸ªæˆ‘è‡ªå·±æ•´çš„ç®€å•å®ç°æ–¹æ³•ã€‚</p>\n<p>æˆ‘ä»¬æŠŠåˆ†å‡ºæ¥çš„å—è§†ä½œè‹¥å¹²ä¸ªæ— å…³è”çš„æ•£å—å¹¶çº³å…¥å—é›†åˆï¼›å¯¹äºæ¯ä¸€ä¸ªç‰ˆæœ¬ï¼Œç”¨ä¸€ä¸ªå¤§å°ä¸º <span class=\"math inline\">\\(\\sqrt n\\)</span> çš„ <span class=\"math inline\">\\(id\\)</span> æ•°ç»„è®°å½•æ¯ä¸€ä½ç½®çš„å—åœ¨å—é›†åˆä¸­å¯¹åº”çš„ä½ç½®ã€‚</p>\n<p>ç„¶åè¯¥æ€ä¹ˆææ€ä¹ˆæå³å¯ã€‚</p>\n<p>P.S. zwb åšå®šä¸ç§»ä¿¡ä»° lxl ç¥æ•™äºæ˜¯å†³å®šç”¨å¯æŒä¹…åŒ–å¹³è¡¡æ ‘å®ç°å¯æŒä¹…åŒ–åˆ†å—ï¼Œç»“æœå½“ç„¶æ˜¯å› ä¸ºå¤šäº†ä¸ª <span class=\"math inline\">\\(\\log\\)</span> è¢«å¡é£äº†ï¼Œæœ€åæ°”æ€¥è´¥åæ…Œä¸æ‹©è·¯æ¼ç¾æˆæ€’æŠ„èµ·äº†æˆ‘çš„ä»£ç ã€‚</p>\n<details>\n<pre class=\"cpp\"><code>#include &lt;bits/stdc++.h&gt;\nconst int maxk = 320;\nconst int maxn = 2e5 + 5;\nclass devicer &#123;\npublic:\n    int l, r;\n    std::vector&lt;int&gt; ne, u, a;\n    int &amp;nex(int x);\n    int &amp;val(int x);\n&#125;;\nint id[maxn][maxk];\nstd::vector&lt;devicer&gt; b;\nint n, q, ty, siz, k, la;\nint a[maxn], tab[maxn], blk[maxn];\nvoid upd(int x, int a, devicer &amp;p) &#123;\n    if (x + a &gt; n)\n        p.nex(x) = -1, p.val(x) = 1;\n    else if (x + a &gt; p.r)\n        p.nex(x) = x + a, p.val(x) = 1;\n    else\n        p.nex(x) = p.nex(x + a), p.val(x) = p.val(x + a) + 1;\n    // printf(&quot;x = %d, a = %d, r = %d, upd ne[%d] to %d\\n&quot;, x, a, p.r, x, p.nex(x));\n    return;\n&#125;\nint main() &#123;\n#ifdef ONLINE_JUDGE\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n    std::cout.tie(nullptr);\n#endif\n    std::cin &gt;&gt; n &gt;&gt; q &gt;&gt; ty;\n    siz = sqrt(n);\n    k = (n + siz - 1) / siz;\n    b.resize(k);\n    int la = 0, now = k - 1;\n    for (auto &amp;i : b)\n        i.l = la + 1, la = i.r = i.l + siz - 1;\n    b.back().r = n;\n    for (int i = 0; i &lt; k; ++i) &#123;\n        id[0][i] = i;\n        b[i].a.resize(b[i].r - b[i].l + 1);\n        b[i].u.resize(b[i].r - b[i].l + 1);\n        b[i].ne.resize(b[i].r - b[i].l + 1);\n        for (int j = b[i].l; j &lt;= b[i].r; ++j)\n            tab[j] = j - b[i].l, blk[j] = i;\n    &#125;\n    for (int i = 1; i &lt;= n; ++i)\n        std::cin &gt;&gt; b[blk[i]].a[tab[i]];\n    for (int i = n; i; --i)\n        upd(i, b[blk[i]].a[tab[i]], b[blk[i]]);\n    int ver = 0;\n    while (q--) &#123;\n        int op, pr, x;\n        static int res = 0;\n        std::cin &gt;&gt; op &gt;&gt; pr &gt;&gt; x;\n        if (!ty)\n            res = 0;\n        x ^= res;\n        if (op == 1) &#123;\n            std::copy(id[pr], id[pr] + k, id[++ver]);\n            b.push_back(b[id[ver][blk[x]]]);\n            id[ver][blk[x]] = ++now;\n            std::cin &gt;&gt; b.back().a[tab[x]];\n            b.back().a[tab[x]] ^= res;\n            for (int i = x; i &gt;= b.back().l; --i)\n                upd(i, b.back().a[tab[i]], b.back());\n        &#125;\n        else &#123;\n            int p = x;\n            res = 0;\n            while (~p) &#123;\n                // printf(&quot;p = %d\\n&quot;, p);\n                res += b[id[pr][blk[p]]].u[tab[p]];\n                p = b[id[pr][blk[p]]].ne[tab[p]];\n            &#125;\n            std::cout &lt;&lt; res &lt;&lt; &#39;\\n&#39;;\n        &#125;\n    &#125;\n    return 0;\n&#125;\nint&amp; devicer::nex(int x) &#123;\n    return ne[tab[x]];\n&#125;\nint&amp; devicer::val(int x) &#123;\n    return u[tab[x]];\n&#125;</code></pre>\n</details>\n",
            "tags": [
                "DP",
                "SAM",
                "çŠ¶å‹",
                "åˆ†å—",
                "å¯æŒä¹…åŒ–",
                "ç¬›å¡å°”æ ‘"
            ]
        }
    ]
}