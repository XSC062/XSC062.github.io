{
    "version": "https://jsonfeed.org/version/1",
    "title": "null • All posts by \"树套树\" tag",
    "description": "",
    "home_page_url": "https://xsc062.netlify.app",
    "items": [
        {
            "id": "https://xsc062.netlify.app/20251007-1/",
            "url": "https://xsc062.netlify.app/20251007-1/",
            "title": "学习笔记 树套树",
            "date_published": "2025-10-07T08:29:52.000Z",
            "content_html": "<p>第一次学树套树时，并没有什么特别的感觉，因为属于我的离线分治，我早已遇见</p>\n<span id=\"more\"></span>\n<p>并非第一次学</p>\n<hr />\n<h2 id=\"线段树\">线段树</h2>\n<ul>\n<li>考虑线段树的本质，即给定序列，能够返回关键字在 <span class=\"math inline\">\\([l,r]\\)</span> 内的可加信息之和</li>\n<li>仅需要保证信息是<strong>可加</strong>的（如众数，mex 等显然不在此列）</li>\n</ul>\n<hr />\n<h2 id=\"树状数组\">树状数组</h2>\n<ul>\n<li>给定序列，能够返回任意关键字处的前缀和 / 后缀和，需要保证信息是<strong>可加</strong>的</li>\n<li>如果要求任意区间内关键字的信息之和，会用到差分，此时还需额外保证信息是<strong>可减</strong>的（如 min / max 显然不在此列）</li>\n</ul>\n<hr />\n<h2 id=\"主席树-可持久化线段树\">主席树 / 可持久化线段树</h2>\n<p>之前有人在争论『主席树』是否等价于『可持久化线段树』，其实从当前 OI 环境的语境下我觉得是等价的</p>\n<ul>\n<li><p>给定序列，存在关键字 A 和关键字 B，能够求出 <span class=\"math inline\">\\(([0, A&#39;], [B_1, B_2])\\)</span> 这个矩形的信息和（这里的矩形可能是 DAG 状的）</p>\n<p>也就是说主席树本身存的是关于 A 的信息前缀和</p></li>\n<li><p>要求 A 只能来源于先前的 A（即 A 具有<strong>单调性</strong>），且底层信息的 delta 为 1</p>\n<p>需要发现这个条件是相当苛刻的，所以这里的 A 通常以时间 / 版本 / DAG 的形式出现</p></li>\n<li><p>如果信息具有<strong>可减</strong>性，对于 <span class=\"math inline\">\\(A_2\\)</span> 和其某个祖先 <span class=\"math inline\">\\(A_1\\)</span>，能够求出 <span class=\"math inline\">\\(([A_1,A_2],[B_1,B_2])\\)</span> 这个矩形的信息和。</p></li>\n</ul>\n<hr />\n<ul>\n<li>考虑为什么主席树不能解决三维偏序</li>\n<li>现在已经对关键字 C 排完序了，我们需要求出 <span class=\"math inline\">\\(([0, A], [0, B])\\)</span> 这个矩形的信息和</li>\n<li>发现 A 是不具备<strong>单调性</strong>的，有没有什么 DS 能够不要求 A 的单调性呢？</li>\n</ul>\n<hr />\n<h2 id=\"树状数组套线段树\">树状数组套线段树</h2>\n<ul>\n<li>用 <span class=\"math inline\">\\(n\\)</span> 棵线段树维护 B 的偏序关系，用类主席树的方式来排列这些树</li>\n<li><p>发现一次修改需要改一段后缀</p>\n<p>这一点我们前面说过了，主席树本身存储的是 A 维的前缀和。</p></li>\n<li>所以直接解决这个问题：维护信息的差分。这样就可以通过询问前缀得到原始信息</li>\n<li><p>这个结构和树状数组是很吻合的，考虑在树状数组的每个点上维护动态开点线段树</p>\n<p>这样就可以只用修改 log 个线段树</p></li>\n<li><p>考虑怎么询问</p>\n<p>我最初的想法是，做一个线段树合并，利用 DS 本身的树形结构可以有一个 dsu on tree 的复杂度（即 <span class=\"math inline\">\\(O(nq\\log^2 n)\\)</span>），但显然这个太糖了</p>\n<p>正常的做法是，注意到每个点的权值线段树结构相同，所以在 log 个线段树上同时维护，当作包含长度 log 的数组的结构体即可</p></li>\n<li>同树状数组，要求信息有<strong>可减性</strong></li>\n<li><p>但由于外层的 DS 本质上舍弃了主席树 DAG 的结构</p>\n<p>导致不能直接简单用于树上问题，而是需要在 <strong>DFS 序</strong>上作文章</p></li>\n<li><p>实际上常数很大，超过 <span class=\"math inline\">\\(10^5\\)</span> 就不太能跑得动了</p></li>\n</ul>\n<hr />\n<h3 id=\"dynamic-rankings-k大数查询\">Dynamic Rankings / K大数查询</h3>\n<p><a href=\"https://www.luogu.com.cn/problem/P2617\" class=\"uri\">https://www.luogu.com.cn/problem/P2617</a> / <a href=\"https://www.luogu.com.cn/problem/P3332\" class=\"uri\">https://www.luogu.com.cn/problem/P3332</a></p>\n<ul>\n<li>全局第 <span class=\"math inline\">\\(k\\)</span> 大就是普通的权值线段树上二分，抑或平衡树，抑或 01-Trie（三者等价）</li>\n<li>这里的权值线段树上二分，其实是矩形第二维限制的变体</li>\n<li>发现这里只需要简单地维护元素个数，是具有可减性的。</li>\n</ul>\n<hr />\n<h3 id=\"三维偏序陌上花开\">三维偏序（陌上花开）</h3>\n<p><a href=\"https://www.luogu.com.cn/problem/P3810\" class=\"uri\">https://www.luogu.com.cn/problem/P3810</a></p>\n<ul>\n<li>树状数组套权值线段树即可</li>\n</ul>\n<hr />\n<h3 id=\"二逼平衡树\">二逼平衡树</h3>\n<p><a href=\"https://loj.ac/p/106\" class=\"uri\">https://loj.ac/p/106</a></p>\n<ul>\n<li>和 k 大数差不多，都是权值线段树那些东西</li>\n</ul>\n<hr />\n<h3 id=\"网络管理\">网络管理</h3>\n<p><a href=\"https://www.luogu.com.cn/problem/P4175\" class=\"uri\">https://www.luogu.com.cn/problem/P4175</a></p>\n<blockquote>\n<p>维护带修树上简单路径第 <span class=\"math inline\">\\(k\\)</span> 大。</p>\n</blockquote>\n<ul>\n<li>做树上差分即可转化为序列第 <span class=\"math inline\">\\(k\\)</span> 大。</li>\n</ul>\n<hr />\n<h3 id=\"买宝石\">买宝石</h3>\n<p><a href=\"http://222.180.160.110:61235/contest/6620/problem/4\" class=\"uri\">http://222.180.160.110:61235/contest/6620/problem/4</a></p>\n<blockquote>\n<p>给定根为 <span class=\"math inline\">\\(1\\)</span> 的树，每个点 <span class=\"math inline\">\\(u\\)</span> 上有 <span class=\"math inline\">\\(k_u\\)</span> 个价钱为 <span class=\"math inline\">\\(w_u\\)</span> 的物品，可以在时间 <span class=\"math inline\">\\(t_u\\)</span> 及之后获得</p>\n<p>给定 <span class=\"math inline\">\\(Q\\)</span> 次询问，从问 <span class=\"math inline\">\\(x\\)</span> 出发到根的路径上所有在时刻 <span class=\"math inline\">\\(T\\)</span> 可以获得的物品全部拿出来排成一列，拥有 <span class=\"math inline\">\\(K\\)</span> 金钱时，按照价值从小到大购买，买到的最后一个物品价值。</p>\n<p><span class=\"math inline\">\\(n\\le 10^5\\)</span>，价钱：<span class=\"math inline\">\\(10^{15}\\)</span>，时间：<span class=\"math inline\">\\(10^5\\)</span>，个数：<span class=\"math inline\">\\(10^5\\)</span>。</p>\n</blockquote>\n<ul>\n<li>信息自带一个有序的时间偏序维 <span class=\"math inline\">\\(T\\)</span> 且原生有序，所以不能整体二分，必须处理 <span class=\"math inline\">\\(k\\)</span> 偏序维和 <span class=\"math inline\">\\(w\\)</span> 二分维。</li>\n<li></li>\n</ul>\n<hr />\n<ul>\n<li>总的来说，就是维护了两个关键字，或者说一个矩形</li>\n<li>根据在 A，B 维需要做的操作选择，以及需要维护的信息类型，选择相应的数据结构</li>\n</ul>\n<hr />\n<h2 id=\"关于整体二分\">关于整体二分</h2>\n<ul>\n<li>考虑动态区间第 K 大这一类的问题，特征是 A 维『求和』，B 维<strong>二分</strong></li>\n<li>此时可以把对 B 维的二分提到外层一起进行，反过来对 A 维应用数据结构</li>\n<li>考虑到树套树常数过大，所以在能用整体二分的时候不推荐用树套树</li>\n</ul>\n",
            "tags": [
                "树套树"
            ]
        }
    ]
}