<!DOCTYPE html>
<html>
<head>
    <!-- ç½‘ç«™å›¾æ ‡ -->
<link rel="icon" type="image/png" sizes="32x32" href="/images/icon.svg">
<!-- å…¶ä»–å›¾æ ‡æ”¯æŒ -->
<link rel="stylesheet" href="/css/facss/fa-brands.min.css">
<link rel="stylesheet" href="/css/facss/fa-regular.min.css">
<link rel="stylesheet" href="/css/facss/fa-solid.min.css">
<link rel="stylesheet" href="/css/facss/fontawesome.min.css">
<link rel="stylesheet" href="/css/facss/fontawesome-all.css">
<link href="https://use.fontawesome.com/releases/v5.0.4/css/all.css" rel="stylesheet">
<!-- ç½‘ç«™æ ‡é¢˜ -->
<title>
	
		çŠ¶å‹ DP -
	
	XSC062 çš„åšå®¢
</title>
<!-- js å¼•å…¥ -->
<script>
const searchPath = "/search.xml"
</script>

<script src="/js/afterloaded.js"></script>


<script src="/js/jQuery.js"></script>

<!-- è½½å…¥ Valine -->

<script src="/js/Valine.min.js"></script>

<!-- css å¼•å…¥ -->

<link rel="stylesheet" href="/css/layout.css">


<link rel="stylesheet" href="/css/prcss/prism.css">



<!-- rss -->
<link rel="alternate" type="application/rss+xml" title="" href="https://xsc062.netlify.app/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="" href="https://xsc062.netlify.app/atom.xml" />
<link rel="alternate" type="application/json" title="" href="https://xsc062.netlify.app/feed.json" />

<meta charset="utf-8"> 
<meta name="generator" content="Hexo 7.2.0"></head>
<body class="line-numbers match-braces no-brace-select rainbow-braces">
	
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            processEscapes: true
          }
        });
      </script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
            tex2jax: {
              skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
          });
      </script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
              var all = MathJax.Hub.getAllJax(), i;
              for(i=0; i < all.length; i += 1) {
                  all[i].SourceElement().parentNode.className += ' has-jax';
              }
          });
      </script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS_CHTML"></script>

	<!-- æœç´¢ -->
<script>
	function closeSearchBox() {
		$("#search-bg").css("transition", "null"); 
		$("#search-bg").css("z-index", "-1"); 
		$("#search-bg").css("opacity", "0%");
		return;
	}
</script>
<div id="search-bg">
	<div id="search-box">
		<button id="close-button" onclick="closeSearchBox()">
			<i class="fas fa-times"></i>
		</button>
		<input type="text" id="search-input" placeholder="Type to search...">
		<div id="search-results">
			<div id="emptyInput">
				<p>é”®å…¥ä»¥æœç´¢â€¦</p>
				<p><i>åŒ¹é…ç®—æ³•</i>ï¼šæŠŠè¾“å…¥æŒ‰ç©ºæ ¼æ‹†åˆ†ï¼Œå•ç‹¬<strong>åŒ¹é…</strong>æ¯ä¸€æ®µè¾“å…¥ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼Œä»…åŒ¹é…æ–‡ç« æ–‡æœ¬å†…å®¹ï¼‰ï¼Œè¾“å‡ºå–æˆ–åçš„ç»“æœã€‚</p>
				<p>æ¨¡ç³Šæœç´¢ä¼¼ä¹å¾ˆéš¾æï¼Œç›®å‰æ²¡æœ‰ç›¸å…³æ‰“ç®—ã€‚</p>
			</div>
		</div>
	</div>
</div>
<!-- é¡¶æ æ•´ä½“å¯¼èˆªèœå• -->
<div class="ui top menu">
	<!-- å·¦å¯¹é½ logo -->
	<a class="logo" href="/">
		<img width="25px" height="25px" style="border: solid transparent 2.5px" src="/images/icon.svg"></img>
		<div id="bartitle" class="text">
			XSC062 çš„åšå®¢
		</div>
	</a>
	<!-- å³å¯¹é½éƒ¨åˆ†å¯¼èˆª -->
	<div id="rightali" class="serif">
		<a class="item" id="Search" type="button">
			<i class="btn text-muted fa fa-search" id="search-icon" disabled></i>
		</a>
		<a class="item" id="Home" href="/">
			Home
		</a>
		<a class="item" id="Arch" href="/archives">
			Archives
		</a>
		<!-- <a class="item" id="Cate" href="/categories">
			Categories
		</a> -->
		<a class="item" id="Tags" href="/tags">
			Tags
		</a>
		<a class="item" id="Frie" href="/friends">
			Friends
		</a>
		<a class="item" id="Abou" href="/about">
			About
		</a>
	</div>
</div>
    
<link rel="stylesheet" href="/css/post.css">


<script src="/js/post.js"></script>


<div class="main">
	<div id="sidebar" class="text">
		<aside id="toc">
			<span id="toctitle">
				<i class="fas fa-list"></i>
				ç›®å½•
			</span>
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#a---%E5%8F%AA%E4%B8%8D%E8%BF%87%E6%98%AF%E9%95%BF%E7%9A%84%E9%A2%86%E5%B8%A6-2-just-long-neckties-2"><span class="toc-text">A - åªä¸è¿‡æ˜¯é•¿çš„é¢†å¸¦ 2 &#x2F; Just Long Neckties 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#b---cut-and-reorder"><span class="toc-text">B - Cut and Reorder</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#c---electric-circuit"><span class="toc-text">C - Electric Circuit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#d---count-grid-3-coloring"><span class="toc-text">D - Count Grid 3-coloring</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#e---pure-straight"><span class="toc-text">E - Pure Straight</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#f---123-set"><span class="toc-text">F - 123 Set</span></a></li></ol>
		</aside>
	</div>
	<div class="ui post container">
		<div class="ui text container">
			<span id="postcon">
				<span id="postinfo">
					<div class="ui post title serif">
						<div id="fortitle" data-content="çŠ¶å‹ DP">
							çŠ¶å‹ DP
						</div>
						<div class="ui title background">
						</div>
					</div>
					<span id="date">
						<i class="fas fa-calendar-alt" style="margin-right: 4px;"></i>
						2025-08-05
					</span>
				</span>
			</span>
			<div id="posttags" class="dotted border">
				
					
						<a href="/tags/DP/" class="citem">DP</a>
					
						<a href="/tags/çŠ¶å‹/" class="citem">çŠ¶å‹</a>
					
				
			</div>
			<!-- æœ¬æ¥ç”¨çš„æ˜¯ fromNow ç„¶åå­—ç¬¦ä¸²åˆ¤æ–­ï¼Œæ²¡æƒ³åˆ°å¯ä»¥ç›´æ¥è°ƒç”¨ moment() -->
			
			<div id="content">
				<p>æ²¡è¡¥å®Œï¼ˆ1/3ï¼‰ï¼ŒåŠ¨ä½œè¿˜æ˜¯å¤ªæ…¢äº†</p>
<span id="more"></span>
<hr />
<h2 id="a---åªä¸è¿‡æ˜¯é•¿çš„é¢†å¸¦-2-just-long-neckties-2">A - åªä¸è¿‡æ˜¯é•¿çš„é¢†å¸¦ 2 / Just Long Neckties 2</h2>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P11665" class="uri">https://www.luogu.com.cn/problem/P11665</a></p>
<p>éœ€è¦è§‚å¯Ÿåˆ°ï¼Œä»»æ„æ—¶åˆ» <span class="math inline">\(B\)</span> ä¸­ä¸å­˜åœ¨é‡å¤å…ƒç´ ã€‚æŠŠ <span class="math inline">\(B\)</span> å‹å‡ºæ¥ï¼Œä»¤ <span class="math inline">\(f_{i,S}\)</span> è¡¨ç¤ºé€‰äº† <span class="math inline">\(i\)</span>ï¼Œå½“å‰ <span class="math inline">\(B\)</span> ä¸º <span class="math inline">\(S\)</span> æ˜¯å¦å¯è¡Œï¼Œèƒ½å¤Ÿ <span class="math inline">\(O(n\cdot 2^V)\)</span>ã€‚å¯¹äºæŸä¸ª <span class="math inline">\(S\)</span>ï¼Œåªå…³å¿ƒå®ƒæœ€è¿œèƒ½åˆ°è¾¾å“ªä¸ª <span class="math inline">\(i\)</span>ï¼Œæ•…ä»¤ <span class="math inline">\(f_S\)</span> è®°å½•ä¹‹ã€‚å¯¹äºæ¯ä¸€ä¸ª <span class="math inline">\(S\)</span>ï¼Œéƒ½å¯ä»¥æ‰¾åˆ° <span class="math inline">\(f_S\)</span> åç¬¬ä¸€å¯¹ <span class="math inline">\(a_i,a_{i+1}\notin S\)</span>ï¼Œç”¨å…¶åˆ·è¡¨ã€‚</p>
<p>å‘ç°ã€æ‰¾ <span class="math inline">\(f_S\)</span> åç¬¬ä¸€å¯¹éæ³•å…ƒç´ ã€æ˜¯å¾ˆæ…¢çš„ï¼Œè€ƒè™‘ä¼˜åŒ–ï¼›å¯¹äºæ¯ä¸ª <span class="math inline">\(i\)</span> ç»´æŠ¤ <span class="math inline">\(p\)</span> åœ¨å…¶åç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½® <span class="math inline">\(x\)</span>ï¼Œå¯¹äºæ¯ä¸ª <span class="math inline">\(a_x=p\)</span> ç»´æŠ¤ <span class="math inline">\(x\)</span> åæ–¹ <span class="math inline">\(a_y=p,a_{y+1}=q\)</span> ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œç›¸å½“äº<strong>å…ˆæ‰¾ <span class="math inline">\(p\)</span> å†æ‰¾ <span class="math inline">\((p,q)\)</span></strong>ï¼Œå°±å¯ä»¥åšåˆ° <span class="math inline">\(O(V^2\cdot 2^V+n\cdot V)\)</span>ã€‚</p>
<details>
<pre class="cpp"><code>#include &lt;bits/stdc++.h&gt;
int main() &#123;
#ifdef ONLINE_JUDGE
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr), std::cout.tie(nullptr);
#else
    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);
    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);
#endif
    int n;
    std::cin &gt;&gt; n;
    std::vector&lt;int&gt; a(n + 1);
    int V = 0;
    for (int i = 1; i &lt;= n; ++i) &#123;
        std::cin &gt;&gt; a[i];
        V = std::max(V, a[i]--);
    &#125;
    std::vector&lt;std::vector&lt;int&gt; &gt; tx(n + 1, std::vector&lt;int&gt; (V)), ty(n + 1, std::vector&lt;int&gt; (V));
    std::vector&lt;int&gt; lp(V);
    std::vector&lt;std::vector&lt;int&gt; &gt; lpq(V, std::vector&lt;int&gt; (V));
    for (int i = n; ~i; --i) &#123;
        if (i &amp;&amp; i != n)
            lpq[a[i]][a[i + 1]] = i;
        for (int j = 0; j &lt; V; ++j) &#123;
            tx[i][j] = lp[j];
            if (i != n)
                ty[i][j] = lpq[a[i]][j];
        &#125;
        if (i != 0)
            lp[a[i]] = i;
    &#125;
    int siz = 1 &lt;&lt; V, res = 21;
    std::vector&lt;int&gt; f(siz);
    for (int i = 0; i &lt; siz; ++i) &#123;
        std::vector&lt;int&gt; p0, p1;
        for (int j = 0; j &lt; V; ++j)
            if ((i &gt;&gt; j) &amp; 1)
                p1.push_back(j);
            else
                p0.push_back(j);
        int j = n;
        for (auto p : p0)
            if (tx[f[i]][p])
                for (auto q : p0)
                    if (ty[tx[f[i]][p]][q])
                        j = std::min(j, ty[tx[f[i]][p]][q]);
        if (j != n) &#123;
            f[i ^ (1 &lt;&lt; a[j])] = std::max(f[i ^ (1 &lt;&lt; a[j])], j);
            f[i ^ (1 &lt;&lt; a[j + 1])] = std::max(f[i ^ (1 &lt;&lt; a[j + 1])], j + 1);
            for (auto k : p1) &#123;
                f[i ^ (1 &lt;&lt; k) ^ (1 &lt;&lt; a[j])] = std::max(f[i ^ (1 &lt;&lt; k) ^ (1 &lt;&lt; a[j])], j);
                f[i ^ (1 &lt;&lt; k) ^ (1 &lt;&lt; a[j + 1])] = std::max(f[i ^ (1 &lt;&lt; k) ^ (1 &lt;&lt; a[j + 1])], j + 1);
            &#125;
        &#125;
        else
            res = std::min(res, __builtin_popcount(i));
    &#125;
    std::cout &lt;&lt; res &lt;&lt; &#39;\n&#39;;
    return 0;
&#125;</code></pre>
</details>
<hr />
<h2 id="b---cut-and-reorder">B - Cut and Reorder</h2>
<p><a target="_blank" rel="noopener" href="https://atcoder.jp/contests/abc328/tasks/abc328_g" class="uri">https://atcoder.jp/contests/abc328/tasks/abc328_g</a></p>
<p>ä¸å¦¨å…ˆé‡æ’å†ä¿®æ”¹ï¼Œä»¤ <span class="math inline">\(f_{i,S}\)</span> è¡¨ç¤ºå·²ç»é‡æ’å¥½æ–°åºåˆ—çš„å‰ <span class="math inline">\(i\)</span> ä¸ªå…ƒç´ ï¼Œå¯¹åº”åŸåºåˆ—çŠ¶æ€ <span class="math inline">\(S\)</span> çš„æœ€å°ä»£ä»·ã€‚æšä¸¾æ–°åŒºé—´å®¹æ˜“è½¬ç§»ã€‚å¯ä»¥å‘ç°æšä¸¾ <span class="math inline">\(i,S\)</span> çš„å®é™…å¤æ‚åº¦ä¸º <span class="math inline">\(O(2^n)\)</span>ï¼ˆç©ºé—´ä¹Ÿå¯ä»¥è¿™ä¹ˆä¼˜åŒ–ï¼‰ï¼Œé¢„å¤„ç†ä¹‹åæ€»æ—¶é—´å¤æ‚åº¦ <span class="math inline">\(O(n^2\cdot 2^n)\)</span>ï¼Œè·‘ä¸æ»¡ï¼Œå¯ä»¥é€šè¿‡ã€‚</p>
<details>
<pre class="cpp"><code>#include &lt;bits/stdc++.h&gt;
const long long inf = 1e18;
int main() &#123;
#ifdef ONLINE_JUDGE
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr), std::cout.tie(nullptr);
#else
    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);
    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);
#endif
    int n;
    long long c;
    std::cin &gt;&gt; n &gt;&gt; c;
    std::vector&lt;long long&gt; a(n), b(n);
    for (int i = 0; i &lt; n; ++i)
        std::cin &gt;&gt; a[i];
    for (int i = 0; i &lt; n; ++i)
        std::cin &gt;&gt; b[i];
    using arr = std::vector&lt;long long&gt;;
    using brr = std::vector&lt;arr&gt;;
    using crr = std::vector&lt;brr&gt;;
    brr p(n, arr(n));
    crr g(n, brr(n, arr(n)));
    for (int l = 0; l &lt; n; ++l)
        for (int r = l; r &lt; n; ++r) &#123;
            for (int k = l; k &lt;= r; ++k)
                p[l][r] ^= (1 &lt;&lt; k);
            for (int R = r - l; R &lt; n; ++R)
                for (int L = R, j = r; j &gt;= l; --L, --j)
                    g[l][r][R] += std::abs(b[L] - a[j]);
        &#125;
    int siz = 1 &lt;&lt; n;
    std::vector&lt;long long&gt; f(siz, inf);
    f[0] = 0ll;
    for (int j = 1; j &lt; siz; ++j) &#123;
        int i = __builtin_popcount(j) - 1;
        for (int r = 0; r &lt; n; ++r)
            for (int l = r; ~l &amp;&amp; ((j &gt;&gt; l) &amp; 1); --l)
                f[j] = std::min(f[j], f[j ^ p[l][r]] + g[l][r][i] + c);
    &#125;
    std::cout &lt;&lt; f[siz - 1] - c &lt;&lt; &#39;\n&#39;;
    return 0;
&#125;</code></pre>
</details>
<hr />
<h2 id="c---electric-circuit">C - Electric Circuit</h2>
<p><a target="_blank" rel="noopener" href="https://atcoder.jp/contests/abc321/tasks/abc321_g" class="uri">https://atcoder.jp/contests/abc321/tasks/abc321_g</a></p>
<p>å¾ˆåƒ<a href="/20250430/#æœ‰æ ‡å·æ— å‘å›¾è®¡æ•°">æ— å‘å›¾å®¹æ–¥</a>ï¼Ÿä»¤ <span class="math inline">\(f_S\)</span> è¡¨ç¤ºè®© <span class="math inline">\(S\)</span> å†…éƒ¨å®Œæˆé…å¯¹ï¼Œå¯ä»¥ä¸è¿é€šçš„æ–¹æ¡ˆæ•°ï¼Œé‚£ä¹ˆå½“ä¸”ä»…å½“ <span class="math inline">\(S\)</span> å†…éƒ¨ç‚¹å‡ºã€å…¥åº¦ä¹‹å’Œç›¸ç­‰ï¼ˆè®°ä¸º <span class="math inline">\(cnt\)</span>ï¼‰æ—¶ï¼Œ<span class="math inline">\(f_S\)</span> æœ‰å€¼ <span class="math inline">\(cnt!\)</span>ã€‚ç›¸ä¼¼åœ°ï¼Œè®¾ <span class="math inline">\(g_S\)</span> è¡¨ç¤ºè®© <span class="math inline">\(S\)</span> å®Œæˆé…å¯¹ï¼Œæˆä¸ºä¸€ä¸ªè¿é€šå—çš„æ–¹æ¡ˆæ•°ï¼Œå¾—åˆ° <span class="math inline">\(g_S=f_S-\sum\limits_{v\in S} f_{S\oplus v}\cdot g_v\)</span>ã€‚è®© <span class="math inline">\(v\)</span> å¿…é¡»åŒ…å« <span class="math inline">\(S\)</span> ä¸­ç¼–å·æœ€å°çš„ç‚¹å°±å¯ä»¥å»é‡ã€‚</p>
<p>ä»è´¡çŒ®çš„è§’åº¦å‡ºå‘ï¼Œ<span class="math inline">\(S\)</span> å¸¦æ¥çš„è´¡çŒ®å°±æ˜¯ <span class="math inline">\(g_S\cdot f_{U\oplus S}\)</span>ï¼Œå…¶ä¸­ <span class="math inline">\(U\)</span> æ˜¯å…¨é›†ã€‚æœ€åé™¤ä»¥ <span class="math inline">\(M!\)</span> æ±‚å‡ºæœŸæœ›ã€‚</p>
<p>å¤æ‚åº¦ <span class="math inline">\(O(3^n)\)</span>ã€‚</p>
<details>
<pre class="cpp"><code>#include &lt;bits/stdc++.h&gt;
const int mod = 998244353;
int main() &#123;
#ifdef ONLINE_JUDGE
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr), std::cout.tie(nullptr);
#else
    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);
    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);
#endif
    int n, m;
    std::cin &gt;&gt; n &gt;&gt; m;
    std::vector&lt;int&gt; ci(n), co(n);
    for (int i = 1, x; i &lt;= m; ++i)
        std::cin &gt;&gt; x, ++ci[x - 1];
    for (int i = 1, x; i &lt;= m; ++i)
        std::cin &gt;&gt; x, ++co[x - 1];
    std::vector&lt;long long&gt; fac(m + 1);
    fac[0] = 1ll;
    for (int i = 1; i &lt;= m; ++i)
        fac[i] = fac[i - 1] * i % mod;
    auto qkp = [&amp;](long long x, int y) &#123;
        auto res(1ll);
        for (; y; (x *= x) %= mod, y &gt;&gt;= 1)
            if (y &amp; 1)
                (res *= x) %= mod;
        return res;
    &#125;;
    int siz = 1 &lt;&lt; n;
    std::vector&lt;long long&gt; f(siz), g(siz);
    for (int i = 1; i &lt; siz; ++i) &#123;
        int si = 0, so = 0;
        for (int j = 0; j &lt; n; ++j)
            if ((i &gt;&gt; j) &amp; 1)
                si += ci[j], so += co[j];
        if (si == so)
            f[i] = fac[si];
    &#125;
    auto res(0ll);
    for (int i = 1; i &lt; siz; ++i) &#123;
        g[i] = f[i];
        int mn = 0;
        for (int j = 0; j &lt; n; ++j)
            if ((i &gt;&gt; j) &amp; 1) &#123;
                mn = j;
                break;
            &#125;
        int s = i ^ (1 &lt;&lt; mn);
        (g[i] += mod - g[1 &lt;&lt; mn] * f[s] % mod) %= mod;
        for (int j = (s - 1) &amp; s; j; j = (j - 1) &amp; s)
            (g[i] += mod - g[j ^ (1 &lt;&lt; mn)] * f[s ^ j] % mod) %= mod;
        if (i != siz - 1)
            (res += g[i] * f[(siz - 1) ^ i]) %= mod;
        else
            (res += g[i]) %= mod;
    &#125;
    std::cout &lt;&lt; res * qkp(fac[m], mod - 2) % mod &lt;&lt; &#39;\n&#39;;
    return 0;
&#125;</code></pre>
</details>
<hr />
<h2 id="d---count-grid-3-coloring">D - Count Grid 3-coloring</h2>
<p><a target="_blank" rel="noopener" href="https://atcoder.jp/contests/abc379/tasks/abc379_g" class="uri">https://atcoder.jp/contests/abc379/tasks/abc379_g</a></p>
<p>è½®å»“çº¿ DPã€‚æŠŠæ¯ä¸€åˆ—å·²ç»ç¡®å®šçš„æœ€é ä¸‹çš„å…ƒç´ å‹èµ·æ¥ï¼Œæ¯è¡Œé€ä¸ªç¡®å®šå³å¯ã€‚</p>
<p>å‘ç°æœ‰æ•ˆçŠ¶æ€ä¸­åªèƒ½å®¹è®¸æœ€å¤šä¸€å¯¹ç›¸é‚»ç›¸åŒå…ƒç´ ï¼Œè¿™æ ·å¤æ‚åº¦å°±èƒ½é™ä¸‹æ¥äº†ã€‚æ³¨æ„ç‰¹åˆ¤ <span class="math inline">\(1\times 1\)</span> çš„æƒ…å†µã€‚</p>
<details>
<pre class="cpp"><code>#include &lt;bits/stdc++.h&gt;
const int mod = 998244353;
int main() &#123;
#ifdef ONLINE_JUDGE
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr), std::cout.tie(nullptr);
#else
    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);
    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);
#endif
    int n, m;
    std::cin &gt;&gt; n &gt;&gt; m;
    std::array&lt;int, 15&gt; p;
    p[0] = 1;
    for (int i = 1; i &lt; 15; ++i)
        p[i] = p[i - 1] * 3;
    std::vector&lt;std::vector&lt;int&gt; &gt; a;
    if (n &gt;= m) &#123;
        a.assign(n + 1, std::vector&lt;int&gt; (m + 1));
        for (int i = 1; i &lt;= n; ++i) 
            for (int j = 1; j &lt;= m; ++j) &#123;
                char t;
                std::cin &gt;&gt; t, a[i][j] = (t == &#39;?&#39; ? -1 : t - &#39;1&#39;);
            &#125;
    &#125;
    else &#123;
        std::swap(n, m);
        a.assign(n + 1, std::vector&lt;int&gt; (m + 1));
        for (int i = 1; i &lt;= m; ++i)
            for (int j = 1; j &lt;= n; ++j) &#123;
                char t;
                std::cin &gt;&gt; t, a[j][i] = (t == &#39;?&#39; ? -1 : t - &#39;1&#39;);
            &#125;
    &#125;
    int siz = p[m];
    using arr = std::vector&lt;long long&gt;;
    using brr = std::vector&lt;arr&gt;;
    using crr = std::vector&lt;brr&gt;;
    std::vector&lt;int&gt; s, tab(siz, -1);
    auto getv_1 = [&amp;](int j, int i) &#123;
        return (j / p[i - 1]) % 3;
    &#125;;
    auto getv = [&amp;](int j, int i) &#123;
        return (s[j] / p[i - 1]) % 3;
    &#125;;
    auto chg = [&amp;](int j, int i, int v) &#123;
        return tab[s[j] - p[i - 1] * getv(j, i) + p[i - 1] * v];
    &#125;;
    auto out = [&amp;](int i) &#123;
        std::string s;
        for (int j = 1; j &lt;= m; ++j)
            s += &#39;1&#39; + getv_1(i, j);
        return s.c_str();
    &#125;;
    for (int i = 0; i &lt; siz; ++i) &#123;
        s.push_back(i);
        int cnt = 0;
        for (int j = 2; j &lt;= m; ++j)
            if (getv_1(i, j - 1) == getv_1(i, j) &amp;&amp; ++cnt &gt;= 2) &#123;
                s.pop_back();
                break;
            &#125;
    &#125;
    for (int i = 0; i &lt; (int)s.size(); ++i)
        tab[s[i]] = i;
    siz = (int)s.size();
    if (n == 1) &#123;
        std::cout &lt;&lt; (a[1][1] == -1 ? 3 : 1) &lt;&lt; &#39;\n&#39;;
        return 0;
    &#125;
    crr f(n + 1, brr(m + 1, arr(siz)));
    for (int i = 0; i &lt; siz; ++i)
        if ([&amp;](int i, int s) &#123;
            for (int j = 1; j &lt;= m; ++j) &#123;
                if (a[i][j] != -1 &amp;&amp; a[i][j] != getv(s, j))
                    return false;
                if (j != 1 &amp;&amp; getv(s, j) == getv(s, j - 1))
                    return false;
            &#125;
            return true;
        &#125; (1, i)) &#123;
            for (int p = 0; p &lt; 3; ++p)
                if ((a[2][1] == -1 || a[2][1] == p) &amp;&amp; getv(i, 1) != p &amp;&amp; ~chg(i, 1, p))
                    (++f[2][1][chg(i, 1, p)]) %= mod;
        &#125;
    for (int i = 2; i &lt;= n; ++i) &#123;
        for (int k = 1; k &lt; m; ++k)
            for (int j = 0; j &lt; siz; ++j)
                if (f[i][k][j]) &#123;
                    // printf(&quot;f[%d][%d][%s] = %lld\n&quot;, i, k, out(s[j]), f[i][k][j]);
                    for (int p = 0; p &lt; 3; ++p)
                        if ((a[i][k + 1] == -1 || a[i][k + 1] == p) &amp;&amp; getv(j, k) != p &amp;&amp; getv(j, k + 1) != p &amp;&amp; ~chg(j, k + 1, p))
                            (f[i][k + 1][chg(j, k + 1, p)] += f[i][k][j]) %= mod;
                &#125;
        for (int j = 0; j &lt; siz; ++j)
            if (i != n &amp;&amp; f[i][m][j])
                for (int p = 0; p &lt; 3; ++p)
                    if ((a[i + 1][1] == -1 || a[i + 1][1] == p) &amp;&amp; getv(j, 1) != p &amp;&amp; ~chg(j, 1, p))
                        (f[i + 1][1][chg(j, 1, p)] += f[i][m][j]) %= mod;
    &#125;
    auto res = 0ll;
    for (int i = 0; i &lt; siz; ++i)
        (res += f[n][m][i]) %= mod;
    std::cout &lt;&lt; res &lt;&lt; &#39;\n&#39;;
    return 0;
&#125;</code></pre>
</details>
<hr />
<h2 id="e---pure-straight">E - Pure Straight</h2>
<p><a target="_blank" rel="noopener" href="https://atcoder.jp/contests/arc126/tasks/arc126_d" class="uri">https://atcoder.jp/contests/arc126/tasks/arc126_d</a></p>
<p>æ‰‹ç©å‘ç°åªè¦æœ€ç»ˆåºåˆ—ç¡®å®šï¼Œé‚£ä¹ˆç§»åŠ¨çš„é¡ºåºä¸å½±å“ç­”æ¡ˆã€‚æ•…è€ƒè™‘ç¡®å®šç›®æ ‡ä½ç½®å’Œç§»åŠ¨åºåˆ—ã€‚è€ƒè™‘ç»å¯¹å€¼çš„å‡ ä½•æ„ä¹‰ï¼Œä¸å¦¨ä»¤ç›®æ ‡å­åºåˆ—ä¸­å…ƒç´ é›†ä¸­åˆ°è¢«é€‰ä¸­ä½ç½®çš„ä¸­é—´å…ƒç´ ï¼Œæ­¤æ—¶çš„ä»£ä»·å¯ä»¥è®¡ç®—ã€‚ç”¨ç‚¹äºŒè¿›åˆ¶æŠ€å·§å’Œåº“å‡½æ•°å¯ä»¥ <span class="math inline">\(O(1)\)</span> ç®—ä»£ä»·ã€‚</p>
<details>
<pre class="cpp"><code>#include &lt;bits/stdc++.h&gt;
int main() &#123;
#ifdef ONLINE_JUDGE
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr), std::cout.tie(nullptr);
#else
    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);
    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);
#endif
    int n, k;
    std::cin &gt;&gt; n &gt;&gt; k;
    int siz = 1 &lt;&lt; k;
    std::vector&lt;int&gt; a(n + 1), f(siz, 0x3f3f3f3f);
    auto out = [&amp;](int j) &#123;
        std::string s;
        for (int i = 0; i &lt; k; ++i)
            s += (&#39;0&#39; + ((j &gt;&gt; i) &amp; 1));
        return s.c_str();
    &#125;;
    f[0] = 0;
    for (int i = 1; i &lt;= n; ++i) &#123;
        std::cin &gt;&gt; a[i], --a[i];
        for (int j = siz - 1; j &gt;= 0; --j) &#123;
            if (!((j &gt;&gt; a[i]) &amp; 1))
                f[j | (1 &lt;&lt; a[i])] = std::min(f[j | (1 &lt;&lt; a[i])], f[j] + __builtin_popcount(j &amp; (~((1 &lt;&lt; a[i]) - 1))));
            f[j] += std::min(__builtin_popcount(j), k - __builtin_popcount(j));
        &#125;
    &#125;
    std::cout &lt;&lt; f[siz - 1] &lt;&lt; &#39;\n&#39;;
    return 0;
&#125;</code></pre>
</details>
<hr />
<h2 id="f---123-set">F - 123 Set</h2>
<p><a target="_blank" rel="noopener" href="https://atcoder.jp/contests/arc184/tasks/arc184_b" class="uri">https://atcoder.jp/contests/arc184/tasks/arc184_b</a></p>
<p>åšè¿‡ <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3226">é›†åˆé€‰æ•°</a>ï¼ˆè¿™ä¸ª trick è§è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œåº”è¯¥ä¸åªè¿™ä¸€é“ï¼Œä½†æˆ‘æƒ³ä¸èµ·æ¥äº†ï¼‰å¾ˆå®¹æ˜“æƒ³åˆ°ç”»ä¸€ä¸ªè¡¨æ ¼æˆ–è€… DAG å‡ºæ¥ï¼Œå…¶å®éƒ½èƒ½åš</p>
<p>å¯¹äºè¡¨æ ¼å·¦ä¸Šè§’å’Œ DAG çš„æºç‚¹ï¼Œè‚¯å®šæ˜¯ä¸€ä¸ª <span class="math inline">\(x\)</span>ï¼Œå…¶ä¸æ˜¯ <span class="math inline">\(2\)</span> æˆ– <span class="math inline">\(3\)</span> çš„å€æ•°ã€‚å¦‚æœç”»è¡¨ï¼Œæ¨ªä¹˜ 3 ç«–ä¹˜ 2ï¼Œè§‚å¯Ÿä¸€ä¸‹æ˜¯åŒ…å«äº† <span class="math inline">\(1\sim n\)</span> æ°å¥½ä¸€æ¬¡çš„å¾ˆå¤šä¸ªæ¨è¡¨ï¼ˆæ²¡ä»€ä¹ˆç”¨ï¼Œæä¸€å˜´è€Œå·²ï¼‰ï¼Œè€ƒè™‘è½¬åŒ–ç›®æ ‡ï¼Œå‘ç°æ˜¯ç”¨ä¸€ä¸ªä¸å¯æ—‹è½¬çš„å€’ L å½¢éª¨ç‰Œå¯å æ”¾åœ°é“ºæ»¡å¼‚å½¢è¡¨æ ¼ï¼Œå¯ä»¥è€ƒè™‘è½®å»“çº¿ DP</p>
<p>å…·ä½“åœ°ï¼Œç”¨ 1 æ¥è¡¨ç¤ºæ‹è§’å¤„ï¼Œ0 è¡¨ç¤ºå…¶ä»–ï¼Œå æ”¾çš„æ—¶å€™ 1 çš„ä¼˜å…ˆçº§æ¯” 0 é«˜ï¼Œç„¶åå°±å¯ä»¥åšäº†ã€‚ä»¥ 3 ä¸ºè¡Œï¼Œæ‚²è§‚ä¼°è®¡å•ä¸ªè¡¨æ ¼å¤§æ¦‚æœ‰ <span class="math inline">\(31\times 2^{19}\)</span> ä¸ªçŠ¶æ€ï¼Œè¿ç®—æ¬¡æ•°å·®ä¸å¤š <span class="math inline">\(31\times 19\times 2^{19}\)</span>ï¼›å†å‘ç°é•¿å¾—ä¸€æ¨¡ä¸€æ ·çš„è¡¨æ ¼è‚¯å®šæ–¹æ¡ˆæ•°æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæŠŠä»»æ„ä¸€ä¸ªè¡¨æ ¼å…¨éƒ¨é™¤ä»¥ <span class="math inline">\(x\)</span>ï¼Œå°±ä¼šå¾—åˆ° <span class="math inline">\(n=10^9\div x\)</span> æ—¶ <span class="math inline">\(1\)</span> ä¸ºå·¦ä¸Šè§’çš„æ¨è¡¨ï¼Œå°±æ˜¯è¯´é•¿ç›¸åªå’Œ <span class="math inline">\(10^9\div x\)</span> çš„å€¼æœ‰å…³ï¼Œå¯ä»¥æ•´é™¤åˆ†å— ğŸ˜± å¯é¢„è®¡çš„è·‘å¾—éå¸¸ä¸æ»¡ï¼Œå®è·µä¸‹æ¥æ˜¯å¯ä»¥è¿‡çš„ï¼ˆä½†æ˜¯å¾ˆæ…¢ï¼‰</p>
<details>
<pre class="cpp"><code>#include &lt;bits/stdc++.h&gt;
int main() &#123;
#ifdef ONLINE_JUDGE
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr), std::cout.tie(nullptr);
#else
    std::freopen(&quot;.in&quot;, &quot;r&quot;, stdin);
    std::freopen(&quot;.out&quot;, &quot;w&quot;, stdout);
#endif
    int n;
    std::cin &gt;&gt; n;
    auto calc = [&amp;](int r) &#123;
        return r - r / 2 - r / 3 + r / 6;
    &#125;;
    auto dp = [&amp;](int lim) &#123;
        if (lim == 1) &#123;
            // printf(&quot;lim = 1, ret 1&quot;);
            return 1;
        &#125;
        int n = 1, m = 1;
        for (int k = 1; k * 2 &lt;= lim; ++n, k *= 2);
        for (int k = 1; k * 3 &lt;= lim; ++m, k *= 3);
        int siz = 1 &lt;&lt; m;
        std::vector&lt;std::vector&lt;std::vector&lt;int&gt; &gt; &gt; f(2, std::vector&lt;std::vector&lt;int&gt; &gt; (2, std::vector&lt;int&gt; (siz))), p(n + 1, std::vector&lt;std::vector&lt;int&gt; &gt; (m));
        std::vector&lt;std::vector&lt;std::vector&lt;std::pair&lt;int, int&gt; &gt; &gt; &gt; t(2, std::vector&lt;std::vector&lt;std::pair&lt;int, int&gt; &gt; &gt; (2, std::vector&lt;std::pair&lt;int, int&gt; &gt; (siz))); // sb
        auto upd = [&amp;](int i, int k, int j, int v) &#123;
            if (t[i &amp; 1][k &amp; 1][j] != std::make_pair(i, k)) &#123;
                p[i][k].push_back(j);
                t[i &amp; 1][k &amp; 1][j] = &#123; i, k &#125;, f[i &amp; 1][k &amp; 1][j] = v;
            &#125;
            else
                f[i &amp; 1][k &amp; 1][j] = std::min(f[i &amp; 1][k &amp; 1][j], v);
            return;
        &#125;;
        auto chg = [&amp;](int i, int j, int v) &#123;
            return i ^ (((i &gt;&gt; j) &amp; 1) &lt;&lt; j) ^ (v &lt;&lt; j);
        &#125;;
        for (int i = 0; i &lt; siz; ++i) &#123;
            bool flag = 0;
            for (int j = 0; j &lt; m; ++j)
                if (((i &gt;&gt; j) &amp; 1) || (j &amp;&amp; ((i &gt;&gt; (j - 1)) &amp; 1)));
                else &#123;
                    flag = 1;
                    break;
                &#125;
            if (!flag)
                upd(1, m - 1, i, __builtin_popcount(i));
        &#125;
        for (int i = 2; i &lt;= n; i++) &#123;
            int m1 = 1;
            for (int x = (1 &lt;&lt; (i - 1)); x * 3ll &lt;= lim; ++m1, x *= 3);
            int siz1 = 1 &lt;&lt; m1;
            for (auto j : p[i - 1][m - 1]) &#123;
                if (j &amp; 1)
                    upd(i, 0, chg(j &amp; (siz1 - 1), 0, 0), f[(i - 1) &amp; 1][(m - 1) &amp; 1][j]);
                upd(i, 0, chg(j &amp; (siz1 - 1), 0, 1), f[(i - 1) &amp; 1][(m - 1) &amp; 1][j] + 1);
            &#125;
            m = m1, siz = siz1;
            for (int k = 0; k &lt; m - 1; ++k)
                for (auto j : p[i][k]) &#123;
                    if (((j &gt;&gt; k) &amp; 1) || ((j &gt;&gt; (k + 1)) &amp; 1))
                        upd(i, k + 1, chg(j, k + 1, 0), f[i &amp; 1][k &amp; 1][j]);
                    upd(i, k + 1, chg(j, k + 1, 1), f[i &amp; 1][k &amp; 1][j] + 1);
                &#125;
        &#125;
        int res = 0x3f3f3f3f;
        for (auto i : p[n][m - 1])
            res = std::min(res, f[n &amp; 1][(m - 1) &amp; 1][i]);
        return res;
    &#125;;
    int res = 0;
    for (int l = 1, r; l &lt;= n; l = r + 1) &#123;
        r = n / (n / l);
        if (calc(r) - calc(l - 1))
            res += (calc(r) - calc(l - 1)) * dp(n / l);
    &#125;
    std::cout &lt;&lt; res &lt;&lt; &#39;\n&#39;;
    return 0;
&#125;</code></pre>
</details>

			</div>
			<hr class="dotted">
			<div class="post footer">
				<div id="hitokoto">
					<h3 id="hitokoto-title">
						è¨€è®º
					</h3>
					<div id="hitokoto-content">
					</div>
					<div id="hitokoto-from">
					</div>
				</div>
				<div class="button flex">
					<div id="prev">
						
							<!-- åæ§½ï¼Œä¸ºå•¥è¿˜éœ€è¦åŠ  / -->
							<a href="/20250807/">
								<i class="fas fa-angle-double-left" style="margin-right: 10px;"></i>
								å­¦ä¹ ç¬”è®°ï¼šåˆ†æ‹†æ•°ä¸ Ferrers å›¾
							</a>
						
					</div>
					<div id="next">
						
							<a href="/20250803/">
								æ ‘ DP
								<i class="fas fa-angle-double-right" style="margin-left: 10px;"></i>
							</a>
						
					</div>
				</div>
				<div id="vcomments" class="text"></div>
<script>
	new Valine({
		el: '#vcomments',
		appId: 'OlmvQ0a2Zw7xo3no2bwabOzx-gzGzoHsz',
		appKey: 'TW6t8mFeGLmhPjWisvmllvvo',
		recordIP: true,
		enableQQ: true, 
		// [EDITED] ç›®å‰ Valine çš„ QQ è‡ªåŠ¨è·å–æ˜µç§°ä¼¼ä¹ä¸å¯ç”¨
		// è¯¥é—®é¢˜åœ¨ v1.5.3 ä¸­å·²ä¿®å¤
		pageSize: 10,
		requiredFields:
			
				['nick']
			,
		placeholder: "The world is but a little place after all...\nèƒ½å¤Ÿæ ¹æ®é‚®ç®±è·å–ä½ çš„ Gravatar å¤´åƒã€‚æ˜µç§°æ˜¯å¿…å¡«é¡¹ï¼Œé•¿åº¦éœ€ä¸ä½äº 3ã€‚",
		avatar: 'identicon',
		avatar_cdn: 'https://cravatar.cn/avatar/',
		emojiCDN: 'https://xsc062.netlify.app/em/', 
		emojiMaps: {
			
				"å¾®ç¬‘": "wx.gif",
			
				"é¾‡ç‰™": "cy.gif",
			
				"æµæ³ª": "ll.gif",
			
				"ç¬‘å“­": "xk.gif",
			
				"æµæ±—": "lh.gif",
			
				"æ“¦æ±—": "ch.gif",
			
				"äº²äº²": "qq.gif",
			
				"è‰²": "se.gif",
			
				"ç–‘é—®": "yiw.gif",
			
				"å‘å‘†": "fd.gif",
			
				"æ™•": "yun.gif",
			
				"é¼“æŒ": "gz.gif",
			
				"æ†¨ç¬‘": "hanx.gif",
			
				"å¿«å“­äº†": "kk.gif",
			
				"å¾—æ„": "dy.gif",
			
				"ç‹‚ç¬‘": "kx.gif",
			
				"å®³ç¾": "hx.gif",
			
				"å¦ˆå¦ˆç”Ÿçš„": "dz.gif",
			
				"ç³—å¤§äº†": "qd.gif",
			
				"åƒç“œ": "cg.gif",
			
				"ççœ¼": "zy.webp",
			
				"è¾£çœ¼ç›": "lyj.gif",
			
				"é…¸äº†": "nm.gif",
			
				"æ»š": "gun.webp",
			
				"æƒŠæ": "jk.gif",
			
				"å¹½çµ": "youl.gif",
			
				"æ— èŠ": "wul.gif",
			
				"åƒ": "eat.gif",
			
				"ä½ å¾ˆæ£’æ£’": "bb.gif",
			
				"èµ": "qiang.gif",
			
				"è¸©": "ruo.gif",
			
				"æ¡æ‰‹": "wsh.gif",
			
				"å‘æŠ–": "fad.gif",
			
				"æŒ¥æ‰‹": "hsh.gif",
			
				"ç£•å¤´": "kt.gif",
			
				"æ€„ç«": "oh.gif",
			
		},
	})
</script>
			</div>
			<script>setHitokoto();</script>
		</div> 
	</div>
</div>
    <!-- é¡µè„šå¼€å§‹ -->
<div id="footer" class="serif">
    Powered by
    <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
    &
    <a href="/about-this-theme">
        iwll
    </a>
    <p style="margin-top: 5px;">
        2021 - 2025
    </p>
    <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" id="CCTAG"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg"></a>
</div>
<!-- Valine ç›¸å…³é…ç½® -->
<script>
    const getValineDomTimer = setInterval(() => {
        // ä¸çŸ¥é“ä¸ºä»€ä¹ˆ æˆ‘ä»åŸåšå®¢ js æ–‡ä»¶ç²˜è¿‡æ¥çš„å‚æ•°æ˜¯
        // "#valine .vcards .vcard"
        // DEBUG äº†åŠå¤©æ‰å®šä½åˆ°è¿™ä¸ªé—®é¢˜ã€‚ã€‚ã€‚
        const vcards =
            document.querySelectorAll('#valine, .vcards, .vcard');
        if (vcards.length > 0) {
            let author = 'XSC062';
            for (let vcard of vcards) {
                const vnick_dom = vcard.querySelector('.vhead .vnick');
                if (vnick_dom != null) {
                    const vnick = vnick_dom.innerHTML;
                    if (vnick === author) {
                        vnick_dom.innerHTML =
                        `${vnick} <span id="rootitem" class="code">root</span>`
                    }
                }
            }
        }
        else {
            clearInterval(getValineDomTimer);
        }
    }, 2000);
    SetActiveItem();
    setDetailsSummary();
    setTitleAnchor();
    setEmptyToc();
    setCodeClassName();
</script>


<!-- js -->
<!-- æœç´¢åŠŸèƒ½ç›¸å…³é…ç½® -->

<script src="/js/search.js"></script>


<script src="/js/local-search.js"></script>

</script>
<!-- prism ç›¸å…³é…ç½® -->
<script type="text/javascript" src="/js/prism.js" defer></script>
<!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ -->
<script type="text/javascript" src="/js/clipboard.min.js"></script>
<script type="text/javascript" src="/js/clipboard-use.js"></script>
<!-- é¡µè„šç»“æŸ -->
</body>
</html>